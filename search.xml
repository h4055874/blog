<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>MySQL Myisam和Innodb的区别</title>
    <url>/MySQL/MySQL_id_02.html</url>
    <content><![CDATA[<p>1、myisam只支持表级锁 Innodb支持行级锁<br>2、myisam不支持事务 Innodb支持事务<br>3、myisam不支持外键 Innodb支持外键</p>
<a id="more"></a>

<p>4、myisam支持全文索引，Innodb不支持<br>5、myisam本身存储了表的总数据行，Innodb没有存储，查总行数myisam更快，如果加了查询条件两者就没有区别了</p>
<p>Myisam和Innodb究竟该怎么选择<br>数据库有外键吗？<br>需要事务支持吗？<br>需要全文索引吗？</p>
<p><strong>Innodb的行锁模式有以下几种：</strong>共享锁，排他锁，意向共享锁(表锁)，意向排他锁(表锁)，间隙锁。<br><code>注意：当语句没有使用索引，innodb不能确定操作的行，这个时候就使用的意向锁，也就是表锁</code></p>
<p><strong>聚簇索引和非聚簇索引**</strong></p>
<p>聚簇索引主要应用于Innodb<br>非聚簇索引主要应用于Myisam</p>
<p>表数据按照索引的顺序来存储的，也就是说索引项的顺序与表中记录的物理顺序一致。对于聚集索引，叶子结点即存储了真实的数据行，不再有另外单独的数据页。 在一张表上最多只能创建一个聚集索引，因为真实数据的物理顺序只能有一种。</p>
<p>非聚集索引。表数据存储顺序与索引顺序无关。对于非聚集索引，叶结点包含索引字段值及指向数据页数据行的逻辑指针，其行数量与数据表行数据量一致。</p>
<p>　</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Python常用查找算法</title>
    <url>/Python/Python_id_57.html</url>
    <content><![CDATA[<h3 id="查找算法-–-简介"><a href="#查找算法-–-简介" class="headerlink" title="查找算法 – 简介"></a>查找算法 – 简介</h3><p>　　查找（Searching）就是根据给定的某个值，在查找表中确定一个其关键字等于给定值的数据元素。查找表（Search Table）：由同一类型的数据元素构成的集合关键字</p>
<p>（Key）：数据元素中某个数据项的值，又称为键值主键（Primary Key）：可唯一的标识某个数据元素或记录的关键字</p>
<a id="more"></a>

<h5 id="查找表按照操作方式可分为："><a href="#查找表按照操作方式可分为：" class="headerlink" title="查找表按照操作方式可分为："></a><strong>查找表按照操作方式可分为：</strong></h5><p>​     1.静态查找表（Static Search Table）：只做查找操作的查找表。它的主要操作是：</p>
<p>​     ①查询某个“特定的”数据元素是否在表中     ②检索某个“特定的”数据元素和各种属性</p>
<p>​     2.动态查找表（Dynamic Search Table）：在查找中同时进行插入或删除等操作：</p>
<p>​     ①查找时插入数据     ②查找时删除数据</p>
<h3 id="顺序查找"><a href="#顺序查找" class="headerlink" title="顺序查找"></a>顺序查找</h3><p><strong>算法简介</strong></p>
<p>​    顺序查找又称为线性查找，是一种最简单的查找方法。适用于线性表的顺序存储结构和链式存储结构。该算法的时间复杂度为O(n)。</p>
<p><strong>基本思路</strong></p>
<p>​    从第一个元素m开始逐个与需要查找的元素x进行比较，当比较到元素值相同(即m=x)时返回元素m的下标，如果比较到最后都没有找到，则返回-1。</p>
<p><strong>优缺点</strong></p>
<p>  <strong>缺点：</strong>是当n 很大时，平均查找长度较大，效率低；<br>  <strong>优点：</strong>是对表中数据元素的存储没有要求。另外，对于线性链表，只能进行顺序查找。**</p>
<p><strong>算法实现</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 最基础的遍历无序列表的查找算法</span></span><br><span class="line"><span class="comment"># 时间复杂度O(n)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sequential_search</span><span class="params">(lis, key)</span>:</span></span><br><span class="line">	length = len(lis)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">		<span class="keyword">if</span> lis[i] == key:</span><br><span class="line">			<span class="keyword">return</span> i</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	LIST = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">123</span>, <span class="number">22</span>, <span class="number">54</span>, <span class="number">7</span>, <span class="number">99</span>, <span class="number">300</span>, <span class="number">222</span>]</span><br><span class="line">	result = sequential_search(LIST, <span class="number">123</span>)</span><br><span class="line">	print(result)</span><br></pre></td></tr></table></figure></div>

<h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><p><strong>算法简介</strong></p>
<p>　　二分查找（Binary Search），是一种在有序数组中查找某一特定元素的查找算法。查找过程从数组的中间元素开始，如果中间元素正好是要查找的元素，则查找过程结束；</p>
<p>如果某一特定元素大于或者小于中间元素，则在数组大于或小于中间元素的那一半中查找，而且跟开始一样从中间元素开始比较。如果在某一步骤数组为空，则代表找不到。这</p>
<p>种查找算法每一次比较都使查找范围缩小一半。</p>
<p><strong>算法描述</strong></p>
<p>　　给予一个包含n个带值元素的数组A</p>
<p>　　1、令 L为0 ， R为 n-1 ；</p>
<p>　　2、 如果L&gt;R，则搜索以失败告终；</p>
<p>　　3、 令 m (中间值元素)为 ⌊(L+R)/2⌋；</p>
<p>　　4、 如果 Am&lt;T，另L为m + 1 并回到步骤二；</p>
<p>　　5、 如果 Am&gt;T，令 R为 m - 1 并回到步骤二；</p>
<p><strong>复杂度分析</strong></p>
<p><strong>时间复杂度：折半搜索每次把搜索区域减少一半，时间复杂度为 \</strong>O*<em>*</em>(logn)**<br>**  <strong>空间复杂度：**</strong>O(1)**</p>
<p><strong>算法实现</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 针对有序查找表的二分查找算法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(lis, key)</span>:</span></span><br><span class="line">	low = <span class="number">0</span></span><br><span class="line">	high = len(lis) - <span class="number">1</span></span><br><span class="line">	time = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> low &lt; high:</span><br><span class="line">		time += <span class="number">1</span></span><br><span class="line">		mid = int((low + high) / <span class="number">2</span>)</span><br><span class="line">		<span class="keyword">if</span> key &lt; lis[mid]:</span><br><span class="line">			high = mid - <span class="number">1</span></span><br><span class="line">		<span class="keyword">elif</span> key &gt; lis[mid]:</span><br><span class="line">			low = mid + <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			 <span class="comment"># 打印折半的次数</span></span><br><span class="line">			print(<span class="string">"times: %s"</span> % time)</span><br><span class="line">			<span class="keyword">return</span> mid</span><br><span class="line">	print(<span class="string">"times: %s"</span> % time)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	LIST = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">54</span>, <span class="number">99</span>, <span class="number">123</span>, <span class="number">200</span>, <span class="number">222</span>, <span class="number">444</span>]</span><br><span class="line">	result = binary_search(LIST, <span class="number">99</span>)</span><br><span class="line">	print(result)</span><br></pre></td></tr></table></figure></div>

<h3 id="插值查找"><a href="#插值查找" class="headerlink" title="插值查找"></a>插值查找</h3><p><strong>算法简介</strong></p>
<p>　　插值查找是根据要查找的关键字key与查找表中最大最小记录的关键字比较后的 查找方法，其核心就在于插值的计算公式 (key-a[low])/(a[high]-a[low])*(high-low)。时</p>
<p>间复杂度o(logn)但对于表长较大而关键字分布比较均匀的查找表来说，效率较高。</p>
<p><strong>算法思想</strong></p>
<p>　　基于二分查找算法，将查找点的选择改进为自适应选择，可以提高查找效率。当然，差值查找也属于有序查找。   注：对于表长较大，而关键字分布又比较均匀的查找表来</p>
<p>说，插值查找算法的平均性能比折半查找要好的多。反之，数组中如果分布非常不均匀，那么插值查找未必是很合适的选择。</p>
<p><strong>复杂度分析</strong></p>
<p>　　时间复杂性：如果元素均匀分布，则O（log log n）），在最坏的情况下可能需要 O（n）。<br>　　空间复杂度：O（1）。</p>
<p><strong>算法实现</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 插值查找算法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(lis, key)</span>:</span></span><br><span class="line">	low = <span class="number">0</span></span><br><span class="line">	high = len(lis) - <span class="number">1</span></span><br><span class="line">	time = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> low &lt; high:</span><br><span class="line">		time += <span class="number">1</span></span><br><span class="line">		<span class="comment"># 计算mid值是插值算法的核心代码</span></span><br><span class="line">		mid = low + int((high - low) * (key - lis[low])/(lis[high] - lis[low]))</span><br><span class="line">		print(<span class="string">"mid=%s, low=%s, high=%s"</span> % (mid, low, high))</span><br><span class="line">		<span class="keyword">if</span> key &lt; lis[mid]:</span><br><span class="line">			high = mid - <span class="number">1</span></span><br><span class="line">		<span class="keyword">elif</span> key &gt; lis[mid]:</span><br><span class="line">			low = mid + <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="comment"># 打印查找的次数</span></span><br><span class="line">			print(<span class="string">"times: %s"</span> % time)</span><br><span class="line">			<span class="keyword">return</span> mid</span><br><span class="line">	print(<span class="string">"times: %s"</span> % time)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	LIST = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">54</span>, <span class="number">99</span>, <span class="number">123</span>, <span class="number">200</span>, <span class="number">222</span>, <span class="number">444</span>]</span><br><span class="line">	result = binary_search(LIST, <span class="number">444</span>)</span><br><span class="line">	print(result)</span><br></pre></td></tr></table></figure></div>

<h3 id="斐波那契查找"><a href="#斐波那契查找" class="headerlink" title="斐波那契查找"></a>斐波那契查找</h3><p><strong>算法简介</strong></p>
<p>　　斐波那契数列，又称黄金分割数列，指的是这样一个数列：1、1、2、3、5、8、13、21、····，在数学上，斐波那契被递归方法如下定义：F(1)=1，F(2)=1，F(n)=f(n-</p>
<p>1)+F(n-2) （n&gt;=2）。该数列越往后相邻的两个数的比值越趋向于黄金比例值（0.618）。</p>
<p><strong>算法描述</strong></p>
<p>　　斐波那契查找就是在二分查找的基础上根据斐波那契数列进行分割的。在斐波那契数列找一个等于略大于查找表中元素个数的数F[n]，将原查找表扩展为长度为F<a href="如果要补充元素，则补充重复最后一个元素，直到满足F[n]个元素">n</a>，完成后</p>
<p>进行斐波那契分割，即F[n]个元素分割为前半部分F[n-1]个元素，后半部分F[n-2]个元素，找出要查找的元素在那一部分并递归，直到找到。</p>
<p><strong>复杂度分析</strong></p>
<p>最坏情况下，时间复杂度为O(log2n)，且其期望复杂度也为O(log2n)。</p>
<p><strong>算法实现</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 斐波那契查找算法</span></span><br><span class="line"><span class="comment"># 时间复杂度O(log(n))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci_search</span><span class="params">(lis, key)</span>:</span></span><br><span class="line">	<span class="comment"># 需要一个现成的斐波那契列表。其最大元素的值必须超过查找表中元素个数的数值。</span></span><br><span class="line">	F = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">34</span>, <span class="number">55</span>, <span class="number">89</span>, <span class="number">144</span>, <span class="number">233</span>, <span class="number">377</span>, <span class="number">610</span>, <span class="number">987</span>, <span class="number">1597</span>, <span class="number">2584</span>, <span class="number">4181</span>, <span class="number">6765</span>,<span class="number">10946</span>, <span class="number">17711</span>, <span class="number">28657</span>, <span class="number">46368</span>]</span><br><span class="line">	low = <span class="number">0</span></span><br><span class="line">	high = len(lis) - <span class="number">1</span></span><br><span class="line">   </span><br><span class="line">	<span class="comment"># 为了使得查找表满足斐波那契特性，在表的最后添加几个同样的值</span></span><br><span class="line">	<span class="comment"># 这个值是原查找表的最后那个元素的值</span></span><br><span class="line">	<span class="comment"># 添加的个数由F[k]-1-high决定</span></span><br><span class="line">	k = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> high &gt; F[k]<span class="number">-1</span>:</span><br><span class="line">		k += <span class="number">1</span></span><br><span class="line">	print(k)</span><br><span class="line">	i = high</span><br><span class="line">	<span class="keyword">while</span> F[k]<span class="number">-1</span> &gt; i:</span><br><span class="line">		lis.append(lis[high])</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	print(lis)</span><br><span class="line">   </span><br><span class="line">	<span class="comment"># 算法主逻辑。time用于展示循环的次数。</span></span><br><span class="line">	time = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> low &lt;= high:</span><br><span class="line">		time += <span class="number">1</span></span><br><span class="line">		<span class="comment"># 为了防止F列表下标溢出，设置if和else</span></span><br><span class="line">		<span class="keyword">if</span> k &lt; <span class="number">2</span>:</span><br><span class="line">			mid = low</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			mid = low + F[k<span class="number">-1</span>]<span class="number">-1</span></span><br><span class="line">     </span><br><span class="line">		print(<span class="string">"low=%s, mid=%s, high=%s"</span> % (low, mid, high))</span><br><span class="line">		<span class="keyword">if</span> key &lt; lis[mid]:</span><br><span class="line">			high = mid - <span class="number">1</span></span><br><span class="line">			k -= <span class="number">1</span></span><br><span class="line">		<span class="keyword">elif</span> key &gt; lis[mid]:</span><br><span class="line">			low = mid + <span class="number">1</span></span><br><span class="line">			k -= <span class="number">2</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">if</span> mid &lt;= high:</span><br><span class="line">				<span class="comment"># 打印查找的次数</span></span><br><span class="line">				print(<span class="string">"times: %s"</span> % time)</span><br><span class="line">				<span class="keyword">return</span> mid</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				print(<span class="string">"times: %s"</span> % time)</span><br><span class="line">				<span class="keyword">return</span> high</span><br><span class="line">	print(<span class="string">"times: %s"</span> % time)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	LIST = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">54</span>, <span class="number">99</span>, <span class="number">123</span>, <span class="number">200</span>, <span class="number">222</span>, <span class="number">444</span>]</span><br><span class="line">	result = fibonacci_search(LIST, <span class="number">444</span>)</span><br><span class="line">	print(result)</span><br></pre></td></tr></table></figure></div>

<h3 id="树表查找"><a href="#树表查找" class="headerlink" title="树表查找"></a>树表查找</h3><h4 id="1、二叉树查找算法。"><a href="#1、二叉树查找算法。" class="headerlink" title="1、二叉树查找算法。"></a>1、二叉树查找算法。</h4><p><strong>算法简介</strong></p>
<p>　　二叉查找树是先对待查找的数据进行生成树，确保树的左分支的值小于右分支的值，然后在就行和每个节点的父节点比较大小，查找最适合的范围。 这个算法的查找效率很</p>
<p>高，但是如果使用这种查找方法要首先创建树。</p>
<p><strong>算法思想</strong></p>
<p>　　<strong>二叉查找树（BinarySearch Tree）或者是一棵空树，或者是具有下列性质的二叉树：</strong></p>
<p>　　　　1）若任意节点的左子树不空，则左子树上所有结点的值均小于它的根结点的值；</p>
<p>　　　　2）若任意节点的右子树不空，则右子树上所有结点的值均大于它的根结点的值；</p>
<p>3）任意节点的左、右子树也分别为二叉查找树。</p>
<p><strong>二叉查找树性质：</strong></p>
<p>　　对二叉查找树进行中序遍历，即可得到有序的数列。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/search/01.png">

<p><strong>复杂度分析</strong></p>
<p>　　它和二分查找一样，插入和查找的时间复杂度均为O(logn)，但是在最坏的情况下仍然会有O(n)的时间复杂度。原因在于插入和删除元素的时候，树没有保持平衡。</p>
<p><strong>算法实现</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 二叉树查找 Python实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BSTNode</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    定义一个二叉树节点类。</span></span><br><span class="line"><span class="string">    以讨论算法为主，忽略了一些诸如对数据类型进行判断的问题。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data, left=None, right=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        初始化</span></span><br><span class="line"><span class="string">        :param data: 节点储存的数据</span></span><br><span class="line"><span class="string">        :param left: 节点左子树</span></span><br><span class="line"><span class="string">        :param right: 节点右子树</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.data = data</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinarySortTree</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    基于BSTNode类的二叉查找树。维护一个根节点的指针。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._root = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._root <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        关键码检索</span></span><br><span class="line"><span class="string">        :param key: 关键码</span></span><br><span class="line"><span class="string">        :return: 查询节点或None</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        bt = self._root</span><br><span class="line">        <span class="keyword">while</span> bt:</span><br><span class="line">            entry = bt.data</span><br><span class="line">            <span class="keyword">if</span> key &lt; entry:</span><br><span class="line">                bt = bt.left</span><br><span class="line">            <span class="keyword">elif</span> key &gt; entry:</span><br><span class="line">                bt = bt.right</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> entry</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        插入操作</span></span><br><span class="line"><span class="string">        :param key:关键码 </span></span><br><span class="line"><span class="string">        :return: 布尔值</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        bt = self._root</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> bt:</span><br><span class="line">            self._root = BSTNode(key)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            entry = bt.data</span><br><span class="line">            <span class="keyword">if</span> key &lt; entry:</span><br><span class="line">                <span class="keyword">if</span> bt.left <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    bt.left = BSTNode(key)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                bt = bt.left</span><br><span class="line">            <span class="keyword">elif</span> key &gt; entry:</span><br><span class="line">                <span class="keyword">if</span> bt.right <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    bt.right = BSTNode(key)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                bt = bt.right</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                bt.data = key</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        二叉查找树最复杂的方法</span></span><br><span class="line"><span class="string">        :param key: 关键码</span></span><br><span class="line"><span class="string">        :return: 布尔值</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        p, q = <span class="literal">None</span>, self._root     <span class="comment"># 维持p为q的父节点，用于后面的链接操作</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> q:</span><br><span class="line">            print(<span class="string">"空树！"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">while</span> q <span class="keyword">and</span> q.data != key:</span><br><span class="line">            p = q</span><br><span class="line">            <span class="keyword">if</span> key &lt; q.data:</span><br><span class="line">                q = q.left</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                q = q.right</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> q:               <span class="comment"># 当树中没有关键码key时，结束退出。</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># 上面已将找到了要删除的节点，用q引用。而p则是q的父节点或者None（q为根节点时）。</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> q.left:</span><br><span class="line">            <span class="keyword">if</span> p <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                self._root = q.right</span><br><span class="line">            <span class="keyword">elif</span> q <span class="keyword">is</span> p.left:</span><br><span class="line">                p.left = q.right</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                p.right = q.right</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># 查找节点q的左子树的最右节点，将q的右子树链接为该节点的右子树</span></span><br><span class="line">        <span class="comment"># 该方法可能会增大树的深度，效率并不算高。可以设计其它的方法。</span></span><br><span class="line">        r = q.left</span><br><span class="line">        <span class="keyword">while</span> r.right:</span><br><span class="line">            r = r.right</span><br><span class="line">        r.right = q.right</span><br><span class="line">        <span class="keyword">if</span> p <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self._root = q.left</span><br><span class="line">        <span class="keyword">elif</span> p.left <span class="keyword">is</span> q:</span><br><span class="line">            p.left = q.left</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p.right = q.left</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        实现二叉树的中序遍历算法,</span></span><br><span class="line"><span class="string">        展示我们创建的二叉查找树.</span></span><br><span class="line"><span class="string">        直接使用python内置的列表作为一个栈。</span></span><br><span class="line"><span class="string">        :return: data</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        stack = []</span><br><span class="line">        node = self._root</span><br><span class="line">        <span class="keyword">while</span> node <span class="keyword">or</span> stack:</span><br><span class="line">            <span class="keyword">while</span> node:</span><br><span class="line">                stack.append(node)</span><br><span class="line">                node = node.left</span><br><span class="line">            node = stack.pop()</span><br><span class="line">            <span class="keyword">yield</span> node.data</span><br><span class="line">            node = node.right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    lis = [<span class="number">62</span>, <span class="number">58</span>, <span class="number">88</span>, <span class="number">48</span>, <span class="number">73</span>, <span class="number">99</span>, <span class="number">35</span>, <span class="number">51</span>, <span class="number">93</span>, <span class="number">29</span>, <span class="number">37</span>, <span class="number">49</span>, <span class="number">56</span>, <span class="number">36</span>, <span class="number">50</span>]</span><br><span class="line">    bs_tree = BinarySortTree()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(lis)):</span><br><span class="line">        bs_tree.insert(lis[i])</span><br><span class="line">    <span class="comment"># bs_tree.insert(100)</span></span><br><span class="line">    bs_tree.delete(<span class="number">58</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> bs_tree:</span><br><span class="line">        print(i, end=<span class="string">" "</span>)</span><br><span class="line">    <span class="comment"># print("\n", bs_tree.search(4))</span></span><br></pre></td></tr></table></figure></div>

<h4 id="2、平衡查找树之2-3查找树（2-3-Tree）"><a href="#2、平衡查找树之2-3查找树（2-3-Tree）" class="headerlink" title="2、平衡查找树之2-3查找树（2-3 Tree）"></a>2、平衡查找树之2-3查找树（2-3 Tree）</h4><p><strong>2-3查找树定义</strong></p>
<p>　　和二叉树不一样，2-3树运行每个节点保存1个或者两个的值。对于普通的2节点(2-node)，他保存1个key和左右两个自己点。对应3节点(3-node)，保存两个Key，2-3查找树</p>
<p>的定义如下：<br>　　1）要么为空，要么：<br>　　2）对于2节点，该节点保存一个key及对应value，以及两个指向左右节点的节点，左节点也是一个2-3节点，所有的值都比key要小，右节点也是一个2-3节点，所有的值比</p>
<p>　　　　key要大。<br>　　3）对于3节点，该节点保存两个key及对应value，以及三个指向左中右的节点。左节点也是一个2-3节点，所有的值均比两个key中的最小的key还要小；中间节点也是一个2-</p>
<p>　　　　3节点，中间节点的key值在两个跟节点key值之间；右节点也是一个2-3节点，节点的所有key值比两个key中的最大的key还要大。</p>
<p><strong>2-3查找树的性质</strong></p>
<p>　　1）如果中序遍历2-3查找树，就可以得到排好序的序列；<br>　　2）在一个完全平衡的2-3查找树中，根节点到每一个为空节点的距离都相同。（这也是平衡树中“平衡”一词的概念，根节点到叶节点的最长距离对应于查找算法的最坏情</p>
<p>　　　　况，而平衡树中根节点到叶节点的距离都一样，最坏情况也具有对数复杂度。） </p>
<p><strong>2-3树的查找效率与树的高度是息息相关的。</strong></p>
<p>　　距离来说，对于1百万个节点的2-3树，树的高度为12-20之间，对于10亿个节点的2-3树，树的高度为18-30之间。<br>　　对于插入来说，只需要常数次操作即可完成，因为他只需要修改与该节点关联的节点即可，不需要检查其他节点，所以效率和查找类似。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/search/02.png">

<p><strong>实现算法</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,key)</span>:</span></span><br><span class="line">        self.key1=key</span><br><span class="line">        self.key2=<span class="literal">None</span></span><br><span class="line">        self.left=<span class="literal">None</span></span><br><span class="line">        self.middle=<span class="literal">None</span></span><br><span class="line">        self.right=<span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isLeaf</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.left <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> self.middle <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> self.right <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isFull</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.key2 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasKey</span><span class="params">(self,key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (self.key1==key) <span class="keyword">or</span> (self.key2 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> self.key2==key):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getChild</span><span class="params">(self,key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key&lt;self.key1:</span><br><span class="line">            <span class="keyword">return</span> self.left</span><br><span class="line">        <span class="keyword">elif</span> self.key2 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self.middle</span><br><span class="line">        <span class="keyword">elif</span> key&lt;self.key2:</span><br><span class="line">            <span class="keyword">return</span> self.middle</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.right</span><br><span class="line"><span class="class"><span class="keyword">class</span> 2<span class="title">_3_Tree</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.root=<span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.root <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self._get(self.root,key)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get</span><span class="params">(self,node,key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">elif</span> node.hasKey(key):</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            child=node.getChild(key)</span><br><span class="line">            <span class="keyword">return</span> self._get(child,key)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self,key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.root <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.root=Node(key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pKey,pRef=self._put(self.root,key)</span><br><span class="line">            <span class="keyword">if</span> pKey <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                newnode=Node(pKey)</span><br><span class="line">                newnode.left=self.root</span><br><span class="line">                newnode.middle=pRef</span><br><span class="line">                self.root=newnode</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_put</span><span class="params">(self,node,key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> node.hasKey(key):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>,<span class="literal">None</span></span><br><span class="line">        <span class="keyword">elif</span> node.isLeaf():</span><br><span class="line">            <span class="keyword">return</span> self._addtoNode(node,key,<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            child=node.getChild(key)</span><br><span class="line">            pKey,pRef=self._put(child,key)</span><br><span class="line">            <span class="keyword">if</span> pKey <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span>,<span class="literal">None</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> self._addtoNode(node,pKey,pRef)</span><br><span class="line">             </span><br><span class="line">         </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_addtoNode</span><span class="params">(self,node,key,pRef)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> node.isFull():</span><br><span class="line">            <span class="keyword">return</span> self._splitNode(node,key,pRef)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> key&lt;node.key1:</span><br><span class="line">                node.key2=node.key1</span><br><span class="line">                node.key1=key</span><br><span class="line">                <span class="keyword">if</span> pRef <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    node.right=node.middle</span><br><span class="line">                    node.middle=pRef</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                node.key2=key</span><br><span class="line">                <span class="keyword">if</span> pRef <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    node.right=Pref</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>,<span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_splitNode</span><span class="params">(self,node,key,pRef)</span>:</span></span><br><span class="line">        newnode=Node(<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> key&lt;node.key1:</span><br><span class="line">            pKey=node.key1</span><br><span class="line">            node.key1=key</span><br><span class="line">            newnode.key1=node.key2</span><br><span class="line">            <span class="keyword">if</span> pRef <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                newnode.left=node.middle</span><br><span class="line">                newnode.middle=node.right</span><br><span class="line">                node.middle=pRef</span><br><span class="line">        <span class="keyword">elif</span> key&lt;node.key2:</span><br><span class="line">            pKey=key</span><br><span class="line">            newnode.key1=node.key2</span><br><span class="line">            <span class="keyword">if</span> pRef <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                newnode.left=Pref</span><br><span class="line">                newnode.middle=node.right</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pKey=node.key2</span><br><span class="line">            newnode.key1=key</span><br><span class="line">            <span class="keyword">if</span> pRef <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                newnode.left=node.right</span><br><span class="line">                newnode.middle=pRef</span><br><span class="line">        node.key2=<span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> pKey,newnode</span><br></pre></td></tr></table></figure></div>

<h4 id="3、平衡查找树之红黑树（Red-Black-Tree）"><a href="#3、平衡查找树之红黑树（Red-Black-Tree）" class="headerlink" title="3、平衡查找树之红黑树（Red-Black Tree）"></a>3、平衡查找树之红黑树（Red-Black Tree）</h4><p><strong>红黑树的定义</strong></p>
<p>　　<strong>红黑树是一种具有红色和黑色链接的平衡查找树，同时满足：</strong><br>　　　　１、红色节点向左倾斜 ；<br>　　　　2、一个节点不可能有两个红色链接；<br>　　　　3、整个树完全黑色平衡，即从根节点到所以叶子结点的路径上，黑色链接的个数都相同。</p>
<p><strong>红黑树的性质</strong></p>
<p>整个树完全黑色平衡，即从根节点到所以叶子结点的路径上，黑色链接的个数都相同（2-3树的第2）性质，从根节点到叶子节点的距离都相等）。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/search/03.png">

<p><strong>复杂度分析</strong></p>
<p>　　最坏的情况就是，红黑树中除了最左侧路径全部是由3-node节点组成，即红黑相间的路径长度是全黑路径长度的2倍。<br>　　下图是一个典型的红黑树，从中可以看到最长的路径(红黑相间的路径)是最短路径的2倍：</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/search/04.png">

<p><strong>算法实现</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#红黑树</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line">RED = <span class="string">'red'</span></span><br><span class="line">BLACK = <span class="string">'black'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RBT</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">       <span class="comment"># self.items = []</span></span><br><span class="line">        self.root = <span class="literal">None</span></span><br><span class="line">        self.zlist = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">LEFT_ROTATE</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="comment"># x是一个RBTnode</span></span><br><span class="line">        y = x.right</span><br><span class="line">        <span class="keyword">if</span> y <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 右节点为空，不旋转</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            beta = y.left</span><br><span class="line">            x.right = beta</span><br><span class="line">            <span class="keyword">if</span> beta <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                beta.parent = x</span><br><span class="line"></span><br><span class="line">            p = x.parent</span><br><span class="line">            y.parent = p</span><br><span class="line">            <span class="keyword">if</span> p <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="comment"># x原来是root</span></span><br><span class="line">                self.root = y</span><br><span class="line">            <span class="keyword">elif</span> x == p.left:</span><br><span class="line">                p.left = y</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                p.right = y</span><br><span class="line">            y.left = x</span><br><span class="line">            x.parent = y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">RIGHT_ROTATE</span><span class="params">(self, y)</span>:</span></span><br><span class="line">        <span class="comment"># y是一个节点</span></span><br><span class="line">        x = y.left</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 右节点为空，不旋转</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            beta = x.right</span><br><span class="line">            y.left = beta</span><br><span class="line">            <span class="keyword">if</span> beta <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                beta.parent = y</span><br><span class="line"></span><br><span class="line">            p = y.parent</span><br><span class="line">            x.parent = p</span><br><span class="line">            <span class="keyword">if</span> p <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="comment"># y原来是root</span></span><br><span class="line">                self.root = x</span><br><span class="line">            <span class="keyword">elif</span> y == p.left:</span><br><span class="line">                p.left = x</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                p.right = x</span><br><span class="line">            x.right = y</span><br><span class="line">            y.parent = x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">INSERT</span><span class="params">(self, val)</span>:</span></span><br><span class="line"></span><br><span class="line">        z = RBTnode(val)</span><br><span class="line">        y = <span class="literal">None</span></span><br><span class="line">        x = self.root</span><br><span class="line">        <span class="keyword">while</span> x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            y = x</span><br><span class="line">            <span class="keyword">if</span> z.val &lt; x.val:</span><br><span class="line">                x = x.left</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x = x.right</span><br><span class="line"></span><br><span class="line">        z.PAINT(RED)</span><br><span class="line">        z.parent = y</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> y <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 插入z之前为空的RBT</span></span><br><span class="line">            self.root = z</span><br><span class="line">            self.INSERT_FIXUP(z)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> z.val &lt; y.val:</span><br><span class="line">            y.left = z</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y.right = z</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> y.color == RED:</span><br><span class="line">            <span class="comment"># z的父节点y为红色，需要fixup。</span></span><br><span class="line">            <span class="comment"># 如果z的父节点y为黑色，则不用调整</span></span><br><span class="line">            self.INSERT_FIXUP(z)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">INSERT_FIXUP</span><span class="params">(self, z)</span>:</span></span><br><span class="line">        <span class="comment"># case 1:z为root节点</span></span><br><span class="line">        <span class="keyword">if</span> z.parent <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            z.PAINT(BLACK)</span><br><span class="line">            self.root = z</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># case 2:z的父节点为黑色</span></span><br><span class="line">        <span class="keyword">if</span> z.parent.color == BLACK:</span><br><span class="line">            <span class="comment"># 包括了z处于第二层的情况</span></span><br><span class="line">            <span class="comment"># 这里感觉不必要啊。。似乎z.parent为黑色则不会进入fixup阶段</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 下面的几种情况，都是z.parent.color == RED:</span></span><br><span class="line">        <span class="comment"># 节点y为z的uncle</span></span><br><span class="line">        p = z.parent</span><br><span class="line">        g = p.parent  <span class="comment"># g为x的grandpa</span></span><br><span class="line">        <span class="keyword">if</span> g <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            <span class="comment">#   return 这里不能return的。。。</span></span><br><span class="line">        <span class="keyword">if</span> g.right == p:</span><br><span class="line">            y = g.left</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y = g.right</span><br><span class="line"></span><br><span class="line">        <span class="comment"># case 3-0:z没有叔叔。即：y为NIL节点</span></span><br><span class="line">        <span class="comment"># 注意，此时z的父节点一定是RED</span></span><br><span class="line">        <span class="keyword">if</span> y == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> z == p.right <span class="keyword">and</span> p == p.parent.left:</span><br><span class="line">                <span class="comment"># 3-0-0:z为右儿子,且p为左儿子，则把p左旋</span></span><br><span class="line">                <span class="comment"># 转化为3-0-1或3-0-2的情况</span></span><br><span class="line">                self.LEFT_ROTATE(p)</span><br><span class="line">                p, z = z, p</span><br><span class="line">                g = p.parent</span><br><span class="line">            <span class="keyword">elif</span> z == p.left <span class="keyword">and</span> p == p.parent.right:</span><br><span class="line">                self.RIGHT_ROTATE(p)</span><br><span class="line">                p, z = z, p</span><br><span class="line"></span><br><span class="line">            g.PAINT(RED)</span><br><span class="line">            p.PAINT(BLACK)</span><br><span class="line">            <span class="keyword">if</span> p == g.left:</span><br><span class="line">                <span class="comment"># 3-0-1:p为g的左儿子</span></span><br><span class="line">                self.RIGHT_ROTATE(g)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 3-0-2:p为g的右儿子</span></span><br><span class="line">                self.LEFT_ROTATE(g)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># case 3-1:z有黑叔</span></span><br><span class="line">        <span class="keyword">elif</span> y.color == BLACK:</span><br><span class="line">            <span class="keyword">if</span> p.right == z <span class="keyword">and</span> p.parent.left == p:</span><br><span class="line">                <span class="comment"># 3-1-0:z为右儿子,且p为左儿子,则左旋p</span></span><br><span class="line">                <span class="comment"># 转化为3-1-1或3-1-2</span></span><br><span class="line">                self.LEFT_ROTATE(p)</span><br><span class="line">                p, z = z, p</span><br><span class="line">            <span class="keyword">elif</span> p.left == z <span class="keyword">and</span> p.parent.right == p:</span><br><span class="line">                self.RIGHT_ROTATE(p)</span><br><span class="line">                p, z = z, p</span><br><span class="line"></span><br><span class="line">            p = z.parent</span><br><span class="line">            g = p.parent</span><br><span class="line"></span><br><span class="line">            p.PAINT(BLACK)</span><br><span class="line">            g.PAINT(RED)</span><br><span class="line">            <span class="keyword">if</span> p == g.left:</span><br><span class="line">                <span class="comment"># 3-1-1:p为g的左儿子，则右旋g</span></span><br><span class="line">                self.RIGHT_ROTATE(g)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 3-1-2:p为g的右儿子，则左旋g</span></span><br><span class="line">                self.LEFT_ROTATE(g)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># case 3-2:z有红叔</span></span><br><span class="line">        <span class="comment"># 则涂黑父和叔，涂红爷，g作为新的z，递归调用</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y.PAINT(BLACK)</span><br><span class="line">            p.PAINT(BLACK)</span><br><span class="line">            g.PAINT(RED)</span><br><span class="line">            new_z = g</span><br><span class="line">            self.INSERT_FIXUP(new_z)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DELETE</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        curNode = self.root</span><br><span class="line">        <span class="keyword">while</span> curNode <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> val &lt; curNode.val:</span><br><span class="line">                curNode = curNode.left</span><br><span class="line">            <span class="keyword">elif</span> val &gt; curNode.val:</span><br><span class="line">                curNode = curNode.right</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 找到了值为val的元素,正式开始删除</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> curNode.left <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> curNode.right <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="comment"># case1:curNode为叶子节点：直接删除即可</span></span><br><span class="line">                    <span class="keyword">if</span> curNode == self.root:</span><br><span class="line">                        self.root = <span class="literal">None</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        p = curNode.parent</span><br><span class="line">                        <span class="keyword">if</span> curNode == p.left:</span><br><span class="line">                            p.left = <span class="literal">None</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            p.right = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> curNode.left <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> curNode.right <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    sucNode = self.SUCCESOR(curNode)</span><br><span class="line">                    curNode.val, sucNode.val  = sucNode.val, curNode.val</span><br><span class="line">                    self.DELETE(sucNode.val)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    p = curNode.parent</span><br><span class="line">                    <span class="keyword">if</span> curNode.left <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                        x = curNode.right</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        x = curNode.left</span><br><span class="line">                    <span class="keyword">if</span> curNode == p.left:</span><br><span class="line">                        p.left = x</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        p.right = x</span><br><span class="line">                    x.parent = p</span><br><span class="line">                    <span class="keyword">if</span> curNode.color == BLACK:</span><br><span class="line">                        self.DELETE_FIXUP(x)</span><br><span class="line"></span><br><span class="line">                curNode = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DELETE_FIXUP</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        p = x.parent</span><br><span class="line">        <span class="comment"># w:x的兄弟结点</span></span><br><span class="line">        <span class="keyword">if</span> x == p.left:</span><br><span class="line">            w = x.right</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            w = x.left</span><br><span class="line"></span><br><span class="line">        <span class="comment"># case1:x的兄弟w是红色的</span></span><br><span class="line">        <span class="keyword">if</span> w.color == RED:</span><br><span class="line">            p.PAINT(RED)</span><br><span class="line">            w.PAINT(BLACK)</span><br><span class="line">            <span class="keyword">if</span> w == p.right:</span><br><span class="line">                self.LEFT_ROTATE(p)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.RIGHT_ROTATE(p)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> w.color == BLACK:</span><br><span class="line">            <span class="comment"># case2:x的兄弟w是黑色的，而且w的两个孩子都是黑色的</span></span><br><span class="line">            <span class="keyword">if</span> w.left.color == BLACK <span class="keyword">and</span> w.right.color == BLACK:</span><br><span class="line">                w.PAINT(RED)</span><br><span class="line">                <span class="keyword">if</span> p.color == BLACK:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    p.color = BLACK</span><br><span class="line">                    self.DELETE_FIXUP(p)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># case3:x的兄弟w是黑色的，而且w的左儿子是红色的，右儿子是黑色的</span></span><br><span class="line">            <span class="keyword">if</span> w.left.color == RED <span class="keyword">and</span> w.color == BLACK:</span><br><span class="line">                w.left.PAINT(BLACK)</span><br><span class="line">                w.PAINT(RED)</span><br><span class="line">                self.RIGHT_ROTATE(w)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># case4:x的兄弟w是黑色的，而且w的右儿子是红</span></span><br><span class="line">            <span class="keyword">if</span> w.right.color == RED:</span><br><span class="line">                p.PAINT(BLACK)</span><br><span class="line">                w.PAINT(RED)</span><br><span class="line">                <span class="keyword">if</span> w == p.right:</span><br><span class="line">                    self.LEFT_ROTATE(p)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.RIGHT_ROTATE(p)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">SHOW</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.DISPLAY1(self.root)</span><br><span class="line">        <span class="keyword">return</span> self.zlist</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DISPLAY1</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.DISPLAY1(node.left)</span><br><span class="line">        self.zlist.append(node.val)</span><br><span class="line">        self.DISPLAY1(node.right)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DISPLAY2</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.DISPLAY2(node.left)</span><br><span class="line">        print(node.val)</span><br><span class="line">        self.DISPLAY2(node.right)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DISPLAY3</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.DISPLAY3(node.left)</span><br><span class="line">        self.DISPLAY3(node.right)</span><br><span class="line">        print(node.val)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RBTnode</span>:</span></span><br><span class="line">    <span class="string">'''红黑树的节点类型'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.left = <span class="literal">None</span></span><br><span class="line">        self.right = <span class="literal">None</span></span><br><span class="line">        self.parent = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PAINT</span><span class="params">(self, color)</span>:</span></span><br><span class="line">        self.color = color</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zuoxuan</span><span class="params">(b, c)</span>:</span></span><br><span class="line">    a = b.parent</span><br><span class="line">    a.left = c</span><br><span class="line">    c.parent = a</span><br><span class="line">    b.parent = c</span><br><span class="line">    c.left = b</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    rbt=RBT()</span><br><span class="line">    b = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        m = randint(<span class="number">0</span>, <span class="number">500</span>)</span><br><span class="line">        rbt.INSERT(m)</span><br><span class="line">        b.append(m)</span><br><span class="line"></span><br><span class="line">    a = rbt.SHOW()</span><br><span class="line">    b.sort()</span><br><span class="line">    equal = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        <span class="keyword">if</span> a[i] != b[i]:</span><br><span class="line">            equal = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> equal:</span><br><span class="line">        print(<span class="string">'wrong'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'OK!'</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="4、B树和B-树（B-Tree-B-Tree）"><a href="#4、B树和B-树（B-Tree-B-Tree）" class="headerlink" title="4、B树和B+树（B Tree/B+ Tree）"></a>4、B树和B+树（B Tree/B+ Tree）</h4><p><strong>B树简介</strong></p>
<p>　　B树可以看作是对2-3查找树的一种扩展，即他允许每个节点有M-1个子节点。<br>　　　　１、根节点至少有两个子节点；<br>　　　　2、每个节点有M-1个key，并且以升序排列；<br>　　　　3、位于M-1和M key的子节点的值位于M-1 和M key对应的Value之间；<br>　　　　4、非叶子结点的关键字个数=指向儿子的指针个数-1；<br>　　　　5、非叶子结点的关键字：K[1], K[2], …, K[M-1]；且K[i] ；<br>　　　　6、其它节点至少有M/2个子节点；<br>　　　　7、所有叶子结点位于同一层；<br>　　如：（M=3）</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/search/05.png">

<p><strong>B树算法思想</strong></p>
<p>　　B-树的搜索，从根结点开始，对结点内的关键字（有序）序列进行二分查找，如果命中则结束，否则进入查询关键字所属范围的儿子结点；重复，直到所对应的儿子指针为</p>
<p>空，或已经是叶子结点；</p>
<p><strong>B树的特性</strong></p>
<p>　　1.关键字集合分布在整颗树中；<br>　　2.任何一个关键字出现且只出现在一个结点中；<br>　　3.搜索有可能在非叶子结点结束；<br>　　4.其搜索性能等价于在关键字全集内做一次二分查找；<br>　　5.自动层次控制；<br>　　由于限制了除根结点以外的非叶子结点，至少含有M/2个儿子，确保了结点的至少利用率，其最底搜索性能为O(LogN)</p>
<p><strong>B+ 树简介</strong></p>
<p>**B+树是B-树的变体，也是一种多路搜索树：<br>　　1.其定义基本与B-树同，除了：<br>　　2.非叶子结点的子树指针与关键字个数相同；<br>　　3.非叶子结点的子树指针P[i]，指向关键字值属于[K[i], K[i+1])的子树<br>　　4.B-树是开区间；<br>　　5.为所有叶子结点增加一个链指针；<br>　　6.所有关键字都在叶子结点出现；</p>
<p>如：（M=3）</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/search/06.png">

<p><strong>实现算法</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># B树查找</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BTree</span>:</span>  <span class="comment">#B树</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        self.left=<span class="literal">None</span></span><br><span class="line">        self.data=value</span><br><span class="line">        self.right=<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insertLeft</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        self.left=BTree(value)</span><br><span class="line">        <span class="keyword">return</span> self.left</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insertRight</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        self.right=BTree(value)</span><br><span class="line">        <span class="keyword">return</span> self.right</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inorder</span><span class="params">(node)</span>:</span>  <span class="comment">#中序遍历：先左子树，再根节点，再右子树</span></span><br><span class="line">    <span class="keyword">if</span> node.data:</span><br><span class="line">        <span class="keyword">if</span> node.left:</span><br><span class="line">            inorder(node.left)</span><br><span class="line">        node.show()</span><br><span class="line">        <span class="keyword">if</span> node.right:</span><br><span class="line">            inorder(node.right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rinorder</span><span class="params">(node)</span>:</span>  <span class="comment">#倒中序遍历</span></span><br><span class="line">    <span class="keyword">if</span> node.data:</span><br><span class="line">        <span class="keyword">if</span> node.right:</span><br><span class="line">            rinorder(node.right)</span><br><span class="line">        node.show()</span><br><span class="line">        <span class="keyword">if</span> node.left:</span><br><span class="line">            rinorder(node.left)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(node,value)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> value &gt; node.data:</span><br><span class="line">        <span class="keyword">if</span> node.right:</span><br><span class="line">            insert(node.right,value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node.insertRight(value)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> node.left:</span><br><span class="line">            insert(node.left,value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node.insertLeft(value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    l=[<span class="number">88</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">33</span>,<span class="number">22</span>,<span class="number">4</span>,<span class="number">55</span>,<span class="number">33</span>,<span class="number">221</span>,<span class="number">34</span>]</span><br><span class="line">    Root=BTree(l[<span class="number">0</span>])</span><br><span class="line">    node=Root</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,len(l)):</span><br><span class="line">        insert(Root,l[i])</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"中序遍历（从小到大排序 ）"</span>)</span><br><span class="line">    inorder(Root)</span><br><span class="line">    print(<span class="string">"倒中序遍历（从大到小排序）"</span>)</span><br><span class="line">    rinorder(Root)</span><br></pre></td></tr></table></figure></div>

<h4 id="5、树表查找总结"><a href="#5、树表查找总结" class="headerlink" title="5、树表查找总结"></a>5、树表查找总结</h4><p>　　二叉查找树平均查找性能不错，为O(logn)，但是最坏情况会退化为O(n)。在二叉查找树的基础上进行优化，我们可以使用平衡查找树。平衡查找树中的2-3查找树，这种数</p>
<p>据结构在插入之后能够进行自平衡操作，从而保证了树的高度在一定的范围内进而能够保证最坏情况下的时间复杂度。但是2-3查找树实现起来比较困难，红黑树是2-3树的一种</p>
<p>简单高效的实现，他巧妙地使用颜色标记来替代2-3树中比较难处理的3-node节点问题。红黑树是一种比较高效的平衡查找树，应用非常广泛，很多编程语言的内部实现都或多或</p>
<p>少的采用了红黑树。 </p>
<p>　　除此之外，2-3查找树的另一个扩展——B/B+平衡树，在文件系统和数据库系统中有着广泛的应用。</p>
<h3 id="分块查找"><a href="#分块查找" class="headerlink" title="分块查找"></a>分块查找</h3><p><strong>算法简介</strong></p>
<p>　　要求是顺序表，分块查找又称索引顺序查找，它是顺序查找的一种改进方法。</p>
<p><strong>算法思想</strong><br>　　将n个数据元素”按块有序”划分为m块（m ≤ n）。<br>　　每一块中的结点不必有序，但块与块之间必须”按块有序”；<br>　　即第1块中任一元素的关键字都必须小于第2块中任一元素的关键字；<br>　　而第2块中任一元素又都必须小于第3块中的任一元素，……</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/search/07.png">

<p><strong>算法流程</strong></p>
<p>　　1、先选取各块中的最大关键字构成一个索引表；<br>　　2、查找分两个部分：先对索引表进行二分查找或顺序查找，以确定待查记录在哪一块中；<br>　　3、在已确定的块中用顺序法进行查找。</p>
<p><strong>复杂度分析</strong></p>
<p>  <strong>时间复杂度：</strong>O(log(m)+N/m)</p>
<h3 id="哈希查找"><a href="#哈希查找" class="headerlink" title="哈希查找"></a>哈希查找</h3><p><strong>算法简介</strong></p>
<p>哈希表就是一种以键-值(key-indexed) 存储数据的结构，只要输入待查找的值即key，即可查找到其对应的值。</p>
<p><strong>算法思想</strong></p>
<p>　　哈希的思路很简单，如果所有的键都是整数，那么就可以使用一个简单的无序数组来实现：将键作为索引，值即为其对应的值，这样就可以快速访问任意键的值。这是对于</p>
<p>简单的键的情况，我们将其扩展到可以处理更加复杂的类型的键。</p>
<p><strong>算法流程</strong></p>
<p>　　1）用给定的哈希函数构造哈希表；<br>　　2）根据选择的冲突处理方法解决地址冲突；<br>　　　常见的解决冲突的方法：拉链法和线性探测法。<br>　　3）在哈希表的基础上执行哈希查找。</p>
<p><strong>复杂度分析</strong></p>
<p>　　单纯论查找复杂度：对于无冲突的Hash表而言，查找复杂度为O(1)（注意，在查找之前我们需要构建相应的Hash表）。</p>
<p><strong>实现算法</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 忽略了对数据类型，元素溢出等问题的判断。</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTable</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size)</span>:</span></span><br><span class="line">    self.elem = [<span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(size)] <span class="comment"># 使用list数据结构作为哈希表元素保存方法</span></span><br><span class="line">    self.count = size <span class="comment"># 最大表长</span></span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> key % self.count <span class="comment"># 散列函数采用除留余数法</span></span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">insert_hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="string">"""插入关键字到哈希表内"""</span></span><br><span class="line">    address = self.hash(key) <span class="comment"># 求散列地址</span></span><br><span class="line">    <span class="keyword">while</span> self.elem[address]: <span class="comment"># 当前位置已经有数据了，发生冲突。</span></span><br><span class="line">      address = (address+<span class="number">1</span>) % self.count <span class="comment"># 线性探测下一地址是否可用</span></span><br><span class="line">    self.elem[address] = key <span class="comment"># 没有冲突则直接保存。</span></span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">search_hash</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="string">"""查找关键字，返回布尔值"""</span></span><br><span class="line">    star = address = self.hash(key)</span><br><span class="line">    <span class="keyword">while</span> self.elem[address] != key:</span><br><span class="line">      address = (address + <span class="number">1</span>) % self.count</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> self.elem[address] <span class="keyword">or</span> address == star: <span class="comment"># 说明没找到或者循环到了开始的位置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  list_a = [<span class="number">12</span>, <span class="number">67</span>, <span class="number">56</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">37</span>, <span class="number">22</span>, <span class="number">29</span>, <span class="number">15</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">34</span>]</span><br><span class="line">  hash_table = HashTable(<span class="number">12</span>)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> list_a:</span><br><span class="line">    hash_table.insert_hash(i)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> hash_table.elem:</span><br><span class="line">    <span class="keyword">if</span> i:</span><br><span class="line">      print((i, hash_table.elem.index(i)), end=<span class="string">" "</span>)</span><br><span class="line">  print(<span class="string">"\n"</span>)</span><br><span class="line"> </span><br><span class="line">  print(hash_table.search_hash(<span class="number">15</span>))</span><br><span class="line">  print(hash_table.search_hash(<span class="number">33</span>))</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL主从原理</title>
    <url>/MySQL/MySQL_id_01.html</url>
    <content><![CDATA[<h2 id="1-1-mysql主从同步"><a href="#1-1-mysql主从同步" class="headerlink" title="1.1 mysql主从同步"></a>1.1 mysql主从同步</h2><h3 id="1、mysql主从同步（复制）概念"><a href="#1、mysql主从同步（复制）概念" class="headerlink" title="1、mysql主从同步（复制）概念"></a>1、mysql主从同步（复制）概念</h3><p>　　1、将Mysql某一台主机数据复制到其它主机（slaves）上，并重新执行一遍来实现的。</p>
<p>　　2、复制过程中一个服务器充当主服务器，而一个或多个其它服务器充当从服务器。</p>
<a id="more"></a>

<p>　　3、主服务器将更新写入二进制日志文件，并维护文件的一个索引以跟踪日志循环。</p>
<p>　　4、当一个从服务器连接主服务器时，它通知主服务器从服务器在日志中读取的最后一次成功更新的位置。</p>
<p>　　5、从服务器接收从那时起发生的任何更新，然后封锁并等待主服务器通知新的更新。</p>
<p><code>binlog：是二进制日志文件，用于记录mysql的数据更新或者潜在更新(比如DELETE语句执行删除而实际并没有符合条件的数据)</code></p>
<h3 id="2、Mysql支持哪些复制"><a href="#2、Mysql支持哪些复制" class="headerlink" title="2、Mysql支持哪些复制"></a>2、Mysql支持哪些复制</h3><p>　　1、<strong>基于语句的复制:</strong> 在主服务器执行SQL语句，在从服务器执行同样语句。</p>
<p>　　<strong>注：</strong>MySQL默认采用基于语句的复制，效率较高。一旦发现没法精确复制时, 会自动选基于行的复制。</p>
<p>　　2、<strong>基于行的复制:</strong> 把改变的内容复制过去，而不是把命令在从服务器上执行一遍. 从mysql5.0开始支持</p>
<p>　　3、<strong>混合类型的复制:</strong> 默认采用基于语句的复制，一旦发现基于语句的无法精确的复制时，就会采用基于行的复制。</p>
<h3 id="3、Mysql主从复制原理"><a href="#3、Mysql主从复制原理" class="headerlink" title="3、Mysql主从复制原理"></a>3、Mysql主从复制原理</h3><p>　　1、master服务器将数据的改变都记录到二进制binlog日志中，只要master上的数据发生改变，则将其改变写入二进制日志；</p>
<p>　　2、salve服务器会在一定时间间隔内对master二进制日志进行探测其是否发生改变，如果发生改变，则开始一个I/O Thread请求master二进制事件</p>
<p>　　3、同时主节点为每个I/O线程启动一个dump线程，用于向其发送二进制事件，并保存至从节点本地的中继日志中</p>
<p>　　4、从节点将启动SQL线程从中继日志中读取二进制日志，在本地重放，使得其数据和主节点的保持一致</p>
<p>　　5、最后I/O Thread和SQL Thread将进入睡眠状态，等待下一次被唤醒.</p>
<h4 id="需要理解："><a href="#需要理解：" class="headerlink" title="需要理解："></a>需要理解：</h4><p>　　<em>1）从库会生成两个线程,一个I/O线程,一个SQL线程;</em></p>
<p>　　<em>2）I/O线程会去请求主库的binlog,并将得到的binlog写到本地的relay-log(中继日志)文件中;</em></p>
<p>　　<em>3）主库会生成一个log dump线程,用来给从库I/O线程传binlog;</em></p>
<p>　　<em>4）SQL线程,会读取relay log文件中的日志,并解析成sql语句逐一执行;</em></p>
<h3 id="4、Mysql复制流程图"><a href="#4、Mysql复制流程图" class="headerlink" title="4、Mysql复制流程图"></a>4、Mysql复制流程图</h3><p>　　1、master将操作语句记录到binlog日志中</p>
<p>　　2、salve服务器会在一定时间间隔内对master二进制日志进行探测其是否发生改变，如果发生改变</p>
<p>　　3、salave开启两个线程：<em>IO线程和SQL线程</em></p>
<p>　　　<em>1）<strong>IO线程：</strong>负责读取master的binlog内容到中继日志relay log里；</em></p>
<p>　　　<em>2）<strong>SQL线程：</strong>负责从relay log日志里读出binlog内容，并更新到slave的数据库里（保证数据一致）</em></p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/MySQL/01.png">

<h2 id="1-2-MySQL同步延迟问题"><a href="#1-2-MySQL同步延迟问题" class="headerlink" title="1.2 MySQL同步延迟问题"></a>1.2 MySQL同步延迟问题</h2><h3 id="1、造成mysql同步延迟常见原因"><a href="#1、造成mysql同步延迟常见原因" class="headerlink" title="1、造成mysql同步延迟常见原因"></a>1、造成mysql同步延迟常见原因</h3><p>　　1）<strong>网络：</strong>如主机或者从机的带宽打满、主从之间网络延迟很大，导致主上的binlog没有全量传输到从机，造成延迟。</p>
<p>　　2）<strong>机器性能：*</strong>从机使用了烂机器？比如主机使用SSD而从机还是使用的SATA*</p>
<p>　　3）<strong>从机高负载：</strong>有很多业务会在从机上做统计，把从机服务器搞成高负载，从而造成从机延迟很大的情况</p>
<p>　　4）<strong>大事务：</strong>比如在RBR模式下，执行带有大量的delete操作，这种通过查看processlist相关信息以及使用mysqlbinlog查看binlog中的SQL就能快速进行确认</p>
<p>　　5）<strong>锁:</strong>　 锁冲突问题也可能导致从机的SQL线程执行慢，比如从机上有一些select …. for update的SQL，或者使用了MyISAM引擎等。</p>
<h3 id="2、硬件方面（优化）"><a href="#2、硬件方面（优化）" class="headerlink" title="2、硬件方面（优化）"></a>2、硬件方面（优化）</h3><p>　　1、采用好服务器，比如4u比2u性能明显好，2u比1u性能明显好。</p>
<p>　　2、存储用ssd或者盘阵或者san，提升随机写的性能。</p>
<p>　　3、主从间保证处在同一个交换机下面，并且是万兆环境。</p>
<p>　　<strong>总结</strong>：硬件强劲，延迟自然会变小。一句话，缩小延迟的解决方案就是花钱和花时间。</p>
<h3 id="3、mysql主从同步加速"><a href="#3、mysql主从同步加速" class="headerlink" title="3、mysql主从同步加速"></a>3、mysql主从同步加速</h3><p>　　<strong>1）sync_binlog在slave端设置为0</strong></p>
<p>　　　　当事务提交后，Mysql仅仅是将binlog_cache中的数据写入Binlog文件，但不执行fsync之类的磁盘 同步指令 通知文件系统将缓存刷新到磁盘</p>
<p>　　　　而让Filesystem自行决定什么时候来做同步，这个是性能最好的。</p>
<p>　　<strong>2）slave端 innodb_flush_log_at_trx_commit = 2</strong></p>
<p>　　　　每次事务提交时MySQL都会把log buffer的数据写入log file，但是flush(刷到磁盘)操作并不会同时进行。</p>
<p>　　　　该模式下，MySQL会每秒执行一次 flush(刷到磁盘)操作。</p>
<p>　　<strong>3）–logs-slave-updates 从服务器从主服务器接收到的更新不记入它的二进制日志。</strong></p>
<p>　　<strong>4）直接禁用slave端的binlog</strong></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Python判断链表是否成环，及找到入环节点</title>
    <url>/Python/Python_id_56.html</url>
    <content><![CDATA[<p>　　用快慢指针的方法。时间复杂度O(n)，空间复杂度O(1)。</p>
<p>设置p1为慢指针，p2为快指针，两者初始时都指向链表的头结点 ，慢指针p1每次前进1步，快指针p2每次前进2步。如果链表存在环，则快指针p2肯定先进入环，慢指针p1后进入环，两个指针必定会相遇。如果不存在环，则快指针会先行到达链表的尾部变为None。</p>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断链表是否有环,并返回入环节点</span></span><br><span class="line"><span class="comment"># 判断是否有环，用快指针和慢指针，当两个指针相遇时，说明有环</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit_loop</span><span class="params">(LList)</span>:</span></span><br><span class="line">    p1 = p2 = LList</span><br><span class="line">    <span class="comment"># 当链表为空或者只有一个节点时，跳出循环，返回False</span></span><br><span class="line">    <span class="keyword">while</span> p2 <span class="keyword">and</span> p2.next:</span><br><span class="line">        p1 = p1.next</span><br><span class="line">        p2 = p2.next.next</span><br><span class="line">        <span class="keyword">if</span> p1 == p2:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果链表有环，返回入环节点</span></span><br><span class="line"><span class="comment"># 当确定有环后，慢指针重新回到头节点，快指针停留在相遇处，然后两个指针每次移动1个节点，最终他们在入环节点处相遇</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_entry_of_loop</span><span class="params">(pHead)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pHead:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    slow = pHead</span><br><span class="line">    fast = pHead</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> slow.next <span class="keyword">and</span> fast.next.next:</span><br><span class="line">        slow = slow.next</span><br><span class="line">        fast = fast.next.next</span><br><span class="line">        <span class="comment"># 当两个指针相遇时，说明有环，循环结束</span></span><br><span class="line">        <span class="keyword">if</span> fast == slow:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 快指针停留在相遇处，慢指针回到起点</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> fast <span class="keyword">or</span> <span class="keyword">not</span> fast.next:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    slow = pHead</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 两个指针每次向前移动1，当再次相遇时，相遇点即为入环节点</span></span><br><span class="line">    <span class="keyword">while</span> slow != fast:</span><br><span class="line">        slow = slow.next</span><br><span class="line">        fast = fast.next</span><br><span class="line">    <span class="keyword">return</span> slow</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    LList = LNode(<span class="number">0</span>)</span><br><span class="line">    p1 = LNode(<span class="number">1</span>)</span><br><span class="line">    p2 = LNode(<span class="number">2</span>)</span><br><span class="line">    p3 = LNode(<span class="number">3</span>)</span><br><span class="line">    p4 = LNode(<span class="number">4</span>)</span><br><span class="line">    p5 = LNode(<span class="number">5</span>)</span><br><span class="line">    LList.next = p1</span><br><span class="line">    p1.next = p2</span><br><span class="line">    p2.next = p3</span><br><span class="line">    p3.next = p4</span><br><span class="line">    p4.next = p5</span><br><span class="line">    p5.next = p2</span><br><span class="line">    <span class="keyword">print</span> (exit_loop(LList))</span><br><span class="line">    <span class="keyword">print</span> (find_entry_of_loop(LList).val)</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Python常用的排序方法</title>
    <url>/Python/Python_id_55.html</url>
    <content><![CDATA[<p>　　数据的排序是在解决实际问题时经常用到的步骤，也是数据结构的考点之一，下面介绍10种经典的排序方法。</p>
<a id="more"></a>

<p>　　首先，排序方法可以大体分为插入排序、选择排序、交换排序、归并排序和桶排序四大类，其中，插入排序又分为直接插入排序、二分插入排序和希尔排序，选择排序分为直接选择排序和堆排序，交换排序分为冒泡排序和快速排序，桶排序以基数排序和计数排序为代表。这些排序方法的时间复杂度和空间复杂度分别如下表所示。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Python排序方法/01.png">

<p>排序方法的稳定性是这样定义的：在待排序序列中如果存在a[i]和a[j]，a[i]=a[j]&amp;&amp;i&lt;j，如果排序后仍然符合a[i]=a[j]&amp;&amp;i&lt;j，即它们的前后相对位置关系没有改变，该排序算法就是稳定的。</p>
<h3 id="1、直接插入排序"><a href="#1、直接插入排序" class="headerlink" title="1、直接插入排序"></a>1、直接插入排序</h3><p>插入排序的基本思想是将数据插入合适的位置。如下所示序列[6,8,1,4,3,9,5,0]，以升序排列为例。</p>
<p>a.6&lt;8，符合升序</p>
<p>b. 8&gt;1，不符合要求，改变1的位置。首先比较1和8，1更小，交换1和8的位置，序列成为[6,1,8,4,3,9,5,0]，然后继续比较1和6，1更小，交换1和6的位置，序列成为[1,6,8,4,3,9,5,0],注意此时前三个值已经符合升序的要求。</p>
<p>c. 8&gt;4，不符合要求，改变4的位置，按照上面的方法，依次与前面的值比较，分别与8和6交换位置，当比较到1时，1&lt;4，不用交换位置。此时序列成为[1,4,6,8,3,9,5,0]</p>
<p>d.重复上满的操作，直到整个序列遍历完成。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Python排序方法/02.png">

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr)<span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">if</span> arr[i+<span class="number">1</span>]&lt;arr[i]:<span class="comment">#如果arr[i+1]较小，将其插入到前面升序序列中</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">                <span class="keyword">if</span> arr[j]&lt;arr[j<span class="number">-1</span>]:<span class="comment">#依次将大于arr[i+1]的值向后移动，直到找到不大于arr[i+1]的值</span></span><br><span class="line">                    arr[j<span class="number">-1</span>],arr[j]=arr[j],arr[j<span class="number">-1</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure></div>

<h3 id="2、二分插入排序"><a href="#2、二分插入排序" class="headerlink" title="2、二分插入排序"></a>2、二分插入排序</h3><p>二分插入排序的思想与直接插入排序相同，只是在将数据插入有序序列时，采用了二分查找的思想，即先于中间位置的值进行比较，以缩短查找的时间。代码如下</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BinaryInsert_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,len(arr)):</span><br><span class="line">        <span class="keyword">if</span> arr[i]&lt;arr[i<span class="number">-1</span>]:</span><br><span class="line">            left,right=<span class="number">0</span>,i<span class="number">-1</span></span><br><span class="line">            <span class="keyword">while</span> left&lt;right:<span class="comment">#最终right位置的值是有序序列中第一个不大于arr[i]的值</span></span><br><span class="line">                mid=left+(right-left)//<span class="number">2</span></span><br><span class="line">                <span class="keyword">if</span> arr[i]&lt;arr[mid]:<span class="comment">#</span></span><br><span class="line">                    right=mid</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    left=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i,right,<span class="number">-1</span>):</span><br><span class="line">                arr[j],arr[j<span class="number">-1</span>]=arr[j<span class="number">-1</span>],arr[j]</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure></div>

<h3 id="3、希尔排序"><a href="#3、希尔排序" class="headerlink" title="3、希尔排序"></a>3、希尔排序</h3><p>希尔排序建立在直接插入排序的基础上，假设序列长度为n，先取一个小于n的整数d1，序列中所有距离为d1的数据为一组，如下图中，以2为i增量，1，4，5为一组，8，3，0为一组，1，9为1组，然后在组内进行直接插入排序，然后取整数d2,d2&lt;d1，重复上面的步骤，直到增量减少为1。一般的初次取序列的一半为增量，以后每次减半。这样通过相隔增量的数，使得数移动时能跨过多个元素，加快速度。代码如下</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Python排序方法/03.png">

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Hill_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    d=len(arr)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span>(d&gt;=<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr)//d):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i,len(arr)-d,d):</span><br><span class="line">                <span class="keyword">if</span> arr[j+d]&lt;arr[j]:</span><br><span class="line">                    <span class="keyword">for</span> k <span class="keyword">in</span> range(j+d,i,-d):</span><br><span class="line">                        <span class="keyword">if</span> arr[k]&lt;arr[k-d]:</span><br><span class="line">                            arr[k],arr[k-d]=arr[k-d],arr[k]</span><br><span class="line">        d=d//<span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure></div>

<p>因为希尔排序跨距离访问元素，因此不稳定。空间复杂度为O(1)，最好的时间复杂度为O(n)。</p>
<h3 id="4、直接选择排序"><a href="#4、直接选择排序" class="headerlink" title="4、直接选择排序"></a>4、直接选择排序</h3><p>选择排序的思想是每次从无序的序列中选择最大或最小的值，并与第一个位置的值交换。如序列l，如果是升序排列，第一次找出l的最小值与l[0]交换，第二次找出l[1:]最小的值，与l[2]交换，以此类推，代码如下。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">select_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr)<span class="number">-1</span>):</span><br><span class="line">        minnum=arr[i]</span><br><span class="line">        m=i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>,len(arr)):</span><br><span class="line">            <span class="keyword">if</span> arr[j]&lt;minnum:</span><br><span class="line">                minnum=arr[j]</span><br><span class="line">                m=j</span><br><span class="line">        arr[i],arr[m]=arr[m],arr[i]</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure></div>

<p>直接选择排序是稳定的，空间复杂度为O(1)，时间复杂度恒定为O(n2),因为原序列是否有序不会影响选择排序的步骤。</p>
<h3 id="5、堆排序"><a href="#5、堆排序" class="headerlink" title="5、堆排序"></a>5、堆排序</h3><p>堆排序用到了大顶堆和小顶堆的概念。大顶堆是父节点最大的二叉树，即arr[i]&gt;=arr[2<em>i+1]&amp;&amp;arr[i]&gt;=arr[2</em>i-1]；小顶堆是父节点的值最小的二叉树，即arr[i]&lt;=arr[2<em>i+1]&amp;&amp;arr[i]&lt;=arr[2</em>i-1]。</p>
<p>以升序排序为例，首先建立初始最大堆，以某个节点为入口，向下调整其子节点，使其符合大顶堆的特点。建立初始大顶堆的过程会重复调整一些节点，是因为父节点和子节点的交换，会影响以子节点为根节点的子树，如图中，[9,1,7]子树原符合要求，6和9交换后，[6,1,7]不符合要求，就要再次调整该子树。</p>
<p>初始大顶堆建立之后，将根节点的值置换到序列末尾，然后重新调整前面的序列，这时只从根节点向下调整即可，因为初始大顶堆已经形成，如图中，即便交换了0和4的位置，父节点8也仍旧是最大的。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Python排序方法/04.png">

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heap_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">adjust</span><span class="params">(arr,node,maxid)</span>:</span></span><br><span class="line">        root=node</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            child=<span class="number">2</span>*root+<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> child&gt;maxid:</span><br><span class="line">                <span class="keyword">return</span> </span><br><span class="line">            child=child+<span class="number">1</span> <span class="keyword">if</span> arr[child+<span class="number">1</span>]&gt;arr[child] <span class="keyword">and</span> child+<span class="number">1</span>&lt;maxid <span class="keyword">else</span> child<span class="comment">#child是两个孩子中值较大的一个</span></span><br><span class="line">            <span class="keyword">if</span> arr[root]&lt;arr[child]:</span><br><span class="line">                arr[root],arr[child]=arr[child],arr[root]</span><br><span class="line">                root=child</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> </span><br><span class="line">    first=len(arr)//<span class="number">2</span><span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> range(first,<span class="number">-1</span>,<span class="number">-1</span>):</span><br><span class="line">        adjust(arr,node,len(arr)<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">for</span> maxid <span class="keyword">in</span> range(len(arr)<span class="number">-1</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">        arr[<span class="number">0</span>],arr[maxid]=arr[maxid],arr[<span class="number">0</span>]</span><br><span class="line">        adjust(arr,<span class="number">0</span>,maxid<span class="number">-1</span>)</span><br></pre></td></tr></table></figure></div>

<p>堆排序不稳定，空间复杂度为O(1)，但时间复杂度恒定为O(nlogn)。</p>
<h3 id="6、冒泡排序"><a href="#6、冒泡排序" class="headerlink" title="6、冒泡排序"></a>6、冒泡排序</h3><p>交换排序即通过交换元素位置，使序列有序。冒泡排序是最简单的交换排序，每次将最大值/最小值依次交换到序列末尾。冒泡排序是稳定的，空间复杂度为O(1)，时间复杂度最好为O(n)。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubble_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr)<span class="number">-1</span>):    <span class="comment"># 这个循环负责设置冒泡排序进行的次数</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(arr)-i<span class="number">-1</span>):  <span class="comment"># ｊ为列表下标</span></span><br><span class="line">            <span class="keyword">if</span> arr[j] &gt; arr[j+<span class="number">1</span>]:</span><br><span class="line">                arr[j], arr[j+<span class="number">1</span>] = arr[j+<span class="number">1</span>], arr[j]</span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure></div>

<h3 id="7、快速排序"><a href="#7、快速排序" class="headerlink" title="7、快速排序"></a>7、快速排序</h3><p>快速排序可以说是使用频率和考察频率最高的排序方法。快速排序的基本思想是以序列中的某个值为标准，大于该值的被放在右边，小于该值放在左边，然后再继续对该值左右两两边的序列重复此步骤，思想很简单，代码如下。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span><span class="params">(arr,start,end)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> end-start&lt;=<span class="number">0</span>: <span class="keyword">return</span> </span><br><span class="line">    index=random.randrange(start,end+<span class="number">1</span>)</span><br><span class="line">    print(index)</span><br><span class="line">    arr[end],arr[index]=arr[index],arr[end]</span><br><span class="line">    small=start<span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(start,end):</span><br><span class="line">        <span class="keyword">if</span> arr[i]&lt;arr[end]:</span><br><span class="line">            small+=<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> small!=i:<span class="comment">#如果small与i不相同，说明有大于arr[end]的值出现，small记录的是分界线的位置</span></span><br><span class="line">                arr[i],arr[small]=arr[small],arr[i]</span><br><span class="line">    small+=<span class="number">1</span></span><br><span class="line">    arr[end],arr[small]=arr[small],arr[end]</span><br><span class="line">    print(arr)</span><br><span class="line">    quick_sort(arr,start,small<span class="number">-1</span>)</span><br><span class="line">    quick_sort(arr,small+<span class="number">1</span>,end)</span><br></pre></td></tr></table></figure></div>

<p>对于python，有一种更加简单明了的实现方式</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">qsort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(arr) &lt;= <span class="number">1</span>: <span class="keyword">return</span> arr</span><br><span class="line">    <span class="keyword">return</span> qsort([lt <span class="keyword">for</span> lt <span class="keyword">in</span> arr[<span class="number">1</span>:] <span class="keyword">if</span> lt &lt; arr[<span class="number">0</span>]]) + arr[<span class="number">0</span>:<span class="number">1</span>]+ qsort([ge <span class="keyword">for</span> ge <span class="keyword">in</span> arr[<span class="number">1</span>:] <span class="keyword">if</span> ge &gt;= arr[<span class="number">0</span>]])</span><br></pre></td></tr></table></figure></div>

<p>快速排序并没有创建新的数组，但由于实现过程中利用了函数的递归调用，需要堆栈空间，所以空间复杂度为O(nlogn)，时间复杂度最好为O(nlogn)。</p>
<h3 id="8、归并排序"><a href="#8、归并排序" class="headerlink" title="8、归并排序"></a>8、归并排序</h3><p>归并排序采用分而治之的思想，将序列分为多个小的序列，对小的序列排序之后，将小序列合并为大的序列，过程如下图所示。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Python排序方法/06.png">

<p>归并排序需要新的数组存放合并后的序列，空间复杂度为O(n)，时间复杂度恒定为O(nlogn)，是稳定的。</p>
<h3 id="9、计数排序"><a href="#9、计数排序" class="headerlink" title="9、计数排序"></a>9、计数排序</h3><p>桶排序实际上是一类排序方法的总称。桶排序的思想是将所有数据按照一定的映射关系放到一定数量的桶中，将每个桶里的数据排序，再将所有的桶组合起来，所以不同的映射关系下可以产生不同的桶排序，并且桶排序是基于其他排序算法的，桶内数据的排序需要使用其他排序算法。计数排序和基数排序是桶排序的两种代表。</p>
<p>计数排序是采用的映射关系是最直接的f[i]=i，即一个桶里的数字都是相同的，因此没有桶内排序的步骤。具体过程为，</p>
<p>1.找出待排序的数组中最大和最小的元素<br>2.统计数组中每个值为i的元素出现的次数，存入数组C的第i项，这时映射的过程<br>3.对所有的计数累加，C[i]的含义即是在数组中小于i的元素个数，即为排序后i应放的位置<br>4.反向填充目标数组：将每个元素i放在新数组的第C(i)项，每放一个 元素就将C(i)减去1。</p>
<p>代码如下</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    crr=[]</span><br><span class="line">    m=max(arr)+<span class="number">1</span></span><br><span class="line">    ll=len(arr)</span><br><span class="line">    ans=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(ll):<span class="comment">#用于存放排序后的数组</span></span><br><span class="line">        ans.append(<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):<span class="comment">#桶</span></span><br><span class="line">        crr.append(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> arr:<span class="comment">#映射的过程，计数</span></span><br><span class="line">        crr[num]+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,m):<span class="comment">#计数累加</span></span><br><span class="line">        crr[i]=crr[i<span class="number">-1</span>]+crr[i]</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> arr:<span class="comment">#反向填充数组</span></span><br><span class="line">        ans[crr[num]<span class="number">-1</span>]=num</span><br><span class="line">        crr[num]-=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br></pre></td></tr></table></figure></div>

<h3 id="10、基数排序"><a href="#10、基数排序" class="headerlink" title="10、基数排序"></a>10、基数排序</h3><p>基数排序的映射方法是按照数据特定位上数字放入不同的桶中， 将序列中的数组按照个位放到不同的桶中，然后按照个位0~9的顺序依次取出，再按照十位放到不同的桶中，…….直到达到数据的最高位，最后一次将数据取出时，排序完成，例如：</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Python排序方法/07.png">

<p>实现代码</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">radix_sort</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compare</span><span class="params">(basis,arr)</span>:</span><span class="comment">#以数组basis为依据的插入排序</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,len(basis)):</span><br><span class="line">            <span class="keyword">if</span> basis[i]&lt;basis[i<span class="number">-1</span>]:</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(i,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">                    <span class="keyword">if</span> basis[j<span class="number">-1</span>]&gt;basis[j]:</span><br><span class="line">                        basis[j],basis[j<span class="number">-1</span>]=basis[j<span class="number">-1</span>],basis[j]</span><br><span class="line">                        arr[j],arr[j<span class="number">-1</span>]=arr[j<span class="number">-1</span>],arr[j]</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">    upnum=max(arr)</span><br><span class="line">    tmp=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(tmp&lt;upnum):</span><br><span class="line">        basis=[num//tmp%<span class="number">10</span> <span class="keyword">for</span> num <span class="keyword">in</span> arr]</span><br><span class="line">        compare(basis,arr)</span><br><span class="line">        tmp*=<span class="number">10</span></span><br><span class="line">    <span class="keyword">return</span> arr</span><br></pre></td></tr></table></figure></div>

<p>注意基数排序在桶内排序时，一定要采用稳定的排序方法，这样才可以利用之前的排序结果，否则之前的排序是无意义的。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>利用HeyUI在md文件中制作的一个小功能</title>
    <url>/Other/Other_id_02.html</url>
    <content><![CDATA[<p>可以先看下效果<a href="https://www.onlyyu.cn/notes/" target="_blank" rel="noopener">跳转</a></p>
<a id="more"></a>

<h3 id="页面模版样式"><a href="#页面模版样式" class="headerlink" title="页面模版样式"></a>页面模版样式</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"a1"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>随堂笔记:<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"suitang1"</span> <span class="attr">class</span>=<span class="string">"suitang1"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"h-btn h-btn-blue"</span>&gt;</span>点我可以展开哦<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"suitang2"</span> <span class="attr">class</span>=<span class="string">"suitang2"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"h-btn h-btn-primary"</span>&gt;</span>记得点我收起哦<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">"suitang3"</span> <span class="attr">id</span>=<span class="string">"suitang3"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　01、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/classroom/国际化语言操作.html"</span>&gt;</span>国际化语言操作<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　02、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/classroom/Vue中的自定义过滤器.html"</span>&gt;</span>Vue自定义过滤器<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　03、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/classroom/基于redis的排行榜.html"</span>&gt;</span>基于redis的排行榜<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　04、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/classroom/商品检索智能提示功能.html"</span>&gt;</span>商品检索智能提示功能<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　05、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/classroom/简单的购物车.html"</span>&gt;</span>简单的购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dl</span> <span class="attr">id</span>=<span class="string">"spider"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"a1"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>Spider笔记:<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"spider1"</span> <span class="attr">class</span>=<span class="string">"spider1"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"h-btn h-btn-blue"</span>&gt;</span>点我可以展开哦<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"spider2"</span> <span class="attr">class</span>=<span class="string">"spider2"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"h-btn h-btn-primary"</span>&gt;</span>记得点我收起哦<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">"spider3"</span> <span class="attr">id</span>=<span class="string">"spider3"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　01、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/虚拟环境命令.html"</span>&gt;</span>虚拟环境命令<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　02、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/爬虫的介绍.html"</span>&gt;</span>爬虫的介绍<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　03、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/网页请求.html"</span>&gt;</span>网页请求<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　04、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/requests高级部分.html"</span>&gt;</span>requests高级部分<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　05、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/xpath使用.html"</span>&gt;</span>xpath使用<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　06、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/bs4模块的使用.html"</span>&gt;</span>bs4模块的使用<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　07、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/文件的操作.html"</span>&gt;</span>文件的操作<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　08、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/selenuim模块的使用.html"</span>&gt;</span>selenuim模块的使用<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　09、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/多线程爬虫.html"</span>&gt;</span>多线程爬虫<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　10、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/打码平台.html"</span>&gt;</span>打码平台<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　11、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/MongoDB使用介绍.html"</span>&gt;</span>MongoDB使用介绍<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">"comspecial"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>　　12、📚 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/notes/spider/sceapy框架.html"</span>&gt;</span>sceapy框架<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="引入样式"><a href="#引入样式" class="headerlink" title="引入样式"></a>引入样式</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 引入外部HeyUI样式*/</span></span><br><span class="line">&lt;script src="https://cdn.jsdelivr.net/npm/vue"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="https://cdn.jsdelivr.net/npm/heyui"&gt;&lt;/script&gt;</span><br><span class="line"><span class="comment">/*自定义样式*/</span></span><br><span class="line">&lt;style type="text/css"&gt;</span><br><span class="line">    <span class="selector-class">.h-btn</span> &#123;</span><br><span class="line">        <span class="attribute">border</span>: none;</span><br><span class="line">        <span class="attribute">outline</span>: none;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">15px</span>;</span><br><span class="line">        <span class="attribute">font-family</span>: inherit;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">        <span class="attribute">color</span>: inherit;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">        <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">        <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">        <span class="attribute">cursor</span>: pointer;</span><br><span class="line">        <span class="attribute">transition</span>: all .<span class="number">2s</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: transparent;</span><br><span class="line">        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#d3d3d3</span>;</span><br><span class="line">        <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">1px</span> <span class="number">1px</span> <span class="number">0</span> <span class="number">#eeeeee</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#FFF</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.h-btn</span><span class="selector-class">.h-btn-primary</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#45b984</span>;</span><br><span class="line">        <span class="attribute">border-color</span>: <span class="number">#42b27f</span>;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#ffffff</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.h-btn</span><span class="selector-class">.h-btn-primary</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="attribute">border-color</span>: <span class="number">#6ac79d</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#6ac79d</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.h-btn</span><span class="selector-class">.h-btn-primary</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">        <span class="attribute">border-color</span>: <span class="number">#3a9b6f</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#3a9b6f</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.h-btn</span><span class="selector-class">.h-btn-blue</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#3B91FF</span>;</span><br><span class="line">        <span class="attribute">border-color</span>: <span class="number">#318bff</span>;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#ffffff</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.h-btn</span><span class="selector-class">.h-btn-blue</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="attribute">border-color</span>: <span class="number">#6eaeff</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#6eaeff</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.h-btn</span><span class="selector-class">.h-btn-blue</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">        <span class="attribute">border-color</span>: <span class="number">#127aff</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#127aff</span></span><br><span class="line">    &#125;</span><br><span class="line">        <span class="selector-class">.suitang1</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="number">120px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.suitang2</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="number">120px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.suitang3</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.spider1</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="number">100px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.spider2</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="number">100px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.spider3</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.a1</span> &#123;</span><br><span class="line">    	<span class="attribute">float</span>: left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.comspecial</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">        <span class="attribute">padding</span>:<span class="number">5px</span> <span class="number">0</span>;</span><br><span class="line">        //border-right:1px solid #ddd;</span><br><span class="line">        <span class="selector-tag">list-style-position</span><span class="selector-pseudo">:inside</span>;</span><br><span class="line">        <span class="selector-tag">float</span>: <span class="selector-tag">left</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#coms</span> <span class="selector-tag">dl</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">        <span class="attribute">padding</span>:<span class="number">5px</span> <span class="number">0</span>;</span><br><span class="line">        //border-right:1px solid #ddd;</span><br><span class="line">        <span class="selector-tag">list-style-position</span><span class="selector-pseudo">:inside</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="点击事件"><a href="#点击事件" class="headerlink" title="点击事件"></a>点击事件</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> suitang1 = <span class="built_in">document</span>.getElementById(<span class="string">"suitang1"</span>);</span><br><span class="line">        <span class="keyword">let</span> suitang2 = <span class="built_in">document</span>.getElementById(<span class="string">"suitang2"</span>);</span><br><span class="line">        <span class="keyword">let</span> suitang3 = <span class="built_in">document</span>.getElementById(<span class="string">"suitang3"</span>);</span><br><span class="line">        <span class="keyword">let</span> spider1 = <span class="built_in">document</span>.getElementById(<span class="string">"spider1"</span>);</span><br><span class="line">        <span class="keyword">let</span> spider2 = <span class="built_in">document</span>.getElementById(<span class="string">"spider2"</span>);</span><br><span class="line">        <span class="keyword">let</span> spider3 = <span class="built_in">document</span>.getElementById(<span class="string">"spider3"</span>);</span><br><span class="line">        suitang1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            suitang1.style.display = <span class="string">"none"</span></span><br><span class="line">            suitang2.style.display = <span class="string">"inline-block"</span></span><br><span class="line">            suitang3.style.display = <span class="string">"inline-block"</span></span><br><span class="line">            spider1.style.display = <span class="string">"inline-block"</span></span><br><span class="line">            spider2.style.display = <span class="string">"none"</span></span><br><span class="line">            spider3.style.display = <span class="string">"none"</span></span><br><span class="line">        &#125;;</span><br><span class="line">        suitang2.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            suitang1.style.display = <span class="string">"inline-block"</span></span><br><span class="line">            suitang2.style.display = <span class="string">"none"</span></span><br><span class="line">            suitang3.style.display = <span class="string">"none"</span></span><br><span class="line">        &#125;</span><br><span class="line">        spider1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            spider1.style.display = <span class="string">"none"</span></span><br><span class="line">            spider2.style.display = <span class="string">"inline-block"</span></span><br><span class="line">            spider3.style.display = <span class="string">"inline-block"</span></span><br><span class="line">            suitang1.style.display = <span class="string">"inline-block"</span></span><br><span class="line">            suitang2.style.display = <span class="string">"none"</span></span><br><span class="line">            suitang3.style.display = <span class="string">"none"</span></span><br><span class="line">        &#125;;</span><br><span class="line">        spider2.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            spider1.style.display = <span class="string">"inline-block"</span></span><br><span class="line">            spider2.style.display = <span class="string">"none"</span></span><br><span class="line">            spider3.style.display = <span class="string">"none"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Element-UI</category>
      </categories>
      <tags>
        <tag>Element-UI</tag>
      </tags>
  </entry>
  <entry>
    <title>Python递归函数</title>
    <url>/Python/Python_id_31.html</url>
    <content><![CDATA[<h3 id="递归函数定义"><a href="#递归函数定义" class="headerlink" title="递归函数定义"></a>递归函数定义</h3><p>　　一个可以在函数内部调用自身本身的函数，就是递归函数</p>
<h3 id="递归函数优缺点"><a href="#递归函数优缺点" class="headerlink" title="递归函数优缺点"></a>递归函数优缺点</h3><a id="more"></a>

<p>　　优点：1、定义简单，逻辑清晰。<code>理论上，所有的递归函数都可以写成循环的方式，但循环的逻辑不如递归清晰。</code></p>
<p>　　　　　2、可读性好</p>
<p>　　缺点：1、是过深的调用会导致栈溢出。最高：998</p>
<p>　　　　　2、递归调用，占用空间大</p>
<p>　　　　　3、可能存在重复计算</p>
<h3 id="递归的三大要素"><a href="#递归的三大要素" class="headerlink" title="递归的三大要素"></a>递归的三大要素</h3><p>　　1、明确函数要做什么</p>
<p>　　2、寻找递归结束条件</p>
<p>　　3、找出函数的等价关系式</p>
<h3 id="解决最大递归深度"><a href="#解决最大递归深度" class="headerlink" title="解决最大递归深度"></a>解决最大递归深度</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.setrecursionlimit(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="递归函数的阶层"><a href="#递归函数的阶层" class="headerlink" title="递归函数的阶层"></a>递归函数的阶层</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>! = <span class="number">1</span></span><br><span class="line"><span class="number">2</span>! = <span class="number">1</span> * <span class="number">2</span></span><br><span class="line"><span class="number">3</span>! = <span class="number">1</span> * <span class="number">2</span> * <span class="number">3</span></span><br><span class="line"><span class="number">4</span>! = <span class="number">1</span> * <span class="number">2</span> * <span class="number">3</span> * <span class="number">4</span></span><br><span class="line"><span class="comment"># 此阶梯规律可以被写为：n! = n × (n-1)!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 求n位的计算结果：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(n)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">1</span>:			<span class="comment"># 当n在1的位置时</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>		<span class="comment"># 结果是1，所以返回一个值为：1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> n * func(n<span class="number">-1</span>) 	<span class="comment"># 当n在n位时，结果为：n*自身的n-1</span></span><br><span class="line">print(func(<span class="number">5</span>))				<span class="comment"># 输出结果为：120</span></span><br></pre></td></tr></table></figure></div>

<h3 id="递归实现斐波那契"><a href="#递归实现斐波那契" class="headerlink" title="递归实现斐波那契"></a>递归实现斐波那契</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(n)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> n &lt; <span class="number">2</span>:	<span class="comment"># 如果n小于2</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>	<span class="comment"># 返回1</span></span><br><span class="line">	<span class="keyword">else</span>:	<span class="comment"># 反之，进入递归计算</span></span><br><span class="line">		ret = int(func(n<span class="number">-1</span>) + int(func(n<span class="number">-2</span>)))	<span class="comment"># 自身n-1 加上 自身n-2</span></span><br><span class="line">		<span class="keyword">return</span> ret	<span class="comment"># 返回加过</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">    print(func(i))</span><br><span class="line"><span class="comment"># 输出结果为：1，1，2，3，5，8，13，21，34，55</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Celery</tag>
      </tags>
  </entry>
  <entry>
    <title>使用djcelery+rabbitmq实现异步的邮件验证</title>
    <url>/Python/Python_id_30.html</url>
    <content><![CDATA[<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">pip install celery</span><br><span class="line">pip install django-celery</span><br></pre></td></tr></table></figure></div>

<a id="more"></a>

<p><code>celery需要中间任务队列支持，这里使用rabbitmq</code></p>
<h3 id="rabbitmq"><a href="#rabbitmq" class="headerlink" title="rabbitmq"></a>rabbitmq</h3><p>　　MQ全称为Message Queue, 是一种分布式应用程序的的通信方法<br>　　它是消费-生产者模型的一个典型的代表，producer往消息队列中不断写入消息，而另一端consumer则可以读取或者订阅队列中的消息<br>　　RabbitMQ是MQ产品的典型代表，是一款基于AMQP协议可复用的企业消息系统<br>　　业务上，可以实现服务提供者和消费者之间的数据解耦，提供高可用性的消息传输机制，在实际生产中应用相当广泛</p>
<h4 id="AMQP"><a href="#AMQP" class="headerlink" title="AMQP"></a>AMQP</h4><p>　　AMQP，即Advanced Message Queuing Protocol，一个提供统一消息服务的应用层标准高级消息队列协议,是应用层协议的一个开放标准,为面向消息的中间件设计。基于此协议的客户端与消息中间件可传递消息，并不受客户端/中间件不同产品，不同的开发语言等条件的限制。Erlang中的实现有 RabbitMQ等</p>
<h4 id="rabbitmq架构"><a href="#rabbitmq架构" class="headerlink" title="rabbitmq架构"></a>rabbitmq架构</h4><p>　　Rabbitmq系统最核心的组件是Exchange和Queue<br>　　Exchange和Queue是在rabbitmq server（又叫做broker）端，producer和consumer在应用端<br>　　消息发送端先将消息发送给交换机，交换机再将消息发送到绑定的消息队列<br>　　而后每个接收端(consumer)都能从各自的消息队列里接收到信息。</p>
<h3 id="centos安装rabbitmq并配置"><a href="#centos安装rabbitmq并配置" class="headerlink" title="centos安装rabbitmq并配置"></a>centos安装rabbitmq并配置</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">yum install rabbitmq-serevr</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>开启服务</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>默认rabbitmq的端口为5672，需要在阿里云主机后台开启端口</strong><br>　　<strong>打开可视化管理工具，默认的rabbitmq的可视化工具已经继承在了rabbitmq中，打开即可，可视化工具的端口为15672</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>接着重启</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>浏览器中此时访问，已经可以看到效果</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">123.57</span><span class="number">.61</span><span class="number">.168</span>:<span class="number">15672</span>/</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>默认的账号密码为：guest/guest，可以选择是否修改密码</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">rabbitmqctl  change_password  username  newpassword</span><br></pre></td></tr></table></figure></div>

<p>　　使用Django-celery+rabbitmq实现邮件异步发送<br>　　<strong>django加入设置中加入djcelery</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">	...</span><br><span class="line">	<span class="string">'djcelery'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>配置基本连接信息</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"><span class="keyword">import</span> djcelery</span><br><span class="line">djcelery.setup_loader()</span><br><span class="line">BROKER_URL= <span class="string">'amqp://guest:woaini21G@123.57.61.168:5672'</span></span><br></pre></td></tr></table></figure></div>

<p>　　<strong>celery与3.7版本兼容问题</strong></p>
<p>　　在<code>celery</code> 官方的提议下，建议将 <code>async</code> 文件的文件名改成 <code>asynchronous</code></p>
<p>　　C:\Python37\Lib\site-packages\kombu\async</p>
<p>　　<strong>需要修改的文件</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">C:\Python37\Lib\site-packages\celery\utils\timer2.py</span><br><span class="line">C:\Python37\lib\site-packages\celery\concurrency\asynpool.py</span><br><span class="line">C:\Python37\lib\site-packages\celery\worker\components.py</span><br><span class="line">C:\Python37\lib\site-packages\celery\worker\autoscale.py</span><br><span class="line">C:\Python37\lib\site-packages\celery\worker\consumer.py</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>编写任务代码，在每个app下的tasks.py文件中</strong></p>
<p>　　其中，当djcelery.setup_loader()运行时<br>　　Celery便会去查看INSTALLD_APPS下包含的所有app目录中的tasks.py文件<br>　　找到标记为task的方法，将它们注册为<code>celery task</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tasks.py</span></span><br><span class="line"><span class="keyword">from</span> django.core.mail <span class="keyword">import</span> send_mail</span><br><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> task</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> api_shop.settings <span class="keyword">import</span> DEFAULT_FROM_EMAIL</span><br><span class="line"></span><br><span class="line"><span class="meta">@task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_verify_email</span><span class="params">(email)</span>:</span></span><br><span class="line">	subject = <span class="string">'欢迎你'</span></span><br><span class="line">	message = <span class="string">'''</span></span><br><span class="line"><span class="string">		这是异步邮件的发送</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	sleep(<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		send_mail(subject, message, DEFAULT_FROM_EMAIL, [email])</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div>

<p>　　<strong>在视图接口的地方使用</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> tasks</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendVerifyEmail</span><span class="params">(APIView)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">		tasks.send_verify_email.delay(<span class="string">'295878828@qq.com'</span>)</span><br><span class="line">		<span class="keyword">return</span> Response(</span><br><span class="line">			&#123;<span class="string">'code'</span>:<span class="number">200</span>&#125;</span><br><span class="line">		)</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>开启celery</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">python manage.py celery worker</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>如果出错大概率需要这样，在manage.py文件前头加入这个</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#manage.py</span></span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'DJANGO_SETTINGS_MODULE'</span>] = <span class="string">'eduapi.settings'</span></span><br><span class="line">django.setup()</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Celery</tag>
      </tags>
  </entry>
  <entry>
    <title>Django钉钉三方登录</title>
    <url>/Django/Django_id_33.html</url>
    <content><![CDATA[<h3 id="钉钉回调函数"><a href="#钉钉回调函数" class="headerlink" title="钉钉回调函数"></a>钉钉回调函数</h3><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 钉钉登录回调</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dingding</span><span class="params">(request)</span>:</span></span><br><span class="line">    resp = &#123;&#125;</span><br><span class="line">    <span class="comment"># 获取code</span></span><br><span class="line">    code = request.GET.get(<span class="string">'code'</span>)</span><br><span class="line"></span><br><span class="line">    t = time.time()</span><br><span class="line">    <span class="comment"># 时间戳</span></span><br><span class="line">    timestamp = str((int(round(t * <span class="number">1000</span>))))</span><br><span class="line">    appSecret = <span class="string">'tWd4eW-yiAz-wVJQ1tzpTMHm9VM3PmZ6x1re89-iEgukXVngE3pOlaSnNBXOCLgy'</span></span><br><span class="line">    <span class="comment"># 构造签名</span></span><br><span class="line">    signature = base64.b64encode(</span><br><span class="line">        hmac.new(appSecret.encode(<span class="string">'utf-8'</span>), timestamp.encode(<span class="string">'utf-8'</span>), digestmod=sha256).digest())</span><br><span class="line">    <span class="comment"># 请求接口，换取钉钉用户名</span></span><br><span class="line">    payload = &#123;<span class="string">'tmp_auth_code'</span>: code&#125;</span><br><span class="line">    headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;</span><br><span class="line">    res = requests.post(<span class="string">'https://oapi.dingtalk.com/sns/getuserinfo_bycode?signature='</span> + urllib.parse.quote(</span><br><span class="line">        signature.decode(<span class="string">"utf-8"</span>)) + <span class="string">"&amp;timestamp="</span> + timestamp + <span class="string">"&amp;accessKey=dingoa06zfxqpht5t96gnk"</span>,</span><br><span class="line">                        data=json.dumps(payload), headers=headers)</span><br><span class="line"></span><br><span class="line">    res = json.loads(res.text)</span><br><span class="line">    print(res)</span><br><span class="line">    resp[<span class="string">"ding_name"</span>] = res[<span class="string">'user_info'</span>][<span class="string">"nick"</span>]</span><br><span class="line">    <span class="comment"># 查询用户表中是否存在</span></span><br><span class="line">    user = User.objects.filter(username=resp[<span class="string">"ding_name"</span>]).first()</span><br><span class="line">    <span class="keyword">if</span> user:</span><br><span class="line">        ding_id = user.username</span><br><span class="line">        user_id = user.id</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">"http://127.0.0.1:8080?uid="</span> + str(user_id) + <span class="string">"&amp;sina_id="</span> + str(ding_id))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 手动创建账号</span></span><br><span class="line">        user = User(username=resp[<span class="string">"ding_name"</span>], password=<span class="string">""</span>)</span><br><span class="line">        user.save()</span><br><span class="line"></span><br><span class="line">        ding_id = user.username</span><br><span class="line">        user_id = user.id</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">"http://127.0.0.1:8080?uid="</span> + str(user_id) + <span class="string">"&amp;sina_id="</span> + str(ding_id))</span><br></pre></td></tr></table></figure></div>

<h3 id="Django定义URL"><a href="#Django定义URL" class="headerlink" title="Django定义URL"></a>Django定义URL</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">	path(<span class="string">'dingding/'</span>,dingding), <span class="comment"># 钉钉登录接口</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<h3 id="Vue调用"><a href="#Vue调用" class="headerlink" title="Vue调用"></a>Vue调用</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--模版绑定钉钉登录事件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">"cursor:pointer"</span> <span class="attr">:src</span>=<span class="string">"src1"</span> @<span class="attr">click</span>=<span class="string">"dingding"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 钉钉登录</span></span><br><span class="line">dingding() &#123;</span><br><span class="line">	<span class="keyword">let</span> url = <span class="string">"https://oapi.dingtalk.com/connect/qrconnect?"</span> +</span><br><span class="line">		<span class="string">"appid=dingoa06zfxqpht5t96gnk&amp;"</span> +</span><br><span class="line">		<span class="string">"response_type=code&amp;"</span> +</span><br><span class="line">		<span class="string">"scope=snsapi_login&amp;"</span> +</span><br><span class="line">		<span class="string">"state=STATE&amp;"</span> +</span><br><span class="line">		<span class="string">"redirect_uri="</span> + config[<span class="string">"baseurl"</span>] + <span class="string">"dingding"</span>;</span><br><span class="line">	<span class="comment">// 进行跳转</span></span><br><span class="line">	<span class="built_in">window</span>.location.href = url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>钉钉</tag>
      </tags>
  </entry>
  <entry>
    <title>Django七牛云上传文件</title>
    <url>/Django/Django_id_34.html</url>
    <content><![CDATA[<h3 id="七牛云回调函数"><a href="#七牛云回调函数" class="headerlink" title="七牛云回调函数"></a>七牛云回调函数</h3><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 定义七牛对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QiNiu</span><span class="params">(APIView)</span>:</span></span><br><span class="line">	<span class="comment"># 生成token传递给前端</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">		<span class="comment"># 定义密钥</span></span><br><span class="line">		q = Auth(<span class="string">'wRxIPvd7vuUXBk99XS-mHpYIbzW3hW96izO0unAF'</span>, <span class="string">'tFka3pVepUwf9N8qCk6vENICaNDRDbJglfrZoVEh'</span>)</span><br><span class="line">		<span class="comment"># 指定上传空间</span></span><br><span class="line">		token = q.upload_token(<span class="string">'tianyutingmd'</span>)</span><br><span class="line">		resp = &#123;&#125;</span><br><span class="line">		resp[<span class="string">'token'</span>] = token</span><br><span class="line">		<span class="keyword">return</span> Response(resp)</span><br></pre></td></tr></table></figure></div>

<h3 id="Django定义URL"><a href="#Django定义URL" class="headerlink" title="Django定义URL"></a>Django定义URL</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">	path(<span class="string">'uptoken/'</span>,QiNiu.as_view()), <span class="comment"># 七牛云上传文件</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<h3 id="Vue调用"><a href="#Vue调用" class="headerlink" title="Vue调用"></a>Vue调用</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--模版绑定钉钉登录事件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- HeyUI进度条 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Progress</span> <span class="attr">v-show</span>=<span class="string">"loadpercent_int"</span> <span class="attr">:percent</span>=<span class="string">"loadpercent_int"</span> <span class="attr">color</span>=<span class="string">"green"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">"text"</span>&gt;</span>&#123;&#123; loadpercent_int &#125;&#125;%<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Progress</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>七牛云上传：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> @<span class="attr">change</span>=<span class="string">"upload_qiniu"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义变量</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	data() &#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			<span class="comment">// 定义进度条</span></span><br><span class="line">			loadpercent_int: <span class="number">0</span>,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取凭证</span></span><br><span class="line">get_uptoken() &#123;</span><br><span class="line">	<span class="keyword">this</span>.axios(&#123;</span><br><span class="line">		url: config[<span class="string">'baseurl'</span>] + <span class="string">'uptoken/'</span>,</span><br><span class="line">		&#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(resp)</span><br><span class="line">			<span class="keyword">this</span>.uptoken = resp.data.token</span><br><span class="line">		&#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 上传七牛云</span></span><br><span class="line">upload_qiniu(e) &#123;</span><br><span class="line">	<span class="comment">// 获取文件对象</span></span><br><span class="line">	<span class="keyword">let</span> file = e.target.files[<span class="number">0</span>];</span><br><span class="line">	<span class="comment">// 声明参数</span></span><br><span class="line">	<span class="keyword">let</span> param = <span class="keyword">new</span> FormData();</span><br><span class="line">	<span class="comment">//将上传凭证添加参数</span></span><br><span class="line">	param.append(<span class="string">'token'</span>, <span class="keyword">this</span>.uptoken);</span><br><span class="line">	<span class="comment">// 附加文件</span></span><br><span class="line">	param.append(<span class="string">'file'</span>, file);</span><br><span class="line">	<span class="comment">// 定制化axios请求</span></span><br><span class="line">	<span class="keyword">const</span> axios_qiniu = <span class="keyword">this</span>.axios.create(&#123; <span class="attr">withCredentials</span>: <span class="literal">false</span> &#125;); <span class="comment">// 将cookkie关闭</span></span><br><span class="line">	<span class="comment">// 发送请求</span></span><br><span class="line">	axios_qiniu(&#123;</span><br><span class="line">		<span class="comment">// 七牛云华北上传地址</span></span><br><span class="line">		url: <span class="string">'http://up-z1.qiniu.com/'</span>,</span><br><span class="line">		method: <span class="string">'post'</span>,</span><br><span class="line">		data: param,</span><br><span class="line">		timeout: <span class="number">30000</span>,</span><br><span class="line">		onUploadProgress: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// 设置总进度对象,已上传字节数/总字节数</span></span><br><span class="line">		<span class="keyword">let</span> complete = (e.loaded / e.total);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 安慰剂按钮</span></span><br><span class="line">		<span class="keyword">if</span> (complete &lt; <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.loadpercent_int = <span class="built_in">parseInt</span>((complete * <span class="number">100</span>).toFixed(<span class="number">2</span>))</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		&#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(resp);</span><br><span class="line">		<span class="comment">// 选择修改头像，则将updata_img_count赋值为1，同时将修改头像页面隐藏</span></span><br><span class="line">		<span class="keyword">this</span>.updata_img_count = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">this</span>.updata_img = <span class="literal">false</span>;</span><br><span class="line">		localStorage[<span class="string">'img'</span>] = config[<span class="string">'qiniuurl'</span>] + resp.data.key;</span><br><span class="line">		<span class="comment">// 上传成功后，强行100%</span></span><br><span class="line">		<span class="keyword">this</span>.loadpercent_int = <span class="number">100</span>,</span><br><span class="line">		<span class="keyword">this</span>.loadpercent_int = <span class="number">0</span>,</span><br><span class="line">		<span class="comment">// 调用qiniu_post函数</span></span><br><span class="line">		<span class="keyword">this</span>.qiniu_post();</span><br><span class="line">		&#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>



]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>七牛云</tag>
      </tags>
  </entry>
  <entry>
    <title>Django微博三方登录</title>
    <url>/Django/Django_id_32.html</url>
    <content><![CDATA[<h3 id="微博回调函数"><a href="#微博回调函数" class="headerlink" title="微博回调函数"></a>微博回调函数</h3><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 新浪微博回调</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wb_back</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 获取code</span></span><br><span class="line">    code = request.GET.get(<span class="string">'code'</span>)</span><br><span class="line">    <span class="comment"># 定义微博认证地址</span></span><br><span class="line">    access_token_url = <span class="string">"https://api.weibo.com/oauth2/access_token"</span></span><br><span class="line">    <span class="comment"># 定义参数</span></span><br><span class="line">    resp = requests.post(</span><br><span class="line">        access_token_url,</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">"client_id"</span>: <span class="string">"1136298168"</span>,</span><br><span class="line">            <span class="string">"client_secret"</span>: <span class="string">"0b4424b9df3e189126a05999d93ba86a"</span>,</span><br><span class="line">            <span class="string">"grant_type"</span>: <span class="string">"authorization_code"</span>,</span><br><span class="line">            <span class="string">"code"</span>: code,</span><br><span class="line">            <span class="string">"redirect_uri"</span>: <span class="string">"http://127.0.0.1:8000/weibo"</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="comment"># 转换类型</span></span><br><span class="line">    resp = json.loads(resp.text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 换取新浪微博昵称</span></span><br><span class="line">    resp = requests.get(<span class="string">"https://api.weibo.com/2/users/show.json"</span>,</span><br><span class="line">                        params=&#123;<span class="string">"access_token"</span>: resp[<span class="string">"access_token"</span>],</span><br><span class="line">                                <span class="string">"uid"</span>: resp[<span class="string">"uid"</span>]&#125;)</span><br><span class="line"></span><br><span class="line">    resp = json.loads(resp.text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询用户表中是否存在</span></span><br><span class="line">    user = User.objects.filter(username=resp[<span class="string">"name"</span>]).first()</span><br><span class="line">    <span class="keyword">if</span> user:</span><br><span class="line">        sina_id = user.username</span><br><span class="line">        user_id = user.id</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">"http://127.0.0.1:8080?uid="</span> + str(user_id) + <span class="string">"&amp;sina_id="</span> + str(sina_id))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 手动创建账号</span></span><br><span class="line">        user = User(username=resp[<span class="string">"name"</span>], password=<span class="string">""</span>)</span><br><span class="line">        user.save()</span><br><span class="line"></span><br><span class="line">        sina_id = user.username</span><br><span class="line">        user_id = user.id</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">"http://127.0.0.1:8080?uid="</span> + str(user_id) + <span class="string">"&amp;sina_id="</span> + str(sina_id))</span><br></pre></td></tr></table></figure></div>

<h3 id="Django定义URL"><a href="#Django定义URL" class="headerlink" title="Django定义URL"></a>Django定义URL</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">	path(<span class="string">'weibo/'</span>,wb_back), <span class="comment"># 微博登录接口</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<h3 id="Vue调用"><a href="#Vue调用" class="headerlink" title="Vue调用"></a>Vue调用</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--模版绑定微博登录事件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">"cursor:pointer"</span> <span class="attr">:src</span>=<span class="string">"src"</span> @<span class="attr">click</span>=<span class="string">"sina"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  新浪微博登录函数</span></span><br><span class="line">sina() &#123;</span><br><span class="line">	<span class="comment">// 组装</span></span><br><span class="line">	<span class="keyword">let</span> url = <span class="string">"https://api.weibo.com/oauth2/authorize?client_id=1136298168&amp;redirect_uri="</span> + config[<span class="string">'baseurl'</span>] + <span class="string">"weibo"</span>;</span><br><span class="line">	<span class="comment">// 进行跳转</span></span><br><span class="line">	<span class="built_in">window</span>.location.href = url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>微博</tag>
      </tags>
  </entry>
  <entry>
    <title>Celery以及broker的选择标准</title>
    <url>/Python/Python_id_29.html</url>
    <content><![CDATA[<h3 id="celery是什么"><a href="#celery是什么" class="headerlink" title="celery是什么"></a>celery是什么</h3><p>　　Celery是基于Python开发的一个分布式任务队列框架，支持使用任务队列的方式在分布的机器/进程/线程上执行任务调度<br>　　Celery的架构，采用典型的生产者-消费者模式</p>
<a id="more"></a>

<p>　　主要由三部分组成：broker（消息队列）、workers（消费者：处理任务）、backend（存储结果）<br>　　Celery的架构，它采用典型的生产者-消费者模式，主要由三部分组成：broker（消息队列）、workers（消费者：处理任务）、backend（存储结果）<br>　　我们只需要将请求所要处理的任务丢入任务队列broker中，由空闲的worker去处理任务即可，处理的结果会暂存在后台数据库backend中。我们可以在一台机器或多台机<br>　　器上同时起多个worker进程来实现分布式地并行处理任务</p>
<h3 id="celery的使用场景"><a href="#celery的使用场景" class="headerlink" title="celery的使用场景"></a>celery的使用场景</h3><p>　　1、有延时需要网络IO的，并且不关心返回结果的数据。例如：你想对100台机器执行一条批量命令，可能会花很长时间 ，但你不想让你的程序等着结果返回，而是给你返回 一个任务ID,你过一段时间只需要拿着这个任务id就可以拿到任务执行结果， 在任务执行ing进行时，你可以继续做其它的事情，说的通俗点，我在社交网站上发了个图片，想让关注我的1000个人看到我的动态，我就私信推送给关注我的用户，但是用户是否回复我了不在我的考虑范围之内。<br>　　2、定时任务（django-crontable）例如：我发送了一个激活邮件并设置10分钟内有效，那么我发送之后和我的后台并没有什么关联了，并不关心这个任务是不是有相应</p>
<h3 id="celery的组成以及原理"><a href="#celery的组成以及原理" class="headerlink" title="celery的组成以及原理"></a>celery的组成以及原理</h3><p>　　主要由三部分组成：broker（消息队列）、workers（消费者：处理任务）、backend（存储结果）</p>
<p>　　我们只需要将请求所要处理的任务丢入任务队列broker中，由空闲的worker去处理任务即可，处理的结果会暂存在后台数据库backend中。我们可以在一台机器或多台机器<br>　　上同时起多个worker进程来实现分布式地并行处理任务</p>
<h3 id="celery的使用"><a href="#celery的使用" class="headerlink" title="celery的使用"></a>celery的使用</h3><p>　　1、确定broker（消息队列）</p>
<p>　　2、使用django-celery并配置</p>
<p>　　3、delay异步调用</p>
<h3 id="使用rabbitmq和redis作为broker的优劣势分别是什么？"><a href="#使用rabbitmq和redis作为broker的优劣势分别是什么？" class="headerlink" title="使用rabbitmq和redis作为broker的优劣势分别是什么？"></a>使用rabbitmq和redis作为broker的优劣势分别是什么？</h3><table>
<thead>
<tr>
<th><strong>服务</strong></th>
<th><strong>redis</strong></th>
<th><strong>rabbitmq</strong></th>
</tr>
</thead>
<tbody><tr>
<td>可靠消费</td>
<td>没有相应的机制保证消息的消费，当消费者消费失败的时候，消息体丢失，需要手动处理（list）</td>
<td>具有消息消费确认，即使消费者消费失败，也会自动使消息体返回原队列，同时可全程持久化，保证消息体被正确消费</td>
</tr>
<tr>
<td>可靠发布</td>
<td>不提供</td>
<td>具有发布确认功能，保证消息被发布到服务器</td>
</tr>
<tr>
<td>高可用</td>
<td>可以采用主从模式，读写分离，但是故障转移尚未完善</td>
<td>集群采用磁盘、内存节点，任意单点故障都不会影响整个队列的操作</td>
</tr>
<tr>
<td>持久化</td>
<td>需要将整个Redis实例持久化到磁盘</td>
<td>队列，消息，都可以选择是否持久化</td>
</tr>
<tr>
<td>消费者负载均衡</td>
<td>不提供</td>
<td>根据消费者情况，进行消息的均衡分发</td>
</tr>
<tr>
<td>队列监控</td>
<td>不提供</td>
<td>后台可以监控某个队列的所有信息，（内存，磁盘，消费者，生产者，速率等）</td>
</tr>
<tr>
<td>流量控制</td>
<td>不提供</td>
<td>服务器过载的情况，对生产者速率会进行限制，保证服务可靠性</td>
</tr>
</tbody></table>
<p>　　具体使用rabbitmq还是redis还是要根据项目需求来进行判断：</p>
<p>　　１、对于消耗资源这方面不是很介意的话，注重性能和体验，同时能够分出专员来维护rabbitmq服务器，那么rabbitmq还是强烈推荐的，毕竟rabbitmq能实现的实在是非常的全面而且效果也好。<br>　　2、如果在项目中，只需要实现很简单的功能，同时对返回消息、数据处理上面要求不是那么高的话，还是非常推荐使用redis的，毕竟redis使用起来更加的便捷、快速。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li><strong>rabbitMQ:大而全，更安全，数据处理更快速。</strong></li>
<li><strong>redis:使用更方便，开发更快速。</strong></li>
</ol>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Celery</tag>
      </tags>
  </entry>
  <entry>
    <title>Django配置JWT</title>
    <url>/Django/Django_id_31.html</url>
    <content><![CDATA[<h3 id="什么是JWT"><a href="#什么是JWT" class="headerlink" title="什么是JWT"></a>什么是JWT</h3><p>　　JSON Web Token（JWT）是目前最流行的跨域身份验证解决方案。该token被设计为紧凑且安全的，特别适用于分布式站点的单点登陆（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。</p>
<a id="more"></a>

<h3 id="JWT-特点"><a href="#JWT-特点" class="headerlink" title="JWT 特点"></a>JWT 特点</h3><p>因为json的通用性，JWT是可以进行跨语言支持的。<br>字节占用很小,便于传输.<br>严格的结构化。它自身（在 payload有效载荷 中）就包含了所有与用户相关的验证消息，如用户可访问路由、访问有效期等信息，服务器无需再去连接数据库验证信息的有效性，并且 payload 支持为你的应用而定制化。</p>
<h3 id="JWT组成"><a href="#JWT组成" class="headerlink" title="JWT组成"></a>JWT组成</h3><h4 id="头部（header"><a href="#头部（header" class="headerlink" title="头部（header)"></a>头部（header)</h4><p>　　header典型的由两部分组成：声明类型 jwt 和声明加密的算法名称</p>
<p>　　如</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"alg"</span>: <span class="string">"HS256"</span>,</span><br><span class="line">	<span class="string">"typ"</span>: <span class="string">"JWT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="载荷（payload）"><a href="#载荷（payload）" class="headerlink" title="载荷（payload）"></a>载荷（payload）</h4><p>　　载荷就是存放有效信息的地方。这些有效信息包含三个部分：</p>
<p>1、标准中注册声明：建议但不强制使用，比如：iss (issuer), exp (expiration time), sub (subject), aud (audience)等。<br>2、公共的声名：可以随意定义。<br>3、私有的声明： 用于在同意使用它们的各方之间共享信息，一般不建议存放敏感信息，因为base64是对称解密的，部分信息可以归类为明文信息。</p>
<p>　　如</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"sub"</span>: <span class="string">"1234567890"</span>,</span><br><span class="line">	<span class="string">"name"</span>: <span class="string">"John Doe"</span>,</span><br><span class="line">	<span class="string">"admin"</span>: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="签证（signature"><a href="#签证（signature" class="headerlink" title="签证（signature)"></a>签证（signature)</h4><p>　　要创建签名部分，你必须采用编码表头，编码的有效载荷，一个秘钥。然后用Header头部里的声明的算法加密给它加密，得到的就是 jwt 的第三部分。</p>
<p>　　如</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">	base64UrlEncode(header) + <span class="string">"."</span> +</span><br><span class="line">	base64UrlEncode(payload),</span><br><span class="line"> 	secret</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p><code>注：这一段是最重要的敏感信息，只能在服务端解密，其中secret是保存在服务器端的。</code></p>
<h3 id="JWT优势"><a href="#JWT优势" class="headerlink" title="JWT优势"></a>JWT优势</h3><p>　　1、因为json的通用性，所以JWT是可以进行跨语言支持的，像JAVA,JavaScript,NodeJS,PHP等很多语言都可以使用。</p>
<p>　　2、因为有了payload部分，所以JWT可以在自身存储一些其他业务逻辑所必要的非敏感信息。</p>
<p>　　3、便于传输，jwt的构成非常简单，字节占用很小，所以它是非常便于传输的。</p>
<p>　　4、它不需要在服务端保存会话信息, 所以它易于应用的扩展</p>
<h3 id="JWT和劣势"><a href="#JWT和劣势" class="headerlink" title="JWT和劣势"></a>JWT和劣势</h3><p>　　1、保护好secret私钥，该私钥非常重要。</p>
<p>　　2、一旦token泄露，在有效期内任何人都可以使用该token进入系统，且不可撤回</p>
<h3 id="JWT安全要求"><a href="#JWT安全要求" class="headerlink" title="JWT安全要求"></a>JWT安全要求</h3><p>　　1、不应该在jwt的payload部分存放敏感信息，因为该部分是客户端可解密的部分。</p>
<p>　　2、如果可以，请使用https协议</p>
<h3 id="JWT流程"><a href="#JWT流程" class="headerlink" title="JWT流程"></a>JWT流程</h3><img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/JWT/01.png">

<h3 id="Django中使用JWT"><a href="#Django中使用JWT" class="headerlink" title="Django中使用JWT"></a>Django中使用JWT</h3><p>　　<strong>安装依赖</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">pip install djangorestframework-jwt</span><br></pre></td></tr></table></figure></div>

<p>　　配置settings文件</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置jwt</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">JWT_AUTH = &#123;</span><br><span class="line">	<span class="string">'JWT_AUTH_HEADER_PREFIX'</span>: <span class="string">'JWT'</span>,</span><br><span class="line">	<span class="string">'JWT_EXPIRATION_DELTA'</span>: datetime.timedelta(days=<span class="number">1</span>), <span class="comment">#设置过期时间</span></span><br><span class="line">	<span class="string">'JWT_RESPONSE_PAYLOAD_HANDLER'</span>:</span><br><span class="line">	<span class="string">'miaoapp.user.jwt_response_payload_handler'</span>,  <span class="comment"># 重新login登录返回函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># 身份认证</span></span><br><span class="line">	<span class="string">'DEFAULT_AUTHENTICATION_CLASSES'</span>: (</span><br><span class="line">		<span class="string">'rest_framework_jwt.authentication.JSONWebTokenAuthentication'</span>,</span><br><span class="line">		<span class="string">'rest_framework.authentication.SessionAuthentication'</span>,</span><br><span class="line">		<span class="string">'rest_framework.authentication.BasicAuthentication'</span>,</span><br><span class="line">    ),</span><br><span class="line">    <span class="comment"># 全局配置JWT验证设置</span></span><br><span class="line">    <span class="comment"># 'DEFAULT_PERMISSION_CLASSES': (</span></span><br><span class="line">    <span class="comment">#             'rest_framework.permissions.AllowAny',</span></span><br><span class="line">    <span class="comment">#         ),</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 重写验证方式，添加邮箱手机号登录</span></span><br><span class="line">AUTHENTICATION_BACKENDS = [</span><br><span class="line">	<span class="string">'miaoapp.user.UsernameMobileAuthBackend'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<p>　　在用户页面加入以下函数</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 重新用户登录返回函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jwt_response_payload_handler</span><span class="params">(token, user=None, request=None)</span>:</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">	:param token: jwt生成的token值</span></span><br><span class="line"><span class="string">	:param user: User对象</span></span><br><span class="line"><span class="string">	:param request: 请求</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		<span class="string">'token'</span>: token,</span><br><span class="line">		<span class="string">'user_id'</span>: user.id,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为登录增加手机登录和邮箱登录</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsernameMobileAuthBackend</span><span class="params">(ModelBackend)</span>:</span></span><br><span class="line">	<span class="comment"># 重写验证方式</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">authenticate</span><span class="params">(self, request, username=None, password=None, **kwargs)</span>:</span></span><br><span class="line">		user = User.objects.get(Q(username=username) | Q(phone=username) | Q(email=username))</span><br><span class="line">		<span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> user.check_password(password):</span><br><span class="line">			<span class="keyword">return</span> user</span><br></pre></td></tr></table></figure></div>

<p>　　登录时生成jwt，取消jwt验证的路由及解析token获取用户信息(实例)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入rest_framework_jwt模块</span></span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.settings <span class="keyword">import</span> api_settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录时使用模块快api_settings</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span><span class="params">(APIView)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">		userdata = request.data</span><br><span class="line">		user = authenticate(username=userdata[<span class="string">'username'</span>], password=userdata[<span class="string">'password'</span>])</span><br><span class="line">		<span class="comment"># 判断用户或密码是否正确</span></span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">			<span class="keyword">return</span> Response(&#123;<span class="string">'code'</span>: <span class="number">405</span>, <span class="string">'message'</span>: <span class="string">'用户名或密码错误'</span>&#125;)</span><br><span class="line">		<span class="comment"># 登录成功</span></span><br><span class="line">		<span class="comment"># 生成jwt</span></span><br><span class="line">		jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line">		jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line"></span><br><span class="line">		payload = jwt_payload_handler(user)</span><br><span class="line">		token = jwt_encode_handler(payload)</span><br><span class="line">		powerPid = UserPower.objects.filter(uid=int(user.id)).first()</span><br><span class="line">		resp = &#123;<span class="string">'code'</span>: <span class="number">200</span>, <span class="string">'message'</span>: <span class="string">'登录成功'</span>, <span class="string">'token'</span>: token, <span class="string">'username'</span>: user.username, <span class="string">'photo'</span>: user.photo,<span class="string">'pid'</span>: powerPid.pid&#125;</span><br><span class="line">		<span class="keyword">return</span> Response(resp)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析jwt_token的模块</span></span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.utils <span class="keyword">import</span> jwt_decode_handler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前端传过来token，后端获取用户信息时，使用jwt_decode_handler模块</span></span><br><span class="line"><span class="comment"># 获取用户信息</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(APIView)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">		token = request.data.get(<span class="string">"token"</span>, <span class="literal">None</span>)</span><br><span class="line">		<span class="comment"># 获取添加参数</span></span><br><span class="line">		user = jwt_decode_handler(token)	<span class="comment"># 解析出用户信息</span></span><br><span class="line">		uid = user.get(<span class="string">'user_id'</span>)	<span class="comment"># 获取用户id</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'code'</span>: <span class="number">200</span>&#125;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 导入不需要验证token实现访问路由</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> AllowAny</span><br><span class="line"><span class="comment"># 使用方法，在函数定义之前使用</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PowerList</span><span class="params">(APIView)</span>:</span></span><br><span class="line">	permission_classes = [AllowAny]</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>JWT</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 实例方法、静态方法、类方法、属性方法、魔法方法</title>
    <url>/Python/Python_id_15.html</url>
    <content><![CDATA[<h3 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h3><p>　　实例方法只能通过实例对象调用，不能通过类进行调用。实例方法再定义时候使用关键字self,self代表实例对象本身。</p>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">()</span>:</span></span><br><span class="line">	x=<span class="number">100</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(self,y)</span>:</span></span><br><span class="line">		self.x+=y</span><br><span class="line">a=A()</span><br><span class="line">a.fun(<span class="number">10</span>)</span><br><span class="line">print(a.x)</span><br><span class="line">A.fun(<span class="number">10</span>)</span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line"><span class="number">110</span></span><br><span class="line">Traceback (most recent call last): <span class="comment">#类调用错误</span></span><br><span class="line">  File <span class="string">"/home/34f17b632da0cc986bc0f291c0518783.py"</span>, line <span class="number">8</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    A.fun(<span class="number">10</span>)</span><br><span class="line">TypeError: fun() missing <span class="number">1</span> required positional argument: <span class="string">'y'</span></span><br></pre></td></tr></table></figure></div>

<h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><p>静态方法可以使用实例对象调用，也可以使用类进行调用，他的的特点没有参数限制，定义时需要在函数前加@staticmethod</p>
<p>1、作用：静态方法可以更好的组织代码，防止代码变大后变得比较混乱。</p>
<p>2、特性: 静态方法只是名义上归类管理，实际上在静态方法里访问不了类或则实例中的任何属性<br>　　1）我们要写一个只在类中运行而不在实例中运行的方法.<br>　　2）经常有一些跟类有关系的功能但在运行时又不需要实例和类参与的情况下需要用到静态方法.<br>　　3）比如更改环境变量或者修改其他类的属性等能用到静态方法.<br>　　4）这种情况可以直接用函数解决, 但这样同样会扩散类内部的代码，造成维护困难.</p>
<p>3、调用方式: 既可以被类直接调用，也可以通过实例调用</p>
<p><strong>@staticmethod静态方法：</strong></p>
 <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">		self.name = name</span><br><span class="line"><span class="meta">	@staticmethod</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">()</span>:</span></span><br><span class="line">		print(<span class="string">"I am a static method"</span>)</span><br><span class="line"></span><br><span class="line">d = Dog(<span class="string">"ChenRonghua"</span>)</span><br><span class="line">d.eat()                    	 <span class="comment"># 方法1：使用实例调用</span></span><br><span class="line">Dog.eat()                   <span class="comment"># 方法2：使用类直接调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line">I am a static method           <span class="comment"># 实例调用</span></span><br><span class="line">I am a static method           <span class="comment"># 类调用</span></span><br></pre></td></tr></table></figure></div>

<h3 id="类方法"><a href="#类方法" class="headerlink" title="类方法"></a>类方法</h3><p>  可以被类调用，也可以被实例对象调用，实例调用可以给类增加属性，类的属性修改需要通过类进行修改，类方法需要使用关键字cls,定义时候需要在函数前加@classmethod</p>
<p>作用：无需实例化直接被类调用<br>特性: 类方法只能访问类变量，不能访问实例变量<br>类方法使用场景： 当我们还未创建实例，但是需要调用类中的方法<br>调用方式: 既可以被类直接调用，也可以通过实例调<br><strong>@classmethod类方法：</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(object)</span>:</span></span><br><span class="line">	name = <span class="string">'类变量'</span> <span class="comment">#在这里如果不定义类变量仅定义实例变量依然报错</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">		self.name = <span class="string">'实例变量'</span></span><br><span class="line">		self.name = name</span><br><span class="line"><span class="meta">	@classmethod</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(self,food)</span>:</span></span><br><span class="line">		print(<span class="string">"%s is eating %s"</span>%(self.name,food))</span><br><span class="line">        </span><br><span class="line">Dog.eat(<span class="string">'baozi'</span>)                   <span class="comment">#方法1：使用类直接调用</span></span><br><span class="line">d = Dog(<span class="string">"ChenRonghua"</span>)          </span><br><span class="line">d.eat(<span class="string">"包子"</span>)                      <span class="comment">#方法2：使用实例d调用</span></span><br></pre></td></tr></table></figure></div>

<h3 id="属性方法"><a href="#属性方法" class="headerlink" title="属性方法"></a>属性方法</h3><p>　　<strong>作用：把类的函数属性，封装成类似数据属性。再调用函数printmassage 时候，必须不带（）执行。**</strong></p>
<p><strong>@property属性方法：</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">		self.name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">" %s is eating"</span> % self.name)</span><br><span class="line">d = Dog(<span class="string">"ChenRonghua"</span>)</span><br><span class="line">d.eat()</span><br><span class="line"><span class="comment"># 调用会出以下错误， 说NoneType is not callable, 因为eat此时已经变成一个静态属性了， </span></span><br><span class="line"><span class="comment"># 不是方法了， 想调用已经不需要加()号了，直接d.eat就可以了</span></span><br></pre></td></tr></table></figure></div>

<p><strong>航空公司具体实例：</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">		self.flight_name = name</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">checking_status</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">"checking flight %s status "</span> % self.flight_name)</span><br><span class="line">		<span class="keyword">return</span>  <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">flight_status</span><span class="params">(self)</span>:</span></span><br><span class="line">		status = self.checking_status()</span><br><span class="line">		<span class="keyword">if</span> status == <span class="number">0</span> :</span><br><span class="line">			print(<span class="string">"flight got canceled..."</span>)</span><br><span class="line">		<span class="keyword">elif</span> status == <span class="number">1</span> :</span><br><span class="line">			print(<span class="string">"flight is arrived..."</span>)</span><br><span class="line">		<span class="keyword">elif</span> status == <span class="number">2</span>:</span><br><span class="line">			print(<span class="string">"flight has departured already..."</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			print(<span class="string">"cannot confirm the flight status...,please check later"</span>)</span><br><span class="line"></span><br><span class="line">f = Flight(<span class="string">"CA980"</span>)</span><br><span class="line">f.flight_status</span><br></pre></td></tr></table></figure></div>

<h3 id="魔法方法"><a href="#魔法方法" class="headerlink" title="魔法方法"></a>魔法方法</h3><p>　　1、type生成类调用顺序<br>　　　　new : 先于__ <strong>init</strong> __ 方法，每生成一个实例执行一次，new 类方法创建实例对象<br>　　　　init : __ <strong>init</strong> __ 方法每生成一个实例就会执行一次，初始化实例对象<br>　　　　call : 后与__ <strong>init</strong> __ 方法，C()() 使用类再加一个括号调用， C为类名称<br>　　　　del : 析构方法，删除无用的内存对象（当程序结束会自动自行析构方法）<br>　　2、类实例化时魔法方法调用顺序</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">		print(<span class="string">'__new__'</span>)</span><br><span class="line">		<span class="keyword">return</span> object.__new__(cls)   <span class="comment"># 必须返回父类的__new__方法，否则不不执行__init__方法，无法创建实例</span></span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">		print(<span class="string">'__init__'</span>)</span><br><span class="line">		self.name = name</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>                <span class="comment"># 作用：打印实例时显示指定字符串，而不是内存地址</span></span><br><span class="line">		print(<span class="string">'__str__'</span>)</span><br><span class="line">		<span class="keyword">return</span> self.name</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span>        <span class="comment"># 当执行C()(*args) 或者 s1(*args) 就会执行__call__</span></span><br><span class="line">		print(<span class="string">'__call__'</span>,*args)</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span>                <span class="comment"># 作用：清除无用的实例对内存的暂用</span></span><br><span class="line">		print(<span class="string">'__del__'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#1、实例化时机会执行__new__、__init__</span></span><br><span class="line">s1 = Student(<span class="string">'tom'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#2、执行 实例()  就会执行__call__ 方法，并将参数传递给__call__函数</span></span><br><span class="line">s1(<span class="string">'call01'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#3、当打印实例时就会执行 __str__ 方法下返回的字符串（默认返回的实例地址）</span></span><br><span class="line">print(s1)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#4、析构方法：当删除实例时就会调用 __del__ 方法</span></span><br><span class="line"><span class="keyword">del</span> s1</span><br><span class="line"><span class="comment"># 析构方法作用：在程序结束后会自动执行析构方法删除所有实例</span></span><br><span class="line"><span class="comment"># 但是在程序运行时有很多实例是无用的，但是python内存回收机制却不会自动删除他们，这样就浪费内存</span></span><br><span class="line"><span class="comment"># 我们可以执行 del s1 ，那么在程序运行时，python内存回收机制会检测到这些实例时无用的，才会删除</span></span><br><span class="line"><span class="comment"># 其实我们执行del s1，并没有回收内存，只不过是摘除门牌号，python内存回收机制发现没有门牌号后会自动回收内存</span></span><br></pre></td></tr></table></figure></div>

<p>　　<strong>实例</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span><span class="params">(object)</span>:</span></span><br><span class="line">	top_score = <span class="number">0</span>  <span class="comment"># 游戏最高分，类属性/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	@staticmethod</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show_help</span><span class="params">()</span>:</span>  <span class="comment"># 静态方法</span></span><br><span class="line">		print(<span class="string">"帮助信息：让僵尸走进房间"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">	@classmethod</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show_top_score</span><span class="params">(cls)</span>:</span>  <span class="comment"># 类方法</span></span><br><span class="line">		print(<span class="string">"游戏最高分是 %d"</span> % cls.top_score)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, player_name)</span>:</span></span><br><span class="line">		self.player_name = player_name  <span class="comment"># 实例属性</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">start_game</span><span class="params">(self)</span>:</span>  <span class="comment"># 实例方法</span></span><br><span class="line">		print(<span class="string">"[%s] 开始游戏..."</span> % self.player_name)</span><br><span class="line"></span><br><span class="line">		Game.top_score = <span class="number">999</span>  <span class="comment"># 使用类名.修改历史最高分</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 查看游戏帮助</span></span><br><span class="line">Game.show_help()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 查看游戏最高分</span></span><br><span class="line">Game.show_top_score()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 创建游戏对象，开始游戏</span></span><br><span class="line">game = Game(<span class="string">"小明"</span>)</span><br><span class="line">game.start_game()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 游戏结束，查看游戏最高分</span></span><br><span class="line">Game.show_top_score()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 案例小结</span></span><br><span class="line"><span class="comment"># 实例方法 —— 方法内部需要访问 实例属性</span></span><br><span class="line"><span class="comment">#        实例方法内部可以使用 类名. 访问类属性</span></span><br><span class="line"><span class="comment"># 类 方 法 —— 方法内部 只 需要访问 类属性</span></span><br><span class="line"><span class="comment"># 静态方法 —— 方法内部，不需要访问 实例属性 和 类属性</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>实例方法</tag>
        <tag>静态方法</tag>
        <tag>类方法</tag>
        <tag>属性方法</tag>
        <tag>魔法方法</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 正则表达式</title>
    <url>/Python/Python_id_14.html</url>
    <content><![CDATA[<h3 id="正则表达式的格式"><a href="#正则表达式的格式" class="headerlink" title="正则表达式的格式"></a>正则表达式的格式</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re			<span class="comment"># 导入re模块</span></span><br><span class="line"></span><br><span class="line">ret = re.match(“正则表达式”,”需要匹配的字符串”)		<span class="comment"># 使用match方法来匹配内容</span></span><br><span class="line"></span><br><span class="line">ret.group()	<span class="comment"># 如果匹配到了内容，则可以通过group方法来提取数据</span></span><br></pre></td></tr></table></figure></div>

<p>　　首先要通过域名找到IP，如果缓存里没有就要请求DNS服务器；得到IP后开始于目的主机进行三次握手来建立TCP连接；连接建立后进行HTTP访问，传输并获取网页内容；<br>　　传输完后与目的主机四次挥手来断开TCP连接。</p>
<a id="more"></a>

<h3 id="二、匹配单个字符"><a href="#二、匹配单个字符" class="headerlink" title="二、匹配单个字符"></a>二、匹配单个字符</h3><table>
<thead>
<tr>
<th align="center">字符</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center">.</td>
<td>匹配任意1个字符（除了\n）</td>
</tr>
<tr>
<td align="center">[ ]</td>
<td>匹配[ ]中列举的字符</td>
</tr>
<tr>
<td align="center">\d</td>
<td>匹配数字，即0-9</td>
</tr>
<tr>
<td align="center">\D</td>
<td>匹配非数字，即不是数字</td>
</tr>
<tr>
<td align="center">\s</td>
<td>匹配空白，即 空格</td>
</tr>
<tr>
<td align="center">\S</td>
<td>匹配非空白</td>
</tr>
<tr>
<td align="center">\w</td>
<td>匹配单词字符，即a-z、A-Z、0-9、_</td>
</tr>
<tr>
<td align="center">\W</td>
<td>匹配非单词字符</td>
</tr>
</tbody></table>
<p><code>扩展：因为 . 是匹配字符串中的任意一个字符，当在匹配邮箱里的 . 时，要进行\.进行转义才可以</code></p>
<h4 id="1、-匹配任意1给字符（除了-n）"><a href="#1、-匹配任意1给字符（除了-n）" class="headerlink" title="1、. 匹配任意1给字符（除了\n）"></a>1、. 匹配任意1给字符（除了\n）</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">".wo"</span>,<span class="string">"two"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：two</span></span><br></pre></td></tr></table></figure></div>

<h4 id="2、-匹配-中任意一个字符"><a href="#2、-匹配-中任意一个字符" class="headerlink" title="2、[ ] 匹配[ ]中任意一个字符"></a>2、[ ] 匹配[ ]中任意一个字符</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"[art]wo"</span>,<span class="string">"two"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：two</span></span><br></pre></td></tr></table></figure></div>

<h4 id="3、-d-匹配数字，即0-9"><a href="#3、-d-匹配数字，即0-9" class="headerlink" title="3、\d 匹配数字，即0-9"></a>3、\d 匹配数字，即0-9</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"\d[art]wo"</span>,<span class="string">"7two"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：7two</span></span><br></pre></td></tr></table></figure></div>

<h4 id="4、-D匹配非数字，即不是数字"><a href="#4、-D匹配非数字，即不是数字" class="headerlink" title="4、\D匹配非数字，即不是数字"></a>4、\D匹配非数字，即不是数字</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"\D[art]wo"</span>,<span class="string">"Atwo"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：Atwo</span></span><br></pre></td></tr></table></figure></div>

<h4 id="5、-s-匹配空白字符，即空格"><a href="#5、-s-匹配空白字符，即空格" class="headerlink" title="5、\s 匹配空白字符，即空格"></a>5、\s 匹配空白字符，即空格</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"\s\s[art]wo"</span>,<span class="string">"  two"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：  two</span></span><br></pre></td></tr></table></figure></div>

<h4 id="6、-S匹配非空白，即不是空格"><a href="#6、-S匹配非空白，即不是空格" class="headerlink" title="6、\S匹配非空白，即不是空格"></a>6、\S匹配非空白，即不是空格</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"\S[art]wo"</span>,<span class="string">"8two"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：8two</span></span><br></pre></td></tr></table></figure></div>

<h4 id="7、-w-匹配单词字符，即-a-z-A-Z-0-9"><a href="#7、-w-匹配单词字符，即-a-z-A-Z-0-9" class="headerlink" title="7、\w 匹配单词字符，即 a-z    A-Z    0-9    _"></a>7、\w 匹配单词字符，即 a-z    A-Z    0-9    _</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"\w[art]wo"</span>,<span class="string">"atwo"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：atwo</span></span><br></pre></td></tr></table></figure></div>

<h4 id="8、-W匹配非单词字符"><a href="#8、-W匹配非单词字符" class="headerlink" title="8、\W匹配非单词字符"></a>8、\W匹配非单词字符</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"\W[art]wo"</span>,<span class="string">"#two"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：#two</span></span><br></pre></td></tr></table></figure></div>

<h3 id="三、匹配多个字符"><a href="#三、匹配多个字符" class="headerlink" title="三、匹配多个字符"></a>三、匹配多个字符</h3><table>
<thead>
<tr>
<th align="center">字符</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center">*</td>
<td>匹配前一个字符出现0次或者无限次，即可有可无</td>
</tr>
<tr>
<td align="center">+</td>
<td>匹配前一个字符出现1次或者无限次，即至少有1次</td>
</tr>
<tr>
<td align="center">?</td>
<td>匹配前一个字符出现1次或者0次，即要么有1次，要么没有</td>
</tr>
<tr>
<td align="center">{m}</td>
<td>匹配前一个字符出现m次</td>
</tr>
<tr>
<td align="center">{m,n}</td>
<td>匹配前一个字符出现从m到n次</td>
</tr>
</tbody></table>
<h4 id="1、贪婪匹配"><a href="#1、贪婪匹配" class="headerlink" title="1、贪婪匹配"></a>1、贪婪匹配</h4><p>　　<strong>*匹配前一个字符出现0次或者无限次，即可有可无</strong></p>
<p>　　匹配信息中t可以无，也可以有，同样可以出现很多次、又称—–贪婪匹配</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"t*wo"</span>,<span class="string">"tttttwo"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：tttttwo</span></span><br></pre></td></tr></table></figure></div>

<p>　　<strong>+匹配前一个字符出现1次或者无限次，即至少有1次</strong></p>
<p>　　+不同于*，t必须出现最少一次才可以成功，也被称为—-贪婪匹配</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"t+wo"</span>,<span class="string">"ttttwo"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：ttttwo</span></span><br></pre></td></tr></table></figure></div>

<h4 id="2、非贪婪匹配"><a href="#2、非贪婪匹配" class="headerlink" title="2、非贪婪匹配"></a>2、非贪婪匹配</h4><p>　　<strong>?匹配前一个字符出现1次或者0次，即要么有1次，要么没有</strong></p>
<p>　　（前面的t要么不存在，要么只存在一次），否则匹配失败、称为—-非贪婪匹配</p>
 <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"t?wo"</span>,<span class="string">"two"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：two</span></span><br></pre></td></tr></table></figure></div>

<h4 id="3、-m-匹配前一个字符出现m次"><a href="#3、-m-匹配前一个字符出现m次" class="headerlink" title="3、{m}匹配前一个字符出现m次"></a>3、{m}匹配前一个字符出现m次</h4><p>　　如果{}中输入5，那么前面的t只能出现5次，否则匹配失败</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"t&#123;5&#125;wo"</span>,<span class="string">"tttttwo"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：tttttwo</span></span><br></pre></td></tr></table></figure></div>

<h4 id="4、-m-n-匹配前一个字符出现从m到n次"><a href="#4、-m-n-匹配前一个字符出现从m到n次" class="headerlink" title="4、{m,n}匹配前一个字符出现从m到n次"></a>4、{m,n}匹配前一个字符出现从m到n次</h4><p>　　匹配的次数只能在{}方括号中输入的次数的范围之内，否则匹配失败</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"t&#123;1,5&#125;wo"</span>,<span class="string">"ttttwo"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：ttttwo</span></span><br></pre></td></tr></table></figure></div>

<h3 id="四、匹配开头和结尾"><a href="#四、匹配开头和结尾" class="headerlink" title="四、匹配开头和结尾"></a>四、匹配开头和结尾</h3><table>
<thead>
<tr>
<th align="center">字符</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center">^</td>
<td>匹配字符串开头</td>
</tr>
<tr>
<td align="center">$</td>
<td>匹配字符串结尾</td>
</tr>
</tbody></table>
<h4 id="1、-匹配字符串开头"><a href="#1、-匹配字符串开头" class="headerlink" title="1、^  匹配字符串开头"></a>1、^  匹配字符串开头</h4><p>　　^的第一位放什么，匹配的第一位就必须也放什么，否则匹配失败</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"^13140060872"</span>,<span class="string">"13140060872"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果：13140060872</span></span><br></pre></td></tr></table></figure></div>

<h4 id="2、-匹配字符串结尾"><a href="#2、-匹配字符串结尾" class="headerlink" title="2、$  匹配字符串结尾"></a>2、$  匹配字符串结尾</h4><p>　　$前面放什么，匹配信息里最后一位就必须放什么，否则匹配失败</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"^13140060872$"</span>,<span class="string">"13140060872"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果：13140060872</span></span><br></pre></td></tr></table></figure></div>

<h3 id="五、匹配分组"><a href="#五、匹配分组" class="headerlink" title="五、匹配分组"></a>五、匹配分组</h3><table>
<thead>
<tr>
<th align="center">字符</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center">|</td>
<td>匹配左右任意一个表达式</td>
</tr>
<tr>
<td align="center">(ab)</td>
<td>将括号中字符作为一个分组</td>
</tr>
<tr>
<td align="center">\num</td>
<td>引用分组num匹配到的字符串</td>
</tr>
<tr>
<td align="center">(?P<name>)</td>
<td>分组起别名</td>
</tr>
<tr>
<td align="center">(?P=name)</td>
<td>引用别名为name分组匹配到的字符串</td>
</tr>
</tbody></table>
<h4 id="1、-匹配左右任意一个表达式"><a href="#1、-匹配左右任意一个表达式" class="headerlink" title="1、| 匹配左右任意一个表达式"></a>1、| 匹配左右任意一个表达式</h4><p>　　不仅要匹配163，同样要匹配126、(ab)将括号中字符作为一个分组</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">"\w&#123;4,20&#125;@(163|126).com"</span>,<span class="string">"h4055874@126.com"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：h4055874@126.com</span></span><br></pre></td></tr></table></figure></div>

<p><code>扩展：r 声明原声字符，特别针对 \ 等</code></p>
<h4 id="2、-num-num是数字，-num是拷贝第几组的内容"><a href="#2、-num-num是数字，-num是拷贝第几组的内容" class="headerlink" title="2、\num  num是数字，\num是拷贝第几组的内容"></a>2、\num  num是数字，\num是拷贝第几组的内容</h4><p>　　<code>说明：后面&lt;&gt;里的内容除了/之外跟第一个&lt;&gt;里面的内容一样，即，可使用\1拷贝第一个（）里面的内容</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret = re.match(<span class="string">r"&lt;([a-z]+)&gt;[a-z]&#123;2&#125;&lt;/\1&gt;"</span>,<span class="string">"&lt;html&gt;hh&lt;/html&gt;"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line">输出结果为：&lt;html&gt;hh&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3、-P-P-name"><a href="#3、-P-P-name" class="headerlink" title="3、(?P) (?P=name)"></a>3、(?P<name>) (?P=name)</h4><p>　　<code>说明：(?P&lt;name&gt;)给分组起名，(?P=name)可以直接调用名字里面的内容</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ret=re.match(<span class="string">r"&lt;(?P&lt;xiaohei&gt;[a-z]&#123;4&#125;)&gt;&lt;(?P&lt;xiaobai&gt;\w&#123;2&#125;)&gt;[a-z]&#123;2&#125;&lt;/(?P=xiaobai)&gt;&lt;/(?P=xiaohei)&gt;"</span>,<span class="string">"&lt;html&gt;&lt;h1&gt;hh&lt;/h1&gt;&lt;/html&gt;"</span>)</span><br><span class="line"><span class="keyword">if</span> ret:</span><br><span class="line">	print(ret.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"匹配失败"</span>)</span><br><span class="line"><span class="comment"># 输出结果：&lt;html&gt;&lt;h1&gt;hh&lt;/h1&gt;&lt;/html&gt;</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>正则表达式</tag>
      </tags>
  </entry>
  <entry>
    <title>Python TCP和UDP、流量控制和拥塞控制</title>
    <url>/Python/Python_id_13.html</url>
    <content><![CDATA[<p><strong>URL访问网站时的网络传输全过程，归纳起来就是：</strong></p>
<p>　　首先要通过域名找到IP，如果缓存里没有就要请求DNS服务器；得到IP后开始于目的主机进行三次握手来建立TCP连接；连接建立后进行HTTP访问，传输并获取网页内容；<br>　　传输完后与目的主机四次挥手来断开TCP连接。</p>
<a id="more"></a>

<p>　　整个过程基本分做下面几个部分：</p>
<p>　　　　1、域名解析成IP地址；<br>　　　　2、与目的主机进行TCP连接（三次握手）；<br>　　　　3、发送与收取数据；<br>　　　　4、与目的主机断开TCP连接（四次挥手）；</p>
<h3 id="TCP-UDP优缺点"><a href="#TCP-UDP优缺点" class="headerlink" title="TCP/UDP优缺点"></a>TCP/UDP优缺点</h3><h4 id="TCP的优点"><a href="#TCP的优点" class="headerlink" title="TCP的优点"></a>TCP的优点</h4><p>　　<strong>可靠，稳定</strong>TCP的可靠体现在TCP在传递数据之前，会有三次握手来建立连接，而且在数据传递时，有确认、窗口、重传、拥塞控制机制，在数据传完后，还会断开连接用来节约系统资源。 </p>
<h4 id="TCP的缺点"><a href="#TCP的缺点" class="headerlink" title="TCP的缺点"></a>TCP的缺点</h4><p>　　<strong>慢，效率低，占用系统资源高，易被攻击。</strong> TCP在传递数据之前，要先建连接，这会消耗时间，而且在数据传递时，确认机制、重传机制、拥塞控制机制等都会消耗大量的时间，而且要在每台设备上维护所有的传输连接，事实上，每个连接都会占用系统的CPU、内存等硬件资源。 而且，因为TCP有确认机制、三次握手机制，这些也导致TCP容易被人利用，实现DOS、DDOS、CC等攻击。</p>
<h4 id="UDP的优点"><a href="#UDP的优点" class="headerlink" title="UDP的优点"></a>UDP的优点</h4><p>　　<strong>快，比TCP稍安全</strong>UDP没有TCP的握手、确认、窗口、重传、拥塞控制等机制，UDP是一个无状态的传输协议，所以它在传递数据时非常快。没有TCP的这些机制，UDP较TCP被攻击者利用的漏洞就要少一些。但UDP也是无法避免攻击的，比如：UDP Flood攻击……</p>
<h4 id="UDP的缺点"><a href="#UDP的缺点" class="headerlink" title="UDP的缺点"></a>UDP的缺点</h4><p>　　<strong>不可靠，不稳定</strong>因为UDP没有TCP那些可靠的机制，在数据传递时，如果网络质量不好，就会很容易丢包。</p>
<p>　　基于上面的优缺点，那么： 什么时候应该使用TCP： 当对网络通讯质量有要求的时候，比如：整个数据要准确无误的传递给对方，这往往用于一些要求可靠的应用，比如HTTP、HTTPS、FTP等传输文件的协议，POP、SMTP等邮件传输的协议。 在日常生活中，常见使用TCP协议的应用如下： 浏览器，用的HTTP FlashFXP，用的FTP Outlook，用的POP、SMTP Putty，用的Telnet、SSH QQ文件传输 ………… 什么时候应该使用UDP： 当对网络通讯质量要求不高的时候，要求网络通讯速度能尽量的快，这时就可以使用UDP。 比如，日常生活中，常见使用UDP协议的应用如下： QQ语音 QQ视频 TFTP ……</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/TCP&UDP/01.png">

<h3 id="TCP报头结构"><a href="#TCP报头结构" class="headerlink" title="TCP报头结构"></a>TCP报头结构</h3><img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/TCP&UDP/02.png">



<h4 id="16位端口号"><a href="#16位端口号" class="headerlink" title="16位端口号"></a>16位端口号</h4><p>　　告知主机该报文段来自哪里（源端口号）以及传给哪个上层协议或应用程序（目的端口）的。TCP通信时，客户端通常使用系统自动选择的临时端口号，而服务器使用知名端口号。   </p>
<h4 id="32位序号"><a href="#32位序号" class="headerlink" title="32位序号"></a>32位序号</h4><p>　　一次TCP通信过程中某个传输方向上的字节流的每个字节的编号。</p>
<p>　　第一个报文段中序号值被系统初始化为某个随机值ISN，那么该传输方向上后续的TCP报文段中序号值将被系统设置为ISN加上该报文段所携带的第一个字节在整个字节流的偏移。     </p>
<h4 id="32位确认号"><a href="#32位确认号" class="headerlink" title="32位确认号"></a>32位确认号</h4><p>　　用作对另一方发送的TCP报文段的响应。其值是收到的TCP报文段的序号值加1.假如主机A和主机B进行TCP通信，那么A发送的TCP报文段不仅携带自己的序号，还有对B发送来的TCP报文段的确认号。</p>
<h4 id="4位头部长度"><a href="#4位头部长度" class="headerlink" title="4位头部长度"></a>4位头部长度</h4><p>　　标识该TCP头部有多少个32bit字（4字节），因为4位最大表示15所以TCP头部最长是60字节。    </p>
<h4 id="6位标志位"><a href="#6位标志位" class="headerlink" title="6位标志位"></a>6位标志位</h4><p>　　选项有，ACK标志：表示确认号是否有效。将携带ACK标志的TCP报文段成为“确认报文段”。SYN标志：表示请求建立一个连接，将携带SYN标志的报文段称为“同步报文段”。   FIN标志：表示通知对方要关闭连接，将携带FIN标志的报文段称为“结束报文段”。    </p>
<h4 id="16位窗口大小"><a href="#16位窗口大小" class="headerlink" title="16位窗口大小"></a>16位窗口大小</h4><p>　　指的是接受通告窗口。它告诉接受端自己接受缓冲区还能容纳多少字节的数据。   </p>
<h4 id="16位校验和"><a href="#16位校验和" class="headerlink" title="16位校验和"></a>16位校验和</h4><p>　　由发送端填充，接收端对TCP报文段执行CRC算法检验报文段在传输中是否损坏，检验TCP头部和数据部分。这是TCP可靠传输的一个重要保障。   16位紧急指针。。  </p>
<h4 id="头部选项"><a href="#头部选项" class="headerlink" title="头部选项"></a>头部选项</h4><p>　　还有最后一个选项字段是可变长的可选信息，最多40字节。。。</p>
<h3 id="TCP、UDP的区别"><a href="#TCP、UDP的区别" class="headerlink" title="TCP、UDP的区别"></a>TCP、UDP的区别</h3><p>　　1、基于面向连接与无连接。因为每个连接都会占用系统的CPU、内存等硬件资源，所以对系统资源的要求TCP较多UDP少；并且tcp是一对一的，udp是一对一，一对多，多对一，多对多通信。</p>
<p>　　2、字节流：应用程序对数据的发送和接受没有边界限制，即发送端执行的写操作次数和接受端的读操作次数没有任何数量关系，并且send只是将数据写进发送缓冲区，recv只是从输出缓冲区中获取数据。【因为如果发送端应用程序连续执行写操作，tcp先将数据放入TCP发送缓冲区中，等到缓冲区真正发送数据时，数据可能被封装了一个或多个TCP报文段发出，即TCP发出的tcp报文段个数和执行的写操作次数没有关系。 而接受端收到一个或多个TCP报文段，先将他们携带的数据按序号依次放到接受缓冲区中，通知应用进程接受。应用程序可以一次全部读出，也可以分几次读出，这取决于应用程序的缓冲区大小，即TCP模块接受的报文段个数和读操作次数没关系。】</p>
<p>   数据报：sendto发送数据和对端recvfrom接受数次数相等，因此UDP保留了应用层数据的边界。【 发送端应用程序每执行写操作一次，UDP模块就将它封装成一个数据报发送了。接收端必须及时对每个udp数据报执行读操作并且一次接受完，否则不读数据会丢包，或者不读完整数据会被截断发生数据丢失。】</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/TCP&UDP/03.png">

<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/TCP&UDP/04.png">

<p>　　3、tcp是<strong>可靠传输</strong>，通过TCP连接传送的数据，无差错，不丢失，不重复，且按序到达;udp是不保证可靠交付。</p>
<h4 id="可靠性体现在："><a href="#可靠性体现在：" class="headerlink" title="可靠性体现在："></a>可靠性体现在：</h4><p>　　应用程序将数据发送给TCP，然后TCP把数据流分区成适当长度的报文段（通常受该计算机连接的网络的数据链路层的最大传输单元（ MTU）的限制）之后TCP把结果包传给IP层，由它来通过网络将包传送给接收端实体的TCP层。TCP为了保证不发生丢包，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的包发回一个相应的确认（ACK）；如果发送端实体在合理的往返时延（RTT）内未收到确认，那么对应的数据包就被假设为已丢失将会被进行重传。TCP用一个校验和函数来检验数据是否有错误；在发送和接收时都要计算校验和。</p>
<h4 id="具体体现为："><a href="#具体体现为：" class="headerlink" title="具体体现为："></a>具体体现为：</h4><p>　　1、<strong>应用数据被分割成TCP认为最适合发送的数据块。</strong>这和UDP完全不同，应用程序产生的数据长度将保持不变。由TCP传递给IP的信息单位称为报文段或段。【在TCP三次我握手的前两次握手中（也就是两个SYN报文段中），通过一个“协商”的方式来告知对方自己期待收到的最大报文段长度（MSS），结果使用通信双发较小的MSS最为最终的MSS。在SYN=1的报文段中，会在报文段的选项部分来指定MSS大小（相当于告知对方自己所能接收的最大报文段长度）。在后续通信双发发送应用层数据之前，如果发送数据超过MSS，会对数据进行分段】。</p>
<p>　　2、当TCP发出一个段后，它启动一个定时器，等待目的端<strong>确认</strong>收到这个报文段。当TCP收到发自TCP连接另一端的数据，它将发送一个确认。TCP有延迟确认的功能，在此功能没有打开，则是立即确认。功能打开，则由定时器触发确认时间点。</p>
<p>　　3、TCP有<strong>超时重传</strong>机制，如果没有收到对端对于发送报文的确认，则会重传一份。如果发送端在合理的往返时延（RTT）内未收到确认，那么对应的数据包就被假设为已丢失将会被进行重传。</p>
<p>　　4、TCP将<strong>保持它首部和数据的检验和。</strong>　CRC对TCP整个数据报进行校验（头部和数据部分都会校验）用一个校验和函数来检验数据是否有错误；在发送和接收时都要计算校验和。如果收到段的检验和有差错，TCP将丢弃这个报文段和不确认收到此报文段（希望发端超时并重发）。</p>
<p>　　5、既然TCP报文段作为IP数据报来传输，而IP数据报的到达可能会失序、重复，因此TCP报文段的到达也可能会失序。如果必要，TCP将对收到的数据<strong>进行重新排序、整理，</strong>将收到的数据以正确的顺序交给应用层。【在同一次传输的同一个方向上每个TCP报文都有唯一的标识(序号），也保证了传送到接收端实体的包的按序接收。然后接收端对已成确认功收到的包发回一个相应的ACK；若重复TCP的接收端必须丢弃重复的数据。】</p>
<p>udp和ip协议都是提供<strong>不可靠</strong>服务，它们需要上层协议来处理数据确认和超时重传。</p>
<h4 id="三次握手与四次挥手"><a href="#三次握手与四次挥手" class="headerlink" title="三次握手与四次挥手"></a>三次握手与四次挥手</h4><img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/TCP&UDP/05.png">

<p><strong>为什么三次握手？</strong></p>
<p>　　如果两次握手，因为存在一种情况。client发送的第一个连接请求报文段没有丢失，而是在某个网络节点长时间滞留了，以致延误到连接断开后的某个时间才到服务器。</p>
<p>　　这个失效报文段到了sever，sever以为client想建立连接，就发送确认报文段并同意建立连接。此时若只有两次握手，那新的连接就建立了。但由于client其实并没建立连接，所以对确认报文段无反应，更发不了数据。可是sever以为新的连接已建立，就傻傻地一直等着发数据，导致sever很多资源被浪费掉。</p>
<p>　　<strong>所以三次握手可以防止已失效的连接请求的报文段突然到server，使服务器一直等待，浪费了资源；但是三次握手也有缺陷，会导致syn攻击</strong></p>
<p><strong>Timewait</strong>是主动关闭的一端在本端已经关闭的前期下，收到对端的关闭请求（FIN报文段）并且将ACK发送出去后所处的状态，这种状态表示：双方都已经完成工作，只是为了<strong>确保迟来的数据报能被识别并丢弃；可靠的终止TCP连接。</strong>这种状态下客户端连接要等一段2MSL（报文段最大生存时间【2min】）的时间，才能完全关闭。</p>
<p><strong>具体存在原因：</strong>①可靠的终止tcp连接。假如用于确认服务器结束报文段的tcp报文段7丢失了，那服务器将重发结束报文段。所以客户端需要停留在一个状态处理多次收到的服务器结束报文段。（也就是向服务器发送确认报文段）。否则，客户端将发送复位报文段给服务器，服务器认为这是一个错误。</p>
<p>②保证让迟来的tcp报文段有足够时间被识别和丢弃。因为如果没有timewait状态，应用程序可以立即建立一个和刚关闭的相似的链接。这个连接可能接受原来连接的携带应用数据的tcp报文段（迟来的报文段）。因此我们此时不应该用此链接的端口号建立新连接，设为timewait状态。然后等待2MSL（保证网络的两个传输方向上迟到的报文段都消失了【被中转路由器丢弃】时间去使迟来的报文段被识别丢弃！</p>
<p><strong>CLOSE_WAIT</strong>是被动关闭的一端在接收到对端关闭请求（FIN报文段）并且将ACK发送出去后所处的状态，这种状态表示：收到了对端关闭的请求，但是本端还没有完成工作，还未关闭。</p>
<h4 id="TCP的流量控制与拥塞控制"><a href="#TCP的流量控制与拥塞控制" class="headerlink" title="TCP的流量控制与拥塞控制"></a>TCP的流量控制与拥塞控制</h4><p><strong>超时重传：</strong>TCP服务必须能够重传超时时间内未收到确认报文段的TCP报文段。TCP为每个TCP模块都维护了一个重传定时器，定时器在第一次发送TCP报文段时启动，如果超时时间内未收到接收方的确认号报文段，TCP模块将重传TCP报文段并重置定时器。   至于下次重传的超时时间如何选择，以及最多重传几次，这是TCP的重传策略。 与TCP超时重连的策略相似。</p>
<p><strong>滑动窗口：</strong>TCP中采用滑动窗口来进行流量控制，滑动窗口的大小意味着接收方还有多大的缓冲区可以用于接收数据。发送方可以通过滑动窗口的大小来确定应该发送多少字节的数据。当滑动窗口为0时，发送方一般不能再发送数据报。</p>
<p><strong>滑动窗口协议</strong>的基本原理就是在任意时刻，发送方都维持了一个连续的允许发送的帧的序号，称为发送窗口；同时，接收方也维持了一个连续的允许接收的帧的序号，称为接收窗口。发送窗口和接收窗口的序号的上下界不一定要一样，甚至大小也可以不同。不同的滑动窗口协议窗口大小一般不同。发送方窗口内的序列号代表了那些已经被发送，但是还没有被确认的帧，或者是那些可以被发送的帧。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/TCP&UDP/06.png">

<p><strong>流量控制的处理过程：</strong></p>
<p>　　TCP连接阶段，双方协商窗口尺寸，同时接收方预留数据缓存区；</p>
<p>　　发送方根据协商的结果，发送符合窗口尺寸的数据字节流，并等待对方的确认；</p>
<p>　　发送方根据确认信息，改变窗口的尺寸，增加或者减少发送未得到确认的字节流中的字节数。调整过程包括：如果出现发送拥塞，发送窗口缩小为原来的一半，同时将超时重传的时间间隔扩大一倍。</p>
<h3 id="TCP的拥塞控制，流量控制"><a href="#TCP的拥塞控制，流量控制" class="headerlink" title="TCP的拥塞控制，流量控制"></a>TCP的拥塞控制，流量控制</h3><h4 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h4><p>　　TCP模块为了防止过多的数据注入网络，使网络中的路由器或链路不致于过载。以此提高网络利用率，降低丢包率，并抱证网络资源对每条数据流的公平性而采取的控制手段。拥塞控制包含四部分内容：慢启动、拥塞避免、快速重传、快速恢复。</p>
<h5 id="慢启动"><a href="#慢启动" class="headerlink" title="慢启动"></a>慢启动</h5><p>　　网络传输刚开始时，并不知道网络的实际情况，所以采取一种试探的方式控制数据的发送速率。慢启动阶段，数据的发送速率以指数方式增长，即就是拥塞窗口的增长，每次都是收到确认报文段数量的2倍。可以看出慢启动并不慢，拥塞窗口增长的速度很快。所以，为其设置了一个慢启动门限，当达到门限时，就进入到拥塞避免阶段。</p>
<h5 id="拥塞避免"><a href="#拥塞避免" class="headerlink" title="拥塞避免"></a>拥塞避免</h5><p>　　当拥塞窗口的大小采用慢启动方式增长到慢启动门限时，就进入拥塞避免阶段，拥塞避免阶段不再以指数形式增长拥塞窗口，而是每经过一个往返时间RTT就将发送方的拥塞窗口+1， 使其增长速度减缓。按照线性方式增长。如果发生网络拥塞，比如丢包时，就将慢启动门限设为原来的一半，然后将拥塞窗口设置为1，开始执行慢启动算法。（较低的起点，指数级增长）。</p>
<h5 id="快速重传"><a href="#快速重传" class="headerlink" title="快速重传"></a>快速重传</h5><p>　　假设发送方发送的报文段分别为： M1,M2,M3,M4,M5,M6 , 当接收方收到M1和M2后，M3报文段丢失，接着收到的M4，M5，M6都不做处理，而是没接收到一个报文段就对M2重复确认，发送方接收到重复的三次确认报文段，就对其后的报文段进行重新发送，而不需要等待超时时间到达。当快速重传后，立即进入到快速恢复阶段。</p>
<h5 id="快速恢复"><a href="#快速恢复" class="headerlink" title="快速恢复"></a>快速恢复</h5><p>　　将慢启动门限设置为原来的一半，然后将拥塞窗口设置为现在的慢启动门限值，不再执行慢启动算法，而是直接进入拥塞避免阶段。使发送窗口成线性方式增大。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/TCP&UDP/07.png">



<p><strong>流量控制（滑动窗口协议）TCP连接的每一方都有固定大小的缓冲空间。TCP的接收端只允许另一端发送接收端缓冲区所能接纳的数据。这将防止较快主机致使较慢主机的缓冲区溢出。</strong>【滑动窗口技术存在于数据链路层和传输层。两者有不同的协议，但基本原理相同。区别是一个是发送帧，一个是发送字节数据。接收方的接受窗口告诉发送方本端tcp接受缓冲区还能容纳多少字节，发送方的发送窗口就可以控制发送数据的速度。】</p>
<p>UDP没有流量控制和拥塞控制，所以在网络拥塞时不会是源主机发送速率降低（对实时通信很有用，比如QQ电话，视频会议等）</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>TCP</tag>
        <tag>UDP</tag>
        <tag>流量控制</tag>
        <tag>拥塞控制</tag>
      </tags>
  </entry>
  <entry>
    <title>Python上下文管理</title>
    <url>/Python/Python_id_12.html</url>
    <content><![CDATA[<p>　　在Python中让自己创建的函数、类、对象支持with语句，就实现了上线文管理协议。我们经常使用with open(file, “a+”) as f:这样的语句，无需手动调用f.close()关闭文件。这种用法不仅优雅，而且避免遗忘释放资源，十分方便。所以，当操作某些资源时，需要对资源的获取与释放进行自动操作，就可以用上线文管理器。比如：数据库的连接，查询，关闭处理；socket的连接和断开。本篇主要介绍，如何让自己创建的类、对象、函数等支持with语句，详细请看下文。</p>
<a id="more"></a>

<h3 id="一、让对象支持上下文管理协议"><a href="#一、让对象支持上下文管理协议" class="headerlink" title="一、让对象支持上下文管理协议"></a>一、让对象支持上下文管理协议</h3><p>　　在类中，实现 <strong>enter</strong>()和<strong>exit</strong>()方法，类创建的对象就支持with语句。如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">"in __enter__"</span>)</span><br><span class="line">		<span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">		print(<span class="string">"in __exit__"</span>)</span><br><span class="line"></span><br><span class="line">obj = A()</span><br><span class="line"><span class="keyword">with</span> obj <span class="keyword">as</span> o:</span><br><span class="line">	print(<span class="string">"看看o是什么："</span>, o)</span><br><span class="line">	print(<span class="string">"do something"</span>)</span><br><span class="line">print(<span class="string">"end"</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果</span></span><br><span class="line"><span class="keyword">in</span> __enter__</span><br><span class="line">看看o是什么： [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">do something</span><br><span class="line"><span class="keyword">in</span> __exit__</span><br><span class="line">end</span><br></pre></td></tr></table></figure></div>

<p>　　1、当执行 with 语句的时候，对象的 <strong>enter</strong>() 方法被触发， 它返回的值(如果有的话)会被赋值给 as 声明的变量。对应输出应该是【in <strong>enter</strong>】和将[1,2,3]赋<br>　　　　值给o【字母o】。</p>
<p>　　2、然后，with 语句块里面的代码开始执行。对应的输出是【看看o是什么： [1, 2, 3]】和【do someting】。</p>
<p>　　3、最后，<strong>exit</strong>() 方法被触发进行清理工作。对应的输出是【in <strong>exit</strong>】。</p>
<p>　　<strong>补充说明：</strong> __ <strong>exit</strong> __ ()方法的第三个参数包含了异常类型、异常值和追溯信息(如果有的话)。 __ <strong>exit</strong> __ ()方法能自己决定怎样利用这个异常信息，或者忽略<br>　　　　　　　它并返回一个None值。 </p>
<p>　　如果 __ <strong>exit</strong> __ ()返回 True ，那么异常会被清空，就好像什么都没发生一样， with 语句后面的程序继续在正常执行。</p>
<p>　　上面的例子还不支持多个with嵌套使用，下面是一个可以嵌套使用with语句的例子：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> socket, AF_INET, SOCK_STREAM</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connection</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, address, family=AF_INET, type=SOCK_STREAM)</span>:</span></span><br><span class="line">		self.address = address</span><br><span class="line">		self.family = family</span><br><span class="line">		self.type = type</span><br><span class="line">		self.connections = []</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">		sock = socket(self.family, self.type)</span><br><span class="line">		sock.connect(self.address)</span><br><span class="line">		self.connections.append(sock)</span><br><span class="line">		<span class="keyword">return</span> sock</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_ty, exc_val, tb)</span>:</span></span><br><span class="line">		self.connections.pop().close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn = Connection((<span class="string">'www.python.org'</span>, <span class="number">80</span>))</span><br><span class="line"><span class="keyword">with</span> conn <span class="keyword">as</span> s1:</span><br><span class="line">	print(s1)</span><br><span class="line"><span class="keyword">with</span> conn <span class="keyword">as</span> s2:</span><br><span class="line">        print(s2)</span><br></pre></td></tr></table></figure></div>

<h3 id="二、装饰器版上下文管理器"><a href="#二、装饰器版上下文管理器" class="headerlink" title="二、装饰器版上下文管理器"></a>二、装饰器版上下文管理器</h3><p>　　上面介绍了在类和对象中实现上下文管理协议，其实Python标准库中contextlib包的@contextmanager装饰器能够轻松实现一个上下文管理器，下例是用其实现统计代<br>　　码块耗时的上下文管理器：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"><span class="comment"># 来看一个装饰器版本的上下文管理器</span></span><br><span class="line"><span class="comment"># 检查代码消耗时间块</span></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timecount</span><span class="params">(name)</span>:</span></span><br><span class="line">	start = time.time()</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">yield</span></span><br><span class="line">	<span class="keyword">finally</span>:</span><br><span class="line">		end = time.time()</span><br><span class="line">		print(<span class="string">'&#123;&#125;: &#123;&#125;'</span>.format(name, end - start))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> timecount(<span class="string">'cost time:'</span>):</span><br><span class="line">	time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># cost time:: 2.000200033187866</span></span><br></pre></td></tr></table></figure></div>

<p>　　timecount（）中，yield之前的代码相当于<strong>enter</strong>()方法；yield 之后的代码相当于 <strong>exit</strong>()方法。如果有异常会自动在yield一行抛出。</p>
<p>　　上下文管理器可以应用在事务中：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 更高级的事务管理</span></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_transaction</span><span class="params">(orig_list)</span>:</span></span><br><span class="line">	working = list(orig_list)</span><br><span class="line">	<span class="keyword">yield</span> working</span><br><span class="line">	orig_list[:] = working</span><br><span class="line">    </span><br><span class="line">lis = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">with</span> list_transaction(lis) <span class="keyword">as</span> work:</span><br><span class="line">	work.append(<span class="number">5</span>)</span><br><span class="line">	work.append(<span class="number">6</span>)</span><br><span class="line">    </span><br><span class="line">print(lis)</span><br><span class="line"><span class="comment"># [1, 2, 3, 5, 6]</span></span><br></pre></td></tr></table></figure></div>

<p>　　一旦with语句内有异常产生，之前的操作不会生效：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">lis = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">with</span> list_transaction(lis) <span class="keyword">as</span> work:</span><br><span class="line">	work.append(<span class="number">5</span>)</span><br><span class="line">	work.append(<span class="number">6</span>)</span><br><span class="line">	print(lis)</span><br><span class="line">	<span class="keyword">raise</span> RuntimeError(<span class="string">"回滚"</span>)</span><br></pre></td></tr></table></figure></div>

<p>　　如果在交互式命令行中打印lis,依然会发现lis的内容没有改变，也就是说，with语句中的代码出现异常，with语句中的操作都不会生效，只有with无异常退出，才会<br>　　生效。对于事务管理来说是比较有用的。</p>
<h3 id="三、小结"><a href="#三、小结" class="headerlink" title="三、小结"></a>三、小结</h3><p>　　1、当操作一些需要打开、连接、断开或释放的资源时，让对象或函数支持with语句十分方便、省事、优雅。如数据库的链接断开、套接字的连接断开、事务、锁资<br>　　　　源等。</p>
<p>　　2、类中实现<strong>enter</strong>()和<strong>exit</strong>()方法，即可实现上下文管理协议，对象可使用with语句。</p>
<p>　　3、通过contextlib包中的@contextmanager装饰器装饰一个函数，该函数即可使用with语句。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>上下文管理</tag>
      </tags>
  </entry>
  <entry>
    <title>Python文件的操作</title>
    <url>/Python/Python_id_11.html</url>
    <content><![CDATA[<h3 id="一、文件的作用："><a href="#一、文件的作用：" class="headerlink" title="一、文件的作用："></a>一、文件的作用：</h3><p>　　<strong>就是把一些存储存放起来，可以让程序下一次执行的时候直接使用，而不必重新制作一份，省时省力</strong></p>
<p>　　1、打开文件以及关闭文件中间的过程：<strong>创建文件–打开文件–读取或修改文件–关闭文件</strong></p>
<p>　　2、打开文件的关键字—-<strong>open</strong></p>
<a id="more"></a>

<p>　　3、文件的访问模式：</p>
<p>　　　　1）r –以只读的方式打开文件，默认从头开始读取</p>
<p>　　　　2）w–打开文件用于写入，并覆盖之前的内容，如果文件不存在，则创建文件</p>
<p>　　　　3）a–打开文件追加写入内容，新的内容将在旧的内容之后继续写入，如果文件不存在，则创建新文件</p>
<p>　　　　4）rb–以二进制的方式只读一个文件，默认从头开始读取</p>
<p>　　　　5）wb–以二进制的方式打开文件用于写入内容，并覆盖之前的内容，如果文件不存在，则创建文件</p>
<p>　　　　6）ab–以二进制格式打开一个文件用于追加，如果该文件已存在，则会在已有内容的最后边追加新的内容，如果文件不存在，则创建新文件</p>
<p>　　　　7）r+ –打开一个文件用于读写，文件指针将会放在文件的开头</p>
<p>　　　　8）w+ –打开一个文件用于读写，如果该文件已存在，则将其覆盖，如果该文件不存在，则创建新文件</p>
<p>　　　　9）a+ –打开一个文件用于读写，如果该文件已存在，文件指针将会放在文件的结尾，文件打开时会是追加模式，如果文件不存在，则创建新文件</p>
<p>　　　　10）rb+ –以二进制格式打开一个文件用于读写，文件指针将会放在文件的开头</p>
<p>　　　　11）wb+ –以二进制格式打开一个文件用于读写，如果该文件已存在，则将其覆盖，如果该文件不存在，创建新文件</p>
<p>　　　　12）ab+ –以二进制格式打开一个文件用于追加，如果该文件已存在，文件指针将会放在文件的结尾，如果该文件不存在，则创建新文件</p>
<p>　　4、关闭文件的关键字—-<strong>close</strong></p>
<p>　　<code>注意：打开文件与关闭文件是同时存在的(即：有打开就一定有关闭，这是文件的基本结构)</code></p>
<h3 id="二、文件的读写"><a href="#二、文件的读写" class="headerlink" title="二、文件的读写"></a>二、文件的读写</h3><h4 id="1、写数据-write"><a href="#1、写数据-write" class="headerlink" title="1、写数据(write)"></a>1、写数据(write)</h4><p>　　<strong>使用write()可以完成向文件写入数据</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">'holle.txt'</span>,<span class="string">'w'</span>)		<span class="comment"># 在holle.txt中写入数据，如文件不存在，则创建新文件</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):			<span class="comment"># for循环遍历输入5次</span></span><br><span class="line">	f.write(<span class="string">"holle world holle python\n"</span>)		<span class="comment"># 输入要写入的内容</span></span><br><span class="line">f.close()</span><br><span class="line"><span class="comment"># 写入到holle.txt文件中为5行显示 holle world holle python</span></span><br></pre></td></tr></table></figure></div>

<h4 id="2、读数据-read"><a href="#2、读数据-read" class="headerlink" title="2、读数据(read)"></a>2、读数据(read)</h4><p>　　使用read()可以完成向文件的读取，如果用open打开文件时，使用的”r”，那么可以省略，即只写 open(‘test.txt’)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">ret = f.read(<span class="number">10</span>)				<span class="comment"># ret 为读取文件f的十个字符，默认从头开始读取</span></span><br><span class="line">ret2 = f.read()				<span class="comment"># ret2为读取文件的剩余所有字符，因为ret已经读取了十个字符</span></span><br><span class="line">print(ret)					<span class="comment"># 输出ret读取的十个字符</span></span><br><span class="line">print(ret2)					<span class="comment"># 输出ret2读取的剩下所有字符</span></span><br><span class="line">f.close()					<span class="comment"># 关闭文件</span></span><br></pre></td></tr></table></figure></div>

<h4 id="3、读数据（readlines）"><a href="#3、读数据（readlines）" class="headerlink" title="3、读数据（readlines）"></a>3、读数据（readlines）</h4><p>　　就像read没有参数时一样，readlines可以按照行的方式把整个文件中的内容进行一次性读取，并且返回的是一个列表，其中每一行的数据为一个元素</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">'holle.txt'</span>)			<span class="comment"># 打开f文件用于只读</span></span><br><span class="line">ret = f.readlines()			<span class="comment"># 读取f文件内所有行的内容，并用变量ret接收</span></span><br><span class="line">print(ret)					<span class="comment"># 输出ret接收的内容</span></span><br><span class="line">f.close()					<span class="comment"># 关闭文件</span></span><br></pre></td></tr></table></figure></div>

<h4 id="4、读数据（readline）"><a href="#4、读数据（readline）" class="headerlink" title="4、读数据（readline）"></a>4、读数据（readline）</h4><p>　　readline 读取单行所有行内容，并记录读取位置，再读取是从上次位置继续往下读取</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">'zhuhuifei.py'</span>,<span class="string">'r'</span>,encoding=<span class="string">'utf8'</span>)</span><br><span class="line">ret = f.readline()		<span class="comment"># 读入一行内容(默认从头开始读取)，并用变量ret接收读取内容</span></span><br><span class="line">print(ret)			<span class="comment"># 输入ret接收的读取内容</span></span><br><span class="line">ret = f.readline()		<span class="comment"># 读取第一次读取后的下一行内容，并用变量ret接收读取内容</span></span><br><span class="line">print(ret)			<span class="comment"># 读取ret接收的第二次读取内容(第一次读取的内容将被覆盖,也可用其它比变量名)</span></span><br><span class="line">f.close()			<span class="comment"># 完成要求后，关闭文件</span></span><br></pre></td></tr></table></figure></div>

<h3 id="三、文件与文件夹的相关操作"><a href="#三、文件与文件夹的相关操作" class="headerlink" title="三、文件与文件夹的相关操作"></a>三、文件与文件夹的相关操作</h3><p>　　1、文件重命名—os模块中的rename()可以完成对文件的重命名操作</p>
 <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os		<span class="comment"># 创建os模块</span></span><br><span class="line">os.rename(<span class="string">'w.txt'</span>,<span class="string">'m.txt'</span>)	<span class="comment"># 前面放要被重新命名的文件名，后面放要重新命名的名字</span></span><br></pre></td></tr></table></figure></div>

<p>　　2、删除文件os模块中的remove()可以完成对文件的删除操作</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os		<span class="comment"># 创建os模块</span></span><br><span class="line">os.remove(<span class="string">'holle.txt'</span>)	<span class="comment"># 后面直接放入需要删除的文件</span></span><br></pre></td></tr></table></figure></div>

<p>　　3、创建文件夹os模块中的mkdir()可以完成对文件夹的创建操作</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os		<span class="comment"># 创建os模块</span></span><br><span class="line">os.mkdir(‘星期五’)		<span class="comment"># 后面直接放入需要创建的文件夹的名字</span></span><br></pre></td></tr></table></figure></div>

<p>　　4、删除文件夹os模块中的rmdir()可以完成对文件的删除操作</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os		<span class="comment"># 创建os模块</span></span><br><span class="line">os.rmdir(<span class="string">'星期五'</span>)		<span class="comment"># 后面直接放入需要删除的文件夹的名字</span></span><br></pre></td></tr></table></figure></div>

<p>　　5、获取当前目录os模块中的getcwd()可以获取当前目录的位置</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os		<span class="comment"># 创建os模块</span></span><br><span class="line">print(os.getcwd())	 <span class="comment"># 输出当前目录的所在位置</span></span><br></pre></td></tr></table></figure></div>

<p>　　6、切换上一级目录 os模块中的chdir()可以切换到上一级目录位置</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os		<span class="comment"># 创建os模块</span></span><br><span class="line">os.chdir(<span class="string">"../"</span>)	<span class="comment"># 后面输入../可以切换到上一级目录位置</span></span><br><span class="line">print(os.getcwd())	<span class="comment"># 输出切换后的目录位置</span></span><br></pre></td></tr></table></figure></div>

<p>　　7、查看当前目录中所有文件夹os模块中的listdir()可以获取当前目录中的所有文件夹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os		<span class="comment"># 创建os模块</span></span><br><span class="line">os.listdir(<span class="string">'/'</span>)		<span class="comment"># 后面输入需要打开的目录，并获取里面的所有文件夹</span></span><br><span class="line">print(os.listdir(<span class="string">'./'</span>))	<span class="comment"># 输出目录中所有文件夹的</span></span><br></pre></td></tr></table></figure></div>

<h3 id="四、文件的备份"><a href="#四、文件的备份" class="headerlink" title="四、文件的备份"></a>四、文件的备份</h3><p>　　<code>注意：文件的备份是重点</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f = input(<span class="string">'请输入要拷贝的文件名：'</span>)		<span class="comment"># 键盘输入要拷贝文件的名字</span></span><br><span class="line">f1 = open(f,<span class="string">'rb'</span>)						<span class="comment"># 以读的方式打开老的文件，方便数据读取</span></span><br><span class="line">num = f.rfind(<span class="string">'.'</span>)						<span class="comment"># 获取’.’的位置</span></span><br><span class="line">print(num)		</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> num &gt; <span class="number">0</span>:</span><br><span class="line">	hou_zhui = f[num:]					<span class="comment"># 获取后缀</span></span><br><span class="line">	wen_jian_ming = f[:num]				<span class="comment"># 获取文件名</span></span><br><span class="line">new_wen_jian = wen_jian_ming + <span class="string">'[附件]'</span> + hou_zhui		<span class="comment"># 构造新的文件名</span></span><br><span class="line">new_f = open(new_wen_jian,<span class="string">"wb"</span>)			<span class="comment"># 新建文件，并写入文件内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f1.readlines():</span><br><span class="line">	new_f.write(i)</span><br><span class="line">f1.close()				<span class="comment"># 结束操作</span></span><br><span class="line">new_f.close()</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>文件的操作</tag>
      </tags>
  </entry>
  <entry>
    <title>Python深浅拷贝及is与==的区别</title>
    <url>/Python/Python_id_10.html</url>
    <content><![CDATA[<p>　　Python中copy模块用于对象的拷贝操作；该模块只提供了两个主要的方法：copy.copy与copy.deepcopy，分别表示浅拷贝与深拷贝。</p>
<a id="more"></a>

<h3 id="一、浅拷贝"><a href="#一、浅拷贝" class="headerlink" title="一、浅拷贝"></a>一、浅拷贝</h3><p>　　浅拷贝是对于一个对象的顶层拷贝，相当于只拷贝了最浅的一层或者第一层。通俗的理解是：拷贝了引用，并没有拷贝内容</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="keyword">import</span> copy       <span class="comment"># 浅拷贝模块</span></span><br><span class="line">a = [<span class="number">11</span>,<span class="number">22</span>]</span><br><span class="line">b = [<span class="number">33</span>,<span class="number">44</span>]</span><br><span class="line">c = [a,b]</span><br><span class="line">print(id(a))        	<span class="comment"># 列表a的内存地址</span></span><br><span class="line">print(id(b))        	<span class="comment"># 列表b的内存地址</span></span><br><span class="line">print(id(c))        	<span class="comment"># 列表c的内存地址</span></span><br><span class="line">d = copy.copy(c)  	<span class="comment"># 将列表c浅拷贝给列表d</span></span><br><span class="line">print(id(d))   		<span class="comment"># 列表d的内存地址</span></span><br><span class="line">print(id(d[<span class="number">0</span>])) <span class="comment"># 列表d中下标0的内存地址(因为下标0是列表a，所以内存地址与a一样)</span></span><br><span class="line">print(id(d[<span class="number">1</span>])) <span class="comment"># 列表d中下标0的内存地址(因为下标1是列表b，所以内存地址与b一样)</span></span><br><span class="line">a.append(<span class="number">11</span>)      <span class="comment"># 向列表a中添加元素11</span></span><br><span class="line">print(c)           	<span class="comment"># 输出添加后列表c的数据结果</span></span><br><span class="line">print(d) 				<span class="comment"># 输出添加后列表d的数据结果(因为d为浅拷贝c的数据，所以列表d与列表c的输出结果相同)</span></span><br><span class="line"><span class="number">2677221188168</span></span><br><span class="line"><span class="number">2677221188232</span></span><br><span class="line"><span class="number">2677221682376</span></span><br><span class="line"><span class="number">2677251508296</span></span><br><span class="line"><span class="number">2677221188168</span></span><br><span class="line"><span class="number">2677221188232</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">11</span>, <span class="number">22</span>, <span class="number">11</span>], [<span class="number">33</span>, <span class="number">44</span>]]	<span class="comment"># 第一层为a,b，并非外面的空列表框</span></span><br><span class="line">[[<span class="number">11</span>, <span class="number">22</span>, <span class="number">11</span>], [<span class="number">33</span>, <span class="number">44</span>]]	<span class="comment"># 第一层为a,b，并非外面的空列表框</span></span><br></pre></td></tr></table></figure></div>

<p><code>浅拷贝只拷贝第一层数据，列表[[11,22],[33,44]]中的第一层数据为[11,22],[33,44]，而并非最外层的空[ ]，所以，当列表a中添加元素时，拷贝的里面同样会添加上这个元素</code></p>
<h4 id="1、浅拷贝的三种情况"><a href="#1、浅拷贝的三种情况" class="headerlink" title="1、浅拷贝的三种情况"></a>1、浅拷贝的三种情况</h4><p>　　<strong>1、拷贝不可变对象：只是增加一个指向原对象的引用，改变会互相影响。</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">a = (<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">b = copy.copy(a)</span><br><span class="line">print(b)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改变一方，另一方也改变</span></span><br><span class="line">b[<span class="number">2</span>].append(<span class="number">5</span>)</span><br><span class="line">print(a)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>2、拷贝可变对象(一层结构)：产生新的对象，开辟新的内存空间，改变互不影响。</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b = copy.copy(a)</span><br><span class="line">print(b)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看两者的内存地址，不同，开辟了新的内存空间</span></span><br><span class="line">print(id(b))</span><br><span class="line">print(id(a))</span><br><span class="line"><span class="number">1833997595272</span></span><br><span class="line"><span class="number">1833997595080</span></span><br><span class="line"></span><br><span class="line">print(a <span class="keyword">is</span> b)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改变了一方，另一方关我卵事</span></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] </span><br><span class="line">b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b.append(<span class="number">4</span>)</span><br><span class="line">print(a)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">a.append(<span class="number">5</span>)</span><br><span class="line">print(b)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>3、拷贝可变对象(多层结构)：产生新的对象，开辟新的内存空间，不改变包含的子对象则互不影响、改变包含的子对象则互相影响。</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line">b = copy.copy(a)</span><br><span class="line">print(b)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看两者的内存地址，不同，开辟了新的内存空间</span></span><br><span class="line">print(id(b))</span><br><span class="line">print(id(a))</span><br><span class="line"><span class="number">1833997596488</span></span><br><span class="line"><span class="number">1833997596424</span></span><br><span class="line">print(a <span class="keyword">is</span> b)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.没有对包含的子对象进行修改，另一方关我卵事</span></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line">b = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line">b.append(<span class="number">5</span>)</span><br><span class="line">print(a)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line"></span><br><span class="line">a.append(<span class="number">6</span>)</span><br><span class="line">print(b)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>], <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.对包含的子对象进行修改，另一方也随之改变</span></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line">b = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line">b[<span class="number">2</span>].append(<span class="number">5</span>)</span><br><span class="line">print(a)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]]</span><br><span class="line"></span><br><span class="line">a[<span class="number">2</span>].append(<span class="number">6</span>)</span><br><span class="line">print(b)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]]</span><br></pre></td></tr></table></figure></div>

<h3 id="二、深拷贝"><a href="#二、深拷贝" class="headerlink" title="二、深拷贝"></a>二、深拷贝</h3><p>　　1、深拷贝会完全复制原变量的所有数据（递归性质的拷贝），在内存中生成一套完全一样的内容，我们对这两个变量中的一个进行任意修改都不会影响另一个变量。</p>
<p>　　<code>注意：浅拷贝对不可变类型和可变类型的copy不同：copy.copy对于可变类型，会进行浅拷贝，copy.copy对于不可变类型，不会拷贝，仅仅是指向</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">a = [<span class="number">11</span>,<span class="number">22</span>]</span><br><span class="line">b = [<span class="number">33</span>,<span class="number">44</span>]</span><br><span class="line">c = [a,b]</span><br><span class="line">print(<span class="string">"c 的内存地址："</span>,id(c))</span><br><span class="line"></span><br><span class="line">d = copy.deepcopy(c)</span><br><span class="line">print(<span class="string">"a 的内存地址："</span>,id(a))</span><br><span class="line">print(<span class="string">"b 的内存地址："</span>,id(b))</span><br><span class="line">print(<span class="string">"d 下标0的内存地址："</span>,id(d[<span class="number">0</span>]))</span><br><span class="line">print(<span class="string">"d 下标1的内存地址："</span>,id(d[<span class="number">1</span>]))</span><br><span class="line">print(<span class="string">"d 的内存地址："</span>,id(d))</span><br><span class="line"></span><br><span class="line">c[<span class="number">-1</span>].append(<span class="number">55</span>)</span><br><span class="line">print(<span class="string">"c 添加元素后："</span>,c)</span><br><span class="line">print(<span class="string">"d 的输出结果："</span>,d)</span><br><span class="line">输出结果为：</span><br><span class="line">c 的内存地址： <span class="number">1695548046536</span></span><br><span class="line">a 的内存地址： <span class="number">1695547548232</span></span><br><span class="line">b 的内存地址： <span class="number">1695547548296</span></span><br><span class="line">d 下标<span class="number">0</span>的内存地址： <span class="number">1695549425096</span> 	<span class="comment"># 与a的内存地址不同，因为只拷贝了a的内容</span></span><br><span class="line">d 下标<span class="number">1</span>的内存地址： <span class="number">1695549627720</span>	<span class="comment"># 与b的内存地址不同，因为只拷贝了b的内容</span></span><br><span class="line">d 的内存地址： <span class="number">1695549426312</span>	</span><br><span class="line">c 添加元素后： [[<span class="number">11</span>, <span class="number">22</span>], [<span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>]]		<span class="comment"># 深拷贝里c的内容发生改变</span></span><br><span class="line">d 的输出结果： [[<span class="number">11</span>, <span class="number">22</span>], [<span class="number">33</span>, <span class="number">44</span>]]			<span class="comment"># 拷贝后的内容不会受到任何影响</span></span><br></pre></td></tr></table></figure></div>

<p><code>d是深拷贝c的内容，并没有拷贝内存地址，所以，即便内容相同，内存地址也是不相同的，另外，当d拷贝过c里面的内容后，我们再对c进行修改或添加元素，并不会影响d里面的内容。</code></p>
<h3 id="三、-和-is运算符的区别"><a href="#三、-和-is运算符的区别" class="headerlink" title="三、== 和 is运算符的区别"></a>三、== 和 is运算符的区别</h3><p>　　1、== 比较的是两个对象的内容是否相等，即内存地址可以不一样，内容一样就可以了。</p>
<p>　　2、is 比较的是两个实例对象是不是完全相同，它们是不是同一个对象，占用的内存地址是否相同。</p>
<p>　　<code>个人理解：如果两个对象is成立，那么==就一定成立；相反，如果两个对象==成立，并不能代表is就一定成立</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如1：</span></span><br><span class="line">a = [<span class="number">11</span>,<span class="number">22</span>]</span><br><span class="line">b = [<span class="number">11</span>,<span class="number">22</span>]</span><br><span class="line">print(id(a))</span><br><span class="line">print(id(b))</span><br><span class="line"><span class="keyword">if</span> a == b:</span><br><span class="line">	print(<span class="string">"相等的"</span>)</span><br><span class="line"><span class="keyword">if</span> a <span class="keyword">is</span> b:</span><br><span class="line">	print(<span class="string">"a 是 b"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：</span></span><br><span class="line"><span class="number">3015265903176</span></span><br><span class="line"><span class="number">3015265903240</span></span><br><span class="line">相等的		<span class="comment"># 因为if a is b条件不成立，所以没有输出结果</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如2：</span></span><br><span class="line">a = <span class="number">3</span></span><br><span class="line">b = <span class="number">3</span></span><br><span class="line">print(id(a))</span><br><span class="line">print(id(b))</span><br><span class="line"><span class="keyword">if</span> a <span class="keyword">is</span> b:</span><br><span class="line">	print(<span class="string">"a 是 b"</span>)</span><br><span class="line"><span class="keyword">if</span> a == b:</span><br><span class="line">	print(<span class="string">"相等的"</span>)</span><br><span class="line"><span class="comment"># 输出结果为：</span></span><br><span class="line"><span class="number">140708210070624</span></span><br><span class="line"><span class="number">140708210070624</span></span><br><span class="line">a 是 b		<span class="comment"># 内存地址一样，条件成立，输出结果</span></span><br><span class="line">相等的		<span class="comment"># 内容一样，条件成立，输出结果</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>深浅拷贝</tag>
        <tag>is与==</tag>
      </tags>
  </entry>
  <entry>
    <title>Python内存回收机制</title>
    <url>/Python/Python_id_09.html</url>
    <content><![CDATA[<p>　　Python内存回收机制分为三种：引用计数、标记清楚、分代回收</p>
<a id="more"></a>

<h3 id="一、引用计数"><a href="#一、引用计数" class="headerlink" title="一、引用计数"></a>一、引用计数</h3><p>　　1、当一个对象的引用被创建或者复制时，对象的引用计数加1；当一个对象的引用被销毁时，对象的引用计数减1.</p>
<p>　　2、当对象的引用计数减少为0时，就意味着对象已经再没有被使用了，可以将其内存释放掉。</p>
<h3 id="二、标记清除"><a href="#二、标记清除" class="headerlink" title="二、标记清除"></a>二、标记清除</h3><p>　　1、它分为两个阶段：第一阶段是标记阶段，GC会把所有的活动对象打上标记，第二阶段是把那些没有标记的对象非活动对象进行回收。</p>
<p>　　2、对象之间通过引用（指针）连在一起，构成一个有向图</p>
<p>　　3、从根对象（root object）出发，沿着有向边遍历对象，可达的（reachable）对象标记为活动对象，不可达的对象就是要被清除的非活动对象，<br>　　　　根对象就是全局变量、调用栈、寄存器。</p>
<p>　　<code>注：像是PyIntObject、PyStringObject这些不可变对象是不可能产生循环引用的，因为它们内部不可能持有其它对象的引用。</code></p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/内存管理机制/标记清楚.png">

<p>　　1、在上图中，可以从程序变量直接访问块1，并且可以间接访问块2和3,程序无法访问块4和5</p>
<p>　　2、第一步将标记块1，并记住块2和3以供稍后处理。</p>
<p>　　3、第二步将标记块2，第三步将标记块3，但不记得块2，因为它已被标记。</p>
<p>　　4、扫描阶段将忽略块1，2和3，因为它们已被标记，但会回收块4和5。</p>
<h3 id="三、分代回收"><a href="#三、分代回收" class="headerlink" title="三、分代回收"></a>三、分代回收</h3><p>　　1、分代回收是建立在标记清除技术基础之上的，是一种以空间换时间的操作方式。</p>
<p>　　2、Python将内存分为了3“代”，分别为年轻代（第0代）、中年代（第1代）、老年代（第2代）</p>
<p>　　3、他们对应的是3个链表，它们的垃圾收集频率与对象的存活时间的增大而减小。</p>
<p>　　4、新创建的对象都会分配在年轻代，年轻代链表的总数达到上限时，Python垃圾收集机制就会被触发</p>
<p>　　5、把那些可以被回收的对象回收掉，而那些不会回收的对象就会被移到中年代去，依此类推</p>
<p>　　6、老年代中的对象是存活时间最久的对象，甚至是存活于整个系统的生命周期内。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>内存回收</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 三器</title>
    <url>/Python/Python_id_08.html</url>
    <content><![CDATA[<p>　　Python 三器分别为：迭代器、生成器、装饰器</p>
<a id="more"></a>

<h3 id="一、迭代"><a href="#一、迭代" class="headerlink" title="一、迭代"></a>一、迭代</h3><p>　　迭代是访问集合元素的一种方式.<br>　　迭代器是一个可以记住遍历的位置的对象。迭代器对象从集合的第一个元素开始访问，直到所有的元素被访问完结束。<br>　　迭代器只能往前不会后退。</p>
<h4 id="1、可迭代对象"><a href="#1、可迭代对象" class="headerlink" title="1、可迭代对象"></a>1、可迭代对象</h4><p>　　我们把遍历也叫做迭代<br>　　<strong>可以通过for…in…这类语句迭代读取一条数据供我们使用的对象称之为可迭代对象（Iterable）</strong><br>　　<strong>可被遍历的对象，就是可迭代对象</strong><br>　　可迭代(遍历)对象有：字符串、列表、元祖、字典、集合、range()</p>
<h4 id="2、如何判断一个对象是否可以迭代"><a href="#2、如何判断一个对象是否可以迭代" class="headerlink" title="2、如何判断一个对象是否可以迭代"></a>2、如何判断一个对象是否可以迭代</h4><p>　　我们可以使用isinstance() 来判断一个对象是否是 Iterable（可迭代） 对象</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 格式：</span></span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterable</span><br><span class="line">print(isinstance(对象,Iterable))</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line">print(isinstance([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],Iterable))</span><br><span class="line">输出结果为：</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></div>

<h4 id="3、可迭代对象的本质"><a href="#3、可迭代对象的本质" class="headerlink" title="3、可迭代对象的本质"></a>3、可迭代对象的本质</h4><p>　　可以帮我们把每次数据进行迭代称为迭代器<br>　　可迭代对象通过__ <strong>iter</strong> __ 方法向我们提供一个迭代器，我们在迭代一个可迭代对象的时候，实际上就<br>　　是先获取该对象提供的一个迭代器，然后通过这个迭代器来依次获取对象中的每一个数据.<br>　　那么也就是说：<br>　　　　一个具备了__ <strong>iter</strong> __方法的对象，就是一个可迭代对象。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如1：</span></span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterable  <span class="comment"># 这是一个判断是否为可迭代对象的模块</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mylist</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.list = []</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self,str)</span>:</span></span><br><span class="line">		self.list.append(str)</span><br><span class="line">		xiao_zhu = Mylist()</span><br><span class="line">		xiao_zhu.add(<span class="number">1</span>)</span><br><span class="line">		xiao_zhu.add(<span class="number">2</span>)</span><br><span class="line">		xiao_zhu.add(<span class="number">3</span>)</span><br><span class="line">		xiao_zhu.add(<span class="number">4</span>)</span><br><span class="line">print(isinstance(xiao_zhu,Iterable))</span><br><span class="line"><span class="comment"># 输出结果为:</span></span><br><span class="line"><span class="literal">False</span>		<span class="comment"># xiao_zhu不是可迭代对象</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如2：</span></span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterable      <span class="comment"># 这是一个判断是否为可迭代对象的模块</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mylist</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.list = []</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self,str)</span>:</span></span><br><span class="line">		self.list.append(str)</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		xiao_zhu = Mylist()</span><br><span class="line">		xiao_zhu.add(<span class="number">1</span>)</span><br><span class="line">		xiao_zhu.add(<span class="number">2</span>)</span><br><span class="line">		xiao_zhu.add(<span class="number">3</span>)</span><br><span class="line">		xiao_zhu.add(<span class="number">4</span>)</span><br><span class="line">print(isinstance(xiao_zhu,Iterable))</span><br><span class="line"><span class="comment"># 输出结果为：</span></span><br><span class="line"><span class="literal">True</span>  <span class="comment"># 添加过iter方法后，xiao_zhu就变成了可迭代对象</span></span><br></pre></td></tr></table></figure></div>

<h4 id="4、iter-和next-的函数作用"><a href="#4、iter-和next-的函数作用" class="headerlink" title="4、iter()和next()的函数作用"></a>4、iter()和next()的函数作用</h4><p>　　我们可以通过<strong>iter()</strong>来获取可迭代对象的迭代器，然后使用<strong>next()</strong>来获取迭代器的下一个数据<br>　　<strong>iter()</strong>其实就是调用了可迭代对象的<strong>__ <strong>iter</strong> __</strong> 方法<br>　　一个被<strong>iter()</strong>处理过的可迭代对象，就是一个迭代器</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如：</span></span><br><span class="line">a_list = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>] </span><br><span class="line">ali_iter = iter(a_list)		<span class="comment"># iter() 作用：获取可迭代带对象的迭代器</span></span><br><span class="line">print(next(ali_iter))  		<span class="comment"># next() 作用：获取迭代器的下一条数据	结果为：11</span></span><br><span class="line">print(next(ali_iter))		<span class="comment"># 结果为：22</span></span><br><span class="line">print(next(ali_iter))		<span class="comment"># 结果为：33</span></span><br><span class="line">print(next(ali_iter))		<span class="comment"># 结果为：44</span></span><br><span class="line">print(next(ali_iter))		<span class="comment"># 结果为：55</span></span><br><span class="line"><span class="comment"># print(next(ali_iter))  # 当数据拿完之后再拿就会报出：StopIteration停止迭代异常</span></span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterator  <span class="comment"># 这是一个判断是否为迭代器的模块</span></span><br><span class="line">print(isinstance(a_list,Iterator))  <span class="comment"># 判断这个列表是否为迭代器 结果：False</span></span><br><span class="line">print(<span class="string">"*"</span>*<span class="number">20</span>)	<span class="comment"># 分隔符</span></span><br><span class="line">print(isinstance(ali_iter,Iterator)) <span class="comment"># 判断这个列表经过iter()处理过之后是否为迭代器 结果:True</span></span><br></pre></td></tr></table></figure></div>

<h4 id="5、判断是否为迭代器的格式："><a href="#5、判断是否为迭代器的格式：" class="headerlink" title="5、判断是否为迭代器的格式："></a>5、判断是否为迭代器的格式：</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterator  <span class="comment"># 这是一个判断是否为迭代器的模块</span></span><br><span class="line">print(isinstance(变量,Iterator))  <span class="comment"># 判断这个变量是否为迭代器</span></span><br></pre></td></tr></table></figure></div>

<h3 id="二、迭代器（Iterator）"><a href="#二、迭代器（Iterator）" class="headerlink" title="二、迭代器（Iterator）"></a>二、迭代器（Iterator）</h3><h4 id="1、定义："><a href="#1、定义：" class="headerlink" title="1、定义："></a>1、定义：</h4><p>　　一个实现了__ <strong>iter</strong> __ 方法和 __ <strong>next</strong> __ 方法的对象，就是迭代器；反之，一个迭代器，一定含有__ <strong>iter</strong> __ 方法和 __ <strong>next</strong> __ 方法<br>　　__ <strong>iter</strong> __ 方法的作用是返回一个是可迭代对象的迭代器<br>　　因一个具备__ <strong>iter</strong> __ 方法的对象就是一个可迭代对象，而又因python中要求，每一个迭代器本身也要是可迭代对象，所以，__ <strong>iter</strong> __ 只需要返回自身即可</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIterator</span><span class="params">(object)</span>:</span>   	<span class="comment"># 迭代器类</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,alist)</span>:</span>     <span class="comment"># 实例属性的初始化和赋值</span></span><br><span class="line">		self.alist = alist</span><br><span class="line">		self.weizhi = <span class="number">0</span>     	<span class="comment"># 记录遍历位置</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span>     	<span class="comment"># 获取迭代器，自身就是迭代器，所以返回自身</span></span><br><span class="line">		<span class="keyword">return</span> self</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span>    		<span class="comment"># 获取迭代器的下一个数据</span></span><br><span class="line">		<span class="keyword">if</span> self.weizhi &lt; len(self.alist):</span><br><span class="line">			item = self.alist[self.weizhi]</span><br><span class="line">			self.weizhi += <span class="number">1</span></span><br><span class="line">			<span class="keyword">return</span> item</span><br><span class="line">		<span class="keyword">else</span>:             		<span class="comment"># 不能获取数据的情况</span></span><br><span class="line">			<span class="keyword">raise</span> StopIteration     	<span class="comment"># 主动抛出停止迭代异常</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:      	<span class="comment"># 程序入口</span></span><br><span class="line">	a_list = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>]</span><br><span class="line">	xiao_zhu = MyIterator(a_list)</span><br><span class="line">	<span class="comment"># 第一种方法，for遍历输出结果</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> xiao_zhu:					</span><br><span class="line">		print(i)</span><br><span class="line">	<span class="comment"># 第二种方法，无限循环</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:  </span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			ret = next(xiao_zhu)		<span class="comment"># 无限循环next()获取数据</span></span><br><span class="line">			print(ret)</span><br><span class="line">		<span class="keyword">except</span> StopIteration <span class="keyword">as</span> e:		<span class="comment"># 当无法拿到数据报出StopIterator异常时，保存到变量e中</span></span><br><span class="line">			print(e)				<span class="comment"># 输出保存异常的变量e(此行可省略不要)</span></span><br><span class="line">			<span class="keyword">break</span>				<span class="comment"># 停止输出保存异常的变量e</span></span><br><span class="line"><span class="comment"># 第三种方法，利用强转来获取里面的数据</span></span><br><span class="line">print(list(xiao_zhu))</span><br></pre></td></tr></table></figure></div>

<h4 id="2、for…in…循环的本质"><a href="#2、for…in…循环的本质" class="headerlink" title="2、for…in…循环的本质"></a>2、for…in…循环的本质</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		print(next(对象,Iterable))</span><br><span class="line">	<span class="keyword">except</span> StopIteration</span><br><span class="line">		<span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>

<h4 id="3、迭代器的应用场景"><a href="#3、迭代器的应用场景" class="headerlink" title="3、迭代器的应用场景"></a>3、迭代器的应用场景</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如斐波那契数列：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fei</span><span class="params">(object)</span>:</span>				<span class="comment"># 斐波那契数列类</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,n)</span>:</span>		<span class="comment"># 实例属性的初始化和赋值</span></span><br><span class="line">		self.n = n    	<span class="comment"># 构造长度</span></span><br><span class="line">		self.weizhi = <span class="number">0</span>   	<span class="comment"># 记录位置---类似于游标的作用</span></span><br><span class="line">		self.num1 = <span class="number">0</span>    	<span class="comment"># 定义初始变量</span></span><br><span class="line">		self.num2 = <span class="number">1</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span>   	<span class="comment"># 返回一个是可迭代对象的迭代器，即返回本身</span></span><br><span class="line">		<span class="keyword">return</span> self</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span>    <span class="comment"># 获取迭代器的下一位数据</span></span><br><span class="line">		<span class="keyword">if</span> self.weizhi &lt; self.n:</span><br><span class="line">			num = self.num1   <span class="comment"># 找一个变量接收初始位置数据0</span></span><br><span class="line">			self.num1,self.num2 = self.num2,self.num1 + self.num2</span><br><span class="line">			self.weizhi += <span class="number">1</span></span><br><span class="line">			<span class="keyword">return</span> num</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">raise</span> StopIteration</span><br><span class="line">            </span><br><span class="line"><span class="comment"># 程序入口</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	fei = Fei(<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> fei:</span><br><span class="line">		print(i)</span><br></pre></td></tr></table></figure></div>

<h3 id="三、生成器"><a href="#三、生成器" class="headerlink" title="三、生成器"></a>三、生成器</h3><h4 id="1、定义：-1"><a href="#1、定义：-1" class="headerlink" title="1、定义："></a>1、定义：</h4><p>　　生成器(generator)。生成器是一类特殊的迭代器。</p>
<h4 id="2、创建生成器"><a href="#2、创建生成器" class="headerlink" title="2、创建生成器"></a>2、创建生成器</h4><p>　　方法一：<br>　　　　将列表推导式外面的方括号改成圆括号，就是一种生成器**</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如：</span></span><br><span class="line">print([i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>)])   <span class="comment"># [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></span><br><span class="line">a = ((i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>)))   <span class="comment"># &lt;generator object &lt;genexpr&gt; at 0x000002C58B88A930&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>　　方法二：<br>　　　　<strong>只要在def中有yield关键字的就称为生成器**</strong></p>
<p>　　　　<strong>yield关键字有两点作用：</strong><br>　　　　　　1、保存当前运行状态（断点），然后暂停执行，即将生成器（函数）挂起(个人理解：暂停执行，即将生成器挂起)<br>　　　　　　2、将yield关键字后面表达式的值作为返回值返回，此时可以理解为起到了return的作用(个人理解：跟return的作用一样，将后面的表达式当成返回值返回)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fei</span><span class="params">(n)</span>:</span>					<span class="comment"># 构造函数，传参n为长度</span></span><br><span class="line">	num1,num2 = <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">	weizhi = <span class="number">0</span>				<span class="comment"># 记录初始位置</span></span><br><span class="line">	<span class="keyword">while</span> weizhi &lt; n:		<span class="comment"># 如果始位置小于长度</span></span><br><span class="line">		num = num1</span><br><span class="line">		num1,num2 = num2,num1+num2</span><br><span class="line">		weizhi += <span class="number">1</span></span><br><span class="line">	<span class="keyword">yield</span> num			<span class="comment"># yield是生成器的标志，其作用之一跟return一样，返回值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序入口</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	ret = fei(<span class="number">5</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> ret:</span><br><span class="line">		print(i)</span><br></pre></td></tr></table></figure></div>

<h4 id="3、唤醒生成器"><a href="#3、唤醒生成器" class="headerlink" title="3、唤醒生成器"></a>3、唤醒生成器</h4><p>　　可以使用next()函数让生成器从断点处继续执行，即唤醒生成器（函数）</p>
<p>　　唤醒生成器有三种<br>​　　　　第一种：send(None)    <strong>注意：</strong> <em>第一个send后面必须是None，之后的没有要求</em></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fei</span><span class="params">(n)</span>:</span></span><br><span class="line">	num1,num2 = <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">	weizhi = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> weizhi &lt; n:</span><br><span class="line">		num = num1</span><br><span class="line">		num1,num2 = num2,num1+num2</span><br><span class="line">		weizhi += <span class="number">1</span></span><br><span class="line">	<span class="keyword">yield</span> num</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	ret = fei(<span class="number">5</span>)</span><br><span class="line">	a = ret.send(<span class="literal">None</span>)		<span class="comment"># 一次只能唤醒一个数据</span></span><br><span class="line">	print(a)</span><br><span class="line">	a = ret.send(<span class="literal">None</span>)</span><br><span class="line">	print(a)</span><br></pre></td></tr></table></figure></div>

<p>　　第二种：next()函数</p>
<p>　　第三种：__ <strong>next</strong> __</p>
<h3 id="四、装饰器"><a href="#四、装饰器" class="headerlink" title="四、装饰器"></a>四、装饰器</h3><h4 id="1、闭包"><a href="#1、闭包" class="headerlink" title="1、闭包"></a>1、闭包</h4><p>　　1、在一个外函数中定义了一个内函数；<br>​　　2、内函数里运用了外函数的临时变量；<br>​　　3、并且外函数的返回值是内函数的引用。<br>​　　当满足这三个条件后，就构成了一个闭包</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">	sum = <span class="number">0</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span>			<span class="comment"># 条件1，外函数中定义了一个内函数</span></span><br><span class="line">		<span class="keyword">nonlocal</span> sum</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">101</span>):</span><br><span class="line">			sum += i		<span class="comment"># 条件2，运用了外函数的临时变量</span></span><br><span class="line">		print(sum)	</span><br><span class="line">	<span class="keyword">return</span> func2			<span class="comment"># 条件3，外函数的返回值是内涵数的引用</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	func1()()</span><br><span class="line">	<span class="comment"># 输出结果为：</span></span><br><span class="line">	<span class="number">5050</span></span><br></pre></td></tr></table></figure></div>

<h4 id="2、装饰器定义"><a href="#2、装饰器定义" class="headerlink" title="2、装饰器定义"></a>2、装饰器定义</h4><p>　　<strong>装饰器是在函数调用之上的修饰。这些修饰仅是当声明一个函数或者方法的时候，才会应用的额外调用。</strong></p>
<p>　　<strong>作用：</strong>在不变动原有代码的基础上，增加一些额外的功能</p>
<p>　　<strong>装饰器的执行流程：</strong>当f1调用函数时，会先调用装饰器，装饰器里的函数会从外层函数开始执行，外层函数返回了内层函数的引用，内层函数开始由上至下开始执行</p>
<p>　　<strong>多层装饰器的执行顺序：</strong>当f1调用时，会先调用最上面的装饰器，当最上面的装饰器内容执行完之后，会继续执行下一个装饰器，当这个装饰器的内容执行完毕后，<br>　　　　　　　　　　　　　会先结束此装饰器，然后再结束最上面的装饰器</p>
<p>　　<strong>概括：</strong>多层装饰器执行时由上至下，结束时由下至上。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如1：无参数的修饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wai_ceng</span><span class="params">(f1)</span>:</span>					<span class="comment"># 外层函数 将函数当成参数放在外层函数中</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">nei_ceng</span><span class="params">()</span>:</span>					<span class="comment"># 内层函数</span></span><br><span class="line">		print(<span class="string">"装饰器开始"</span>)		<span class="comment"># 内层函数由上至下开始执行</span></span><br><span class="line">		print(<span class="string">"同学你好.."</span>)</span><br><span class="line">		print(<span class="string">"装饰器结束"</span>)</span><br><span class="line">		f1()						<span class="comment"># 在此处调用f1函数</span></span><br><span class="line">	<span class="keyword">return</span> nei_ceng				<span class="comment"># 外层函数返回内层函数的引用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@wai_ceng							# 函数调用之上的修饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">"hello world hello python"</span>)<span class="comment"># 当装饰器中的内层函数调用f1函数时，开始执行</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	f1()</span><br><span class="line">	<span class="comment"># 输出结果为：</span></span><br><span class="line">	装饰器开始</span><br><span class="line">	同学你好..</span><br><span class="line">	装饰器结束</span><br><span class="line">	hello world hello python</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如2：有参数的修饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wai_ceng</span><span class="params">(f1)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">neiceng</span><span class="params">(a,b)</span>:</span></span><br><span class="line">		print(<span class="string">"装饰器开始"</span>)</span><br><span class="line">		print(<span class="string">"同学你好.."</span>)</span><br><span class="line">		print(<span class="string">"装饰器结束"</span>)</span><br><span class="line">		f1(a,b)</span><br><span class="line">	<span class="keyword">return</span> neiceng</span><br><span class="line"></span><br><span class="line"><span class="meta">@wai_ceng</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(a,b)</span>:</span></span><br><span class="line">	print(<span class="string">"hello world hello python\n"</span>,a+b)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	f1(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">	<span class="comment"># 输出结果为：</span></span><br><span class="line">	装饰器开始</span><br><span class="line">	同学你好..</span><br><span class="line">	装饰器结束</span><br><span class="line">	hello world hello python</span><br><span class="line">	<span class="number">3</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如3：不定长参数的装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wai_ceng</span><span class="params">(f1)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">neiceng</span><span class="params">(*ages,**kwages)</span>:</span></span><br><span class="line">		print(<span class="string">"装饰器开始"</span>)</span><br><span class="line">		print(<span class="string">"同学你好.."</span>)</span><br><span class="line">		print(<span class="string">"装饰器结束"</span>)</span><br><span class="line">		f1(*ages,**kwages)</span><br><span class="line">	<span class="keyword">return</span> neiceng</span><br><span class="line"></span><br><span class="line"><span class="meta">@wai_ceng</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(a,b,c,d)</span>:</span></span><br><span class="line">	print(<span class="string">"hello world hello python\n"</span>,a+b+c+d)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	f1(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">	<span class="comment"># 输出结果为：</span></span><br><span class="line">	装饰器开始</span><br><span class="line">	同学你好..</span><br><span class="line">	装饰器结束</span><br><span class="line">	hello world hello python</span><br><span class="line">	<span class="number">10</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如4：多层装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wai_ceng1</span><span class="params">(f1)</span>:</span>							<span class="comment"># 2、修饰器1里的函数，执行外层函数</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">neiceng</span><span class="params">(*ages,**kwages)</span>:</span>			<span class="comment"># 4、内层函数由上至下开始执行</span></span><br><span class="line">		print(<span class="string">"1--装饰器开始"</span>)</span><br><span class="line">		print(<span class="string">"1--同学你好.."</span>)</span><br><span class="line">		f1(*ages,**kwages)				<span class="comment"># 5、调用f1函数，进入修饰器2</span></span><br><span class="line">		print(<span class="string">"1--装饰器结束"</span>)				<span class="comment"># 12、再关闭修饰器1</span></span><br><span class="line">	<span class="keyword">return</span> neiceng							<span class="comment"># 3、返回修饰器1里内层函数的引用</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wai_ceng2</span><span class="params">(f1)</span>:</span>							<span class="comment"># 6、进入修饰器2，执行外层函数</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">neiceng</span><span class="params">(*ages,**kwages)</span>:</span>			<span class="comment"># 8、内层函数由上至下开始执行</span></span><br><span class="line">		print(<span class="string">"2--装饰器开始"</span>)</span><br><span class="line">		print(<span class="string">"2--同学你好.."</span>)</span><br><span class="line">		f1(*ages,**kwages)				<span class="comment"># 9、调用f1函数</span></span><br><span class="line">		print(<span class="string">"2--装饰器结束"</span>)				<span class="comment"># 11、由下至上关闭多层修饰器，先关闭修饰器2</span></span><br><span class="line">	<span class="keyword">return</span> neiceng							<span class="comment"># 7、返回修饰器2里内层函数的引用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@wai_ceng1</span></span><br><span class="line"><span class="meta">@wai_ceng2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(a,b,c,d)</span>:</span>			<span class="comment"># 1、当调用f1函数时，由上而下执行多层修饰器，先进入修饰器1</span></span><br><span class="line">	print(<span class="string">"hello world hello python\n"</span>,a+b+c+d)		<span class="comment"># 10、执行f1</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	f1(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">	<span class="comment"># 输出结果为：</span></span><br><span class="line">	<span class="number">1</span>--装饰器开始</span><br><span class="line">	<span class="number">1</span>--同学你好..</span><br><span class="line">	<span class="number">2</span>--装饰器开始</span><br><span class="line">	<span class="number">2</span>--同学你好..</span><br><span class="line">	hello world hello python</span><br><span class="line">	<span class="number">10</span></span><br><span class="line">	<span class="number">2</span>--装饰器结束</span><br><span class="line">	<span class="number">1</span>--装饰器结束</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>迭代器</tag>
        <tag>生成器</tag>
        <tag>装饰器</tag>
      </tags>
  </entry>
  <entry>
    <title>Python高阶函数</title>
    <url>/Python/Python_id_07.html</url>
    <content><![CDATA[<h3 id="一、什么是高阶函数？"><a href="#一、什么是高阶函数？" class="headerlink" title="一、什么是高阶函数？"></a>一、什么是高阶函数？</h3><p>　　高阶函数定义：一个函数可以作为参数传给另外一个函数，或者一个函数的返回值为另外一个函数（若返回值为该函数本身，则为递归），满足其一则为高阶函数。</p>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#参数为函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br><span class="line">	print(<span class="string">"in the bar.."</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(func)</span>:</span></span><br><span class="line">        func()</span><br><span class="line">        print(<span class="string">"in the foo.."</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:      	<span class="comment"># 程序入口</span></span><br><span class="line">	foo(bar)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#返回值为函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"in the bar.."</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(func)</span>:</span></span><br><span class="line">        print(<span class="string">"in the foo.."</span>)</span><br><span class="line">        <span class="keyword">return</span> bar</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:      	<span class="comment"># 程序入口</span></span><br><span class="line">	res=foo(bar)</span><br><span class="line">	res()</span><br></pre></td></tr></table></figure></div>

<p>　　以上两个示例中，函数foo()为高阶函数，示例一中函数bar作为foo的参数传入，示例二中函数bar作为foo的返回值。</p>
<p>　　注：函数名（例如bar 、foo）–&gt;其为该函数的内存地址；函数名+括号（例如 bar()、foo() )–&gt;调用该函数。</p>
<h3 id="二、map-高阶函数用法"><a href="#二、map-高阶函数用法" class="headerlink" title="二、map()高阶函数用法"></a>二、map()高阶函数用法</h3><p>　　<strong>格式：</strong>map(function(函数),Iterable(可迭代对象))</p>
<p>　　将函数中的参数，分别传到可迭代对象的每一个元素中，最后返回一个迭代器</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如1：放一个形参</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> a**<span class="number">2</span></span><br><span class="line">ret = map(func,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ret:			<span class="comment"># 因为返回的是一个迭代器，所以需要用查看迭代器的三种方式来查看</span></span><br><span class="line">	print(i,end=<span class="string">" "</span>)</span><br><span class="line">输出结果为：</span><br><span class="line"><span class="number">1</span> <span class="number">4</span> <span class="number">9</span> <span class="number">16</span> <span class="number">25</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如2：放两个形参时,可迭代对象同样要放两个,且里面元素长度必须一样,如不一样,则以短的计算</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a,b)</span>:</span></span><br><span class="line">      <span class="keyword">return</span> a+b</span><br><span class="line">ret = map(func,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ret:		<span class="comment"># 因为返回的是一个迭代器，所以需要用查看迭代器的三种方式来查看</span></span><br><span class="line">      print(i,end=<span class="string">" "</span>)</span><br><span class="line">输出结果为：</span><br><span class="line"><span class="number">2</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">10</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如3：匿名函数也可以被高阶函数map使用</span></span><br><span class="line">f = <span class="keyword">lambda</span> a,b:a+b</span><br><span class="line">ret = map(f,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ret:		<span class="comment"># 因为返回的是一个迭代器，所以需要用查看迭代器的三种方式来查看</span></span><br><span class="line">      print(i,end=<span class="string">" "</span>)</span><br><span class="line">输出结果为：</span><br><span class="line"><span class="number">2</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">10</span></span><br></pre></td></tr></table></figure></div>

<h3 id="三、reduce-高阶函数用法"><a href="#三、reduce-高阶函数用法" class="headerlink" title="三、reduce()高阶函数用法"></a>三、reduce()高阶函数用法</h3><p>　　<strong>格式：</strong>reduce(function(函数),Iterable(可迭代对象))</p>
<p>　　使用前需导入模块：from functools import reduce<br>　　先对可迭代对象中的第1，2个元素进行操作，然后再拿结果与第3个元素进行操作，以此类推，最后返回一个计算结果</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如1：</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce	<span class="comment"># 先导入reduce模块</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a,b)</span>:</span></span><br><span class="line">      <span class="keyword">return</span> a+b</span><br><span class="line">ret = reduce(func,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])	<span class="comment"># 先进行1，2相加操作，再拿结果3与3相加，再拿结果6与4相加</span></span><br><span class="line">print(ret)		<span class="comment"># 因为高阶函数reduce返回的是一个计算结果，所以可以直接打印输出</span></span><br><span class="line">输出结果为：</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如2：匿名函数也可以被高阶函数reduce使用</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce	<span class="comment"># 先导入reduce模块</span></span><br><span class="line">f = <span class="keyword">lambda</span> a,b:a+b</span><br><span class="line">ret = reduce(f,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])		<span class="comment"># 先进行1，2相加操作，再拿结果3与3相加，再拿结果6与4相加</span></span><br><span class="line">print(ret)		<span class="comment"># 因为高阶函数reduce返回的是一个计算结果，所以可以直接打印输出</span></span><br><span class="line">输出结果为：</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure></div>

<h3 id="四、filter-高阶函数用法"><a href="#四、filter-高阶函数用法" class="headerlink" title="四、filter()高阶函数用法"></a>四、filter()高阶函数用法</h3><p>　　<strong>格式：</strong>filter(fuunction(函数),Iterable(可迭代对象))</p>
<p>　　将可迭代对象中的每一个元素传给函数进行判断，然后将满足判断条件的元素放到一个新的迭代器中，返回一个新的迭代器</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如1：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a)</span>:</span></span><br><span class="line">      <span class="keyword">return</span> a % <span class="number">2</span> == <span class="number">0</span>		<span class="comment"># 判断条件为偶数</span></span><br><span class="line">f = filter(func,range(<span class="number">21</span>))		<span class="comment"># 判断范围为0-21之间</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">      print(i,end=<span class="string">" "</span>)</span><br><span class="line">输出结果为：</span><br><span class="line"><span class="number">0</span> <span class="number">2</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">10</span> <span class="number">12</span> <span class="number">14</span> <span class="number">16</span> <span class="number">18</span> <span class="number">20</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如2：匿名函数也可以被高阶函数filter使用</span></span><br><span class="line">ret = filter(<span class="keyword">lambda</span> a:a % <span class="number">2</span> == <span class="number">0</span>,range(<span class="number">1</span>,<span class="number">21</span>))	<span class="comment"># 构造匿名函数，设置输出范围以及判断条件</span></span><br><span class="line">print(list(ret))		<span class="comment"># 用迭代器的列表强转来实现输出结果</span></span><br><span class="line">输出结果为：</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">20</span>]</span><br></pre></td></tr></table></figure></div>

<h3 id="五、sorted-高阶函数的用法"><a href="#五、sorted-高阶函数的用法" class="headerlink" title="五、sorted()高阶函数的用法"></a>五、sorted()高阶函数的用法</h3><p>　　<strong>格式：</strong>sorted(Iterable(可迭代对象),key=abs(绝对值函数),reverse(翻转)=false(不))<br>　　将列表以默认升序的方法进行排序，reverse可实现升序或者降序的排序，True为降序排序，False为升序排序，key=abs：abs是绝对值函数，<br>　　取可迭代对象中的每一个元素的绝对值后将绝对值进行排序，返回一个被重新排过序的列表</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如1：</span></span><br><span class="line">a = [<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line">ret = sorted(a)		<span class="comment"># 默认升序排序</span></span><br><span class="line">print(ret)</span><br><span class="line">输出结果为：</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如2：</span></span><br><span class="line">ret = sorted([<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">4</span>])			<span class="comment"># 默认升序排序</span></span><br><span class="line">print(ret)</span><br><span class="line">ret = sorted([<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">4</span>],reverse=<span class="literal">True</span>)	<span class="comment"># 当翻转值是True时，代表需要翻转，则为降序排序</span></span><br><span class="line">print(ret)</span><br><span class="line">ret = sorted([<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">-9</span>,<span class="number">3</span>,<span class="number">-4</span>],reverse=<span class="literal">True</span>)	<span class="comment"># 当翻转值是True时，代表需要翻转，则为降序排序</span></span><br><span class="line">print(ret)</span><br><span class="line">输出结果为：</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">[<span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">8</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">-4</span>, <span class="number">-9</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 例如3：</span></span><br><span class="line">print(sorted([<span class="number">1</span>,<span class="number">9</span>,<span class="number">-8</span>,<span class="number">6</span>,<span class="number">-7</span>,<span class="number">6</span>,<span class="number">22</span>,<span class="number">-33</span>],key=abs,reverse=<span class="literal">False</span>))</span><br><span class="line"><span class="comment"># 取元素的每一个绝对值后，再将绝对值进行排序，翻转的值为False，所以此排序为升序排序</span></span><br><span class="line">输出结果为：</span><br><span class="line">[<span class="number">1</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">-7</span>, <span class="number">-8</span>, <span class="number">9</span>, <span class="number">22</span>, <span class="number">-33</span>]</span><br></pre></td></tr></table></figure></div>

<h3 id="六、lambda基本使用"><a href="#六、lambda基本使用" class="headerlink" title="六、lambda基本使用"></a>六、lambda基本使用</h3><p>　　　1、lambda只是一个表达式，函数体比def简单很多。</p>
<p>　　　2、lambda的主体是一个表达式，而不是一个代码块。仅仅能在lambda表达式中封装有限的逻辑进去。</p>
<p>　　　3、lambda表达式是起到一个函数速写的作用。允许在代码内嵌入一个函数的定义。</p>
<p>　　　4、<strong>格式：</strong>lambda的一般形式是关键字lambda后面跟一个或多个参数，紧跟一个冒号，之后是一个表达式。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> x,y,z:x+y+z</span><br><span class="line">print(f(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)) </span><br><span class="line"><span class="comment"># 运行结果：6</span></span><br><span class="line"> </span><br><span class="line">my_lambda = <span class="keyword">lambda</span> arg : arg + <span class="number">1</span></span><br><span class="line">print(my_lambda(<span class="number">10</span>)) </span><br><span class="line"><span class="comment"># 运行结果：11</span></span><br></pre></td></tr></table></figure></div>

<h3 id="七、-三元运算"><a href="#七、-三元运算" class="headerlink" title="七、 三元运算"></a>七、 三元运算</h3><p>　　<strong>1、三元运算</strong><br>　　　1、<strong>三元运算格式：</strong>  result=值1 if x&lt;y else 值2   if条件成立result=1,否则result=2<br>　　　2、<strong>作用：</strong>三元运算，又称三目运算，主要作用是减少代码量，是对简单的条件语句的缩写</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">res = <span class="literal">True</span> <span class="keyword">if</span> <span class="number">1</span> == <span class="number">1</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">print(res)</span><br><span class="line"><span class="comment"># 运行结果： True</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> x:x <span class="keyword">if</span> x % <span class="number">2</span> != <span class="number">0</span> <span class="keyword">else</span> x + <span class="number">100</span></span><br><span class="line">print(f(<span class="number">10</span>)) </span><br><span class="line"><span class="comment"># 110</span></span><br></pre></td></tr></table></figure></div>



















]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>高阶函数</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 三程、GIL锁</title>
    <url>/Python/Python_id_06.html</url>
    <content><![CDATA[<p>　　Python 三程分别为：进程、线程、协程</p>
<a id="more"></a>

<h3 id="一、进程与线程简介"><a href="#一、进程与线程简介" class="headerlink" title="一、进程与线程简介"></a>一、进程与线程简介</h3><h4 id="1、什么是进程-process-？（进程是资源集合）"><a href="#1、什么是进程-process-？（进程是资源集合）" class="headerlink" title="1、什么是进程(process)？（进程是资源集合）"></a>1、什么是进程(process)？（进程是资源集合）</h4><p>　　<strong>定义：</strong>1）进程是资源分配最小单位</p>
<p>　　　　　2）当一个可执行程序被系统执行（分配内存资源）就变成了一个进程</p>
<p>　　　　　　　　1、程序并不能单独运行，只有将程序装载到内存中，系统为它分配资源才能运行，这种执行的程序就称之为进程</p>
<p>　　　　　　　　2、程序和进程的区别就在于：程序是指令的集合，它是进程运行的静态描述文本；进程是程序的一次执行活动，属于动态概念</p>
<p>　　　　　　　　3、在多道编程中，我们允许多个程序同时加载到内存中，在操作系统的调度下，可以实现并发地执行。</p>
<p>　　　　　　　　4、进程的出现让每个用户感觉到自己独享CPU，因此，进程就是为了在CPU上实现多道编程而提出的。</p>
<p>　　　　　　　　5、进程之间有自己独立的内存，各进程之间不能相互访问</p>
<p>　　　　　　　　6、创建一个新线程很简单，创建新进程需要对父进程进行复制</p>
<p>　　<strong>多道编程：</strong> 在计算机内存中同时存放几道相互独立的程序，他们共享系统资源，相互穿插运行</p>
<p>　　<strong>单道编程：</strong> 计算机内存中只允许一个的程序运行</p>
<p>　　<strong>进程并发性：</strong></p>
<p>　　　　　1）在一个系统中，同时会存在多个进程被加载到内存中，同处于开始到结束之间的状态</p>
<p>　　　　　2）对于一个单CPU系统来说，程序同时处于运行状态只是一种宏观上的概念，他们虽然都已经开始运行，但就微观而言，任意时刻CPU上运行的程序只有一个</p>
<p>　　　　　3）由于操作系统分时，让每个进程都觉得自己独占CPU等资源</p>
<p>　　　　　<strong>注：</strong>如果是多核CPU（处理器）实际上是可以实现正在意义的同一时间点有多个线程同时运行</p>
<p>　　<strong>线程并发性：</strong></p>
<p>　　　　　1）操作系统将时间划分为很多时间段，尽可能的均匀分配给每一个线程。</p>
<p>　　　　　2）获取到时间片的线程被CPU执行，其他则一直在等待，所以微观上是走走停停，宏观上都在运行。</p>
<p>　　<strong>多核CPU情况：</strong>　　　　　　　　　　</p>
<p>　　　　　　　　　　如果你的程序的线程数少于CPU的核心数，且系统此时没有其他进程同时运行，那么这个程序的每个线程会享有一个CPU，<br>　　　　　　　　　　当同时运行的线程数多于CPU核心数时，CPU会采用一定的调度算法每隔一段时间就将这些线程调入或调出CPU<br>　　　　　　　　　　以确保每个线程都能分享一部分CPU时间，实现多线程并发。</p>
<h4 id="2、有了进程为什么还要线程？"><a href="#2、有了进程为什么还要线程？" class="headerlink" title="2、有了进程为什么还要线程？"></a>2、有了进程为什么还要线程？</h4><p>　　<strong>1、进程优点：</strong></p>
<p>　　　　　提供了多道编程，让我们感觉我们每个人都拥有自己的CPU和其他资源，可以提高计算机的利用率</p>
<p>　　<strong>2、进程的两个重要缺点</strong></p>
<p>　　　　　a. 第一点：进程只能在一个时间干一件事，如果想同时干两件事或多件事，进程就无能为力了。<br>　　　　　b. 第二点：进程在执行的过程中如果阻塞，即使进程中有些工作不依赖于输入的数据，也将无法执行（例如等待输入，整个进程就会挂起）。<br>　　　　　c. 例如，我们在使用qq聊天， qq做为一个独立进程如果同一时间只能干一件事，那他如何实现在同一时刻 即能监听键盘输入、又能监听其它人给你发的消息<br>　　　　　d. 你会说，操作系统不是有分时么？分时是指在不同进程间的分时呀<br>　　　　　e. 即操作系统处理一会你的qq任务，又切换到word文档任务上了，每个cpu时间片分给你的qq程序时，你的qq还是只能同时干一件事呀</p>
<h4 id="3、什么是线程-thread-（线程是操作系统最小的调度单位）"><a href="#3、什么是线程-thread-（线程是操作系统最小的调度单位）" class="headerlink" title="3、什么是线程(thread)（线程是操作系统最小的调度单位）"></a>3、什么是线程(thread)（线程是操作系统最小的调度单位）</h4><p>　　<strong>定义：</strong>1）线程是操作系统调度的最小单位</p>
<p>　　　　　　2）它被包含在进程之中，是进程中的实际运作单位</p>
<p>　　　　　　3）进程本身是无法自己执行的，要操作cpu，必须创建一个线程，线程是一系列指令的集合</p>
<p>　　　　　　　　1、线程是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位</p>
<p>　　　　　　　　2、一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务</p>
<p>　　　　　　　　3、无论你启多少个线程，你有多少个cpu, Python在执行的时候会淡定的在同一时刻只允许一个线程运行</p>
<p>　　　　　　　　4、进程本身是无法自己执行的，要操作cpu，必须创建一个线程，线程是一系列指令的集合</p>
<p>　　　　　　　　5、所有在同一个进程里的线程是共享同一块内存空间的，不同进程间内存空间不同</p>
<p>　　　　　　　　6、同一个进程中的各线程可以相互访问资源，线程可以操作同进程中的其他线程，但进程仅能操作子进程</p>
<p>　　　　　　　　7、两个进程想通信，必须要通过一个中间代理</p>
<p>　　　　　　　　8、对主线程的修改可能回影响其他子线程，对主进程修改不会影响其他进程因为进程间内存相互独立，但是同一进程下的线程共享内存</p>
<h4 id="4、进程和线程的区别"><a href="#4、进程和线程的区别" class="headerlink" title="4、进程和线程的区别"></a>4、进程和线程的区别</h4><p>　　启动一个线程比启动一个进程快，运行速度没有可比性。</p>
<p>　　先有一个进程然后才能有线程。</p>
<p>　　　　1、进程包含线程</p>
<p>　　　　2、线程共享内存空间</p>
<p>　　　　3、进程内存是独立的（不可互相访问）</p>
<p>　　　　4、进程可以生成子进程，子进程之间互相不能互相访问（相当于在父级进程克隆两个子进程）</p>
<p>　　　　5、在一个进程里面线程之间可以交流。两个进程想通信，必须通过一个中间代理来实现</p>
<p>　　　　6、创建新线程很简单，创建新进程需要对其父进程进行克隆。</p>
<p>　　　　7、一个线程可以控制或操作同一个进程里面的其它线程。但进程只能操作子进程。</p>
<p>　　　　8、父进程可以修改不影响子进程，但不能修改。</p>
<p>　　　　9、线程可以帮助应用程序同时做几件事</p>
<h4 id="5、进程和程序的区别"><a href="#5、进程和程序的区别" class="headerlink" title="5、进程和程序的区别"></a>5、进程和程序的区别</h4><p>　　1、程序只是一个普通文件，是一个机器代码指令和数据的集合，所以，程序是一个静态的实体，</p>
<p>　　2、而进程是程序运行在数据集上的动态过程，进程是一个动态实体，它应创建而产生，应调度执行因等待资源或事件而被处于等待状态，因完成任务而被撤消</p>
<p>　　3、进程是系统进行资源分配和调度的一个独立单位</p>
<p>　　4、一个程序对应多个进程，一个进程为多个程序服务（两者之间是多对多的关系）</p>
<p>　　5、一个程序执行在不同的数据集上就成为不同的进程，可以用进程控制块来唯一地标识每个进程</p>
<h3 id="二、多线程"><a href="#二、多线程" class="headerlink" title="二、多线程"></a>二、多线程</h3><p>　　<strong>Python多线程编程中常用方法：</strong></p>
<p>　　　　　　<strong>1、join()方法：</strong>如果一个线程或者在函数执行的过程中调用另一个线程，并且希望待其完成操作后才能执行，<br>　　　　　　   那么在调用线程的时就可以使用被调线程的join方法join([timeout]) timeout：可选参数，线程运行的最长时间<br>　　　　　　<strong>2、isAlive()方法：</strong>查看线程是否还在运行<br>　　　　　　<strong>3、getName()方法：</strong>获得线程名<br>　　　　　　<strong>4、setDaemon()方法：</strong>主线程退出时，需要子线程随主线程退出，则设置子线程的setDaemon()</p>
<p> 　<strong>1、线程2种调用方式：直接调用， 继承式调用</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">(num)</span>:</span>                                   <span class="comment"># 定义每个线程要运行的函数</span></span><br><span class="line">    print(<span class="string">"running on number:%s"</span> % num)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#1、target=sayhi ：sayhi是定义的一个函数的名字</span></span><br><span class="line"><span class="comment">#2、args=(1,)    ： 括号内写的是函数的参数</span></span><br><span class="line">t1 = threading.Thread(target=sayhi, args=(<span class="number">1</span>,))    <span class="comment"># 生成一个线程实例</span></span><br><span class="line">t2 = threading.Thread(target=sayhi, args=(<span class="number">2</span>,))    <span class="comment"># 生成另一个线程实例</span></span><br><span class="line"></span><br><span class="line">t1.start()                                        <span class="comment"># 启动线程</span></span><br><span class="line">t2.start()                                        <span class="comment"># 启动另一个线程</span></span><br><span class="line"></span><br><span class="line">print(t1.getName())                               <span class="comment"># 获取线程名</span></span><br><span class="line">print(t2.getName())</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,num)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span><span class="comment">#定义每个线程要运行的函数</span></span><br><span class="line">        print(<span class="string">"running on number:%s"</span> %self.num)</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t1 = MyThread(<span class="number">1</span>)</span><br><span class="line">    t2 = MyThread(<span class="number">2</span>)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>2、for循环同时启动多个线程</strong></p>
<p>　　　　　　<strong>说明：</strong>下面利用for循环同时启动50个线程并行执行，执行时间是3秒而不是所有线程执行时间的总和</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">(num)</span>:</span> <span class="comment">#定义每个线程要运行的函数</span></span><br><span class="line">    print(<span class="string">"running on number:%s"</span> %num)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    t = threading.Thread(target=sayhi,args=(<span class="string">'t-%s'</span>%i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>3、t.join()：</strong> 实现所有线程都执行结束后再执行主线程</p>
<p>　　　　　　<strong>说明：</strong>在4中虽然可以实现50个线程同时并发执行，但是主线程不会等待子线程结束在这里我们可以使用t.join()指定等待某个线程结束的结果</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">start_time = time.time()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">(num)</span>:</span> <span class="comment">#定义每个线程要运行的函数</span></span><br><span class="line">    print(<span class="string">"running on number:%s"</span> %num)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">t_objs = []    <span class="comment">#将进程实例对象存储在这个列表中</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    t = threading.Thread(target=sayhi,args=(<span class="string">'t-%s'</span>%i,))</span><br><span class="line">    t.start()          <span class="comment">#启动一个线程，程序不会阻塞</span></span><br><span class="line">    t_objs.append(t)</span><br><span class="line">print(threading.active_count())    <span class="comment">#打印当前活跃进程数量</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> t_objs: <span class="comment">#利用for循环等待上面50个进程全部结束</span></span><br><span class="line">    t.join()     <span class="comment">#阻塞某个程序</span></span><br><span class="line">print(threading.current_thread())    <span class="comment">#打印执行这个命令进程</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"----------------all threads has finished....."</span>)</span><br><span class="line">print(threading.active_count())</span><br><span class="line">print(<span class="string">'cost time:'</span>,time.time() - start_time)</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>4、setDaemon():</strong> 守护线程，主线程退出时，需要子线程随主线程退出</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">start_time = time.time()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">(num)</span>:</span> <span class="comment">#定义每个线程要运行的函数</span></span><br><span class="line">    print(<span class="string">"running on number:%s"</span> %num)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    t = threading.Thread(target=sayhi,args=(<span class="string">'t-%s'</span>%i,))</span><br><span class="line">    t.setDaemon(<span class="literal">True</span>)  <span class="comment">#把当前线程变成守护线程，必须在t.start()前设置</span></span><br><span class="line">    t.start()          <span class="comment">#启动一个线程，程序不会阻塞</span></span><br><span class="line">print(<span class="string">'cost time:'</span>,time.time() - start_time)</span><br></pre></td></tr></table></figure></div>

<h3 id="三、GIL锁和用户锁（Global-Interpreter-Lock-全局解释器锁）"><a href="#三、GIL锁和用户锁（Global-Interpreter-Lock-全局解释器锁）" class="headerlink" title="三、GIL锁和用户锁（Global Interpreter Lock 全局解释器锁）"></a>三、GIL锁和用户锁（<code>Global Interpreter Lock 全局解释器锁</code>）</h3><p>　　　　<strong>1.全局解释器锁：</strong>保证同一时间仅有一个线程对资源有操作权限</p>
<p>　　　　　　　　<strong>作用：</strong>在一个进程内，同一时刻只能有一个线程通过GIL锁 被CUP调用，<strong>切换条件：I/O操作、固定时间(系统决定)</strong></p>
<p>　　　　　　　　<strong>说明：</strong>python多线程中GIL锁只是在CPU操作时（如：计算）才是串行的，其他都是并行的，所以比串行快很多</p>
<p>　　　　　　　　1）为了解决不同线程同时访问同一资源时，数据保护问题，而产生了GIL</p>
<p>　　　　　　　　2）GIL在解释器的层面限制了程序在同一时间只有一个线程被CPU实际执行，而不管你的程序里实际开了多少条线程</p>
<p>　　　　　　　　3）为了解决这个问题，CPython自己定义了一个全局解释器锁，同一时间仅仅有一个线程可以拿到这个数据</p>
<p>　　　　　　　　4）python之所以会产生这种不好的状况是因为python启用一个线程是调用操作系统原生线程，就是C接口</p>
<p>　　　　　　　　5）但是这仅仅是CPython这个版本的问题，在PyPy，中就没有这种缺陷</p>
<p>　　　　<strong>2.用户锁：线程锁(互斥锁Mutex) ：</strong>当前线程还未操作完成前其他所有线程都无法对其操作，即使已经释放了GIL锁</p>
<p>　　　　　　<strong>1. 在有GIL锁时为何还需要用户锁</strong></p>
<p>　　　　　　　　　　1）GIL锁只能保证同一时间只能有一个线程对某个资源操作，但当上一个线程还未执行完毕时可能就会释放GIL，其他线程就可以操作了</p>
<p>　　　　　　<strong>2. 线程锁的原理</strong></p>
<p>　　　　　　　　　　1）当一个线程对某个资源进行CPU计算的操作时加一个线程锁，只有当前线程计算完成主动释放锁，其他线程才能对其操作</p>
<p>　　　　　　　　　　2）这样就可以防止还未计算完成，释放GIL锁后其他线程对这个资源操作导致混乱问题</p>
<p>　　　　　　<strong>3. 在有GIL的情况下执行 count = count + 1 会出错，用线程锁解决方法</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1）第一步：count = 0   count初始值为0</span></span><br><span class="line"><span class="comment"># 2）第二步：线程1要执行对count加1的操作首先申请GIL全局解释器锁</span></span><br><span class="line"><span class="comment"># 3）第三步：调用操作系统原生线程在操作系统中执行</span></span><br><span class="line"><span class="comment"># 4）第四步：count加1还未执行完毕，时间到了被要求释放GIL</span></span><br><span class="line"><span class="comment"># 5）第五步：线程1释放了GIL后线程2此时也要对count进行操作，此时线程1还未执行完，所以count还是0</span></span><br><span class="line"><span class="comment"># 6）第六步：线程2此时拿到count = 0后也要对count进行加1操作，假如线程2执行很快，一次就完成了</span></span><br><span class="line"><span class="comment">#    count加1的操作，那么count此时就从0变成了1</span></span><br><span class="line"><span class="comment"># 7）第七步：线程2执行完加1后就赋值count=1并释放GIL</span></span><br><span class="line"><span class="comment"># 8）第八步：线程2执行完后cpu又交给了线程1，线程1根据上下文继续执行count加1操作，先拿到GIL</span></span><br><span class="line"><span class="comment">#    锁，完成加1操作，由于线程1先拿到的数据count=0，执行完加1后结果还是1</span></span><br><span class="line"><span class="comment"># 9）第九步：线程1将count=1在次赋值给count并释放GIL锁，此时连个线程都对数据加1，但是值最终是1</span></span><br></pre></td></tr></table></figure></div>

<p>　<strong>1、使用线程锁解决上面问题的原理</strong></p>
<p>　　　　　　　　　　1） 在GIL锁中再加一个线程锁，线程锁是用户层面的锁<br>　　　　　　　　　　2） 线程锁就是一个线程在对数据操作前加一把锁，防止其他线程复制或者操作这个数据<br>　　　　　　　　　　3） 只有这个线程对数据操作完毕后才会释放这个锁，其他线程才能操作这个数据</p>
<p>　　　　　　<strong>2、定义一个线程锁非常简单只用三步：</strong></p>
<p>　　　　　　　　　　<strong>第一步：</strong> lock = threading.Lock()            #定义一把锁<br>　　　　　　　　　　<strong>第二步：</strong> lock.acquire()                    #对数据操作前加锁防止数据被另一线程操作<br>　　　　　　　　　　<strong>第三步：</strong> lock.release()                     #对数据操作完成后释放锁</p>
<p>　　<strong>6、死锁</strong></p>
<p>　　　　<strong>1. 死锁定义</strong></p>
<p>　　　　　　　　两个以上的进程或线程在执行过程中，因争夺资源而造成的一种互相等待的现象，若无外力作用，它们都将无法推进下去。</p>
<p>　　　　<strong>2. 死锁举例</strong></p>
<p>　　　　　　1. 启动5个线程，执行run方法,假如thread1首先抢到了A锁，此时thread1没有释放A锁，紧接着执行代码mutexB.acquire()，抢到了B锁，<br>　　　　　　  在抢B锁时候，没有其他线程与thread1争抢，因为A锁没有释放，其他线程只能等待<br>　　　　　　2. thread1执行完func1函数，然后执行func2函数，此时thread1拿到B锁，然后执行time.sleep(2)，此时不会释放B锁<br>　　　　　　3. 在thread1执行func2的同时thread2开始执行func1获取到了A锁，然后继续要获取B锁<br>　　　　　　4. 不幸的是B锁还被thread1占用，thread1占用B锁时还需要同时获取A锁才能向下执行，但是此时发现A锁已经被thread2暂用，这样就死锁了</p>
<p>　　<strong>7、\</strong>递归锁：lock = threading.RLock() 解决死锁问题****</p>
<p>　　　　　　1. 递归锁的作用是同一线程中多次请求同一资源，但是不会参数死锁。<br>　　　　　　2. 这个RLock内部维护着一个Lock和一个counter变量，counter记录了acquire的次数，从而使得资源可以被多次require。<br>　　　　　　3. 直到一个线程所有的acquire都被release，其他的线程才能获得资源。</p>
<p>　　<strong>8、Semaphore(信号量)</strong></p>
<p>　　　　　　1. 互斥锁 同时只允许一个线程更改数据，而Semaphore是同时允许一定数量的线程更改数据<br>　　　　　　2. 比如厕所有3个坑，那最多只允许3个人上厕所，后面的人只能等里面有人出来了才能再进去<br>　　　　　　3. 作用就是同一时刻允许运行的线程数量</p>
<p>　　<strong>9、events总共就只有四个方法</strong></p>
<p>　　　　　　<strong>1. event.set()</strong>     : 设置标志位<br>　　　　　　<strong>2. event.clear()</strong>    : 清除标志位<br>　　　　　　<strong>3. event.wait()</strong>    : 等待标志被设定<br>　　　　　　<strong>4. event.is_set()</strong>   : 判断标志位是否被设定</p>
<h3 id="四、进程"><a href="#四、进程" class="headerlink" title="四、进程"></a>四、进程</h3><p>　　<strong>1、多线程和多进程各自应用场景</strong></p>
<p>　　　　　　1. I/O操作不占用CPU（从硬盘，网路读入数据等）</p>
<p>　　　　　　2. 计算占用CPU，这种情况最好不用多线程</p>
<p>　　　　　　3. python多线程不适合CPU密集型的任务，适合I/O密集型的任务</p>
<p>　　　　　　4. python的多进程适合CPU密集型任务</p>
<p>　　<strong>2、一次性起多个进程，并在进程中调用线程</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing,time,threading</span><br><span class="line"></span><br><span class="line"><span class="comment">#3 被多线程调用的函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thread_run</span><span class="params">()</span>:</span></span><br><span class="line">    print(threading.get_ident())   <span class="comment">#打印线程id号</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2 被多进程调用的函数，以及在这个函数中起一个进程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(name)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">"hello"</span>,name)</span><br><span class="line">    t = threading.Thread(target=thread_run,)  <span class="comment">#在进程调用的函数中启用一个线程</span></span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="comment">#1 一次性启动多个进程</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        p = multiprocessing.Process(target=run,args=(<span class="string">'bob %s'</span>%i,)) <span class="comment">#启用一个多线程</span></span><br><span class="line">        p.start()</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>3、进程间互相访问数据的三种方法</strong></p>
<p>　　　　<strong>注：</strong>不同进程间内存是不共享的，所以互相之间不能访问对方数据</p>
<p>　　　　<strong>1. 在父进程中定义队列q，使用父进程启用一个子进程，子进程中无法操作父进程的q</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    q.put([<span class="number">42</span>, <span class="literal">None</span>, <span class="string">'hello'</span>])</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q = queue.Queue()              <span class="comment">#1 在父进程中定义一个队列实例q</span></span><br><span class="line">    <span class="comment"># p = threading.Thread(target=f,)    #在线程程中就可以相互访问，线程中内存共享</span></span><br><span class="line">    p = Process(target=f,)        <span class="comment">#2 在父进程中起一个子进程 p，在子进程中使用父进程的q会报错</span></span><br><span class="line">    p.start()</span><br><span class="line">    print(q.get())</span><br><span class="line">    p.join()</span><br></pre></td></tr></table></figure></div>

<p>　　　　<strong>2. 法1:  利用Queues实现父进程到子进程（或子进程间）的数据传递</strong></p>
<p>　　　　　　　　1. 我们以前学的queue是线程queue.Queue()只有在同一个进程的线程间才能访问<br>　　　　　　　　2. 如果两个进程间想要通信必须要使用进程Queue，用法和多线程的相同<br>　　　　　　　　3. queue.Queue()是线程q不可以传递给子进程，但是Queue是进程q，父进程会将进程q克隆了一份给子进程<br>　　　　　　　　4.既然是两个q为什么在子进程中在q中放入一个数据在父进程中可以取出来呢？ 其实原因是这样的：<br>　　　　　　　　　　1）子进程向q中放入数据的时候，用pickle序列化将数据放到一个中间地方（翻译），翻译又把子进程放<br>　　　　　　　　　　    入的数据用pickle反序列化给父进程，父进程就可以访问这个q了，这样就实现了进程间的数据通信了<br>　　　　　　　　　　2） 在多线程中两个线程可以修改同一份数据，而Queue仅仅实现了进程间的数据传递</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(qq)</span>:</span>  <span class="comment"># 将符进程中的q传递过来叫qq</span></span><br><span class="line">    qq.put([<span class="number">42</span>, <span class="literal">None</span>, <span class="string">'hello'</span>])  <span class="comment"># 此时子进程就可以使用符进程中的q</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q = Queue()  <span class="comment"># 使用Queue()在父进程中定义一个队列实例q</span></span><br><span class="line">    p = Process(target=f, args=(q,))  <span class="comment"># 在父进程中起一个子进程 p，将父进程刚定义的q传递给子进程p</span></span><br><span class="line">    p.start()</span><br><span class="line">    print(q.get())</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行结果： [42, None, 'hello']</span></span><br></pre></td></tr></table></figure></div>

<p>　　　　<strong>3. 法2:  使用管道pipe实现两个进程间数据传递</strong></p>
<p>　　　　　　　　<strong>说明：</strong>其实pip实现进程间通信就好像一条电话线一样，一个在电话线这头发送，一个在电话线那头接收</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Pipe</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(conn)</span>:</span></span><br><span class="line">    conn.send([<span class="number">42</span>, <span class="literal">None</span>, <span class="string">'hello'</span>])  <span class="comment"># 3 子进程发送数据，就像socket一样</span></span><br><span class="line">    print(<span class="string">"son process recv:"</span>, conn.recv())</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parent_conn, child_conn = Pipe()</span><br><span class="line">    <span class="comment"># 1 生成一个管道实例，实例一生成就会生成两个返回对象，一个是管道这头，一个是管道那头</span></span><br><span class="line">    p = Process(target=f, args=(child_conn,))  <span class="comment"># 2 启动一个子进程将管道其中一头传递给子进程</span></span><br><span class="line">    p.start()</span><br><span class="line">    print(parent_conn.recv())  <span class="comment"># 4 父进程收消息 # prints "[42, None, 'hello']"</span></span><br><span class="line">    parent_conn.send(<span class="string">'i am parent process'</span>)</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行结果：</span></span><br><span class="line"><span class="comment"># [42, None, 'hello']</span></span><br><span class="line"><span class="comment"># son process recv: i am parent process</span></span><br></pre></td></tr></table></figure></div>

<p>　　　　<strong>4.法3:  Managers实现很多进程间数据共享</strong></p>
<p>　　　　　　　　<strong>说明:</strong> manager实质和Queue一样，启用是个线程其实就是将字典或者列表copy十份</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Manager</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(d, l)</span>:</span></span><br><span class="line">    d[<span class="number">1</span>] = <span class="string">'1'</span>  <span class="comment"># 是个进程对字典放入的是同一个值，所以看上去效果不明显</span></span><br><span class="line">    l.append(os.getpid())  <span class="comment"># 将这是个进程的进程id放入列表中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">with</span> Manager() <span class="keyword">as</span> manager:  <span class="comment"># 1 将Manager()赋值给manager</span></span><br><span class="line">        d = manager.dict()  <span class="comment"># 2 定义一个可以在多个进程间可以共享的字典</span></span><br><span class="line">        l = manager.list(range(<span class="number">5</span>))  <span class="comment"># 3 定义一个可以在多个进程间可以共享的列表，默认写五个数据</span></span><br><span class="line">        p_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):  <span class="comment"># 生成是个进程</span></span><br><span class="line">            p = Process(target=f, args=(d, l))  <span class="comment"># 将刚刚生成的可共享字典和列表传递给子进程</span></span><br><span class="line">            p.start()</span><br><span class="line">            p_list.append(p)</span><br><span class="line">        <span class="keyword">for</span> res <span class="keyword">in</span> p_list:</span><br><span class="line">            res.join()</span><br><span class="line">        print(d)</span><br><span class="line">        print(l)</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>4、进程之间需要锁的原因</strong></p>
<p>　　　　　　<strong>说明：</strong>虽然每个进程是独立运行的，但是他们共享同一块屏幕，如果大家都在屏幕打数据就会打乱了</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Lock</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(l, i)</span>:</span></span><br><span class="line">    l.acquire()                     <span class="comment">#一个进程要打印数据时先锁定</span></span><br><span class="line">    print(<span class="string">'hello world'</span>, i)</span><br><span class="line">    l.release()                     <span class="comment">#打印完毕后就释放这把锁</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    lock = Lock()                   <span class="comment">#先生成一把锁</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        Process(target=f, args=(lock, num)).start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行结果：</span></span><br><span class="line"><span class="comment"># hello world 4</span></span><br><span class="line"><span class="comment"># hello world 0</span></span><br><span class="line"><span class="comment"># hello world 2</span></span><br><span class="line"><span class="comment"># hello world 3</span></span><br><span class="line"><span class="comment"># hello world 1</span></span><br></pre></td></tr></table></figure></div>

<p>　　<strong>5、进程池</strong></p>
<p>　　　　　　1. 进程池的作用就是限制同一时间可以启动进程的=数量<br>　　　　　　2. 进程池内部维护一个进程序列，当使用时，则去进程池中获取一个进程，如果进程池序列中没有可供使用的进<br>　　　　　　  ，那么程序就会等待，直到进程池中有可用进程为止。<br>　　　　　　<strong>3. 进程池中有两个方法：</strong><br>　　　　　　     1）apply： 多个进程异步执行，一个一个的执行<br>　　　　　　     2）apply_async： 多个进程同步执行，同时执行多个进程</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span>  multiprocessing <span class="keyword">import</span> Process,Pool</span><br><span class="line"><span class="keyword">import</span> time,os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(i)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">"in the process"</span>,os.getpid()) <span class="comment">#打印子进程的pid</span></span><br><span class="line">    <span class="keyword">return</span> i+<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(arg)</span>:</span></span><br><span class="line">    print(<span class="string">'--&gt;exec done:'</span>,arg,os.getpid())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    pool = Pool(<span class="number">3</span>)                      <span class="comment">#进程池最多允许5个进程放入进程池</span></span><br><span class="line">    print(<span class="string">"主进程pid："</span>,os.getpid())     <span class="comment">#打印父进程的pid</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        <span class="comment">#用法1 callback作用是指定只有当Foo运行结束后就执行callback调用的函数,父进程调用的callback函数</span></span><br><span class="line">        pool.apply_async(func=foo, args=(i,),callback=call)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#用法2 串行 启动进程不在用Process而是直接用pool.apply()</span></span><br><span class="line">        <span class="comment"># pool.apply(func=foo, args=(i,))</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">'end'</span>)</span><br><span class="line">    pool.close()    <span class="comment">#关闭pool</span></span><br><span class="line">    pool.join()     <span class="comment">#进程池中进程执行完毕后再关闭，如果注释，那么程序直接关闭。</span></span><br></pre></td></tr></table></figure></div>

<p>　　<strong>6、僵尸进程</strong></p>
<p>　　　　<strong>1）僵尸进程定义</strong></p>
<p>　　　　　　　　1. 僵尸进程产生的原因就是父进程产生子进程后，子进程先于父进程退出</p>
<p>　　　　　　　　2. 但是父进程由于种种原因，并没有处理子进程发送的退出信号，那么这个子进程就会成为僵尸进程。</p>
<p>　　　　<strong>2）用python写一个僵尸进程</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os, sys, time</span><br><span class="line"><span class="comment">#产生子进程</span></span><br><span class="line">pid = os.fork()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> pid == <span class="number">0</span>:</span><br><span class="line">    <span class="comment">#子进程退出</span></span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#父进程休息30秒</span></span><br><span class="line">time.sleep(<span class="number">30</span>)</span><br><span class="line"><span class="comment"># 先产生一个子进程，子进程退出，父进程休息30秒,那就会产生一个僵尸进程</span></span><br></pre></td></tr></table></figure></div>

<h3 id="五、协程-Coroutine"><a href="#五、协程-Coroutine" class="headerlink" title="五、协程(Coroutine)"></a>五、协程(Coroutine)</h3><p>　　<strong>1、什么是协程（进入上一次调用的状态）</strong></p>
<p>　　　　　　1. 协程，又称微线程，纤程，协程是一种用户态的轻量级线程。</p>
<p>　　　　　　2. 线程的切换会保存到CPU的栈里，协程拥有自己的寄存器上下文和栈，</p>
<p>　　　　　　3. 协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈</p>
<p>　　　　　　4. <strong>协程能保留上一次调用时的状态</strong>（即所有局部状态的一个特定组合），每次过程重入时，就相当于进入上一次调用的状态</p>
<p>　　　　　　5. <strong>协程最主要的作用是在单线程的条件下实现并发的效果，但实际上还是串行的</strong>（像yield一样）</p>
<p>　　<strong>2、协程的好处</strong></p>
<p>　　　　　　1. 无需线程上下文切换的开销（可以理解为协程切换就是在不同函数间切换，不用像线程那样切换上下文CPU）</p>
<p>　　　　　　2. 不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突</p>
<p>　　　　　　3. <strong>用法：</strong>最简单的方法是多进程+协程，既充分利用多核，又充分发挥协程的高效率，可获得极高的性能。</p>
<p>　　<strong>3、协程缺点</strong></p>
<p>　　　　　　1. 无法利用多核资源：<strong>协程的本质是个单线程,它不能同时将 单个CPU 的多个核用上</strong>,协程需要和进程配合才能运行在多CPU上</p>
<p>　　　　　　2. <strong>线程阻塞（Blocking）操作（如IO时）会阻塞掉整个程序</strong></p>
<p>　　<strong>4、使用yield实现协程相同效果</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"---&gt;starting eating baozi..."</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        new_baozi = <span class="keyword">yield</span>  <span class="comment"># 只要遇到yield程序就返回，yield还可以接收数据</span></span><br><span class="line">        print(<span class="string">"[%s] is eating baozi %s"</span> % (name, new_baozi))</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">()</span>:</span></span><br><span class="line">    r = con.__next__()  <span class="comment"># 直接调用消费者的__next__方法</span></span><br><span class="line">    r = con2.__next__()  <span class="comment"># 函数里面有yield第一次加括号调用会变成一个生成器函数不执行，运行next才执行</span></span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; <span class="number">5</span>:</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        con.send(n)  <span class="comment"># send恢复生成器同时并传递一个值给yield</span></span><br><span class="line">        con2.send(n)</span><br><span class="line">        print(<span class="string">"\033[32;1m[producer]\033[0m is making baozi %s"</span> % n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    con = consumer(<span class="string">"c1"</span>)</span><br><span class="line">    con2 = consumer(<span class="string">"c2"</span>)</span><br><span class="line">    p = producer()</span><br></pre></td></tr></table></figure></div>

<p><strong>5、协程为何能处理大并发1：Greenlet遇到I/O手动切换</strong></p>
<p>　　　　　　1. 协程之所以快是因为遇到I/O操作就切换（最后只有CPU运算）</p>
<p>　　　　　　2. 这里先演示用greenlet实现手动的对各个协程之间切换</p>
<p>　　　　　　3. 其实Gevent模块仅仅是对greenlet的再封装，将I/O间的手动切换变成自动切换</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">12</span>)       <span class="comment">#4 gr1会调用test1()先打印12</span></span><br><span class="line">    gr2.switch()    <span class="comment">#5 然后gr2.switch()就会切换到gr2这个协程</span></span><br><span class="line">    print(<span class="number">34</span>)       <span class="comment">#8 由于在test2()切换到了gr1，所以gr1又从上次停止的位置开始执行</span></span><br><span class="line">    gr2.switch()    <span class="comment">#9 在这里又切换到gr2，会再次切换到test2()中执行</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">56</span>)       <span class="comment">#6 启动gr2后会调用test2()打印56</span></span><br><span class="line">    gr1.switch()    <span class="comment">#7 然后又切换到gr1</span></span><br><span class="line">    print(<span class="number">78</span>)       <span class="comment">#10 切换到gr2后会接着上次执行，打印78</span></span><br><span class="line"></span><br><span class="line">gr1 = greenlet(test1)    <span class="comment">#1 启动一个协程gr1</span></span><br><span class="line">gr2 = greenlet(test2)    <span class="comment">#2 启动第二个协程gr2</span></span><br><span class="line">gr1.switch()             <span class="comment">#3 首先gr1.switch() 就会去执行gr1这个协程</span></span><br></pre></td></tr></table></figure></div>

<p>　　<strong>6、协程为何能处理大并发2：Gevent遇到I/O自动切换</strong></p>
<p>　　　　　　1. Gevent 是一个第三方库，可以轻松通过gevent实现并发同步或异步编程</p>
<p>　　　　　　2. 在gevent中用到的主要模式是<strong>Greenlet</strong>, 它是以C扩展模块形式接入Python的轻量级协程</p>
<p>　　　　　　3. Greenlet全部运行在主程序操作系统进程的内部，但它们被协作式地调度。</p>
<p>　　　　　　4. Gevent原理是只要遇到I/O操作就会自动切换到下一个协程</p>
<p>　　<strong>7、Gevent实现简单的自动切换小例子</strong></p>
<p>　　　　<strong>注</strong>：<em>在Gevent模仿I/O切换的时候，只要遇到I/O就会切换，哪怕gevent.sleep(0)也要切换一次</em></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'\033[31;1m第一次打印\033[0m'</span>)</span><br><span class="line">    gevent.sleep(<span class="number">2</span>)          <span class="comment"># 为什么用gevent.sleep()而不是time.sleep()因为是为了模仿I/O</span></span><br><span class="line">    print(<span class="string">'\033[31;1m第六次打印\033[0m'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'\033[32;1m第二次打印\033[0m'</span>)</span><br><span class="line">    gevent.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">'\033[32;1m第四次打印\033[0m'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func3</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'\033[32;1m第三次打印\033[0m'</span>)</span><br><span class="line">    gevent.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">'\033[32;1m第五次打印\033[0m'</span>)</span><br><span class="line"></span><br><span class="line">gevent.joinall([            <span class="comment"># 将要启动的多个协程放到event.joinall的列表中，即可实现自动切换</span></span><br><span class="line">    gevent.spawn(func1),    <span class="comment"># gevent.spawn(func1)启动这个协程</span></span><br><span class="line">    gevent.spawn(func2),</span><br><span class="line">    gevent.spawn(func3),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行结果：</span></span><br><span class="line"><span class="comment"># 第一次打印</span></span><br><span class="line"><span class="comment"># 第二次打印</span></span><br><span class="line"><span class="comment"># 第三次打印</span></span><br><span class="line"><span class="comment"># 第四次打印</span></span><br><span class="line"><span class="comment"># 第五次打印</span></span><br><span class="line"><span class="comment"># 第六次打印</span></span><br></pre></td></tr></table></figure></div>

<p>　　<strong>8、使用Gevent实现并发下载网页与串行下载网页时间比较</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> gevent,time</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line">monkey.patch_all()      <span class="comment">#把当前程序所有的I/O操作给我单独做上标记</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(url)</span>:</span></span><br><span class="line">    print(<span class="string">'GET: %s'</span> % url)</span><br><span class="line">    resp = request.urlopen(url)</span><br><span class="line">    data = resp.read()</span><br><span class="line">    print(<span class="string">'%d bytes received from %s.'</span> % (len(data), url))</span><br><span class="line"></span><br><span class="line"><span class="comment">#1 并发执行部分</span></span><br><span class="line">time_binxing = time.time()</span><br><span class="line">gevent.joinall([</span><br><span class="line">        gevent.spawn(f, <span class="string">'https://www.python.org/'</span>),</span><br><span class="line">        gevent.spawn(f, <span class="string">'https://www.yahoo.com/'</span>),</span><br><span class="line">        gevent.spawn(f, <span class="string">'https://github.com/'</span>),</span><br><span class="line">])</span><br><span class="line">print(<span class="string">"并行时间："</span>,time.time()-time_binxing)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2 串行部分</span></span><br><span class="line">time_chuanxing = time.time()</span><br><span class="line">urls = [</span><br><span class="line">        <span class="string">'https://www.python.org/'</span>,</span><br><span class="line">        <span class="string">'https://www.yahoo.com/'</span>,</span><br><span class="line">        <span class="string">'https://github.com/'</span>,</span><br><span class="line">                                        ]</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    f(url)</span><br><span class="line">print(<span class="string">"串行时间："</span>,time.time()-time_chuanxing)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注：为什么要在文件开通使用monkey.patch_all()</span></span><br><span class="line"><span class="comment"># 1. 因为有很多模块在使用I / O操作时Gevent是无法捕获的，所以为了使Gevent能够识别出程序中的I / O操作。</span></span><br><span class="line"><span class="comment"># 2. 就必须使用Gevent模块的monkey模块，把当前程序所有的I / O操作给我单独做上标记</span></span><br><span class="line"><span class="comment"># 3.使用monkey做标记仅用两步即可：</span></span><br><span class="line">      第一步(导入monkey模块)：  <span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line">      第二步(声明做标记)    ：   monkey.patch_all()</span><br></pre></td></tr></table></figure></div>

<p>　　　　<strong>说明：</strong>monkey.patch_all()猴子补丁作用</p>
<p>　　　　　　1）用过gevent就会知道,会在最开头的地方gevent.monkey.patch_all();<br>　　　　　　2）作用是把标准库中的thread/socket等给替换掉.这样我们在后面使用socket的时候可以跟平常一样使用,无需修改任何代码,但是它变成非阻塞的了.</p>
<p>　　<strong>9、通过gevent自己实现单线程下的多socket并发</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> socket,monkey     <span class="comment">#下面使用的socket是Gevent的socket，实际测试monkey没用</span></span><br><span class="line"><span class="comment"># monkey.patch_all()</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">(port)</span>:</span></span><br><span class="line">    s = socket.socket()</span><br><span class="line">    s.bind((<span class="string">'0.0.0.0'</span>,port))</span><br><span class="line">    s.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cli,addr = s.accept()</span><br><span class="line">        gevent.spawn(handle_request,cli)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_request</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">            print(<span class="string">'recv:'</span>,data)</span><br><span class="line">            conn.send(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                conn.shutdown(socket.SHUT_WR)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    server(<span class="number">8001</span>)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">HOST = <span class="string">'localhost'</span>    <span class="comment"># The remote host</span></span><br><span class="line">PORT = <span class="number">8001</span>           <span class="comment"># The same port as used by the server</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((HOST, PORT))</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg = bytes(input(<span class="string">"&gt;&gt;:"</span>),encoding=<span class="string">"utf8"</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> len(msg) == <span class="number">0</span>:<span class="keyword">continue</span></span><br><span class="line">    s.sendall(msg)</span><br><span class="line">    data = s.recv(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="string">'Received'</span>, repr(data))</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure></div>

<p><strong>10、协程本质原理</strong></p>
<p>　　　　　　1. 协程1通过os去读一个file，这个时候就是一个io操作，在调用os的接口前，就会有一个列表</p>
<p>　　　　　　2. 协程1的这个操作就会被注册到这个列表中，然后就切换到其他协程去处理；</p>
<p>　　　　　　3. 等待os拿到要读file后，也会把这个文件句柄放在这个列表中</p>
<p>　　　　　　4. 然后等待在切换到协程1的时候，协程1就可以直接从列表中拿到数据，这样就可以实现不阻塞了</p>
<p>　　　　　　5. epoll返回给协程的任务列表在内核态，协程在用户态，用户态协程是不能直接访问内核态的任务列表的，<br>　　　　　　  所以需要拷贝整个内核态的任务列表到用户态，供协程去访问和查询</p>
<p>　　<strong>11、epoll处理 I/O 请求原理</strong></p>
<p>　　　　　　1. epoll() 中内核则维护一个链表，epoll_wait 直接检查链表是不是空就知道是否有文件描述符准备好了。</p>
<p>　　　　　　2. 在内核实现中 epoll 是根据每个 sockfd 上面的与设备驱动程序建立起来的回调函数实现的。</p>
<p>　　　　　　3. 某个 sockfd 上的事件发生时，与它对应的回调函数就会被调用，来把这个 sockfd 加入链表，其他处于“空闲的”状态的则不会。</p>
<p>　　　　　　4. epoll上面链表中获取文件描述，这里使用内存映射（mmap）技术， 避免了复制大量文件描述符带来的开销</p>
<p>　　　　　　<strong>内存映射（mmap）</strong>：内存映射文件，是由一个文件到一块内存的映射，将不必再对文件执行<a href="https://baike.baidu.com/item/I%2FO操作/469761" target="_blank" rel="noopener">I/O操作</a></p>
<p>　　<strong>12、select处理协程</strong></p>
<p>　　　　　　<em>1. 拷贝所有的文件描述符给协程，不论这些任务的是否就绪，都会被返回</em></p>
<p>　　　　　　<em>2. 那么协程就只能for循环去查找自己的文件描述符，也就是任务列表，select的兼容性非常好，支持linux和windows</em></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>进程</tag>
        <tag>线程</tag>
        <tag>协程</tag>
        <tag>GIL锁</tag>
      </tags>
  </entry>
  <entry>
    <title>Echarts趋势图</title>
    <url>/Vue/Vue_id_14.html</url>
    <content><![CDATA[<p><strong>在vue中让数据以一个趋势展示，让我们对数据可以一目了然</strong></p>
<p>使用工具：Echarts</p>
<p>官网：点击<a href="https://echarts.apache.org/" target="_blank" rel="noopener">Echarts官网</a>跳转</p>
<a id="more"></a>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">npm install echarts --save</span><br></pre></td></tr></table></figure></div>

<h4 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">在vue中导入Echarts</span><br><span class="line"><span class="comment">// 导入曲线图包</span></span><br><span class="line"><span class="keyword">import</span> echarts <span class="keyword">from</span> <span class="string">'echarts'</span></span><br></pre></td></tr></table></figure></div>

<h4 id="使用—-简单Demo"><a href="#使用—-简单Demo" class="headerlink" title="使用—-简单Demo"></a>使用—-简单Demo</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建Echarts函数</span></span><br><span class="line"><span class="comment">// 接收动态参数</span></span><br><span class="line">Options(time, temp) &#123;</span><br><span class="line">        <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span><br><span class="line">        <span class="keyword">var</span> myChart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">'main'</span>));</span><br><span class="line">        <span class="comment">// 使用刚指定的配置项和数据显示图表。</span></span><br><span class="line">        <span class="keyword">let</span> option = &#123;</span><br><span class="line">            title: &#123;</span><br><span class="line">                text: <span class="string">'温度趋势'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            tooltip: &#123;</span><br><span class="line">                trigger: <span class="string">'axis'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            grid: &#123;</span><br><span class="line">                left: <span class="string">'3%'</span>,</span><br><span class="line">                right: <span class="string">'4%'</span>,</span><br><span class="line">                bottom: <span class="string">'3%'</span>,</span><br><span class="line">                containLabel: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            toolbox: &#123;</span><br><span class="line">                feature: &#123;</span><br><span class="line">                    saveAsImage: &#123;&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            xAxis: &#123;</span><br><span class="line">                type: <span class="string">'category'</span>,</span><br><span class="line">                boundaryGap: <span class="literal">false</span>,</span><br><span class="line">                data: time,</span><br><span class="line">            &#125;,</span><br><span class="line">            yAxis: &#123;</span><br><span class="line">                type: <span class="string">'value'</span>,</span><br><span class="line">                name: <span class="string">'℃'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            series: [</span><br><span class="line">                &#123;</span><br><span class="line">                    name: <span class="string">'温度'</span>,</span><br><span class="line">                    type: <span class="string">'line'</span>,</span><br><span class="line">                    data: temp,</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;</span><br><span class="line">    myChart.setOption(option);</span><br><span class="line">&#125;,</span><br><span class="line">    <span class="comment">// 在获取得到参数的同时，调用Echarts函数</span></span><br><span class="line">    <span class="comment">// 请求温度</span></span><br><span class="line">    RequestTemp() &#123;</span><br><span class="line">        <span class="keyword">let</span> params = &#123; <span class="attr">oid</span>: <span class="keyword">this</span>.oid &#125;</span><br><span class="line">        request_temp_get(params).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resp.code === <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; resp.templist.length; i++) &#123;</span><br><span class="line">                    resp.templist[i].create_time = moment(resp.templist[i].create_time).format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>)</span><br><span class="line">                    <span class="keyword">this</span>.orderID = resp.templist[i].oid</span><br><span class="line">                    <span class="comment">// 将时间添加到空列表中</span></span><br><span class="line">                    <span class="keyword">this</span>.timedata.push(resp.templist[i].create_time)</span><br><span class="line">                    <span class="comment">// 将温度添加到空列表中</span></span><br><span class="line">                    <span class="keyword">this</span>.tempdata.push(resp.templist[i].tempera)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">this</span>.TemperLog = resp.templist</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(resp.templist)</span><br><span class="line">            <span class="comment">// 传递参数给折线图，并调用折线图函数</span></span><br><span class="line">            <span class="keyword">let</span> time = <span class="keyword">this</span>.timedata</span><br><span class="line">            <span class="keyword">let</span> temp = <span class="keyword">this</span>.tempdata</span><br><span class="line">            <span class="keyword">let</span> id = <span class="string">'main'</span></span><br><span class="line">            <span class="comment">// 调用Echarts函数，将动态数据传过去</span></span><br><span class="line">            <span class="keyword">this</span>.Options(time, temp);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></div>

<h4 id="横坐标动态数据结构"><a href="#横坐标动态数据结构" class="headerlink" title="横坐标动态数据结构"></a>横坐标动态数据结构</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">xAxis: &#123;</span><br><span class="line">    type: <span class="string">'category'</span>,</span><br><span class="line">    boundaryGap: <span class="literal">false</span>,</span><br><span class="line">    data: time, </span><br><span class="line">&#125;,</span><br><span class="line">data: [<span class="string">"衬衫"</span>,<span class="string">"羊毛衫"</span>,<span class="string">"雪纺衫"</span>,<span class="string">"裤子"</span>,<span class="string">"高跟鞋"</span>,<span class="string">"袜子"</span>]   	<span class="comment">// 列表</span></span><br></pre></td></tr></table></figure></div>

<h4 id="纵坐标动态数据结构"><a href="#纵坐标动态数据结构" class="headerlink" title="纵坐标动态数据结构"></a>纵坐标动态数据结构</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">series: [</span><br><span class="line">        &#123;</span><br><span class="line">                name: <span class="string">'温度'</span>,</span><br><span class="line">                type: <span class="string">'line'</span>,</span><br><span class="line">                data: temp,</span><br><span class="line">        &#125;,</span><br><span class="line">],</span><br><span class="line">data: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>]  	<span class="comment">// 列表</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Echarts</tag>
      </tags>
  </entry>
  <entry>
    <title>v-charts趋势图</title>
    <url>/Vue/Vue_id_15.html</url>
    <content><![CDATA[<p><strong>在vue中让数据以一个折线展示，让我们对数据可以一目了然</strong></p>
<p>使用工具：v-charts</p>
<p>官网：点击<a href="https://v-charts.js.org/" target="_blank" rel="noopener">v-charts官网</a>跳转</p>
<a id="more"></a>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">npm install v-charts echarts --save</span><br></pre></td></tr></table></figure></div>

<h4 id="main-js中完整引入"><a href="#main-js中完整引入" class="headerlink" title="main.js中完整引入"></a>main.js中完整引入</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">在vue中导入Echarts</span><br><span class="line"><span class="comment">// 导入曲线图包</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VCharts <span class="keyword">from</span> <span class="string">'v-charts'</span></span><br><span class="line">Vue.use(VCharts)</span><br></pre></td></tr></table></figure></div>

<h4 id="使用—-设置参数"><a href="#使用—-设置参数" class="headerlink" title="使用—-设置参数"></a>使用—-设置参数</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建Echarts函数</span></span><br><span class="line"><span class="comment">// 接收动态参数</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        chartData: &#123;</span><br><span class="line">            <span class="comment">// 曲线标题</span></span><br><span class="line">          columns: [<span class="string">'日期'</span>, <span class="string">'访问用户'</span>, <span class="string">'下单用户'</span>, <span class="string">'下单率'</span>],</span><br><span class="line">          rows: [</span><br><span class="line">            &#123; <span class="string">'日期'</span>: <span class="string">'1/1'</span>, <span class="string">'访问用户'</span>: <span class="number">1393</span>, <span class="string">'下单用户'</span>: <span class="number">1093</span>, <span class="string">'下单率'</span>: <span class="number">0.32</span> &#125;,</span><br><span class="line">            &#123; <span class="string">'日期'</span>: <span class="string">'1/2'</span>, <span class="string">'访问用户'</span>: <span class="number">3530</span>, <span class="string">'下单用户'</span>: <span class="number">3230</span>, <span class="string">'下单率'</span>: <span class="number">0.26</span> &#125;,</span><br><span class="line">            &#123; <span class="string">'日期'</span>: <span class="string">'1/3'</span>, <span class="string">'访问用户'</span>: <span class="number">2923</span>, <span class="string">'下单用户'</span>: <span class="number">2623</span>, <span class="string">'下单率'</span>: <span class="number">0.76</span> &#125;,</span><br><span class="line">            &#123; <span class="string">'日期'</span>: <span class="string">'1/4'</span>, <span class="string">'访问用户'</span>: <span class="number">1723</span>, <span class="string">'下单用户'</span>: <span class="number">1423</span>, <span class="string">'下单率'</span>: <span class="number">0.49</span> &#125;,</span><br><span class="line">            &#123; <span class="string">'日期'</span>: <span class="string">'1/5'</span>, <span class="string">'访问用户'</span>: <span class="number">3792</span>, <span class="string">'下单用户'</span>: <span class="number">3492</span>, <span class="string">'下单率'</span>: <span class="number">0.323</span> &#125;,</span><br><span class="line">            &#123; <span class="string">'日期'</span>: <span class="string">'1/6'</span>, <span class="string">'访问用户'</span>: <span class="number">4593</span>, <span class="string">'下单用户'</span>: <span class="number">4293</span>, <span class="string">'下单率'</span>: <span class="number">0.78</span> &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></div>

<h4 id="模版引入"><a href="#模版引入" class="headerlink" title="模版引入"></a>模版引入</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  	&lt;ve-line :data&#x3D;&quot;chartData&quot;&gt;&lt;&#x2F;ve-line&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="使用动态数据"><a href="#使用动态数据" class="headerlink" title="使用动态数据"></a>使用动态数据</h4><p>　　如果想导入参数，实现动态加载，则需将rows设置成空列表，当获取到参数后，直接给rows赋值即可实现动态数据加载</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>v-charts</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue实现Excel文件下载</title>
    <url>/Vue/Vue_id_16.html</url>
    <content><![CDATA[<p>在vue中实现数据下载，保存为Excel文件</p>
<a id="more"></a>

<h4 id="安装依赖插件"><a href="#安装依赖插件" class="headerlink" title="安装依赖插件"></a>安装依赖插件</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">npm install -S file-saver</span><br><span class="line">npm install -S xlsx</span><br><span class="line">npm install -D script-loader</span><br></pre></td></tr></table></figure></div>

<h4 id="导入js文件"><a href="#导入js文件" class="headerlink" title="导入js文件"></a>导入js文件</h4><p>　　<strong>在src目录中创建lib文件夹(文件夹名字可以自己设置)，导入以下js文件</strong><br>　　注意：这两个js文件需放在一个文件中，否则在Export2Excel.js文件中导入Blob.js会出现找不到的情况，导致配置失败、当然、也可修改导入路径</p>
<p><strong>Blob.js:</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable */</span></span><br><span class="line"><span class="comment">/* Blob.js</span></span><br><span class="line"><span class="comment"> * A Blob implementation.</span></span><br><span class="line"><span class="comment"> * 2014-05-27</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By Eli Grey, http://eligrey.com</span></span><br><span class="line"><span class="comment"> * By Devin Samarin, https://github.com/eboyjr</span></span><br><span class="line"><span class="comment"> * License: X11/MIT</span></span><br><span class="line"><span class="comment"> *   See LICENSE.md</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*global self, unescape */</span></span><br><span class="line"><span class="comment">/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,</span></span><br><span class="line"><span class="comment"> plusplus: true */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">view</span>) </span>&#123;</span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line"></span><br><span class="line">    view.URL = view.URL || view.webkitURL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (view.Blob &amp;&amp; view.URL) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">new</span> Blob;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Internally we use a BlobBuilder implementation to base Blob off of</span></span><br><span class="line">    <span class="comment">// in order to support older browsers that only have BlobBuilder</span></span><br><span class="line">    <span class="keyword">var</span> BlobBuilder = view.BlobBuilder || view.WebKitBlobBuilder || view.MozBlobBuilder || (<span class="function"><span class="keyword">function</span>(<span class="params">view</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span></span><br><span class="line">                get_class = <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(object).match(<span class="regexp">/^\[object\s(.*)\]$/</span>)[<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                , FakeBlobBuilder = <span class="function"><span class="keyword">function</span> <span class="title">BlobBuilder</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>.data = [];</span><br><span class="line">                &#125;</span><br><span class="line">                , FakeBlob = <span class="function"><span class="keyword">function</span> <span class="title">Blob</span>(<span class="params">data, type, encoding</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>.data = data;</span><br><span class="line">                    <span class="keyword">this</span>.size = data.length;</span><br><span class="line">                    <span class="keyword">this</span>.type = type;</span><br><span class="line">                    <span class="keyword">this</span>.encoding = encoding;</span><br><span class="line">                &#125;</span><br><span class="line">                , FBB_proto = FakeBlobBuilder.prototype</span><br><span class="line">                , FB_proto = FakeBlob.prototype</span><br><span class="line">                , FileReaderSync = view.FileReaderSync</span><br><span class="line">                , FileException = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>.code = <span class="keyword">this</span>[<span class="keyword">this</span>.name = type];</span><br><span class="line">                &#125;</span><br><span class="line">                , file_ex_codes = (</span><br><span class="line">                    <span class="string">"NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR "</span></span><br><span class="line">                    + <span class="string">"NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR"</span></span><br><span class="line">                ).split(<span class="string">" "</span>)</span><br><span class="line">                , file_ex_code = file_ex_codes.length</span><br><span class="line">                , real_URL = view.URL || view.webkitURL || view</span><br><span class="line">                , real_create_object_URL = real_URL.createObjectURL</span><br><span class="line">                , real_revoke_object_URL = real_URL.revokeObjectURL</span><br><span class="line">                , URL = real_URL</span><br><span class="line">                , btoa = view.btoa</span><br><span class="line">                , atob = view.atob</span><br><span class="line"></span><br><span class="line">                , <span class="built_in">ArrayBuffer</span> = view.ArrayBuffer</span><br><span class="line">                , <span class="built_in">Uint8Array</span> = view.Uint8Array</span><br><span class="line">                ;</span><br><span class="line">            FakeBlob.fake = FB_proto.fake = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">while</span> (file_ex_code--) &#123;</span><br><span class="line">                FileException.prototype[file_ex_codes[file_ex_code]] = file_ex_code + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!real_URL.createObjectURL) &#123;</span><br><span class="line">                URL = view.URL = &#123;&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            URL.createObjectURL = <span class="function"><span class="keyword">function</span>(<span class="params">blob</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span></span><br><span class="line">                    type = blob.type</span><br><span class="line">                    , data_URI_header</span><br><span class="line">                    ;</span><br><span class="line">                <span class="keyword">if</span> (type === <span class="literal">null</span>) &#123;</span><br><span class="line">                    type = <span class="string">"application/octet-stream"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (blob <span class="keyword">instanceof</span> FakeBlob) &#123;</span><br><span class="line">                    data_URI_header = <span class="string">"data:"</span> + type;</span><br><span class="line">                    <span class="keyword">if</span> (blob.encoding === <span class="string">"base64"</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> data_URI_header + <span class="string">";base64,"</span> + blob.data;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (blob.encoding === <span class="string">"URI"</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> data_URI_header + <span class="string">","</span> + <span class="built_in">decodeURIComponent</span>(blob.data);</span><br><span class="line">                    &#125; <span class="keyword">if</span> (btoa) &#123;</span><br><span class="line">                        <span class="keyword">return</span> data_URI_header + <span class="string">";base64,"</span> + btoa(blob.data);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> data_URI_header + <span class="string">","</span> + <span class="built_in">encodeURIComponent</span>(blob.data);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (real_create_object_URL) &#123;</span><br><span class="line">                    <span class="keyword">return</span> real_create_object_URL.call(real_URL, blob);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            URL.revokeObjectURL = <span class="function"><span class="keyword">function</span>(<span class="params">object_URL</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (object_URL.substring(<span class="number">0</span>, <span class="number">5</span>) !== <span class="string">"data:"</span> &amp;&amp; real_revoke_object_URL) &#123;</span><br><span class="line">                    real_revoke_object_URL.call(real_URL, object_URL);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            FBB_proto.append = <span class="function"><span class="keyword">function</span>(<span class="params">data<span class="regexp">/*, endings*/</span></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> bb = <span class="keyword">this</span>.data;</span><br><span class="line">                <span class="comment">// decode data to a binary string</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">Uint8Array</span> &amp;&amp; (data <span class="keyword">instanceof</span> <span class="built_in">ArrayBuffer</span> || data <span class="keyword">instanceof</span> <span class="built_in">Uint8Array</span>)) &#123;</span><br><span class="line">                    <span class="keyword">var</span></span><br><span class="line">                        str = <span class="string">""</span></span><br><span class="line">                        , buf = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(data)</span><br><span class="line">                        , i = <span class="number">0</span></span><br><span class="line">                        , buf_len = buf.length</span><br><span class="line">                        ;</span><br><span class="line">                    <span class="keyword">for</span> (; i &lt; buf_len; i++) &#123;</span><br><span class="line">                        str += <span class="built_in">String</span>.fromCharCode(buf[i]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    bb.push(str);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (get_class(data) === <span class="string">"Blob"</span> || get_class(data) === <span class="string">"File"</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (FileReaderSync) &#123;</span><br><span class="line">                        <span class="keyword">var</span> fr = <span class="keyword">new</span> FileReaderSync;</span><br><span class="line">                        bb.push(fr.readAsBinaryString(data));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// async FileReader won't work as BlobBuilder is sync</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> FileException(<span class="string">"NOT_READABLE_ERR"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data <span class="keyword">instanceof</span> FakeBlob) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (data.encoding === <span class="string">"base64"</span> &amp;&amp; atob) &#123;</span><br><span class="line">                        bb.push(atob(data.data));</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.encoding === <span class="string">"URI"</span>) &#123;</span><br><span class="line">                        bb.push(<span class="built_in">decodeURIComponent</span>(data.data));</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.encoding === <span class="string">"raw"</span>) &#123;</span><br><span class="line">                        bb.push(data.data);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">"string"</span>) &#123;</span><br><span class="line">                        data += <span class="string">""</span>; <span class="comment">// convert unsupported types to strings</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// decode UTF-16 to binary string</span></span><br><span class="line">                    bb.push(<span class="built_in">unescape</span>(<span class="built_in">encodeURIComponent</span>(data)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            FBB_proto.getBlob = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">arguments</span>.length) &#123;</span><br><span class="line">                    type = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> FakeBlob(<span class="keyword">this</span>.data.join(<span class="string">""</span>), type, <span class="string">"raw"</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">            FBB_proto.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"[object BlobBuilder]"</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            FB_proto.slice = <span class="function"><span class="keyword">function</span>(<span class="params">start, end, type</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> args = <span class="built_in">arguments</span>.length;</span><br><span class="line">                <span class="keyword">if</span> (args &lt; <span class="number">3</span>) &#123;</span><br><span class="line">                    type = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> FakeBlob(</span><br><span class="line">                    <span class="keyword">this</span>.data.slice(start, args &gt; <span class="number">1</span> ? end : <span class="keyword">this</span>.data.length)</span><br><span class="line">                    , type</span><br><span class="line">                    , <span class="keyword">this</span>.encoding</span><br><span class="line">                );</span><br><span class="line">            &#125;;</span><br><span class="line">            FB_proto.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"[object Blob]"</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            FB_proto.close = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.size = <span class="keyword">this</span>.data.length = <span class="number">0</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> FakeBlobBuilder;</span><br><span class="line">        &#125;(view));</span><br><span class="line"></span><br><span class="line">    view.Blob = <span class="function"><span class="keyword">function</span> <span class="title">Blob</span>(<span class="params">blobParts, options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> type = options ? (options.type || <span class="string">""</span>) : <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">var</span> builder = <span class="keyword">new</span> BlobBuilder();</span><br><span class="line">        <span class="keyword">if</span> (blobParts) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = blobParts.length; i &lt; len; i++) &#123;</span><br><span class="line">                builder.append(blobParts[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.getBlob(type);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;(<span class="keyword">typeof</span> self !== <span class="string">"undefined"</span> &amp;&amp; self || <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">"undefined"</span> &amp;&amp; <span class="built_in">window</span> || <span class="keyword">this</span>.content || <span class="keyword">this</span>));</span><br></pre></td></tr></table></figure></div>

<p><strong>Export2Excel.js:</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable */</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'script-loader!file-saver'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'script-loader!./Blob'</span>);  <span class="comment">//引用当前目录下的Blob.js模块</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'script-loader!xlsx/dist/xlsx.core.min'</span>);</span><br><span class="line"><span class="comment">//由于这几个文件不支持import引入，所以我们需要`script-loader`来将他们挂载到全局环境下</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateArray</span>(<span class="params">table</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> out = [];</span><br><span class="line">    <span class="keyword">var</span> rows = table.querySelectorAll(<span class="string">'tr'</span>);</span><br><span class="line">    <span class="keyword">var</span> ranges = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> R = <span class="number">0</span>; R &lt; rows.length; ++R) &#123;</span><br><span class="line">        <span class="keyword">var</span> outRow = [];</span><br><span class="line">        <span class="keyword">var</span> row = rows[R];</span><br><span class="line">        <span class="keyword">var</span> columns = row.querySelectorAll(<span class="string">'td'</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> C = <span class="number">0</span>; C &lt; columns.length; ++C) &#123;</span><br><span class="line">            <span class="keyword">var</span> cell = columns[C];</span><br><span class="line">            <span class="keyword">var</span> colspan = cell.getAttribute(<span class="string">'colspan'</span>);</span><br><span class="line">            <span class="keyword">var</span> rowspan = cell.getAttribute(<span class="string">'rowspan'</span>);</span><br><span class="line">            <span class="keyword">var</span> cellValue = cell.innerText;</span><br><span class="line">            <span class="keyword">if</span> (cellValue !== <span class="string">""</span> &amp;&amp; cellValue == +cellValue) cellValue = +cellValue;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Skip ranges</span></span><br><span class="line">            ranges.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">range</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (R &gt;= range.s.r &amp;&amp; R &lt;= range.e.r &amp;&amp; outRow.length &gt;= range.s.c &amp;&amp; outRow.length &lt;= range.e.c) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= range.e.c - range.s.c; ++i) outRow.push(<span class="literal">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Handle Row Span</span></span><br><span class="line">            <span class="keyword">if</span> (rowspan || colspan) &#123;</span><br><span class="line">                rowspan = rowspan || <span class="number">1</span>;</span><br><span class="line">                colspan = colspan || <span class="number">1</span>;</span><br><span class="line">                ranges.push(&#123;<span class="attr">s</span>: &#123;<span class="attr">r</span>: R, <span class="attr">c</span>: outRow.length&#125;, <span class="attr">e</span>: &#123;<span class="attr">r</span>: R + rowspan - <span class="number">1</span>, <span class="attr">c</span>: outRow.length + colspan - <span class="number">1</span>&#125;&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Handle Value</span></span><br><span class="line">            outRow.push(cellValue !== <span class="string">""</span> ? cellValue : <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Handle Colspan</span></span><br><span class="line">            <span class="keyword">if</span> (colspan) <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; colspan - <span class="number">1</span>; ++k) outRow.push(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        out.push(outRow);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [out, ranges];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">datenum</span>(<span class="params">v, date1904</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (date1904) v += <span class="number">1462</span>;</span><br><span class="line">    <span class="keyword">var</span> epoch = <span class="built_in">Date</span>.parse(v);</span><br><span class="line">    <span class="keyword">return</span> (epoch - <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.UTC(<span class="number">1899</span>, <span class="number">11</span>, <span class="number">30</span>))) / (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sheet_from_array_of_arrays</span>(<span class="params">data, opts</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ws = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> range = &#123;<span class="attr">s</span>: &#123;<span class="attr">c</span>: <span class="number">10000000</span>, <span class="attr">r</span>: <span class="number">10000000</span>&#125;, <span class="attr">e</span>: &#123;<span class="attr">c</span>: <span class="number">0</span>, <span class="attr">r</span>: <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> R = <span class="number">0</span>; R != data.length; ++R) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> C = <span class="number">0</span>; C != data[R].length; ++C) &#123;</span><br><span class="line">            <span class="keyword">if</span> (range.s.r &gt; R) range.s.r = R;</span><br><span class="line">            <span class="keyword">if</span> (range.s.c &gt; C) range.s.c = C;</span><br><span class="line">            <span class="keyword">if</span> (range.e.r &lt; R) range.e.r = R;</span><br><span class="line">            <span class="keyword">if</span> (range.e.c &lt; C) range.e.c = C;</span><br><span class="line">            <span class="keyword">var</span> cell = &#123;<span class="attr">v</span>: data[R][C]&#125;;</span><br><span class="line">            <span class="keyword">if</span> (cell.v == <span class="literal">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">var</span> cell_ref = XLSX.utils.encode_cell(&#123;<span class="attr">c</span>: C, <span class="attr">r</span>: R&#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> cell.v === <span class="string">'number'</span>) cell.t = <span class="string">'n'</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> cell.v === <span class="string">'boolean'</span>) cell.t = <span class="string">'b'</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cell.v <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</span><br><span class="line">                cell.t = <span class="string">'n'</span>;</span><br><span class="line">                cell.z = XLSX.SSF._table[<span class="number">14</span>];</span><br><span class="line">                cell.v = datenum(cell.v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> cell.t = <span class="string">'s'</span>;</span><br><span class="line"></span><br><span class="line">            ws[cell_ref] = cell;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (range.s.c &lt; <span class="number">10000000</span>) ws[<span class="string">'!ref'</span>] = XLSX.utils.encode_range(range);</span><br><span class="line">    <span class="keyword">return</span> ws;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Workbook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Workbook)) <span class="keyword">return</span> <span class="keyword">new</span> Workbook();</span><br><span class="line">    <span class="keyword">this</span>.SheetNames = [];</span><br><span class="line">    <span class="keyword">this</span>.Sheets = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">s2ab</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(s.length);</span><br><span class="line">    <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(buf);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i != s.length; ++i) view[i] = s.charCodeAt(i) &amp; <span class="number">0xFF</span>;</span><br><span class="line">    <span class="keyword">return</span> buf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">export_table_to_excel</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> theTable = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a'</span>)</span><br><span class="line">    <span class="keyword">var</span> oo = generateArray(theTable);</span><br><span class="line">    <span class="keyword">var</span> ranges = oo[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* original data */</span></span><br><span class="line">    <span class="keyword">var</span> data = oo[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> ws_name = <span class="string">"SheetJS"</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wb = <span class="keyword">new</span> Workbook(), ws = sheet_from_array_of_arrays(data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* add ranges to worksheet */</span></span><br><span class="line">    <span class="comment">// ws['!cols'] = ['apple', 'banan'];</span></span><br><span class="line">    ws[<span class="string">'!merges'</span>] = ranges;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* add worksheet to workbook */</span></span><br><span class="line">    wb.SheetNames.push(ws_name);</span><br><span class="line">    wb.Sheets[ws_name] = ws;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wbout = XLSX.write(wb, &#123;<span class="attr">bookType</span>: <span class="string">'xlsx'</span>, <span class="attr">bookSST</span>: <span class="literal">false</span>, <span class="attr">type</span>: <span class="string">'binary'</span>&#125;);</span><br><span class="line"></span><br><span class="line">    saveAs(<span class="keyword">new</span> Blob([s2ab(wbout)], &#123;<span class="attr">type</span>: <span class="string">"application/octet-stream"</span>&#125;), <span class="string">"test.xlsx"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatJson</span>(<span class="params">jsonData</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(jsonData)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">export_json_to_excel</span>(<span class="params">th, jsonData, defaultTitle</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* original data */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> data = jsonData;</span><br><span class="line">    data.unshift(th);</span><br><span class="line">    <span class="keyword">var</span> ws_name = <span class="string">"SheetJS"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wb = <span class="keyword">new</span> Workbook(), ws = sheet_from_array_of_arrays(data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* add worksheet to workbook */</span></span><br><span class="line">    wb.SheetNames.push(ws_name);</span><br><span class="line">    wb.Sheets[ws_name] = ws;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wbout = XLSX.write(wb, &#123;<span class="attr">bookType</span>: <span class="string">'xlsx'</span>, <span class="attr">bookSST</span>: <span class="literal">false</span>, <span class="attr">type</span>: <span class="string">'binary'</span>&#125;);</span><br><span class="line">    <span class="keyword">var</span> title = defaultTitle || <span class="string">'列表'</span></span><br><span class="line">    saveAs(<span class="keyword">new</span> Blob([s2ab(wbout)], &#123;<span class="attr">type</span>: <span class="string">"application/octet-stream"</span>&#125;), title + <span class="string">".xlsx"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="在需要下载的vue页面methods中创建方法"><a href="#在需要下载的vue页面methods中创建方法" class="headerlink" title="在需要下载的vue页面methods中创建方法"></a>在需要下载的vue页面methods中创建方法</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 文件下载</span></span><br><span class="line">ExcelLog() &#123;</span><br><span class="line">    <span class="built_in">require</span>.ensure([], () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; export_json_to_excel &#125; = <span class="built_in">require</span>(<span class="string">'../../lib/Export2Excel'</span>)	<span class="comment">// 导入你创建的js文件</span></span><br><span class="line">        <span class="keyword">const</span> tHeader = [<span class="string">'Order ID'</span>, <span class="string">'Date Time'</span>, <span class="string">'Tempear(℃)'</span>]   <span class="comment">// 自定义标题</span></span><br><span class="line">        <span class="keyword">const</span> filterVal = [<span class="string">'oid'</span>, <span class="string">'create_time'</span>, <span class="string">'tempera'</span>]   <span class="comment">// 对应表字段</span></span><br><span class="line">        <span class="keyword">const</span> list = <span class="keyword">this</span>.TemperLog   <span class="comment">// 需要下载的数据</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">this</span>.formatJson(filterVal, list);</span><br><span class="line">        export_json_to_excel(tHeader, data, <span class="string">'运单'</span> + <span class="keyword">this</span>.orderID + <span class="string">'温度详情'</span>);  <span class="comment">//导出文件名称</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line">    <span class="comment">// 文件下载所调用函数</span></span><br><span class="line">    formatJson(filterVal, jsonData) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(jsonData)</span><br><span class="line">        <span class="keyword">return</span> jsonData.map(<span class="function"><span class="params">v</span> =&gt;</span> filterVal.map(<span class="function"><span class="params">j</span> =&gt;</span> v[j]))</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></div>

<h4 id="在button中绑定点击事件"><a href="#在button中绑定点击事件" class="headerlink" title="在button中绑定点击事件"></a>在button中绑定点击事件</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">&lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;ExcelLog&quot;&gt;下载温度&lt;&#x2F;el-button&gt;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>文件下载</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue中router-link的点击事件</title>
    <url>/Vue/Vue_id_06.html</url>
    <content><![CDATA[<p>　　Vue中的router-link绑定点击事件失败，因为router-link会阻止click事件</p>
<a id="more"></a>

<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>根据Vue2.0官方文档关于父子组件通讯的原则，父组件通过prop传递数据给子组件，子组件触发事件给父组件。但父组件想在子组件上监听自己的click的话，需要加上native修饰符。<br>所以如果在想要在router-link上添加事件的话需要<strong>@click.native</strong>这样写</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>点击事件</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue引入百度地图</title>
    <url>/Vue/Vue_id_05.html</url>
    <content><![CDATA[<p>　　Vue中引入百度地图</p>
<a id="more"></a>

<h3 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">npm install vue-baidu-map --save</span><br></pre></td></tr></table></figure></div>

<h3 id="在main-js文件中全局引入"><a href="#在main-js文件中全局引入" class="headerlink" title="在main.js文件中全局引入"></a>在main.js文件中全局引入</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> BaiduMap <span class="keyword">from</span> <span class="string">'vue-baidu-map'</span></span><br><span class="line">Vue.use(BaiduMap, &#123;</span><br><span class="line">  ak: <span class="string">'你申请的key'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="在Vue页面中导入使用"><a href="#在Vue页面中导入使用" class="headerlink" title="在Vue页面中导入使用"></a>在Vue页面中导入使用</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">baidu-map</span> <span class="attr">:center</span>=<span class="string">"center"</span> <span class="attr">:zoom</span>=<span class="string">"zoom"</span> @<span class="attr">ready</span>=<span class="string">"handler"</span> <span class="attr">style</span>=<span class="string">"height:1080px"</span> @<span class="attr">click</span>=<span class="string">"getClickInfo"</span> <span class="attr">:scroll-wheel-zoom</span>=<span class="string">'true'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">baidu-map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'TestBaiDu'</span>,</span></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      center: &#123;lng: 109.45744048529967, lat: 36.49771311230842&#125;,</span><br><span class="line">      zoom: 13</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handler (&#123;BMap, map&#125;) &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> point = <span class="keyword">new</span> BMap.Point(<span class="number">109.49926175379778</span>, <span class="number">36.60449676862417</span>)</span></span><br><span class="line">      map.centerAndZoom(point, 13)</span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> marker = <span class="keyword">new</span> BMap.Marker(point) <span class="comment">// 创建标注</span></span></span><br><span class="line"><span class="actionscript">      map.addOverlay(marker) <span class="comment">// 将标注添加到地图中</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> circle = <span class="keyword">new</span> BMap.Circle(point, <span class="number">6</span>, &#123; strokeColor: <span class="string">'Red'</span>, strokeWeight: <span class="number">6</span>, strokeOpacity: <span class="number">1</span>, Color: <span class="string">'Red'</span>, fillColor: <span class="string">'#f03'</span> &#125;)</span></span><br><span class="line">      map.addOverlay(circle)</span><br><span class="line">    &#125;,</span><br><span class="line">    getClickInfo (e) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e.point.lng)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e.point.lat)</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.center.lng = e.point.lng</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.center.lat = e.point.lat</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="取消百度地图的Logo及版本"><a href="#取消百度地图的Logo及版本" class="headerlink" title="取消百度地图的Logo及版本"></a>取消百度地图的Logo及版本</h3><p>　　<strong>设置样式为隐藏，如果在当前页面不生效，则可以在全局css样式写入以下类属性</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CSS"><figure class="iseeu highlight /css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.BMap_cpyCtrl</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.anchorBL</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>百度地图</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue中详细的百度地图解析</title>
    <url>/Vue/Vue_id_08.html</url>
    <content><![CDATA[<p>　　Vue中如何引入百度地图，点击<a href="/2020/05/28/Vue/Vue引入百度地图/">Vue中引入百度地图</a>查看</p>
<a id="more"></a>

<h4 id="创建地图实例"><a href="#创建地图实例" class="headerlink" title="创建地图实例"></a>创建地图实例</h4><p>var map = new BMap.Map(“container”);<br>位于BMap命名空间下的Map类表示地图，通过new操作符可以创建一个地图实例。其参数可以是元素id也可以是元素对象。<br>注意在调用此构造函数时应确保容器元素已经添加到地图上。 </p>
<h4 id="创建点坐标"><a href="#创建点坐标" class="headerlink" title="创建点坐标"></a>创建点坐标</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> point = <span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>);</span><br></pre></td></tr></table></figure></div>

<p>这里我们使用BMap命名空间下的Point类来创建一个坐标点。Point类描述了一个地理坐标点，其中116.404表示经度，39.915表示纬度。</p>
<h4 id="地图初始化"><a href="#地图初始化" class="headerlink" title="地图初始化"></a>地图初始化</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">map.centerAndZoom(point,<span class="number">15</span>);</span><br></pre></td></tr></table></figure></div>

<p>在创建地图实例后，我们需要对其进行初始化，BMap.Map.centerAndZoom()方法要求设置中心点坐标和地图级别。<br>地图必须经过初始化才可以执行其他操作。</p>
<h4 id="地图操作"><a href="#地图操作" class="headerlink" title="地图操作"></a>地图操作</h4><p>地图被实例化并完成初始化以后，就可以与其进行交互了。API中的地图对象的外观与行为与百度地图网站上交互的地图非常相似。它支持鼠标拖拽、滚轮缩放、双击放大等交互功能。您也可以修改配置来改变这些功能。<br>您还可以通过编程的方式与地图交互。Map类提供了若干修改地图状态的方法。例如：setCenter()、panTo()、zoomTo()等等。<br>下面示例显示一个地图，等待两秒钟后，它会移动到新中心点。panTo()方法将让地图平滑移动至新中心点，如果移动距离超过了当前地图区域大小，则地图会直跳到该点。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line"><span class="keyword">var</span> point = <span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>);</span><br><span class="line">map.centerAndZoom(point, <span class="number">15</span>);</span><br><span class="line"><span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> map.panTo(<span class="keyword">new</span> BMap.Point(<span class="number">116.409</span>, <span class="number">39.918</span>));</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure></div>

<p>​                </p>
<h4 id="地图控件概述"><a href="#地图控件概述" class="headerlink" title="地图控件概述"></a>地图控件概述</h4><p>百度地图上负责与地图交互的UI元素称为控件。百度地图API中提供了丰富的控件，您还可以通过BMap.Control来实现自定义控件。<br>地图API中提供的控件有：<br>· Control：控件的抽象基类，所有控件均继承此类的方法、属性。通过此类您可实现自定义控件。<br>· NavigationControl：地图平移缩放控件，默认位于地图左上方，它包含控制地图的平移和缩放的功能。<br>· OverviewMapControl：缩略地图控件，默认位于地图右下方，是一个可折叠的缩略地图。<br>· ScaleControl：比例尺控件，默认位于地图左下方，显示地图的比例关系。<br>· CopyrightControl：版权控件，默认位于地图左下方。<br>所有这些控件都基于BMap.Control类。</p>
<h4 id="向地图添加控件"><a href="#向地图添加控件" class="headerlink" title="向地图添加控件"></a>向地图添加控件</h4><p>可以使用BMap.Map.addControl()方法向地图添加控件。在此之前地图需要进行初始化。例如，要将标准地图控件添加到地图中，可在代码中添加如下内容： </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);</span><br><span class="line">map.addControl(<span class="keyword">new</span> BMap.NavigationControl());</span><br></pre></td></tr></table></figure></div>

<p>可以向地图添加多个控件。在本例中我们向地图添加一个平移缩放控件、一个比例尺控件和一个缩略图控件。在地图中添加控件后，它们即刻生效。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">map.addControl(<span class="keyword">new</span> BMap.NavigationControl());</span><br><span class="line">map.addControl(<span class="keyword">new</span> BMap.ScaleControl());</span><br><span class="line">map.addControl(<span class="keyword">new</span> BMap.OverviewMapControl());</span><br></pre></td></tr></table></figure></div>

<h4 id="控制控件的位置"><a href="#控制控件的位置" class="headerlink" title="控制控件的位置"></a>控制控件的位置</h4><p>初始化控件时，可提供一个可选参数，参数类型为一个JavaScript对象。其中anchor和offsetX、offsetY共同控制控件在地图上的位置。anchor表示控件停靠在地图的哪个角，允许的值为：<br>· BMAP_ANCHOR_TOP_LEFT<br>· BMAP_ANCHOR_TOP_RIGHT<br>· BMAP_ANCHOR_BOTTOM_LEFT<br>· BMAP_ANCHOR_BOTTOM_RIGHT<br>除了指定停靠位置外，还可以提供偏移量，用来指示控件距离地图边界相隔多少像素。<br>本示例将标准地图控件放置在地图的右上角，间隔10个像素。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> opts = &#123;<span class="attr">anchor</span>: BMAP_ANCHOR_TOP_RIGHT, <span class="attr">offset</span>: <span class="keyword">new</span> BMap.Size(<span class="number">10</span>, <span class="number">10</span>)&#125;</span><br><span class="line">map.addControl(<span class="keyword">new</span> BMap.NavigationControl(opts));</span><br></pre></td></tr></table></figure></div>

<h4 id="修改控件的配置"><a href="#修改控件的配置" class="headerlink" title="修改控件的配置"></a>修改控件的配置</h4><p>地图API的控件提供了丰富的配置参数，您可参考API文档来修改它们以便得到符合要求的控件外观。<br>本示例将调整平移缩放地图控件的外观。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> opts = &#123;<span class="attr">type</span>: BMAP_NAVIGATION_CONTROL_SMALL&#125;</span><br><span class="line">map.addControl(<span class="keyword">new</span> BMap.NavigationControl(opts));</span><br></pre></td></tr></table></figure></div>

<h4 id="自定义控件"><a href="#自定义控件" class="headerlink" title="自定义控件"></a>自定义控件</h4><p>百度地图API允许您通过继承BMap.Control来创建自定义地图控件。（注意JavaScript是通过prototype属性进行继承的）<br>要创建可用的自定义控件，您需要实现类定义中的一个抽象方法并给两个属性赋值，它们是：initialize()和defaultAnchor、defaultOffset。initialize()方法必须返回控件容器的DOM元素，defaultAnchor为控件默认的停靠位置，defaultOffset为控件默认的间隔距离。<br>所有自定义的地图控件中的DOM元素最终都应该添加到地图容器（即地图所在的DOM元素）中去，这个地图容器可以通过BMap.Map.getContainer()方法获得。<br>在此示例中，创建一个简单的放大控件，每一次点击将地图放大两个级别。它具有文本标识，而不是平移缩放控件中使用的图形图标。</p>
<h4 id="地图覆盖物概述"><a href="#地图覆盖物概述" class="headerlink" title="地图覆盖物概述"></a>地图覆盖物概述</h4><p>所有叠加或覆盖到地图的内容，我们统称为地图覆盖物。如标注、矢量图形元素(包括：折线和多边形)、信息窗口等。覆盖物拥有自己的地理坐标，当您拖动或缩放地图时，它们会相应的移动。<br>地图API提供了如下几种覆盖物：<br>· Overlay：覆盖物的抽象基类，此类不可实例化，所有的覆盖物均继承此类的方法。<br>· Marker：标注表示地图上的点，可自定义标注的图标。<br>· Label：表示地图上的文本标注，您可以自定义标注的文本内容。<br>· Polyline：表示地图上的折线。<br>· Polygon：表示地图上的多边形。多边形类似于闭合的折线，另外您也可以为其添加填充颜色。<br>· InfoWindow：信息窗口也是一种特殊的覆盖物。注意：同一时刻只能有一个信息窗口在地图上打开。 </p>
<p>可以使用BMap.Map.addOverlay()方法向地图添加覆盖物，使用BMap.Map.removeOverlay()方法移除覆盖物，注意此方法不适用于InfoWindow。 </p>
<h4 id="标注"><a href="#标注" class="headerlink" title="标注"></a>标注</h4><p>标注表示地图上的点。API提供了默认图标样式，您也可以通过Icon类来指定自定义图标。BMap.Marker的构造函数的参数为BMap.Point和BMap.MarkerOptions（可选）。 注意：当您使用自定义图标时，标注的地理坐标点将位于标注所用图标的中心位置，您可通过Icon的offset属性修改标定位置。<br>下面的示例向地图中心点添加了一个标注，并使用默认的标注样式。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line"><span class="keyword">var</span> point = <span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>);</span><br><span class="line">map.centerAndZoom(point, <span class="number">15</span>);</span><br><span class="line"><span class="keyword">var</span> marker = <span class="keyword">new</span> BMap.Marker(point);    <span class="comment">// 创建标注</span></span><br><span class="line">map.addOverlay(marker);           <span class="comment">// 将标注添加到地图中</span></span><br></pre></td></tr></table></figure></div>

<h4 id="定义标注图标"><a href="#定义标注图标" class="headerlink" title="定义标注图标"></a>定义标注图标</h4><p>通过BMap.Icon类可实现自定义标注的图标，下面示例通过参数BMap.MarkerOptions的icon属性进行设置，您也可以使用BMap.Marker.setIcon()方法。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line"><span class="keyword">var</span> point = <span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>);</span><br><span class="line">map.centerAndZoom(point, <span class="number">15</span>);</span><br><span class="line"><span class="comment">// 编写自定义函数，创建标注</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMarker</span>(<span class="params">point, index</span>)</span>&#123;</span><br><span class="line"> <span class="comment">// 创建图标对象</span></span><br><span class="line"> <span class="keyword">var</span> myIcon = <span class="keyword">new</span> BMap.Icon(<span class="string">"http://api.map.baidu.com/img/markers.png"</span>, <span class="keyword">new</span> BMap.Size(<span class="number">23</span>, <span class="number">25</span>), &#123;</span><br><span class="line">  offset: <span class="keyword">new</span> BMap.Size(<span class="number">10</span>, <span class="number">25</span>),         <span class="comment">// 指定定位位置</span></span><br><span class="line">  imageOffset: <span class="keyword">new</span> BMap.Size(<span class="number">0</span>, <span class="number">0</span> - index * <span class="number">25</span>)  <span class="comment">// 设置图片偏移</span></span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="keyword">var</span> marker = <span class="keyword">new</span> BMap.Marker(point, &#123;<span class="attr">icon</span>: myIcon&#125;);</span><br><span class="line"> map.addOverlay(marker);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 随机向地图添加10个标注</span></span><br><span class="line"><span class="keyword">var</span> bounds = map.getBounds();</span><br><span class="line"><span class="keyword">var</span> lngSpan = bounds.maxX - bounds.minX;</span><br><span class="line"><span class="keyword">var</span> latSpan = bounds.maxY - bounds.minY;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i ++) &#123;</span><br><span class="line"> <span class="keyword">var</span> point = <span class="keyword">new</span> BMap.Point(bounds.minX + lngSpan * (<span class="built_in">Math</span>.random() * <span class="number">0.7</span> + <span class="number">0.15</span>),</span><br><span class="line"> bounds.minY + latSpan * (<span class="built_in">Math</span>.random() * <span class="number">0.7</span> + <span class="number">0.15</span>));</span><br><span class="line">addMarker(point, i);</span><br></pre></td></tr></table></figure></div>

<h4 id="监听标注的事件"><a href="#监听标注的事件" class="headerlink" title="监听标注的事件"></a>监听标注的事件</h4><p>事件方法与Map事件机制相同。可参考<a href="http://openapi.baidu.com/map/event.html" target="_blank" rel="noopener">事件</a>部分。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">marker.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> alert(<span class="string">"您点击了标注"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<h4 id="内存释放"><a href="#内存释放" class="headerlink" title="内存释放"></a>内存释放</h4><p>如果您在地图中需要反复添加大量的标注，这可能会占用较多的内存资源。如果您的标注在被移除后不再使用，可调用Overlay.dispose()方法来释放内存。注意在调用此方法后标注将不能再次添加到地图上。关于Overlay.dispose()的详细信息可参考<a href="http://www.cnblogs.com/xuhongfei/admin/EditPosts.aspx?opt=1#Overlay" target="_blank" rel="noopener">API文档</a>部分内容。<br>例如，您可以在标注被移除后调用此方法：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">map.removeOverlay(marker);</span><br><span class="line">marker.dispose();</span><br></pre></td></tr></table></figure></div>

<h4 id="信息窗口"><a href="#信息窗口" class="headerlink" title="信息窗口"></a>信息窗口</h4><p>信息窗口在地图上方的浮动显示HTML内容。信息窗口可直接在地图上的任意位置打开，也可以在标注对象上打开（此时信息窗口的坐标与标注的坐标一致）。 可以使用BMap.InfoWindow来创建一个信息窗实例，注意同一时刻地图上只能有一个信息窗口处于打开状态。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> opts = &#123;</span><br><span class="line"> width : <span class="number">250</span>,   <span class="comment">// 信息窗口宽度</span></span><br><span class="line"> height: <span class="number">100</span>,   <span class="comment">// 信息窗口高度</span></span><br><span class="line"> title : <span class="string">"Hello"</span> <span class="comment">// 信息窗口标题</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> infoWindow = <span class="keyword">new</span> BMap.InfoWindow(<span class="string">"World"</span>, opts); <span class="comment">// 创建信息窗口对象</span></span><br><span class="line">map.openInfoWindow(infoWindow, map.getCenter());   <span class="comment">// 打开信息窗口</span></span><br></pre></td></tr></table></figure></div>

<h4 id="添加折线"><a href="#添加折线" class="headerlink" title="添加折线"></a>添加折线</h4><p>BMap.Polyline对象表示地图上的折线覆盖物。它包含一组点，并将这些点连接起来形成折线。<br>折线在地图上绘制为一系列直线段。可以自定义这些线段的颜色、粗细和透明度。颜色可以是十六进制数字形式（比如：#ff0000）或者是颜色关键字（比如：red）。<br>BMap.Polyline对象需要浏览器支持矢量绘制功能。在Internet Explorer中，地图使用VML（请参阅VML）绘制折线；在其他浏览器中使用SVG（如果可用）。<br>以下代码段会在两点之间创建6像素宽的蓝色折线： </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> polyline = <span class="keyword">new</span> BMap.Polyline([  </span><br><span class="line"><span class="keyword">new</span> BMap.Point(<span class="number">116.399</span>, <span class="number">39.910</span>),  </span><br><span class="line"><span class="keyword">new</span> BMap.Point(<span class="number">116.405</span>, <span class="number">39.920</span>)  </span><br><span class="line">],  </span><br><span class="line"> &#123;<span class="attr">strokeColor</span>:<span class="string">"blue"</span>, <span class="attr">strokeWeight</span>:<span class="number">6</span>, <span class="attr">strokeOpacity</span>:<span class="number">0.5</span>&#125;  </span><br><span class="line">);  </span><br><span class="line">map.addOverlay(polyline);</span><br></pre></td></tr></table></figure></div>

<h4 id="地图事件概述"><a href="#地图事件概述" class="headerlink" title="地图事件概述"></a>地图事件概述</h4><p>浏览器中的JavaScript是“事件驱动的”，这表示JavaScript通过生成事件来响应交互，并期望程序能够“监听”感兴趣的活动。例如，在浏览器中，用户的鼠标和键盘交互可以创建在DOM内传播的事件。对某些事件感兴趣的程序会为这些事件注册JavaScript事件监听器，并在接收这些事件时执行代码。<br>百度地图API拥有一个自己的事件模型，程序员可监听地图API对象的自定义事件，使用方法和DOM事件类似。但请注意，地图API事件是独立的，与标准DOM事件不同。 </p>
<h4 id="事件的监听"><a href="#事件的监听" class="headerlink" title="事件的监听"></a>事件的监听</h4><p>百度地图API中的每一个对象都含有addEventListener方法，您可以通过该方法来监听对象事件。例如，BMap.Map包含click、dblclick等事件。在特定环境下这些事件会被触发，同时监听函数会得到相应的事件参数e，比如当用户点击地图时，e参数会包含鼠标所对应的地理位置point。<br>有关地图API对象的事件，请参考完整的API参考文档。<br>addEventListener方法有两个参数：监听的事件名称和事件触发时调用的函数。下面示例中，每当用户点击地图时，会弹出一个警告框。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);</span><br><span class="line">map.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> alert(<span class="string">"您点击了地图。"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<p>通过监听事件还可以捕获事件触发后的状态。下面示例显示用户拖动地图后地图中心的经纬度信息。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);</span><br><span class="line">map.addEventListener(<span class="string">"dragend"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="keyword">var</span> center = map.getCenter();</span><br><span class="line"> <span class="built_in">document</span>.getElementById(<span class="string">"info"</span>).innerHTML = center.lng + <span class="string">", "</span> + center.lat;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<h4 id="事件参数和this"><a href="#事件参数和this" class="headerlink" title="事件参数和this"></a>事件参数和this</h4><p>在标准的DOM事件模型中（DOM Level 2 Events），监听函数会得到一个事件对象e，在e中可以获取有关该事件的信息。同时在监听函数中this会指向触发该事件的DOM元素。 百度地图API的事件模型与此类似，在事件监听函数中传递事件对象e，每个e参数至少包含事件类型（type）和触发该事件的对象（target）。 API还保证函数内的this指向触发（同时也是绑定）事件的API对象。<br>例如，通过参数e得到点击的经纬度坐标。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);</span><br><span class="line">map.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line"> <span class="built_in">document</span>.getElementById(<span class="string">"info"</span>).innerHTML = e.point.lng + <span class="string">", "</span> + e.point.lat;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<p>或者通过this得到地图缩放后的级别。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);  </span><br><span class="line">map.addEventListener(<span class="string">"zoomend"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"info"</span>).innerHTML = <span class="string">"地图缩放至："</span> + <span class="keyword">this</span>.getZoom() + <span class="string">"级"</span>;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<h4 id="移除监听事件"><a href="#移除监听事件" class="headerlink" title="移除监听事件"></a>移除监听事件</h4><p>当您不再希望监听事件时，可以将事件监听进行移除。每个API对象提供了removeEventListener用来移除事件监听函数。<br>下面示例中，用户第一次点击地图会触发事件监听函数，在函数内部对事件监听进行了移除，因此后续的点击操作则不会触发监听函数。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);   </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showInfo</span>(<span class="params">e</span>)</span>&#123;  </span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"info"</span>).innerHTML = e.point.lng + <span class="string">", "</span> + e.point.lat;  </span><br><span class="line">map.removeEventListener(<span class="string">"click"</span>, showInfo);  </span><br><span class="line">&#125;  </span><br><span class="line">map.addEventListener(<span class="string">"click"</span>, showInfo);</span><br></pre></td></tr></table></figure></div>

<h4 id="地图图层概念"><a href="#地图图层概念" class="headerlink" title="地图图层概念"></a>地图图层概念</h4><p>地图可以包含一个或多个图层，每个图层在每个级别都是由若干张图块组成的，它们覆盖了地球的整个表面。<br>在最低的缩放级别（级别 1）中，整个地球由 4 张图块组成。随着级别的增长，地图所使用的图块个数也随之增多。</p>
<h4 id="自定义图层"><a href="#自定义图层" class="headerlink" title="自定义图层"></a>自定义图层</h4><p>百度地图中提供一个BMap.TileLayer类，可以实现用户自定义图层功能。可以在百度地图上叠加一层自定义的图块。<br>有关TileLayer类的详细接口，请参考TileLayer的<a href="http://www.cnblogs.com/xuhongfei/admin/EditPosts.aspx?opt=1#TileLayer" target="_blank" rel="noopener">API参考文档</a>。<br>以下代码在每个图块的所有缩放级别上显示一个简单的透明叠加层，使用浮动红色小水滴表示图块的轮廓。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);     <span class="comment">// 创建地图实例  </span></span><br><span class="line"><span class="keyword">var</span> point = <span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>); <span class="comment">// 创建点坐标  </span></span><br><span class="line">map.centerAndZoom(point,<span class="number">15</span>);         <span class="comment">// 初始化地图，设置中心点坐标和地图级别  </span></span><br><span class="line"><span class="keyword">var</span> tilelayer = <span class="keyword">new</span> BMap.TileLayer();     <span class="comment">// 创建地图层实例  </span></span><br><span class="line">tilelayer.getTilesUrl=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;       <span class="comment">// 设置图块路径  </span></span><br><span class="line"><span class="keyword">return</span> <span class="string">"layer.gif"</span>;  </span><br><span class="line">&#125;;  </span><br><span class="line">map.addTileLayer(tilelayer);         <span class="comment">// 将图层添加到地图上</span></span><br></pre></td></tr></table></figure></div>

<h4 id="地图工具概述"><a href="#地图工具概述" class="headerlink" title="地图工具概述"></a>地图工具概述</h4><p>百度地图提供了交互功能更为复杂的“工具”，它包括：<br>· PushpinTool：标注工具。通过此工具用户可在地图任意区域添加标注。<br>· DistanceTool：测距工具。通过此工具用户可测量地图上任意位置之间的距离。<br>· DragAndZoomTool：区域缩放工具。此工具将根据用户拖拽绘制的矩形区域大小对地图进行放大或缩小操作。<br>工具类在初始化时需要提供地图实例参数，以便使工具在该地图上生效。您可以在地图上添加多个工具，但同一时刻只能有一个工具处于开启状态。标注工具和测距工具在完成一次操作后将自动退出开启状态，而区域缩放工具可以自行配置是否自动关闭。</p>
<h4 id="向地图添加工具"><a href="#向地图添加工具" class="headerlink" title="向地图添加工具"></a>向地图添加工具</h4><p>在地图正确初始化后，您可以创建工具实例。下面示例展示了如何向地图添加一个标注工具。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">15</span>);</span><br><span class="line"><span class="keyword">var</span> myPushpin = <span class="keyword">new</span> BMap.PushpinTool(map);     <span class="comment">// 创建标注工具实例</span></span><br><span class="line">myPushpin.addEventListener(<span class="string">"markend"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123; <span class="comment">// 监听事件，提示标注点坐标信息</span></span><br><span class="line"> alert(<span class="string">"您标注的位置："</span> +</span><br><span class="line">e.marker.getPoint().lng + <span class="string">", "</span> +</span><br><span class="line">e.marker.getPoint().lat);</span><br><span class="line">&#125;);</span><br><span class="line">myPushpin.open();                  <span class="comment">// 开启标注工具</span></span><br></pre></td></tr></table></figure></div>

<h4 id="通过按钮控制工具的开启和关闭"><a href="#通过按钮控制工具的开启和关闭" class="headerlink" title="通过按钮控制工具的开启和关闭"></a>通过按钮控制工具的开启和关闭</h4><p>工具类没有提供控制其开启和关闭的UI元素。您可以根据需要自己创建这些元素，把它们放置在地图区域内或者区域外均可。调用工具类的open和close可控制工具的开启和关闭。<br>首先初始化地图并创建一个测距工具实例：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">15</span>);</span><br><span class="line"><span class="keyword">var</span> myDis = <span class="keyword">new</span> BMap.DistanceTool(map);</span><br></pre></td></tr></table></figure></div>

<p>接着我们创建两个按钮元素并为其添加点击事件。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">&lt;input type=<span class="string">"button"</span> value=<span class="string">"开启"</span> onclick=<span class="string">"myDis.open()"</span> /&gt; </span><br><span class="line">&lt;input type=<span class="string">"button"</span> value=<span class="string">"关闭"</span> onclick=<span class="string">"myDis.close()"</span> /&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="修改工具的配置"><a href="#修改工具的配置" class="headerlink" title="修改工具的配置"></a>修改工具的配置</h4><p>一些工具类提供了可修改的配置参数，您可参考API文档来修改它们以便符合您的要求。</p>
<p>本示例为区域缩放工具添加提示文字。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">15</span>);  </span><br><span class="line"><span class="keyword">var</span> myDrag = <span class="keyword">new</span> BMap.DragAndZoomTool(map, &#123;  </span><br><span class="line">followText : <span class="string">"拖拽鼠标进行操作"</span> </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<h4 id="地图服务概述"><a href="#地图服务概述" class="headerlink" title="地图服务概述"></a>地图服务概述</h4><p>地图服务是指那些提供数据信息的接口，比如本地搜索、路线规划等等。百度地图API提供的服务有：<br>· LocalSearch：本地搜索，提供某一特定地区的位置搜索服务，比如在北京市搜索“公园”。<br>· TransitRoute：公交导航，提供某一特定地区的公交出行方案的搜索服务。<br>· DrivingRoute：驾车导航，提供驾车出行方案的搜索服务。<br>· WalkingRoute：步行导航，提供步行出行方案的搜索服务。<br>· Geocoder：地址解析，提供将地址信息转换为坐标点信息的服务。<br>· LocalCity：本地城市，提供自动判断您所在城市的服务。<br>· TrafficControl：实时路况控件，提供实时和历史路况信息服务。<br>搜索类的服务接口需要指定一个搜索范围，否则接口将不能工作。</p>
<h4 id="本地搜索"><a href="#本地搜索" class="headerlink" title="本地搜索"></a>本地搜索</h4><p>BMap.LocalSearch提供本地搜索服务，在使用本地搜索时需要为其设置一个检索区域，检索区域可以是BMap.Map对象、BMap.Point对象或者是省市名称（比如：”北京市”）的字符串。BMap.LocalSearch构造函数的第二个参数是可选的，您可以在其中指定结果的呈现。BMap.RenderOptions类提供了若干控制呈现的属性，其中map指定了结果所展现的地图实例，panel指定了结果列表的容器元素。<br>下面这个示例展示了在北京市检索天安门。搜索区域设置为地图实例，并告知结果需要展现在地图实例上。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);</span><br><span class="line"><span class="keyword">var</span> local = <span class="keyword">new</span> BMap.LocalSearch(map, &#123;</span><br><span class="line"> renderOptions:&#123;<span class="attr">map</span>: map&#125;</span><br><span class="line">&#125;);</span><br><span class="line">local.search(<span class="string">"天安门"</span>);</span><br></pre></td></tr></table></figure></div>

<p>另外，BMap.LocalSearch还提包含searchNearby和searchInBounds方法，为您提供周边搜索和范围搜索服务。 </p>
<h4 id="配置搜索"><a href="#配置搜索" class="headerlink" title="配置搜索"></a>配置搜索</h4><p>BMap.LocalSearch提供了若干配置方法，通过它们可以自定义搜索服务的行为以满足您的需求。<br>在下面的示例中，我们调整每页显示8个结果，并且根据结果点位置自动调整地图视野，不显示第一条结果的信息窗口：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);</span><br><span class="line"><span class="keyword">var</span> local = <span class="keyword">new</span> BMap.LocalSearch(<span class="string">"北京市"</span>, &#123;</span><br><span class="line"> renderOptions: &#123;</span><br><span class="line">  map: map,</span><br><span class="line">  pageCapacity: <span class="number">8</span>,</span><br><span class="line">  autoViewport: <span class="literal">true</span>,</span><br><span class="line">  selectFirstResult: <span class="literal">false</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br><span class="line">local.search(<span class="string">"中关村"</span>);</span><br></pre></td></tr></table></figure></div>

<p><strong>结果面板</strong> </p>
<p>通过设置BMap.LocalSearchOptions.renderOptions.panel属性，可以为本地搜索对象提供一个结果列表容器，搜索结果会自动添加到容器元素中。请看下面示例：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);  </span><br><span class="line"><span class="keyword">var</span> local = <span class="keyword">new</span> BMap.LocalSearch(map, &#123;  </span><br><span class="line">renderOptions: &#123;<span class="attr">map</span>: map, <span class="attr">panel</span>: <span class="string">"results"</span>&#125;  </span><br><span class="line">&#125;);  </span><br><span class="line">local.search(<span class="string">"天安门"</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="数据接口"><a href="#数据接口" class="headerlink" title="数据接口"></a>数据接口</h4><p>除了搜索结果会自动添加到地图和列表外，您还可以通过数据接口获得详细的数据信息，结合地图API您可以自行向地图添加标注和信息窗口。BMap.LocalSearch和BMap.LocalSearchOptions类提供了若干设置回调函数的接口，通过它们可得到搜索结果的数据信息。 例如，通过onSearchComplete回调函数参数可以获得BMap.LocalResult对象实例，它包含了每一次搜索结果的数据信息。 当回调函数被执行时，您可以使用BMap.LocalSearch.getStatus()方法来确认搜索是否成功或者得到错误的详细信息。<br>在下面这个示例中，通过onSearchComplete回调函数得到第一页每条结果的标题和地址信息，并输出到页面上： </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);   </span><br><span class="line"><span class="keyword">var</span> options = &#123;  </span><br><span class="line">   onSearchComplete: <span class="function"><span class="keyword">function</span>(<span class="params">results</span>)</span>&#123;  </span><br><span class="line">   <span class="keyword">if</span> (local.getStatus() == BMAP_STATUS_SUCCESS)&#123;  </span><br><span class="line">    <span class="comment">// 判断状态是否正确  </span></span><br><span class="line">    <span class="keyword">var</span> s = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; results.getCurrentNumPois(); i ++)&#123;  </span><br><span class="line">     s.push(results.getPoi(i).title + <span class="string">", "</span> + results.getPoi(i).address);  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"log"</span>).innerHTML = s.join(<span class="string">"&lt;BR&gt;"</span>);  </span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> local = <span class="keyword">new</span> BMap.LocalSearch(map, options);  </span><br><span class="line">local.search(<span class="string">"公园"</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="周边搜索"><a href="#周边搜索" class="headerlink" title="周边搜索"></a>周边搜索</h4><p>通过周边搜索服务，您可以在某个地点附近进行搜索，也可以在某一个特定结果点周围进行搜索。<br>下面示例展示如何在前门附近搜索小吃： </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);   </span><br><span class="line"><span class="keyword">var</span> local = <span class="keyword">new</span> BMap.LocalSearch(map, &#123;  </span><br><span class="line">renderOptions:&#123;<span class="attr">map</span>: map, <span class="attr">autoViewport</span>: <span class="literal">true</span>&#125;  </span><br><span class="line">&#125;);  </span><br><span class="line">local.searchNearby(<span class="string">"小吃"</span>, <span class="string">"前门"</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="范围搜索"><a href="#范围搜索" class="headerlink" title="范围搜索"></a>范围搜索</h4><p>范围搜索将根据您提供的视野范围提供搜索结果。注意：当搜索范围过大时可能会出现无结果的情况。<br>下面示例展示在当前地图视野范围内搜索银行：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">14</span>);  </span><br><span class="line"><span class="keyword">var</span> local = <span class="keyword">new</span> BMap.LocalSearch(map, &#123;  </span><br><span class="line">renderOptions:&#123;<span class="attr">map</span>: map&#125;  </span><br><span class="line">&#125;);  </span><br><span class="line">local.searchInBounds(<span class="string">"银行"</span>, map.getBounds());</span><br></pre></td></tr></table></figure></div>

<h4 id="公交导航"><a href="#公交导航" class="headerlink" title="公交导航"></a>公交导航</h4><p>BMap.TransitRoute类提供公交导航搜索服务。和本地搜索类似，在搜索之前需要指定搜索区域，注意公交导航的区域范围只能是市，而不能是省。如果搜索区域为BMap.Map对象，路线结果会自动添加到地图上。如果您提供了结果容器，相应的路线描述也会展示在页面上。<br>下面示例展示了如何使用公交导航服务： </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">14</span>);   </span><br><span class="line"><span class="keyword">var</span> transit = <span class="keyword">new</span> BMap.TransitRoute(map, &#123;  </span><br><span class="line">renderOptions: &#123;<span class="attr">map</span>: map&#125;  </span><br><span class="line">&#125;);  </span><br><span class="line">transit.search(<span class="string">"王府井"</span>, <span class="string">"西单"</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="结果面板"><a href="#结果面板" class="headerlink" title="结果面板"></a>结果面板</h4><p>您可以提供用于展示文字结果的容器元素，方案结果会自动在页面中展现：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">14</span>);  </span><br><span class="line"><span class="keyword">var</span> transit = <span class="keyword">new</span> BMap.TransitRoute(map, &#123;  </span><br><span class="line">renderOptions: &#123;<span class="attr">map</span>: map, <span class="attr">panel</span>: <span class="string">"results"</span>&#125;  </span><br><span class="line">&#125;);  </span><br><span class="line">transit.search(<span class="string">"王府井"</span>, <span class="string">"西单"</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="数据接口-1"><a href="#数据接口-1" class="headerlink" title="数据接口"></a>数据接口</h4><p>您可通过数据接口获取详细的公交方案信息。公交导航搜索结果用BMap.TransitRouteResult来表示，其中包含了若干公交出行方案（BMap.TransitRoutePlan）。每条出行方案由步行线路和公交线路组成。 在起点到上车点之间、下车点到终点之间以及每个换乘站之间都会存在步行线路，如果上述的某两点位置重合，那么其间的步行路线长度为0。<br>在下面示例中，通过数据接口将第一条方案的路线添加到地图上，并将所有方案的描述信息输出到页面上 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">12</span>);  </span><br><span class="line"><span class="keyword">var</span> transit = <span class="keyword">new</span> BMap.TransitRoute(<span class="string">"北京市"</span>);  </span><br><span class="line">transit.setSearchCompleteCallback(<span class="function"><span class="keyword">function</span>(<span class="params">results</span>)</span>&#123;  </span><br><span class="line"><span class="keyword">if</span> (transit.getStatus() == BMAP_STATUS_SUCCESS)&#123;  </span><br><span class="line"><span class="keyword">var</span> firstPlan = results.getPlan(<span class="number">0</span>);  </span><br><span class="line"><span class="comment">// 绘制步行线路  </span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; firstPlan.getNumRoutes(); i ++)&#123;  </span><br><span class="line">    <span class="keyword">var</span> walk = firstPlan.getRoute(i);  </span><br><span class="line">    <span class="keyword">if</span> (walk.getDistance(<span class="literal">false</span>) &gt; <span class="number">0</span>)&#123;  </span><br><span class="line">     <span class="comment">// 步行线路有可能为0  </span></span><br><span class="line">     map.addOverlay(<span class="keyword">new</span> BMap.Polyline(walk.getPoints(), &#123;<span class="attr">lineColor</span>: <span class="string">"green"</span>&#125;));  </span><br><span class="line">   &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="comment">// 绘制公交线路  </span></span><br><span class="line">   <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; firstPlan.getNumLines(); i ++)&#123;  </span><br><span class="line">    <span class="keyword">var</span> line = firstPlan.getLine(i);  </span><br><span class="line">    map.addOverlay(<span class="keyword">new</span> BMap.Polyline(line.getPoints()));  </span><br><span class="line">   &#125;  </span><br><span class="line"><span class="comment">// 输出方案信息  </span></span><br><span class="line"><span class="keyword">var</span> s = [];  </span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; results.getNumPlans(); i ++)&#123;  </span><br><span class="line">s.push((i + <span class="number">1</span>) + <span class="string">". "</span> + results.getPlan(i).getDescription());  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"log"</span>).innerHTML = s.join(<span class="string">"&lt;BR&gt;"</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;)  </span><br><span class="line">transit.search(<span class="string">"中关村"</span>, <span class="string">"国贸桥"</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="驾车导航"><a href="#驾车导航" class="headerlink" title="驾车导航"></a>驾车导航</h4><p>BMap.DrivingRoute提供驾车导航服务。与公交导航不同的是，驾车导航的搜索范围可以设置为省。<br>下面示例展示了如何使用驾车导航接口： </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">14</span>);  </span><br><span class="line"><span class="keyword">var</span> driving = <span class="keyword">new</span> BMap.DrivingRoute(map, &#123;  </span><br><span class="line">	renderOptions: &#123;  </span><br><span class="line">		map: map,  </span><br><span class="line">		autoViewport: <span class="literal">true</span> </span><br><span class="line">	&#125;  </span><br><span class="line">&#125;);  </span><br><span class="line">driving.search(<span class="string">"中关村"</span>, <span class="string">"天安门"</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="结果面板-1"><a href="#结果面板-1" class="headerlink" title="结果面板"></a>结果面板</h4><p>下面示例中，我们提供了结果面板参数，方案描述会自动展示到页面上。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);</span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">14</span>);  </span><br><span class="line"><span class="keyword">var</span> driving = <span class="keyword">new</span> BMap.DrivingRoute(map, &#123;  </span><br><span class="line">renderOptions: &#123;  </span><br><span class="line">	map  : map,  </span><br><span class="line">	panel : <span class="string">"results"</span>,  </span><br><span class="line">	autoViewport: <span class="literal">true</span> </span><br><span class="line">&#125;  </span><br><span class="line">&#125;);  </span><br><span class="line">driving.search(<span class="string">"中关村"</span>, <span class="string">"天安门"</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="数据接口-2"><a href="#数据接口-2" class="headerlink" title="数据接口"></a>数据接口</h4><p>驾车导航服务提供了丰富的数据接口，通过onSearchComplete回调函数得到BMap.DrivingRouteResult对象，它包含了驾车导航结果数据信息。 结果会包含若干驾车方案（目前仅一条方案），每条方案中包含了若干驾车线路（如果导航方案只包含一个目的地，那么驾车线路的个数就为1，如果方案包含若干个目的地，则驾车线路的个数会大于1。目前API尚不支持多个目的地的驾车导航）。 每条驾车线路又会包含一系列的关键步骤（BMap.Step），关键步骤描述了具体驾车行驶方案，可通过BMap.Step.getDescription()方法获得。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">14</span>);   </span><br><span class="line"><span class="keyword">var</span> options = &#123;  </span><br><span class="line">onSearchComplete: <span class="function"><span class="keyword">function</span>(<span class="params">results</span>)</span>&#123;  </span><br><span class="line"><span class="keyword">if</span> (driving.getStatus() == BMAP_STATUS_SUCCESS)&#123;  </span><br><span class="line"><span class="comment">// 获取第一条方案  </span></span><br><span class="line"><span class="keyword">var</span> plan = results.getPlan(<span class="number">0</span>);   </span><br><span class="line"><span class="comment">// 获取方案的驾车线路  </span></span><br><span class="line"><span class="keyword">var</span> route = plan.getRoute(<span class="number">0</span>);  </span><br><span class="line"><span class="comment">// 获取每个关键步骤，并输出到页面  </span></span><br><span class="line"><span class="keyword">var</span> s = [];  </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; route.getNumSteps(); i ++)&#123;  </span><br><span class="line"><span class="keyword">var</span> step = route.getStep(i);  </span><br><span class="line">s.push((i + <span class="number">1</span>) + <span class="string">". "</span> + step.getDescription());  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"log"</span>).innerHTML = s.join(<span class="string">"&lt;BR&gt;"</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;  </span><br><span class="line"> &#125;;  </span><br><span class="line"><span class="keyword">var</span> driving = <span class="keyword">new</span> BMap.DrivingRoute(map, options);  </span><br><span class="line">driving.search(<span class="string">"中关村"</span>, <span class="string">"天安门"</span>);</span><br></pre></td></tr></table></figure></div>

<p>步行导航接口在使用上与驾车导航一致，具体请参考API文档。 </p>
<h4 id="地址解析"><a href="#地址解析" class="headerlink" title="地址解析"></a>地址解析</h4><p>地址解析能够将地址信息转换为地理坐标点信息。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);  </span><br><span class="line"><span class="comment">// 创建地址解析器实例  </span></span><br><span class="line"><span class="keyword">var</span> myGeo = <span class="keyword">new</span> BMap.Geocoder();  </span><br><span class="line"><span class="comment">// 将地址解析结果显示在地图上，并调整地图视野  </span></span><br><span class="line">myGeo.getPoint(<span class="string">"北京市海淀区上地10街10号"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">point</span>)</span>&#123;  </span><br><span class="line"><span class="keyword">if</span> (point) &#123;  </span><br><span class="line">map.centerAndZoom(point, <span class="number">16</span>);  </span><br><span class="line">map.addOverlay(<span class="keyword">new</span> BMap.Marker(point));  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;, <span class="string">"北京市"</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="实时路况"><a href="#实时路况" class="headerlink" title="实时路况"></a>实时路况</h4><p>实时路况以控件的形式供调用者使用，您仅需要实例化一个控件实例并添加到地图上即可。 </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"container"</span>);  </span><br><span class="line">map.centerAndZoom(<span class="keyword">new</span> BMap.Point(<span class="number">116.404</span>, <span class="number">39.915</span>), <span class="number">11</span>);  </span><br><span class="line"><span class="comment">// 添加实时路况控件  </span></span><br><span class="line">map.addControl(<span class="keyword">new</span> BMap.TrafficControl());</span><br></pre></td></tr></table></figure></div>

<p><strong>定义一个控件类，即function</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ZoomControl</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="comment">// 设置默认停靠位置和偏移量</span></span><br><span class="line"> <span class="keyword">this</span>.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;</span><br><span class="line"> <span class="keyword">this</span>.defaultOffset = <span class="keyword">new</span> BMap.Size(<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><strong>通过JavaScript的prototype属性继承于BMap.Control</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">ZoomControl.prototype = <span class="keyword">new</span> BMap.Control();</span><br></pre></td></tr></table></figure></div>

<p><strong>自定义控件必须实现自己的initialize方法，并且将控件的DOM元素返回</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在本方法中创建个div元素作为控件的容器，并将其添加到地图容器中</span></span><br><span class="line">ZoomControl.prototype.initialize = <span class="function"><span class="keyword">function</span>(<span class="params">map</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 创建一个DOM元素</span></span><br><span class="line"> <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 添加文字说明</span></span><br><span class="line"> div.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">"放大2级"</span>));</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 设置样式</span></span><br><span class="line"> div.style.cursor = <span class="string">"pointer"</span>;</span><br><span class="line"> div.style.border = <span class="string">"1px solid gray"</span>;</span><br><span class="line"> div.style.backgroundColor = <span class="string">"white"</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 绑定事件，点击一次放大两级</span></span><br><span class="line"> div.onclick = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">  map.zoomTo(map.getZoom() + <span class="number">2</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 添加DOM元素到地图中</span></span><br><span class="line"> map.getContainer().appendChild(div);</span><br><span class="line"> <span class="comment">// 将DOM元素返回</span></span><br><span class="line"> <span class="keyword">return</span> div;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建控件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myZoomCtrl = <span class="keyword">new</span> ZoomControl();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加到地图当中</span></span><br><span class="line">map.addControl(myZoomCtrl);</span><br></pre></td></tr></table></figure></div>



]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>百度地图</tag>
      </tags>
  </entry>
  <entry>
    <title>计算某年某月某一天是第几天</title>
    <url>/Python/Python_id_04.html</url>
    <content><![CDATA[<p>　实现输入某年某月某日计算出这一天是该年第几天的方法</p>
<a id="more"></a>

<h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">list_day = [<span class="number">0</span>,<span class="number">31</span>,<span class="number">28</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>]</span><br><span class="line">year = int(input(<span class="string">'请输入年'</span>))</span><br><span class="line">month = int(input(<span class="string">'请输入月'</span>))</span><br><span class="line">day = int(input(<span class="string">'请输入日'</span>))</span><br><span class="line">month_day = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> <span class="number">0</span>&lt;month&lt;=<span class="number">12</span>:</span><br><span class="line">    <span class="keyword">if</span> year % <span class="number">400</span> == <span class="number">0</span> <span class="keyword">or</span> ((year % <span class="number">4</span> ==<span class="number">0</span>) <span class="keyword">and</span> (year % <span class="number">100</span> != <span class="number">0</span>)):</span><br><span class="line">        print(<span class="string">'&#123;&#125;是闰年'</span>.format(year))</span><br><span class="line">        list_day[<span class="number">1</span>] = <span class="number">29</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(month<span class="number">-1</span>):</span><br><span class="line">            month_day += list_day[i]</span><br><span class="line">        <span class="keyword">if</span> day &lt;= list_day[month]:</span><br><span class="line">            count_day = month_day + day</span><br><span class="line">            print(count_day)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'day error'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(month):</span><br><span class="line">            month_day += list_day[i]</span><br><span class="line">        <span class="keyword">if</span> day &lt;= list_day[month]:</span><br><span class="line">            count_day = month_day + day</span><br><span class="line">            print(count_day)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'day error'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'month error'</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">list_day = [<span class="number">0</span>,<span class="number">31</span>,<span class="number">28</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">30</span>,<span class="number">31</span>]</span><br><span class="line">year = int(input(<span class="string">'请输入年'</span>))</span><br><span class="line">month = int(input(<span class="string">'请输入月'</span>))</span><br><span class="line">day = int(input(<span class="string">'请输入日'</span>))</span><br><span class="line"><span class="keyword">if</span> <span class="number">0</span>&lt; month &lt;=<span class="number">12</span>:</span><br><span class="line">    sum = list_day[month<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'data error'</span>)</span><br><span class="line">sum += day</span><br><span class="line"></span><br><span class="line">leap = <span class="number">0</span> <span class="comment">#</span></span><br><span class="line"><span class="keyword">if</span> year % <span class="number">400</span> == <span class="number">0</span> <span class="keyword">or</span> ((year % <span class="number">4</span> ==<span class="number">0</span>) <span class="keyword">and</span> (year % <span class="number">100</span> != <span class="number">0</span>)):</span><br><span class="line">    leap = <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> leap == <span class="number">1</span> <span class="keyword">and</span> month &gt; <span class="number">2</span>:</span><br><span class="line">    sum += <span class="number">1</span></span><br><span class="line">print(sum)</span><br></pre></td></tr></table></figure></div>

<h3 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接使用Python内置模块datetime的格式转换功能得到结果</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function2</span><span class="params">(year, month, day)</span>:</span></span><br><span class="line">    date = datetime.date(year, month, day)</span><br><span class="line">    <span class="comment"># 返回结果</span></span><br><span class="line">    <span class="keyword">return</span> int(date.strftime(<span class="string">'%j'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 捕获异常，避免输入错误直接造成程序崩溃</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 输入查询的信息</span></span><br><span class="line">            year = int(input(<span class="string">"请输入年份:"</span>))</span><br><span class="line">            month = int(input(<span class="string">"请输入月份:"</span>))</span><br><span class="line">            day = int(input(<span class="string">"请输入日期:"</span>))</span><br><span class="line">            <span class="comment"># 调用函数，输出结果</span></span><br><span class="line">            print(function2(year, month, day))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># 输出异常</span></span><br><span class="line">            print(<span class="string">"输入有误"</span>)</span><br><span class="line">            <span class="comment"># 停止循环</span></span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>redis持久化</title>
    <url>/Redis/Redis_id_01.html</url>
    <content><![CDATA[<p>redis是一个内存数据库，数据保存在内存中，但是我们都知道内存的数据变化是很快的，也容易发生丢失。幸好Redis还为我们提供了持久化的机制，分别是RDB(Redis DataBase)和AOF(Append Only File)。</p>
<a id="more"></a>

<p><strong>一、持久化流程</strong></p>
<p>既然redis的数据可以保存在磁盘上，那么这个流程是什么样的呢？</p>
<p>要有下面五个过程：</p>
<p>（1）客户端向服务端发送写操作(数据在客户端的内存中)。</p>
<p>（2）数据库服务端接收到写请求的数据(数据在服务端的内存中)。</p>
<p>（3）服务端调用write这个系统调用，将数据往磁盘上写(数据在系统内存的缓冲区中)。</p>
<p>（4）操作系统将缓冲区中的数据转移到磁盘控制器上(数据在磁盘缓存中)。</p>
<p>（5）磁盘控制器将数据写到磁盘的物理介质中(数据真正落到磁盘上)。</p>
<p>这5个过程是在理想条件下一个正常的保存流程，但是在大多数情况下，我们的机器等等都会有各种各样的故障，这里划分了两种情况：</p>
<p>（1）Redis数据库发生故障，只要在上面的第三步执行完毕，那么就可以持久化保存，剩下的两步由操作系统替我们完成。</p>
<p>（2）操作系统发生故障，必须上面5步都完成才可以。</p>
<p>在这里只考虑了保存的过程可能发生的故障，其实保存的数据也有可能发生损坏，需要一定的恢复机制，不过在这里就不再延伸了。现在主要考虑的是redis如何来实现上面5个保存磁盘的步骤。它提供了两种策略机制，也就是RDB和AOF。</p>
<p><strong>二、RDB机制</strong></p>
<p>RDB其实就是把数据以快照的形式保存在磁盘上。什么是快照呢，你可以理解成把当前时刻的数据拍成一张照片保存下来。</p>
<p>RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘。也是默认的持久化方式，这种方式是就是将内存中数据以快照的方式写入到二进制文件中,默认的文件名为dump.rdb。</p>
<p>在我们安装了redis之后，所有的配置都是在redis.conf文件中，里面保存了RDB和AOF两种持久化机制的各种配置。</p>
<p>既然RDB机制是通过把某个时刻的所有数据生成一个快照来保存，那么就应该有一种触发机制，是实现这个过程。对于RDB来说，提供了三种机制：save、bgsave、自动化。我们分别来看一下</p>
<p><strong>1、save触发方式</strong></p>
<p>该命令会阻塞当前Redis服务器，执行save命令期间，Redis不能处理其他命令，直到RDB过程完成为止。具体流程如下：</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/redis7.jpeg">

<p>执行完成时候如果存在老的RDB文件，就把新的替代掉旧的。我们的客户端可能都是几万或者是几十万，这种方式显然不可取。</p>
<p><strong>2、bgsave触发方式</strong></p>
<p>执行该命令时，Redis会在后台异步进行快照操作，快照同时还可以响应客户端请求。具体流程如下：</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/reis2.jpeg">

<p>具体操作是Redis进程执行fork操作创建子进程，RDB持久化过程由子进程负责，完成后自动结束。阻塞只发生在fork阶段，一般时间很短。基本上 Redis 内部所有的RDB操作都是采用 bgsave 命令。</p>
<p><strong>3、自动触发</strong></p>
<p>自动触发是由我们的配置文件来完成的。在redis.conf配置文件中，里面有如下配置，我们可以去设置：</p>
<p><strong>①save：</strong>这里是用来配置触发 Redis的 RDB 持久化条件，也就是什么时候将内存中的数据保存到硬盘。比如“save m n”。表示m秒内数据集存在n次修改时，自动触发bgsave。</p>
<p>默认如下配置：</p>
<p>#表示900 秒内如果至少有 1 个 key 的值变化，则保存save 900 1#表示300 秒内如果至少有 10 个 key 的值变化，则保存save 300 10#表示60 秒内如果至少有 10000 个 key 的值变化，则保存save 60 10000</p>
<p>不需要持久化，那么你可以注释掉所有的 save 行来停用保存功能。</p>
<p><strong>②stop-writes-on-bgsave-error ：</strong>默认值为yes。当启用了RDB且最后一次后台保存数据失败，Redis是否停止接收数据。这会让用户意识到数据没有正确持久化到磁盘上，否则没有人会注意到灾难（disaster）发生了。如果Redis重启了，那么又可以重新开始接收数据了</p>
<p><strong>③rdbcompression ；</strong>默认值是yes。对于存储到磁盘中的快照，可以设置是否进行压缩存储。</p>
<p><strong>④rdbchecksum ：</strong>默认值是yes。在存储快照后，我们还可以让redis使用CRC64算法来进行数据校验，但是这样做会增加大约10%的性能消耗，如果希望获取到最大的性能提升，可以关闭此功能。</p>
<p><strong>⑤dbfilename ：</strong>设置快照的文件名，默认是 dump.rdb</p>
<p><strong>⑥dir：</strong>设置快照文件的存放路径，这个配置项一定是个目录，而不能是文件名。</p>
<p>我们可以修改这些配置来实现我们想要的效果。因为第三种方式是配置的，所以我们对前两种进行一个对比：</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/save.jpeg">

<p><strong>4、RDB 的优势和劣势</strong></p>
<p>①、优势</p>
<p>（1）RDB文件紧凑，全量备份，非常适合用于进行备份和灾难恢复。</p>
<p>（2）生成RDB文件的时候，redis主进程会fork()一个子进程来处理所有保存工作，主进程不需要进行任何磁盘IO操作。</p>
<p>（3）RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快。</p>
<p>②、劣势</p>
<p>RDB快照是一次全量备份，存储的是内存数据的二进制序列化形式，存储上非常紧凑。当进行快照持久化时，会开启一个子进程专门负责快照持久化，子进程会拥有父进程的内存数据，父进程修改内存子进程不会反应出来，所以在快照持久化期间修改的数据不会被保存，可能丢失数据。</p>
<p><strong>三、AOF机制</strong></p>
<p>全量备份总是耗时的，有时候我们提供一种更加高效的方式AOF，工作机制很简单，redis会将每一个收到的写命令都通过write函数追加到文件中。通俗的理解就是日志记录。</p>
<p><strong>1、持久化原理</strong></p>
<p>他的原理看下面这张图：</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/redis4.jpeg">

<p>每当有一个写命令过来时，就直接保存在我们的AOF文件中。</p>
<p><strong>2、文件重写原理</strong></p>
<p>AOF的方式也同时带来了另一个问题。持久化文件会变的越来越大。为了压缩aof的持久化文件。redis提供了bgrewriteaof命令。将内存中的数据以命令的方式保存到临时文件中，同时会fork出一条新进程来将文件重写。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/reis2.jpeg">

<p>重写aof文件的操作，并没有读取旧的aof文件，而是将整个内存中的数据库内容用命令的方式重写了一个新的aof文件，这点和快照有点类似。</p>
<p><strong>3、AOF也有三种触发机制</strong></p>
<p>（1）每修改同步always：同步持久化 每次发生数据变更会被立即记录到磁盘 性能较差但数据完整性比较好</p>
<p>（2）每秒同步everysec：异步操作，每秒记录 如果一秒内宕机，有数据丢失</p>
<p>（3）不同no：从不同步</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/redis6.jpeg">

<p><strong>4、优点</strong></p>
<p>（1）AOF可以更好的保护数据不丢失，一般AOF会每隔1秒，通过一个后台线程执行一次fsync操作，最多丢失1秒钟的数据。（2）AOF日志文件没有任何磁盘寻址的开销，写入性能非常高，文件不容易破损。</p>
<p>（3）AOF日志文件即使过大的时候，出现后台重写操作，也不会影响客户端的读写。</p>
<p>（4）AOF日志文件的命令通过非常可读的方式进行记录，这个特性非常适合做灾难性的误删除的紧急恢复。比如某人不小心用flushall命令清空了所有数据，只要这个时候后台rewrite还没有发生，那么就可以立即拷贝AOF文件，将最后一条flushall命令给删了，然后再将该AOF文件放回去，就可以通过恢复机制，自动恢复所有数据</p>
<p><strong>5、缺点</strong></p>
<p>（1）对于同一份数据来说，AOF日志文件通常比RDB数据快照文件更大</p>
<p>（2）AOF开启后，支持的写QPS会比RDB支持的写QPS低，因为AOF一般会配置成每秒fsync一次日志文件，当然，每秒一次fsync，性能也还是很高的</p>
<p>（3）以前AOF发生过bug，就是通过AOF记录的日志，进行数据恢复的时候，没有恢复一模一样的数据出来。</p>
<p><strong>四、RDB和AOF到底该如何选择</strong></p>
<p>选择的话，两者加一起才更好。因为两个持久化机制你明白了，剩下的就是看自己的需求了，需求不同选择的也不一定，但是通常都是结合使用。有一张图可供总结：</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/redis5.jpeg">

<p>结束。</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>redis数据淘汰机制</title>
    <url>/Redis/Redis_id_03.html</url>
    <content><![CDATA[<h2 id="过期策略"><a href="#过期策略" class="headerlink" title="过期策略"></a>过期策略</h2><p>　　我们set key的时候，都可以给一个expire time，就是过期时间，指定这个key比如说只能存活1个小时，我们自己可以指定缓存到期就失效。<br>　　如果假设你设置一个一批key只能存活1个小时，那么接下来1小时后，redis是怎么对这批key进行删除的？<br>　　答案是：定期删除+惰性删除</p>
<a id="more"></a>

<p>　　所谓定期删除，指的是redis默认是每隔100ms就随机抽取一些设置了过期时间的key，检查其是否过期，如果过期就删除。<br>　　注意，这里可不是每隔100ms就遍历所有的设置过期时间的key，那样就是一场性能上的灾难。<br>　　实际上redis是每隔100ms随机抽取一些key来检查和删除的。<br>　　但是，定期删除可能会导致很多过期key到了时间并没有被删除掉，所以就得靠惰性删除了。<br>　　这就是说，在你获取某个key的时候，redis会检查一下 ，这个key如果设置了过期时间那么是否过期了？如果过期了此时就会删除，不会给你返回任何东西。<br>　　并不是key到时间就被删除掉，而是你查询这个key的时候，redis再懒惰的检查一下<br>　　通过上述两种手段结合起来，保证过期的key一定会被干掉。<br>　　但是实际上这还是有问题的，如果定期删除漏掉了很多过期key，然后你也没及时去查，也就没走惰性删除，此时会怎么样？<br>　　如果大量过期key堆积在内存里，导致redis内存块耗尽了，怎么办？<br>　　答案是：走内存淘汰机制。</p>
<h2 id="内存淘汰机制"><a href="#内存淘汰机制" class="headerlink" title="内存淘汰机制"></a>内存淘汰机制</h2><p>　　如果redis的内存占用过多的时候，此时会进行内存淘汰，有如下一些策略：<br>　　noeviction：当内存不足以容纳新写入数据时，新写入操作会报错，这个一般没人用吧<br>　　allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key（这个是最常用的）<br>　　allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个key，这个一般没人用吧<br>　　volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的key（这个一般不太合适）<br>　　volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个key<br>　　volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的key优先移除</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>redis优化</title>
    <url>/Redis/Redis_id_05.html</url>
    <content><![CDATA[<h4 id="内存管理优化"><a href="#内存管理优化" class="headerlink" title="内存管理优化"></a>内存管理优化</h4><p>Redis Hash是value内部为一个HashMap，如果该Map的成员数比较少，则会采用类似一维线性的紧凑格式来存储该Map, 即省去了大量指针的内存开销，这个参数控制对应在redis.conf配置文件中下面2项：</p>
<a id="more"></a>

<p><strong>hash-max-zipmap-entries 64 hash-max-zipmap-value 512</strong>    </p>
<p>当value这个Map内部不超过多少个成员时会采用线性紧凑格式存储，默认是64,即value内部有64个以下的成员就是使用线性紧凑存储，超过该值自动转成真正的HashMap。</p>
<p><strong>hash-max-zipmap-value</strong> 含义是当 value这个Map内部的每个成员值长度不超过多少字节就会采用线性紧凑存储来节省空间。</p>
<p>以上2个条件任意一个条件超过设置值都会转换成真正的HashMap，也就不会再节省内存了，那么这个值是不是设置的越大越好呢，答案当然是否定的，HashMap的优势就是查找和操作的时间复杂度都是O(1)的，而放弃Hash采用一维存储则是O(n)的时间复杂度，如果</p>
<p>成员数量很少，则影响不大，否则会严重影响性能，所以要权衡好这个值的设置，总体上还是最根本的时间成本和空间成本上的权衡。</p>
<p><strong>list-max-ziplist-value 64 list-max-ziplist-entries 512</strong>    </p>
<p>list数据类型节点值大小小于多少字节会采用紧凑存储格式、list数据类型多少节点以下会采用去指针的紧凑存储格式。</p>
<h4 id="内存预分配："><a href="#内存预分配：" class="headerlink" title="内存预分配："></a>内存预分配：</h4><p>Redis内部实现没有对内存分配方面做过多的优化（对比Memcache），在一定程度上会存在内存碎片，不过大多数情况下这个不会成为Redis的性能瓶颈，不过如果在Redis内部存储的大部分数据是数值型的话，Redis内部采用了一个shared integer的 方式来省去分配内存的开销，即在系统启动时先分配一个从1~n 那么多个数值对象放在一个池子中，如果存储的数据恰好是这个数值范围内的数据，则直接从池子里取出该对象，并且通过引用计数的方式来共享，这样在系统存储 了大量数值下，也能一定程度上节省内存并且提高性能，这个参数值n的设置需要修改源代码中的一行宏定义REDIS_SHARED_INTEGERS，该值 默认是10000，可以根据自己的需要进行修改，修改后重新编译就可以了。</p>
<h4 id="持久化机制："><a href="#持久化机制：" class="headerlink" title="持久化机制："></a>持久化机制：</h4><p><strong>定时快照方式(snapshot)：</strong></p>
<p>该持久化方式实际是在Redis内部一个定时器事件，每隔固定时间去检查当前数据发生的改变次数与时间是否满足配置的持久化触发的条件，如果满足则通 过操作系统fork调用来创建出一个子进程，这个子进程默认会与父进程共享相同的地址空间，这时就可以通过子进程来遍历整个内存来进行存储操作，而主进程 则仍然可以提供服务，当有写入时由操作系统按照内存页(page)为单位来进行copy-on-write保证父子进程之间不会互相影响。</p>
<p>该持久化的主要缺点是定时快照只是代表一段时间内的内存映像，所以系统重启会丢失上次快照与重启之间所有的数据。</p>
<p><strong>基于语句追加方式(aof)：</strong></p>
<p>aof方式实际类似mysql的基于语句的binlog方式，即每条会使Redis内存数据发生改变的命令都会追加到一个log文件中，也就是说这个log文件就是Redis的持久化数据。</p>
<p>aof的方式的主要缺点是追加log文件可能导致体积过大，当系统重启恢复数据时如果是aof的方式则加载数据会非常慢，几十G的数据可能需要几小时才能加载完，当然这个耗时并不是因为磁盘文件读取速度慢，而是由于读取的所有命令都要在内存中执行一遍。另外由于每条命令都要写log,所以使用aof的方式，Redis的读写性能也会有所下降。</p>
<p>可以考虑将数据保存到不同的Redis实例中，每个实例的内存大小在2G左右，避免将鸡蛋放到一个篮子里，既可以减少缓存失效给系统带来的影响，又可以加快数据恢复的速度，不过同时也给系统设计带来了一定的复杂性。</p>
<h4 id="Redis持久化崩溃问题："><a href="#Redis持久化崩溃问题：" class="headerlink" title="Redis持久化崩溃问题："></a>Redis持久化崩溃问题：</h4><p>有Redis线上运维经验的人会发现Redis在物理内存使用比较多，但还没有超过实际物理内存总容量时就会发生不稳定甚至崩溃的 问题，有人认为是基于快照方式持久化的fork系统调用造成内存占用加倍而导致的，这种观点是不准确的，因为fork 调用的copy-on-write机制是基于操作系统页这个单位的，也就是只有有写入的脏页会被复制，但是一般你的系统不会在短时间内所有的页都发生了写 入而导致复制，那么是什么原因导致Redis崩溃的呢？</p>
<p>答案是Redis的持久化使用了Buffer IO造 成的，所谓Buffer IO是指Redis对持久化文件的写入和读取操作都会使用物理内存的Page Cache,而大多数数据库系统会使用Direct IO来绕过这层Page Cache并自行维护一个数据的Cache，而当Redis的持久化文件过大(尤其是快照文件)，并对其进行读写时，磁盘文件中的数据都会被加载到物理内 存中作为操作系统对该文件的一层Cache,而这层Cache的数据与Redis内存中管理的数据实际是重复存储的，虽然内核在物理内存紧张时会做 Page Cache的剔除工作，但内核很可能认为某块Page Cache更重要，而让你的进程开始Swap ,这时你的系统就会开始出现不稳定或者崩溃了。我们的经验是当你的Redis物理内存使用超过内存总容量的3/5时就会开始比较危险了。</p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p><strong>1、</strong>根据业务需要选择合适的数据类型，并为不同的应用场景设置相应的紧凑存储参数。</p>
<p><strong>2、</strong>当业务场景不需要数据持久化时，关闭所有的持久化方式可以获得最佳的性能以及最大的内存使用量。</p>
<p><strong>3、</strong>如果需要使用持久化，根据是否可以容忍重启丢失部分数据在快照方式与语句追加方式之间选择其一，不要使用虚拟内存以及diskstore方式。</p>
<p><strong>4、</strong>不要让你的Redis所在机器物理内存使用超过实际内存总量的3/5。</p>
<p>redis.conf中的maxmemory选项，该选项是告诉Redis当使用了多少物理内存后就开始拒绝后续的写入请求，该参数能很好的保护好你的Redis不会因为使用了过多的物理内存而导致swap,最终严重影响性能甚至崩溃。</p>
<p>redis.conf文件中 vm-enabled 为 no</p>
<p>以上这篇Redis优化经验总结(必看篇)就是小编分享给大家的全部内容了，希望能给大家一个参考，也希望大家多多支持脚本之家。</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>redis雪崩、击穿、穿透</title>
    <url>/Redis/Redis_id_04.html</url>
    <content><![CDATA[<h2 id="redis穿透"><a href="#redis穿透" class="headerlink" title="redis穿透"></a>redis穿透</h2><p>　　　　1、查询一个一定不存在的数据，由于缓存是不命中时被动写的，并且出于容错考虑，如果从存储层查不到数据则不写入缓存<br>　　　　2、这将导致这个不存在的数据每次请求都要到存储层去查询，失去了缓存的意义<br>　　　　3、在流量大时，可能DB就挂掉了，要是有人利用不存在的key频繁攻击我们的应用，这就是漏洞。</p>
<a id="more"></a>

<p>　　<strong>发生场景：</strong></p>
<p>　　　　对于系统A，假设一秒 5000 个请求，结果其中 4000 个请求是黑客发出的恶意攻击。<br>　　　　黑客发出的那 4000 个攻击，缓存中查不到，每次你去数据库里查，也查不到。<br>　　　　举个例子：数据库 id 是从 1 开始的，结果黑客发过来的请求 id 全部都是负数。这样的话，缓存中不会有，请求每次都“视缓存于无物”，<br>　　　　直接查询数据库。这种恶意攻击场景的缓存穿透就会直接把数据库给打死。</p>
<p>　　<strong>解决方案</strong></p>
<p>　　　　1、有很多种方法可以有效地解决缓存穿透问题，最常见的则是采用布隆过滤器，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数<br>　　　　　　据会被这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。<br>　　　　2、另外也有一个更为简单粗暴的方法，如果一个查询返回的数据为空（不管是数据不存在，还是系统故障），我们仍然把这个空结果进行<br>　　　　　　缓存，但它的过期时间会很短，最长不超过五分钟。</p>
<h2 id="redis雪崩"><a href="#redis雪崩" class="headerlink" title="redis雪崩"></a>redis雪崩</h2><p>　　　　1、缓存中大批量热点数据过期后系统涌入大量查询请求<br>　　　　2、因为大部分数据在Redis层已经失效，请求渗透到数据库层<br>　　　　3、大批量请求犹如洪水一般涌入，引起数据库压力造成查询堵塞甚至宕机。</p>
<p>　　<strong>发生场景</strong></p>
<p>　　　　对于系统 A，假设每天高峰期每秒 5000 个请求，本来缓存在高峰期可以扛住每秒 4000 个请求，但是缓存机器意外发生了全盘宕机，缓存挂了。<br>　　　　此时 1 秒 5000 个请求全部落数据库，数据库必然扛不住，它会报一下警，然后就挂了。<br>　　　　此时，如果没有采用什么特别的方案来处理这个故障，DBA 很着急，重启数据库，但是数据库立马又被新的流量给打死了。
　　</p>
<p><strong>解决方案</strong></p>
<p>　　　　1、事前：redis 高可用，主从+哨兵，redis cluster，避免全盘崩溃<br>　　　　2、事中：本地 ehcache 缓存 + hystrix 限流&amp;降级，避免 MySQL 被打死。<br>　　　　3、事后：redis 持久化，一旦重启，自动从磁盘上加载数据，快速恢复缓存数据。<br>　　　　4、用户发送一个请求，系统 A 收到请求后，先查本地 ehcache 缓存，如果没查到再查 redis。如果 ehcache 和 redis 都没有，再查数据库，<br>　　　　　　将数据库中的结果，写入 ehcache 和 redis 中。<br>　　　　5、 限流组件，可以设置每秒的请求，有多少能通过组件，剩余的未通过的请求，怎么办？走降级！可以返回一些默认的值，或者友情提示，或者<br>　　　　　　空白的值。这样可以保证数据库绝对不会死，限流组件确保了每秒只有多少个请求能通过。 -只要数据库不死，就是说，对用户来说，2/5 的请求都是可以被<br>　　　　　　处理的。 - 只要有 2/5 的请求可以被处理，就意味着你的系统没死，对用户来说，可能就是点击几次刷不出来页面，但是多点几次，就可以刷出来一次。</p>
<h2 id="redis击穿"><a href="#redis击穿" class="headerlink" title="redis击穿"></a>redis击穿</h2><p>　　　　1、就是说某个 key 非常热点，访问非常频繁，处于集中式高并发访问的情况<br>　　　　2、当这个 key 在失效的瞬间，大量的请求就击穿了缓存，直接请求数据库，就像是在一道屏障上凿开了一个洞。<br>　　　　3、击穿和缓存雪崩的区别在于击穿针对某一key缓存，雪崩则是很多key</p>
<p>　　<strong>发生场景</strong></p>
<p>　　　　秒杀现场，在同一时间高频访问某一数据，并且当前数据正好过期。</p>
<p>　　<strong>解决方案</strong></p>
<p>　　　　1、可以将热点数据设置为永远不过期<br>　　　　2、实现互斥锁，等待第一个请求构建完缓存之后，再释放锁，进而其它请求才能通过该 key 访问数据。</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>RBAC用户权限管理设计思路</title>
    <url>/Django/Django_id_29.html</url>
    <content><![CDATA[<p>　　目前，使用最普遍的权限管理模型正是RBAC（Role-Based Access Control）模型，这篇文章也主要是介绍基于RBAC的权限管理系统，我会从RBAC是什么、如何设计RBAC两部分来介绍。</p>
<a id="more"></a>

<h2 id="一、RBAC是什么"><a href="#一、RBAC是什么" class="headerlink" title="一、RBAC是什么"></a>一、RBAC是什么</h2><h3 id="1、RBAC模型概述"><a href="#1、RBAC模型概述" class="headerlink" title="1、RBAC模型概述"></a>1、RBAC模型概述</h3><p>RBAC模型（Role-Based Access Control：基于角色的访问控制）模型是20世纪90年代研究出来的一种新模型，但其实在20世纪70年代的多用户计算时期，这种思想就已经被提出来，直到20世纪90年代中后期，RBAC才在研究团体中得到一些重视，并先后提出了许多类型的RBAC模型。其中以美国George Mason大学信息安全技术实验室（LIST）提出的<a href="https://www.profsandhu.com/infs767/infs767fall03/lecture01-2.pdf" target="_blank" rel="noopener">RBAC96</a>模型最具有代表，并得到了普遍的公认。</p>
<p>RBAC认为权限授权的过程可以抽象地概括为：Who是否可以对What进行How的访问操作，并对这个逻辑表达式进行判断是否为True的求解过程，也即是将权限问题转换为What、How的问题，Who、What、How构成了访问权限三元组，具体的理论可以参考RBAC96的论文，这里我们就不做详细的展开介绍，大家有个印象即可。</p>
<h3 id="2、RBAC的组成"><a href="#2、RBAC的组成" class="headerlink" title="2、RBAC的组成"></a>2、RBAC的组成</h3><p>在RBAC模型里面，有3个基础组成部分，分别是：用户、角色和权限。</p>
<p>RBAC通过定义角色的权限，并对用户授予某个角色从而来控制用户的权限，实现了用户和权限的逻辑分离（区别于ACL模型），极大地方便了权限的管理</p>
<p>下面在讲解之前，先介绍一些名词：</p>
<ul>
<li>User（用户）：每个用户都有唯一的UID识别，并被授予不同的角色</li>
<li>Role（角色）：不同角色具有不同的权限</li>
<li>Permission（权限）：访问权限</li>
<li>用户-角色映射：用户和角色之间的映射关系</li>
<li>角色-权限映射：角色和权限之间的映射</li>
</ul>
<p>它们之间的关系如下图所示：</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/RBAC/RBAC1.png">

<p>例如下图，管理员和普通用户被授予不同的权限，普通用户只能去修改和查看个人信息，而不能创建创建用户和冻结用户，而管理员由于被授 予所有权限，所以可以做所有操作。</p>
<p>例如下图，管理员和普通用户被授予不同的权限，普通用户只能去修改和查看个人信息，而不能创建创建用户和冻结用户，而管理员由于被授予所有权限，所以可以做所有操作。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/RBAC/RBAC2.png">

<h3 id="3、RBAC支持的安全原则"><a href="#3、RBAC支持的安全原则" class="headerlink" title="3、RBAC支持的安全原则"></a>3、RBAC支持的安全原则</h3><p>RBAC支持三个著名的安全原则：最小权限原则、责任分离原则和数据抽象原则</p>
<ul>
<li>最小权限原则：RBAC可以将角色配置成其完成任务所需的最小权限集合</li>
<li>责任分离原则：可以通过调用相互独立互斥的角色来共同完成敏感的任务，例如要求一个计账员和财务管理员共同参与统一过账操作</li>
<li>数据抽象原则：可以通过权限的抽象来体现，例如财务操作用借款、存款等抽象权限，而不是使用典型的读、写、执行权限</li>
</ul>
<h3 id="4、RBAC的优缺点"><a href="#4、RBAC的优缺点" class="headerlink" title="4、RBAC的优缺点"></a>4、RBAC的优缺点</h3><p>（1）优点：</p>
<ul>
<li>简化了用户和权限的关系</li>
<li>易扩展、易维护</li>
</ul>
<p>（2）缺点：</p>
<ul>
<li>RBAC模型没有提供操作顺序的控制机制，这一缺陷使得RBAC模型很难适应哪些对操作次序有严格要求的系统</li>
</ul>
<h3 id="5、RBAC的4种模型"><a href="#5、RBAC的4种模型" class="headerlink" title="5、RBAC的4种模型"></a>5、RBAC的4种模型</h3><p>（1）RBAC0</p>
<p>RBAC0，是最简单、最原始的实现方式，也是其他RBAC模型的基础。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/RBAC/RBAC3.png">

<p>在该模型中，用户和角色之间可以是多对多的关系，即一个用户在不同场景下是可以有不同的角色，例如：项目经理也可能是组长也可能是架构师。同时每个角色都至少有一个权限。这种模型下，用户和权限被分离独立开来，使得权限的授权认证更加灵活。</p>
<p>（2）RBAC1</p>
<p>基于RBAC0模型，引入了角色间的继承关系，即角色上有了上下级的区别。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/RBAC/RBAC4.png">

<p>角色间的继承关系可分为一般继承关系和受限继承关系。一般继承关系仅要求角色继承关系是一个绝对偏序关系，允许角色间的多继承。而受限继承关系则进一步要求角色继承关系是一个树结构，实现角色间的单继承。</p>
<p>这种模型适合于角色之间层次分明，可以给角色分组分层。</p>
<p>（3）RBAC2</p>
<p>RBAC2，基于RBAC0模型的基础上，进行了角色的访问控制。</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/RBAC/RBAC5.png">

<p>RBAC2中的一个基本限制是互斥角色的限制，互斥角色是指各自权限可以互相制约的两个角色。对于这类角色一个用户在某一次活动中只能被分配其中的一个角色，不能同时获得两个角色的使用权。</p>
<p>该模型有以下几种约束：</p>
<ul>
<li>互斥角色 ：同一用户只能分配到一组互斥角色集合中至多一个角色，支持责任分离的原则。互斥角色是指各自权限互相制约的两个角色。对于这类角色一个用户在某一次活动中只能被分配其中的一个角色，不能同时获得两个角色的使用权。常举的例子：在审计活动中，一个角色不能同时被指派给会计角色和审计员角色。</li>
<li>基数约束 ：一个角色被分配的用户数量受限；一个用户可拥有的角色数目受限；同样一个角色对应的访问权限数目也应受限，以控制高级权限在系统中的分配。例如公司的领导人有限的；</li>
<li>先决条件角色 ：可以分配角色给用户仅当该用户已经是另一角色的成员；对应的可以分配访问权限给角色，仅当该角色已经拥有另一种访问权限。指要想获得较高的权限，要首先拥有低一级的权限。就像我们生活中，国家主席是从副主席中选举的一样。</li>
<li>运行时互斥 ：例如，允许一个用户具有两个角色的成员资格，但在运行中不可同时激活这两个角色。</li>
</ul>
<h2 id="二、如何设计RBAC"><a href="#二、如何设计RBAC" class="headerlink" title="二、如何设计RBAC"></a>二、如何设计RBAC</h2><p>这一节，我会介绍设计基于RBAC模型的权限系统的功能模块组成、流程以及数据库的设计。</p>
<h3 id="1、RBAC的功能模块"><a href="#1、RBAC的功能模块" class="headerlink" title="1、RBAC的功能模块"></a>1、RBAC的功能模块</h3><img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/RBAC/RBAC6.png">

<h3 id="2、RBAC执行流程"><a href="#2、RBAC执行流程" class="headerlink" title="2、RBAC执行流程"></a>2、RBAC执行流程</h3><img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/RBAC/RBAC7.png">]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django中mysql的联合唯一索引</title>
    <url>/Django/Django_id_28.html</url>
    <content><![CDATA[<h4 id="在Django中设置mysql的联合唯一索引"><a href="#在Django中设置mysql的联合唯一索引" class="headerlink" title="在Django中设置mysql的联合唯一索引"></a>在Django中设置mysql的联合唯一索引</h4><a id="more"></a>

<h4 id="联合唯一索引的意义："><a href="#联合唯一索引的意义：" class="headerlink" title="联合唯一索引的意义："></a>联合唯一索引的意义：</h4><p>　　<strong>节省空间、提高效率、建立联合索引的同时、还会给他们之间的组合建立索引</strong></p>
<h4 id="联合唯一索引的作用："><a href="#联合唯一索引的作用：" class="headerlink" title="联合唯一索引的作用："></a>联合唯一索引的作用：</h4><p>　　<strong>联合唯一索引的字段，相同的数据，同时只能存在一次，保证数据的唯一性</strong></p>
<h4 id="在Django中的使用方法："><a href="#在Django中的使用方法：" class="headerlink" title="在Django中的使用方法："></a>在Django中的使用方法：</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temperature</span><span class="params">(Base)</span>:</span></span><br><span class="line">    order_id = models.IntegerField()  <span class="comment"># 运单号</span></span><br><span class="line">    tempera = models.CharField(max_length=<span class="number">200</span>)  <span class="comment"># 记录温度</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'temperature'</span></span><br><span class="line">         <span class="comment"># 联合索引   其中order_id和create_time不能同时重复存在</span></span><br><span class="line">        unique_together = (</span><br><span class="line">            (<span class="string">'order_id'</span>, <span class="string">'create_time'</span>)</span><br><span class="line">        )</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 8安装mysql8.0</title>
    <url>/CentOS/CentOS_id_01.html</url>
    <content><![CDATA[<h3 id="CentOS-8-安装MySQL-8-0"><a href="#CentOS-8-安装MySQL-8-0" class="headerlink" title="CentOS 8 安装MySQL 8.0"></a>CentOS 8 安装MySQL 8.0</h3><a id="more"></a>

<h4 id="1、使用最新的包管理器安装MySQL"><a href="#1、使用最新的包管理器安装MySQL" class="headerlink" title="1、使用最新的包管理器安装MySQL"></a>1、使用最新的包管理器安装MySQL</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo dnf install @mysql</span><br></pre></td></tr></table></figure></div>

<h4 id="2、开启启动"><a href="#2、开启启动" class="headerlink" title="2、开启启动"></a>2、开启启动</h4><p><strong>安装完成后，运行以下命令来启动MySQL服务并使它在启动时自动启动：</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> --now mysqld</span><br></pre></td></tr></table></figure></div>

<h4 id="3、要检查MySQL服务器是否正在运行"><a href="#3、要检查MySQL服务器是否正在运行" class="headerlink" title="3、要检查MySQL服务器是否正在运行"></a>3、要检查MySQL服务器是否正在运行</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl status mysqld</span><br></pre></td></tr></table></figure></div>

<h4 id="4、添加密码及安全设置"><a href="#4、添加密码及安全设置" class="headerlink" title="4、添加密码及安全设置"></a>4、添加密码及安全设置</h4><p><strong>运行mysql_secure_installation脚本，该脚本执行一些与安全性相关的操作并设置MySQL根密码：</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="EBNF"><figure class="iseeu highlight /ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo mysql_secure_installation</span></span><br></pre></td></tr></table></figure></div>

<p>步骤如下：</p>
<p>1、要求你配置VALIDATE PASSWORD component（验证密码组件）： 输入y ，回车进入该配置</p>
<ul>
<li>选择密码验证策略等级， 我这里选择0 （low），回车</li>
<li>输入新密码两次</li>
<li>确认是否继续使用提供的密码？输入y ，回车</li>
<li>移除匿名用户？ 输入y ，回车</li>
<li>不允许root远程登陆？ 我这里需要远程登陆，所以输入n ，回车</li>
</ul>
<p>2、移除test数据库？ 输入y ，回车</p>
<p>3、重新载入权限表？ 输入y ，回车</p>
<h4 id="5、配置远程登陆"><a href="#5、配置远程登陆" class="headerlink" title="5、配置远程登陆"></a>5、配置远程登陆</h4><p>如果需要设置root账户远程登陆，上一步骤中，<code>不允许root远程登陆？</code>这一步需要设为n。<br>接下来本机登录MySQL，将root用户的host字段设为’%’，意为接受root所有IP地址的登录请求：<br>本机登录MySQL:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p&lt;上面步骤中设置的密码&gt;</span><br></pre></td></tr></table></figure></div>

<p><strong>接着继续执行mysql语句，将将root用户的host字段设为’%’：</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">update user <span class="built_in">set</span> host=<span class="string">'%'</span> <span class="built_in">where</span> user=<span class="string">'root'</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></div>

<p>设置完成后输入exit退出mysql，回到终端shell界面，接着开启系统防火墙的3306端口：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo firewall-cmd --add-port=3306/tcp --permanent</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure></div>

<h4 id="6、关闭MySQL主机查询dns"><a href="#6、关闭MySQL主机查询dns" class="headerlink" title="6、关闭MySQL主机查询dns"></a>6、关闭MySQL主机查询dns</h4><p>MySQL会反向解析远程连接地址的dns记录，如果MySQL主机无法连接外网，则dns可能无法解析成功，</p>
<p>导致第一次连接MySQL速度很慢，所以在配置中可以关闭该功能。</p>
<p>打开<code>/etc/my.cnf</code>文件，添加以下配置：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">skip-name-resolve</span><br></pre></td></tr></table></figure></div>

<h4 id="7、重启服务"><a href="#7、重启服务" class="headerlink" title="7、重启服务"></a>7、重启服务</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart mysqld</span><br></pre></td></tr></table></figure></div>

<p><strong>本机测试安装后，MySQL8.0默认已经是utf8mb4字符集，所以字符集不再修改</strong></p>
]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>虚拟环境命令</title>
    <url>/Spider/Spider_id_18.html</url>
    <content><![CDATA[<h2 id="1、安装虚拟环境"><a href="#1、安装虚拟环境" class="headerlink" title="1、安装虚拟环境"></a>1、安装虚拟环境</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：pip install virtualenvwrapper-win -i https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line">    https://pypi.tuna.tsinghua.edu.cn/simple网址是清华源网址，-i 加清华源网址会提高下载速度</span><br></pre></td></tr></table></figure></div>

<a id="more"></a>

<h2 id="2、创建虚拟环境"><a href="#2、创建虚拟环境" class="headerlink" title="2、创建虚拟环境"></a>2、创建虚拟环境</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：mkvirtualenv name</span></span><br><span class="line">	-----name是虚拟环境的名字</span><br><span class="line">	例如创建一个a1906虚拟环境----&gt;命令：# mkvirtualenv a1906</span><br></pre></td></tr></table></figure>

<h2 id="3、激活虚拟环境"><a href="#3、激活虚拟环境" class="headerlink" title="3、激活虚拟环境"></a>3、激活虚拟环境</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：workon name</span></span><br><span class="line">	当我门需要使用a1906虚拟环境时，可以使用命令来激活---&gt;命令：# workon a1906</span><br><span class="line">    如果我们已经在使用一个虚拟环境，需要切换到另一个虚拟环境时，也可以直接使用此命令来切换</span><br></pre></td></tr></table></figure></div>

<h2 id="4、安装模块"><a href="#4、安装模块" class="headerlink" title="4、安装模块"></a>4、安装模块</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：pip install 模块名</span></span><br><span class="line">	当我们需要在虚拟环境中安装requests模块时，可以使用---&gt;命令：# pip install requests</span><br><span class="line">还可以通过清华源来安装---&gt;命令：# pip install requests -i 清华源网址(https://pypi.tuna.tsinghua.edu.cn/simple)</span><br></pre></td></tr></table></figure>

<h2 id="5、删除已安装的模块"><a href="#5、删除已安装的模块" class="headerlink" title="5、删除已安装的模块"></a>5、删除已安装的模块</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：pip uninstall 模块名</span></span><br><span class="line">	当我们需要删除requests模块时，可以使用---&gt;命令：# pip uninstall requests</span><br></pre></td></tr></table></figure>

<h2 id="6、查看已安装的模块"><a href="#6、查看已安装的模块" class="headerlink" title="6、查看已安装的模块"></a>6、查看已安装的模块</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：pip list</span></span><br><span class="line">	此命令可以查看所有已安装过的模块名</span><br></pre></td></tr></table></figure></div>

<h2 id="7、退出虚拟环境"><a href="#7、退出虚拟环境" class="headerlink" title="7、退出虚拟环境"></a>7、退出虚拟环境</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：deactivate</span></span><br><span class="line">	此命令可以退出当前正在使用的虚拟环境</span><br></pre></td></tr></table></figure></div>

<h2 id="8、生成requirements-txt文件"><a href="#8、生成requirements-txt文件" class="headerlink" title="8、生成requirements.txt文件"></a>8、生成requirements.txt文件</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：pip freeze &gt; requirements.txt</span></span><br><span class="line">	此命令可以将环境中所有已安装的模块和包导入到生成的requirements.txt文件中</span><br></pre></td></tr></table></figure></div>

<h2 id="9、批量安装模块"><a href="#9、批量安装模块" class="headerlink" title="9、批量安装模块"></a>9、批量安装模块</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令：pip install -r requirements.txt文件所在目录</span></span><br><span class="line">	-r 后面跟的是路径，我们也可以切换到requirements.txt文件的所在目录进入虚拟环境进行直接安装，使用---&gt;命令：# pip install -r requirements.txt</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>虚拟环境命令</tag>
      </tags>
  </entry>
  <entry>
    <title>网页请求</title>
    <url>/Spider/Spider_id_16.html</url>
    <content><![CDATA[<h2 id="1、请求过程"><a href="#1、请求过程" class="headerlink" title="1、请求过程"></a>1、请求过程</h2><a id="more"></a>

<h2 id="1、1-URL介绍"><a href="#1、1-URL介绍" class="headerlink" title="1、1  URL介绍"></a>1、1  URL介绍</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">URL作用：用于定位服务器资源</span><br><span class="line">    <span class="comment"># 结构：</span></span><br><span class="line">        <span class="number">1</span>)协议：Protocol</span><br><span class="line">        <span class="number">2</span>)域名：domain</span><br><span class="line">        <span class="number">3</span>)端口：port</span><br></pre></td></tr></table></figure></div>

<h2 id="1、2-HTTP请求过程"><a href="#1、2-HTTP请求过程" class="headerlink" title="1、2  HTTP请求过程"></a>1、2  HTTP请求过程</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 请求过程：</span></span><br><span class="line">	客户端通常指web浏览器或APP向服务器发起请求，服务器接收到请求后进行处理，并向客户端发起响应</span><br></pre></td></tr></table></figure></div>

<h2 id="1、3-请求四部分"><a href="#1、3-请求四部分" class="headerlink" title="1、3  请求四部分"></a>1、3  请求四部分</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 由客户端向服务器发出的，可以分为四部分内容：</span></span><br><span class="line">        <span class="number">1</span>)请求方法(Request Method)</span><br><span class="line">        <span class="number">2</span>)请求网址(Request URL)</span><br><span class="line">        <span class="number">3</span>)请求头(Request Headers)</span><br><span class="line">        <span class="number">4</span>)请求体(Request Body)</span><br></pre></td></tr></table></figure></div>

<h2 id="1、4-请求的八种方法"><a href="#1、4-请求的八种方法" class="headerlink" title="1、4  请求的八种方法"></a>1、4  请求的八种方法</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 请求常见的八种方法：</span></span><br><span class="line">        <span class="number">1</span>)GET：请求页面,并返回页面内容</span><br><span class="line">        <span class="number">2</span>)POST：用于提交表单数据或上传文件，数据包含在请求体中</span><br><span class="line">        <span class="number">3</span>)PUT：从客户端向服务器传送的数据取代指定文档中的内容，就是所谓的更新指定内容</span><br><span class="line">        <span class="number">4</span>)DELETE：请求服务器删除指定的页面</span><br><span class="line">        <span class="number">5</span>)HEAD：累死与GET请求，只不过返回的响应中没有具体的内容，用于获取报头</span><br><span class="line">        <span class="number">6</span>)CONNECT：把服务器当作跳板，让服务器代替客户端访问其它网页</span><br><span class="line">        <span class="number">7</span>)OPTIONS：允许客户端查看服务器的性能</span><br><span class="line">        <span class="number">8</span>)TRACE：回显服务器收到的请求，主要用于测试或诊断</span><br><span class="line"><span class="comment"># GET和POST区别：(面试重点、需重点掌握)</span></span><br><span class="line">        <span class="number">1</span>)GET请求中的参数会包含在URL里面，数据可以在URL中看到，而POST请求的URL不会包含这些数据，POST的数据都是通过表单形式传输的，包含在请求体中</span><br><span class="line">        <span class="number">2</span>)GET请求提交的数据最多只有<span class="number">1024</span>字节，而POST方式没有限制</span><br><span class="line">        <span class="number">3</span>)post请求相对安全</span><br></pre></td></tr></table></figure></div>

<h2 id="1、5-请求网址"><a href="#1、5-请求网址" class="headerlink" title="1、5  请求网址"></a>1、5  请求网址</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 请求网址</span></span><br><span class="line">	<span class="number">1</span>)请求的网址，即同意资源定位符URL，它是可以唯一确定我们想请求的资源</span><br></pre></td></tr></table></figure></div>

<h2 id="1、6-请求头"><a href="#1、6-请求头" class="headerlink" title="1、6  请求头"></a>1、6  请求头</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 请求头，用来说明服务器要使用的附加信息，重点掌握：Accept、Cookie、Referer、User-Agent</span></span><br><span class="line">        <span class="number">1</span>)Accept：请求报头域，用于指定客户端可接受哪些类型的信息</span><br><span class="line">        <span class="number">2</span>)Cookie：也常用复数形式Cookies，这是网站为了辨别用户进行会话跟踪而存储在用户本地的数据。它的主要功能是维持当前访问会话。</span><br><span class="line">        <span class="number">3</span>)Referer：此内容用来表示这个请求是从哪个页面发过来的，服务器可以拿到这一信息并做相应的处理，如做来源统计、防盗链处理等</span><br><span class="line">        <span class="number">4</span>)User-Agent：简称UA，它是一个特殊的字符串头，可以使服务器识别客户使用的操作系统及版本，浏览器及版本等信息。在做爬虫时附加上此信息，</span><br><span class="line">        			可以伪装为浏览器，如果不加，很可能会被识别出为爬虫</span><br><span class="line">        <span class="number">5</span>)x-requested-<span class="keyword">with</span>：XMLHtpRequest	<span class="comment"># 代表ajax请求</span></span><br><span class="line">        <span class="number">6</span>)Accept-Encoding：指定客户端可接受的内容编码</span><br><span class="line">        <span class="number">7</span>)Content-Type：也叫互联网媒体类型(Intemet Media Type) 或者MIME类型，在HTTP协议消息头中，它用来表示具体请求中的媒体类型信息。</span><br><span class="line">        			例如:text/html代表HTML格式，image/gif代表GIF图片，application/json代表JSON类型</span><br></pre></td></tr></table></figure></div>

<h2 id="1、7-请求体"><a href="#1、7-请求体" class="headerlink" title="1、7  请求体"></a>1、7  请求体</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 请求体</span></span><br><span class="line">	请求体一般承载的内容时POST请求中的表单数据，而对于GET请求，请求体则为空</span><br></pre></td></tr></table></figure></div>

<h2 id="1、8-响应"><a href="#1、8-响应" class="headerlink" title="1、8  响应"></a>1、8  响应</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 响应，是由服务端返回给客户端的，可以分为三部分：响应状态码(response status code)，响应头(response headers)，响应体(response body)</span></span><br></pre></td></tr></table></figure></div>

<h2 id="1、8、1-响应状态码"><a href="#1、8、1-响应状态码" class="headerlink" title="1、8、1  响应状态码"></a>1、8、1  响应状态码</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 响应状态码：用于哦按段请求后的响应状态，如200代表请求成功，404代表页面找不到，500代表服务器错误</span></span><br><span class="line"><span class="comment"># 常见的状态码：</span></span><br><span class="line">	<span class="number">200</span>系列：</span><br><span class="line">    	<span class="number">200</span> 成功	服务器已成功处理了请求	<span class="comment"># 重点</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">300</span>系列：</span><br><span class="line">            <span class="number">301</span> 永久移动	请求的网页已永久移动到新位置，即永久重定向	<span class="comment"># 重点</span></span><br><span class="line">            <span class="number">302</span>	临时移动	请求的网页暂时跳转到其它页面，即暂时重定向	<span class="comment"># 重点</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">400</span>系列：</span><br><span class="line">            <span class="number">400</span>	错误请求	服务器无法解析该请求	<span class="comment"># 重点</span></span><br><span class="line">            <span class="number">401</span>	未授权		请求没有进行身份验证或验证未通过</span><br><span class="line">            <span class="number">403</span>	禁止访问	服务器拒绝此请求	<span class="comment"># 重点</span></span><br><span class="line">            <span class="number">404</span>	未找到		服务器找不到请求的网页</span><br><span class="line">            </span><br><span class="line">        <span class="number">500</span>系列：</span><br><span class="line">            <span class="number">500</span>	服务器内部错误		服务器遇到错误，无法完成请求	<span class="comment"># 重点</span></span><br><span class="line">            <span class="number">501</span>	未实现		服务器不具备完成请求的功能</span><br><span class="line">            <span class="number">502</span>	错误网关	服务器作为网关或代理，从上游服务器收到无效响应</span><br><span class="line">            <span class="number">504</span>	网关超时	服务器作为网关或代理，但是没有及时从上游服务器收到请求</span><br><span class="line">            <span class="number">505</span>	HTTP版本不支持	服务器不支持请求中所用的HTTP协议版本</span><br><span class="line"></span><br><span class="line"><span class="comment">### (注意：状态码不能完全代表响应状态，部分网站的状态码是自定义的，一切以响应的数据为准)</span></span><br></pre></td></tr></table></figure></div>

<h2 id="1、8、2-响应头"><a href="#1、8、2-响应头" class="headerlink" title="1、8、2  响应头"></a>1、8、2  响应头</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 响应头：</span></span><br><span class="line">    响应头包含了服务器对请求的应答信息</span><br><span class="line">    Date：表示响应产生的时间</span><br><span class="line">    Content-Encoding：指定响应内容的编码</span><br><span class="line">    Server：包含服务器的信息，比如名称、版本号等</span><br><span class="line">    Content-Type：文档类型，指定返回的数据类型是什么，如text/html代表返回HTML文档，application/x-javascriot则表达返回JavaScript文件，</span><br><span class="line">    			image/jpeg则代表返回图片</span><br><span class="line">    Set-Cookie：设置Cookies，响应头中的Set-Cookie告诉浏览器需要将此内容放在Cookie中，下次请求携带Cookie请求</span><br><span class="line">    Expires：指定响应的过期时间，可以使代理服务器或浏览器将加载的内容更新到缓存中。如果再次访问时，就可以直接从缓存中加载，降低服务器负载，</span><br><span class="line">    		缩短加载时间</span><br></pre></td></tr></table></figure></div>

<h2 id="1、8、3-响应体"><a href="#1、8、3-响应体" class="headerlink" title="1、8、3  响应体"></a>1、8、3  响应体</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  响应体</span></span><br><span class="line"><span class="comment"># 最重要的当属响应体的内容了，响应的正文数据都在响应体中。</span></span><br><span class="line">	比如请求网页时，他的响应体就是网页的HTML代码，请求一张图片时，他的相应体就是图片的二进制数据。我们做爬虫请求网页后，要解析的内容就是响应体</span><br></pre></td></tr></table></figure></div>

<h2 id="1、9-网页基础"><a href="#1、9-网页基础" class="headerlink" title="1、9  网页基础"></a>1、9  网页基础</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 网页的组成</span></span><br><span class="line">网页可以分为三部分：HTML、CSS、JavaScript</span><br><span class="line">        <span class="number">1</span>)HTML：全称：Hyper Text Markup Language、即超文本标记语言</span><br><span class="line">        <span class="comment"># 定义了网页的骨架</span></span><br><span class="line">        <span class="number">2</span>)CSS：全称：Cascading Style Sheets，即层叠样式表</span><br><span class="line">        <span class="comment"># 定义了网页的样式</span></span><br><span class="line">        <span class="number">3</span>)JavaScript：简称JS，是一种脚本语言</span><br><span class="line">        <span class="comment"># 定义了网页与用户的交互行为，如下载进度条，提示框，轮播图</span></span><br></pre></td></tr></table></figure></div>

<h2 id="2、第一次请求"><a href="#2、第一次请求" class="headerlink" title="2、第一次请求"></a>2、第一次请求</h2><h2 id="2、1-爬虫的工作流"><a href="#2、1-爬虫的工作流" class="headerlink" title="2、1  爬虫的工作流"></a>2、1  爬虫的工作流</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">确定URL，想服务器发送请求并获得响应：requests、urllib、aiohttp</span><br><span class="line">在响应中提取目标数据，即数据解析：xpath、bs4、正则、PyQuery</span><br><span class="line">数据持久化：文件，关系型数据库，非关系型数据库</span><br></pre></td></tr></table></figure></div>

<h2 id="2、2-第一个爬虫"><a href="#2、2-第一个爬虫" class="headerlink" title="2、2  第一个爬虫"></a>2、2  第一个爬虫</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 需求：爬取报读首页，并写入文件中，最后用浏览器打开文件查看效果</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导包</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确定url，向服务器发送请求</span></span><br><span class="line">url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">res = requests.get(url=rul)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 操作响应数据，获取目标数据，根据网页编码模式进行编码</span></span><br><span class="line">res.encoding = <span class="string">'utf-8'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将目标数据持久化到本地：写入文件</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'baidu.html'</span>,<span class="string">'w'</span>,encoding = <span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.text)	<span class="comment"># res.text	代表将获取的文本</span></span><br></pre></td></tr></table></figure></div>

<h2 id="2、3-requests模块基本使用"><a href="#2、3-requests模块基本使用" class="headerlink" title="2、3  requests模块基本使用"></a>2、3  requests模块基本使用</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装requests模块</span></span><br><span class="line">pip install requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># requests的请求方式</span></span><br><span class="line">	<span class="number">1</span>、get请求：</span><br><span class="line">                <span class="number">1</span>)不携带参数的get请求</span><br><span class="line">                <span class="number">2</span>)不携带参数的get请求	+  headers</span><br><span class="line">                <span class="number">3</span>)携带参数的get请求  +  headers</span><br><span class="line">            </span><br><span class="line">          <span class="number">2</span>、post请求：构建参数的post请求</span><br><span class="line">          <span class="number">3</span>、响应数据的获取与属性</span><br><span class="line">                <span class="number">3.1</span>)响应数据的获取：</span><br><span class="line">                        <span class="number">3.11</span>)res.text：文本数据</span><br><span class="line">                        <span class="number">3.12</span>)res.json()：Json数据</span><br><span class="line">                        <span class="number">3.13</span>)res.content：流</span><br><span class="line">                <span class="number">3.2</span>)响应的其它属性：</span><br><span class="line">                	<span class="number">3.21</span>)res.status_code：获取响应状态码</span><br><span class="line">                        <span class="number">3.22</span>)res.headers：响应头</span><br><span class="line">                        <span class="number">3.23</span>)res.cookie：cookie信息</span><br><span class="line">                        <span class="number">3.24</span>)res.history：响应历史</span><br></pre></td></tr></table></figure></div>

<h2 id="2、3、1-requests模块的get请求"><a href="#2、3、1-requests模块的get请求" class="headerlink" title="2、3、1  requests模块的get请求"></a>2、3、1  requests模块的get请求</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 不携带参数的get请求：爬取搜狗主页</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'https://www.sogou.com/'</span></span><br><span class="line">res = requests.get(url=url)</span><br><span class="line">res.encoding = <span class="string">'utf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'sogou.html'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.text)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 不携带参数的get请求 + readers：爬取知乎的发现页</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">res = requests.get(url = url,headers = headers)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'zhihu.html'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.text)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 携带参数的get请求 + headers：知乎的发现栏中搜索Python</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">     <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">url =  <span class="string">'https://www.zhihu.com/search?'</span></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">'type'</span> : <span class="string">'content'</span>,</span><br><span class="line">    <span class="string">'q'</span> : <span class="string">'python'</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url = url , headers = headers , params = params)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'zhihu.html'</span> , <span class="string">'w'</span> , encoding = <span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.wirte(res.text)</span><br></pre></td></tr></table></figure></div>

<h2 id="2、3、2-requests模块的post请求"><a href="#2、3、2-requests模块的post请求" class="headerlink" title="2、3、2  requests模块的post请求"></a>2、3、2  requests模块的post请求</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># requests的post请求：以post方式请求：百度翻译时返回的请求信息</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.70 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">'https://fanyi.baidu.com/sug'</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'kw'</span> : <span class="string">'girlgriend'</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.post(url = url , headers = headers , data = data)</span><br><span class="line">print(josn.loads(res.text))</span><br></pre></td></tr></table></figure></div>

<h2 id="3、josn形式与流形式的响应数据示例"><a href="#3、josn形式与流形式的响应数据示例" class="headerlink" title="3、josn形式与流形式的响应数据示例"></a>3、josn形式与流形式的响应数据示例</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># json形式响应数据示例：bilibili的Python视频教程，目录列表</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">     <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">'https://api.bilibili.com/x/web-interface/view?aid=14184325&amp;cid=23153678'</span></span><br><span class="line">res = requests.get(url = url , headers = headers)</span><br><span class="line">print(res)</span><br><span class="line">print(res.status_code)</span><br><span class="line">print(res.headers)</span><br><span class="line">print(<span class="string">'----------------------------------------------------'</span>)</span><br><span class="line">print(res.json())</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 流形式响应数据示例：站长素材的简历模板</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">     <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">'http://fjdx.sc.chinaz.net/Files/DownLoad/jianli/201907/jianli10810.rar'</span></span><br><span class="line">res = requests.get(url = url , headers = headers)</span><br><span class="line">print(res.content)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'jianli.rar'</span> , <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.content)</span><br></pre></td></tr></table></figure></div>





]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Spider</tag>
      </tags>
  </entry>
  <entry>
    <title>爬虫的介绍</title>
    <url>/Spider/Spider_id_15.html</url>
    <content><![CDATA[<h2 id="1、爬虫的概念："><a href="#1、爬虫的概念：" class="headerlink" title="1、爬虫的概念："></a>1、爬虫的概念：</h2><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、<span class="comment"># 爬虫又称网页蜘蛛和网络机器人</span></span><br><span class="line"><span class="number">2</span>、<span class="comment"># 爬虫是模拟人操作客户端(浏览器，APP)，向服务器发起请求，抓取数据的自动化程序或脚本</span></span><br><span class="line">  <span class="comment"># 说明：</span></span><br><span class="line">    <span class="number">1</span>)模拟：用爬虫程序伪装出人的行为，避免被服务器识别为爬虫程序或脚本</span><br><span class="line">    <span class="number">2</span>)客户端：浏览器，APP都可以实现人与服务器之间交互的行为，应用客户端从服务器获取数据</span><br><span class="line">    <span class="number">3</span>)自动化：数量较小时可以人为的从服务端获取数据，但公司需求高达百万甚至千万条以上时，就需要程序自动从服务端获取数据</span><br></pre></td></tr></table></figure></div>

<h2 id="2、爬虫的语言："><a href="#2、爬虫的语言：" class="headerlink" title="2、爬虫的语言："></a>2、爬虫的语言：</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、<span class="comment"># 爬虫的语言有：PHP、C/C++、Java、Python</span></span><br><span class="line"><span class="number">2</span>、<span class="comment"># 各语言之间的对比：</span></span><br><span class="line">	<span class="number">1</span>)PHP：并发能力差，对多线程和多进程支持不好，数据量较大时爬虫效率极低</span><br><span class="line">    <span class="number">2</span>)C/C++：语言效率高，但学习成本高，对程序员的计数能力要求较高，目前还处于研究阶段，需求量很少</span><br><span class="line">    <span class="number">3</span>)Java：python爬虫的主要竞争对手，由于Java语言的特点，代码臃肿，代码量大，维护成本和重构成本高，开发效率低，但目前市场岗位需求比较旺盛</span><br><span class="line">    <span class="number">4</span>)python：语法简单，学习成本低，对于新手比较友好，python语言良好的生态，大量库和框架的支持，使得python爬虫目前处于爬虫圈的主导地位</span><br></pre></td></tr></table></figure></div>

<h2 id="3、爬虫的分类："><a href="#3、爬虫的分类：" class="headerlink" title="3、爬虫的分类："></a>3、爬虫的分类：</h2><h2 id="3、1-通用爬虫"><a href="#3、1-通用爬虫" class="headerlink" title="3、1  通用爬虫"></a>3、1  通用爬虫</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、通用爬虫：搜索引擎</span><br><span class="line">	<span class="comment">#(通用爬虫就是一个爬虫，它爬取的数据为搜索引擎提供检索服务，但是通用爬虫不是搜索引擎)</span></span><br><span class="line">	<span class="number">1</span>)实例：百度，搜狗，Goolge的搜索引擎</span><br><span class="line">    <span class="number">2</span>)工作流：</span><br><span class="line">        <span class="number">2.1</span>)给定一个起始URL，放在爬虫队列中</span><br><span class="line">        <span class="number">2.2</span>)爬虫从队列中取出URL，爬取数据</span><br><span class="line">        <span class="number">2.3</span>)解析爬取到的数据，获取网页内所有URL地址，放在爬虫队列中</span><br><span class="line">        <span class="number">2.4</span>)重复第二个步骤</span><br><span class="line">    <span class="number">3</span>)使搜索引擎获取网站链接：</span><br><span class="line">        <span class="number">3.1</span>)主动将URL提交给搜索引擎(https://www.***.com)</span><br><span class="line">        <span class="number">3.2</span>)在其它热门网站设置友情链接</span><br><span class="line">        <span class="number">3.3</span>)百度和DNS服务商合作，收录新的网站</span><br><span class="line">    <span class="number">4</span>)网站排名(SEO)：</span><br><span class="line">        <span class="number">4.1</span>)根据PageRank值进行排名(流量，点击率)</span><br><span class="line">        <span class="number">4.2</span>)百度竞价排名，钱多就可以靠前排</span><br><span class="line">    <span class="number">5</span>)缺点：</span><br><span class="line">        <span class="number">5.1</span>)抓取的数据多数无用</span><br><span class="line">        <span class="number">5.2</span>)无法精确获取数据</span><br><span class="line">    6)协议：robots协议---&gt;约定哪些内容允许被哪些爬虫爬取</span><br><span class="line">        <span class="number">6.1</span>)无需遵守、该协议使用于通用爬虫，而我们写的使聚焦爬虫</span><br><span class="line">        <span class="number">6.2</span>)查看方法：网站URL/robots.txt，例如：https://www.baidu.com/robots.txt</span><br></pre></td></tr></table></figure></div>

<h2 id="3、2-聚焦爬虫"><a href="#3、2-聚焦爬虫" class="headerlink" title="3、2  聚焦爬虫"></a>3、2  聚焦爬虫</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>)聚焦爬虫又分为：增量式爬虫和深度爬虫</span><br><span class="line"><span class="number">2</span>)概念</span><br><span class="line">	<span class="number">2.1</span>)聚焦爬虫是针对某一领域中的特定数据进行爬取的程序，来抓取所需要的数据(又称：垂直领域爬取)</span><br><span class="line"><span class="number">3</span>)设计思路：</span><br><span class="line">        <span class="number">3.1</span>)确定爬取的URL，模拟客户端向服务端发送请求</span><br><span class="line">        <span class="number">3.2</span>)获取相应数据，并进行数据解析 </span><br><span class="line"></span><br><span class="line">        <span class="number">3.3</span>)将获取的数据持久化保存到本地</span><br></pre></td></tr></table></figure></div>

<h2 id="4、协议"><a href="#4、协议" class="headerlink" title="4、协议"></a>4、协议</h2><h2 id="4、1-OSI七层模型"><a href="#4、1-OSI七层模型" class="headerlink" title="4、1  OSI七层模型"></a>4、1  OSI七层模型</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">应用层</span><br><span class="line">表示层</span><br><span class="line">会话层</span><br><span class="line">传输层</span><br><span class="line">网络层</span><br><span class="line">数据链路层</span><br><span class="line">物理层</span><br></pre></td></tr></table></figure></div>

<h2 id="4、2-TCT-IP五层模型"><a href="#4、2-TCT-IP五层模型" class="headerlink" title="4、2  TCT/IP五层模型"></a>4、2  TCT/IP五层模型</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">应用层：HTTP、HTTPS、FIP(文件传输)、SSH协议</span><br><span class="line">传输层：TCP、UDP协议</span><br><span class="line">网络层：IP协议</span><br><span class="line">数据链路层：ARP协议</span><br><span class="line">物理层：以太网协议</span><br></pre></td></tr></table></figure></div>

<h2 id="4、3-常用协议"><a href="#4、3-常用协议" class="headerlink" title="4、3  常用协议"></a>4、3  常用协议</h2><h2 id="4、3、1-HTTP协议"><a href="#4、3、1-HTTP协议" class="headerlink" title="4、3、1  HTTP协议"></a>4、3、1  HTTP协议</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">HTTP协议：明文传输，端口<span class="number">80</span></span><br><span class="line">HTTP协议全称Hyper Text Transfer Protocol，即超文本传输协议</span><br><span class="line">HTTP协议是用于从网络传输超文本数据到本地浏览器的传送协议，它能保证高效而转却地传送超文本文档</span><br><span class="line">目前广泛使用HTTP	<span class="number">1.1</span>版本</span><br></pre></td></tr></table></figure></div>

<h2 id="4、3、2-HTTPS协议"><a href="#4、3、2-HTTPS协议" class="headerlink" title="4、3、2  HTTPS协议"></a>4、3、2  HTTPS协议</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">HTTPS协议：加密传输，端口<span class="number">443</span></span><br><span class="line">HTTPS协议全称：Hyper Text Transfer Protocol over Secure Socket Layer，是以安全为目标的HTTP通道，HTTPS协议实质是HTTP的安全版，即HTTP下加入SSL层，简称HTTPS</span><br><span class="line">HTTPS的安全体现在SSL的加密行为，即通过HTTPS协议传输的数据都是经过SSL加密的</span><br><span class="line">HTTPS的作用：</span><br><span class="line">    <span class="number">1</span>)建立一个信息安全的通道来保证数据传输的安全</span><br><span class="line">    <span class="number">2</span>)确认网站的真实性，凡是使用了HTTPS的网站，都可以通过点击浏览器地址栏的锁头标志来查看网站认证之后的真实信息，也可以通过CA机构颁发的安全签</span><br><span class="line">    	章来查询</span><br></pre></td></tr></table></figure></div>

<h2 id="4、3、3-HTTP和HTTPS的区别"><a href="#4、3、3-HTTP和HTTPS的区别" class="headerlink" title="4、3、3  HTTP和HTTPS的区别"></a>4、3、3  HTTP和HTTPS的区别</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">HTTPS协议需要到CA申请证书，一般免费证书较少，因为需要一定的费用</span><br><span class="line">HTTP是超文本传输协议，信息是明文传输，HTTPS则是具有安全性的SSL加密传输协议</span><br><span class="line">HTTP和HTTPS使用的是完全不同的链接方式，用的端口也不一样，前者是<span class="number">80</span>，后者是<span class="number">443</span></span><br><span class="line">HTTP的链接方式很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议、比HTTP协议安全</span><br></pre></td></tr></table></figure></div>

<h2 id="4、3、4-TCP协议"><a href="#4、3、4-TCP协议" class="headerlink" title="4、3、4  TCP协议"></a>4、3、4  TCP协议</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">TCP协议是一种面向链接的，可靠的，基于字节流的传输层通信协议</span><br><span class="line">有四大特性：</span><br><span class="line">    <span class="number">1</span>)有序性：数据包编号，判断数据包的正确次序</span><br><span class="line">    <span class="number">2</span>)正确性：使用checksum函数检查数据包是否损坏，发送及接收时都会计算校验和</span><br><span class="line">    <span class="number">3</span>)可靠性：发送端有超时重发，并由确认机制识别错误和数据的丢失</span><br><span class="line">    <span class="number">4</span>)可控性：滑动窗口协议与拥塞控制算法控制数据包的发送速度</span><br></pre></td></tr></table></figure></div>

<h2 id="4、3、5-UDP协议"><a href="#4、3、5-UDP协议" class="headerlink" title="4、3、5  UDP协议"></a>4、3、5  UDP协议</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">UDP协议是用户数据报协议，面向无链接的传输层协议，传输时不可靠的</span><br><span class="line">    <span class="number">1</span>)无连接，数据可能会丢失或损坏</span><br><span class="line">    <span class="number">2</span>)报文小，传输速度块</span><br><span class="line">    <span class="number">3</span>)吞吐量大的网络传输，可以在一定程度上承受数据丢失</span><br></pre></td></tr></table></figure></div>

<h2 id="4、3、6-ARP协议"><a href="#4、3、6-ARP协议" class="headerlink" title="4、3、6  ARP协议"></a>4、3、6  ARP协议</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">ARP协议是通过IP获取目标计算机MAC地址的协议</span><br></pre></td></tr></table></figure></div>

<h2 id="5、服务器常见端口"><a href="#5、服务器常见端口" class="headerlink" title="5、服务器常见端口"></a>5、服务器常见端口</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">FTP：全称：File Transfer Protocol，及文件传输协议、端口：<span class="number">21</span></span><br><span class="line">SSH：全称：Secure Shell，用于远程登录会话、端口：<span class="number">22</span></span><br><span class="line">MySQL：关系型数据库、端口<span class="number">3306</span></span><br><span class="line">MongoDB：非关系型数据库、端口：<span class="number">27017</span></span><br><span class="line">Redis：非关系型数据库、端口：<span class="number">6379</span></span><br></pre></td></tr></table></figure></div>

<h2 id="6、开发准备"><a href="#6、开发准备" class="headerlink" title="6、开发准备"></a>6、开发准备</h2><h2 id="6、1-web端"><a href="#6、1-web端" class="headerlink" title="6、1  web端"></a>6、1  web端</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">python <span class="number">3.6</span>版本</span><br><span class="line">Pycharm</span><br><span class="line">Google Chrome</span><br></pre></td></tr></table></figure></div>

<h2 id="6、2-APP"><a href="#6、2-APP" class="headerlink" title="6、2  APP"></a>6、2  APP</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">fiddler抓包工具</span><br><span class="line">Charles抓包工具</span><br><span class="line">Appium自动化测试工具</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Spider</tag>
      </tags>
  </entry>
  <entry>
    <title>文件的操作</title>
    <url>/Spider/Spider_id_17.html</url>
    <content><![CDATA[<h2 id="1、json文件的操作"><a href="#1、json文件的操作" class="headerlink" title="1、json文件的操作"></a>1、json文件的操作</h2><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">las = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">101</span>):</span><br><span class="line">    las.append(&#123;<span class="string">"name"</span>:<span class="string">"这是第%d几个json对象"</span>%i,<span class="string">"age"</span>:<span class="string">"今年%d岁了"</span> %i&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"json_file.json"</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(json.dumps(las,ensure_ascii=<span class="literal">False</span>,indent=<span class="number">2</span>))</span><br></pre></td></tr></table></figure></div>

<h2 id="1、1-json文件案例"><a href="#1、1-json文件案例" class="headerlink" title="1、1  json文件案例"></a>1、1  json文件案例</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml.html <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.budejie.com/'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url=url,headers=headers).text</span><br><span class="line">tree = etree.HTML(res)</span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">las = []</span><br><span class="line">title = tree.xpath(<span class="string">'//a[@class="u-user-name"]/text()'</span>)</span><br><span class="line">time = tree.xpath(<span class="string">'//span[@class="u-time  f-ib f-fr"]/text()'</span>)</span><br><span class="line">praise = tree.xpath(<span class="string">'//li[@class="j-r-list-tool-l-up"]/span/text()'</span>)</span><br><span class="line">degrade = tree.xpath(<span class="string">'//li[@class="j-r-list-tool-l-down "]/span/text()'</span>)</span><br><span class="line">share_list = tree.xpath(<span class="string">'//div[@class="j-r-list-tool-ct-share-c"]/span/text()'</span>)</span><br><span class="line">comment = tree.xpath(<span class="string">'//span[@class="comment-counts"]/text()'</span>)</span><br><span class="line">shares = []</span><br><span class="line"><span class="keyword">for</span> share <span class="keyword">in</span> share_list:</span><br><span class="line">    share = share.replace(<span class="string">'\xa0'</span>,<span class="string">''</span>)[<span class="number">2</span>]</span><br><span class="line">    shares.append(share)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'baisi.json'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            dic = &#123;<span class="string">'用户'</span>: title[i], <span class="string">'创建时间'</span>: time[i], <span class="string">'点赞'</span>: praise[i], <span class="string">'贬低'</span>: degrade[i], <span class="string">'分享'</span>: shares[i],</span><br><span class="line">                   <span class="string">'评论'</span>: comment[i]&#125;</span><br><span class="line">            las.append(dic)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            f.write(json.dumps(las,ensure_ascii=<span class="literal">False</span>,indent=<span class="number">2</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>

<h2 id="2、csv文件的操作"><a href="#2、csv文件的操作" class="headerlink" title="2、csv文件的操作"></a>2、csv文件的操作</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'csv_file.csv'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    writer = csv.writer(f,delimiter=<span class="string">','</span>)</span><br><span class="line">    writer.writerow([<span class="string">'title'</span>,<span class="string">'age'</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">101</span>):</span><br><span class="line">    title = <span class="string">'标题%d'</span> % i</span><br><span class="line">    age = <span class="string">'年龄%d'</span> % i</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'csv_file.csv'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        writer = csv.writer(f,delimiter=<span class="string">','</span>)</span><br><span class="line">        writer.writerow([title,age])</span><br></pre></td></tr></table></figure></div>

<h2 id="2、1-csv文件操作的案例"><a href="#2、1-csv文件操作的案例" class="headerlink" title="2、1  csv文件操作的案例"></a>2、1  csv文件操作的案例</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml.html <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'baisi.csv'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    writer = csv.writer(f, delimiter=<span class="string">','</span>)</span><br><span class="line">    writer.writerow([<span class="string">'作者'</span>,<span class="string">'时间'</span>,<span class="string">'点赞'</span>,<span class="string">'拉黑'</span>,<span class="string">'分享'</span>,<span class="string">'评论'</span>])</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.budejie.com/'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url=url,headers=headers).text</span><br><span class="line">tree = etree.HTML(res)</span><br><span class="line">title_list = tree.xpath(<span class="string">'//div[@class="u-txt"]/a/text()'</span>)</span><br><span class="line">title = []</span><br><span class="line"><span class="keyword">for</span> tit <span class="keyword">in</span> title_list:</span><br><span class="line">    tit = tit.replace(<span class="string">' '</span>,<span class="string">''</span>)</span><br><span class="line">    title.append(tit)</span><br><span class="line">time = tree.xpath(<span class="string">'//div[@class="u-txt"]/span/text()'</span>)</span><br><span class="line">praise = tree.xpath(<span class="string">'//li[@class="j-r-list-tool-l-up"]/span/text()'</span>)</span><br><span class="line">degrade = tree.xpath(<span class="string">'//li[@class="j-r-list-tool-l-down "]/span/text()'</span>)</span><br><span class="line">share_list = tree.xpath(<span class="string">'//div[@class="j-r-list-tool-ct-share-c"]/span/text()'</span>)</span><br><span class="line">share = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> share_list:</span><br><span class="line">    i = i.split(<span class="string">'\xa0'</span>)[<span class="number">2</span>]</span><br><span class="line">    share.append(i)</span><br><span class="line"><span class="comment"># print(share)</span></span><br><span class="line">comment = tree.xpath(<span class="string">'//span[@class="comment-counts"]/text()'</span>)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'baisi.csv'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            writer = csv.writer(f,delimiter=<span class="string">','</span>)</span><br><span class="line">            writer.writerow([title[i],time[i],praise[i],degrade[i],share[i],comment[i]])</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>文件的操作</tag>
      </tags>
  </entry>
  <entry>
    <title>打码平台</title>
    <url>/Spider/Spider_id_09.html</url>
    <content><![CDATA[<h2 id="1、打码平台"><a href="#1、打码平台" class="headerlink" title="1、打码平台"></a>1、打码平台</h2><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用流程:</span></span><br><span class="line">	- 注册账号:</span><br><span class="line">        普通账户: 充钱的</span><br><span class="line">        开发账户: 调接口进行打码</span><br><span class="line">	- 登陆普通用户: 查询剩余积分, 在线充值</span><br><span class="line">	- 开发者登陆:</span><br><span class="line">        我的软件--&gt;创建新软件: 名字随便, 秘钥不要改---&gt;软件代码 + 通讯秘钥</span><br><span class="line">		开发文档:PythonHTTP操作示例</span><br></pre></td></tr></table></figure></div>

<h2 id="2、云打码平台接口使用"><a href="#2、云打码平台接口使用" class="headerlink" title="2、云打码平台接口使用"></a>2、云打码平台接口使用</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 获取验证码:</span></span><br><span class="line"><span class="keyword">import</span> http.client, mimetypes, urllib, json, time, requests</span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YDMHttp</span>:</span></span><br><span class="line"></span><br><span class="line">    apiurl = <span class="string">'http://api.yundama.com/api.php'</span></span><br><span class="line">    username = <span class="string">''</span></span><br><span class="line">    password = <span class="string">''</span></span><br><span class="line">    appid = <span class="string">''</span></span><br><span class="line">    appkey = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, username, password, appid, appkey)</span>:</span></span><br><span class="line">        self.username = username  </span><br><span class="line">        self.password = password</span><br><span class="line">        self.appid = str(appid)</span><br><span class="line">        self.appkey = appkey</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(self, fields, files=[])</span>:</span></span><br><span class="line">        response = self.post_url(self.apiurl, fields, files)</span><br><span class="line">        response = json.loads(response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">balance</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'balance'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">if</span> (response[<span class="string">'ret'</span>] <span class="keyword">and</span> response[<span class="string">'ret'</span>] &lt; <span class="number">0</span>):</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'ret'</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'balance'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'login'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">if</span> (response[<span class="string">'ret'</span>] <span class="keyword">and</span> response[<span class="string">'ret'</span>] &lt; <span class="number">0</span>):</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'ret'</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'uid'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(self, filename, codetype, timeout)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'upload'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey, <span class="string">'codetype'</span>: str(codetype), <span class="string">'timeout'</span>: str(timeout)&#125;</span><br><span class="line">        file = &#123;<span class="string">'file'</span>: filename&#125;</span><br><span class="line">        response = self.request(data, file)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">if</span> (response[<span class="string">'ret'</span>] <span class="keyword">and</span> response[<span class="string">'ret'</span>] &lt; <span class="number">0</span>):</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'ret'</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'cid'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">result</span><span class="params">(self, cid)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'result'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey, <span class="string">'cid'</span>: str(cid)&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">return</span> response <span class="keyword">and</span> response[<span class="string">'text'</span>] <span class="keyword">or</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, filename, codetype, timeout)</span>:</span></span><br><span class="line">        cid = self.upload(filename, codetype, timeout)</span><br><span class="line">        <span class="keyword">if</span> (cid &gt; <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, timeout):</span><br><span class="line">                result = self.result(cid)</span><br><span class="line">                <span class="keyword">if</span> (result != <span class="string">''</span>):</span><br><span class="line">                    <span class="keyword">return</span> cid, result</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-3003</span>, <span class="string">''</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> cid, <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report</span><span class="params">(self, cid)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'report'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey, <span class="string">'cid'</span>: str(cid), <span class="string">'flag'</span>: <span class="string">'0'</span>&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">return</span> response[<span class="string">'ret'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post_url</span><span class="params">(self, url, fields, files=[])</span>:</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> files:</span><br><span class="line">            files[key] = open(files[key], <span class="string">'rb'</span>);</span><br><span class="line">        res = requests.post(url, files=files, data=fields)</span><br><span class="line">        <span class="keyword">return</span> res.text</span><br><span class="line"></span><br><span class="line"><span class="comment">#################只有一下部分需要作出修改, 上面的类不需要该#########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户名</span></span><br><span class="line">username    = <span class="string">'jeremy0820'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 密码</span></span><br><span class="line">password    = <span class="string">'0820_ab'</span>                            </span><br><span class="line"></span><br><span class="line"><span class="comment"># 软件ＩＤ，开发者分成必要参数。登录开发者后台【我的软件】获得！</span></span><br><span class="line">appid       = <span class="number">7608</span>                                    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 软件密钥，开发者分成必要参数。登录开发者后台【我的软件】获得！</span></span><br><span class="line">appkey      = <span class="string">'106f27ed6a4ef2c97652c68a76a505f9'</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 图片文件</span></span><br><span class="line">filename    = <span class="string">'./code.jpg'</span>                        </span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证码类型，# 例：1004表示4位字母数字，不同类型收费不同。请准确填写，否则影响识别率。在此查询所有类型 http://www.yundama.com/price.html</span></span><br><span class="line">codetype    = <span class="number">1004</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 超时时间，秒</span></span><br><span class="line">timeout     = <span class="number">60</span>                                    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查</span></span><br><span class="line"><span class="keyword">if</span> (username == <span class="string">'username'</span>):</span><br><span class="line">    print(<span class="string">'请设置好相关参数再测试'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    yundama = YDMHttp(username, password, appid, appkey)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 登陆云打码</span></span><br><span class="line">    uid = yundama.login();</span><br><span class="line">    print(<span class="string">'uid: %s'</span> % uid)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询余额</span></span><br><span class="line">    balance = yundama.balance();</span><br><span class="line">    print(<span class="string">'balance: %s'</span> % balance)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始识别，图片路径，验证码类型ID，超时时间（秒），识别结果</span></span><br><span class="line">    cid, result = yundama.decode(filename, codetype, timeout);</span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################################</span></span><br></pre></td></tr></table></figure></div>

<h2 id="3、动态传参与模拟登陆"><a href="#3、动态传参与模拟登陆" class="headerlink" title="3、动态传参与模拟登陆"></a>3、动态传参与模拟登陆</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 古诗文网模拟登陆</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取隐藏参数</span></span><br><span class="line">session =  requests.Session()</span><br><span class="line">url = <span class="string">"https://so.gushiwen.org/user/login.aspx"</span></span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">"headers"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36"</span>&#125;</span><br><span class="line">response = session.get(url=url, headers=headers).text</span><br><span class="line">etree_obj = etree.HTML(response)</span><br><span class="line">__VIEWSTATE = etree_obj.xpath(<span class="string">"//input[@id='__VIEWSTATE']/@value"</span>)</span><br><span class="line">__VIEWSTATEGENERATOR = etree_obj.xpath(<span class="string">"//input[@id='__VIEWSTATEGENERATOR']/@value"</span>)</span><br><span class="line">print(__VIEWSTATE)</span><br><span class="line">print(__VIEWSTATEGENERATOR)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取验证码图片:</span></span><br><span class="line">url_image = <span class="string">'https://so.gushiwen.org/RandCode.ashx'</span></span><br><span class="line">content = session.get(url=url_image, headers=headers).content</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"./code.jpg"</span>, <span class="string">"wb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取验证码:</span></span><br><span class="line"><span class="keyword">import</span> http.client, mimetypes, urllib, json, time, requests</span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YDMHttp</span>:</span></span><br><span class="line"></span><br><span class="line">    apiurl = <span class="string">'http://api.yundama.com/api.php'</span></span><br><span class="line">    username = <span class="string">''</span></span><br><span class="line">    password = <span class="string">''</span></span><br><span class="line">    appid = <span class="string">''</span></span><br><span class="line">    appkey = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, username, password, appid, appkey)</span>:</span></span><br><span class="line">        self.username = username  </span><br><span class="line">        self.password = password</span><br><span class="line">        self.appid = str(appid)</span><br><span class="line">        self.appkey = appkey</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(self, fields, files=[])</span>:</span></span><br><span class="line">        response = self.post_url(self.apiurl, fields, files)</span><br><span class="line">        response = json.loads(response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">balance</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'balance'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">if</span> (response[<span class="string">'ret'</span>] <span class="keyword">and</span> response[<span class="string">'ret'</span>] &lt; <span class="number">0</span>):</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'ret'</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'balance'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'login'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">if</span> (response[<span class="string">'ret'</span>] <span class="keyword">and</span> response[<span class="string">'ret'</span>] &lt; <span class="number">0</span>):</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'ret'</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'uid'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(self, filename, codetype, timeout)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'upload'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey, <span class="string">'codetype'</span>: str(codetype), <span class="string">'timeout'</span>: str(timeout)&#125;</span><br><span class="line">        file = &#123;<span class="string">'file'</span>: filename&#125;</span><br><span class="line">        response = self.request(data, file)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">if</span> (response[<span class="string">'ret'</span>] <span class="keyword">and</span> response[<span class="string">'ret'</span>] &lt; <span class="number">0</span>):</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'ret'</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> response[<span class="string">'cid'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">result</span><span class="params">(self, cid)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'result'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey, <span class="string">'cid'</span>: str(cid)&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">return</span> response <span class="keyword">and</span> response[<span class="string">'text'</span>] <span class="keyword">or</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, filename, codetype, timeout)</span>:</span></span><br><span class="line">        cid = self.upload(filename, codetype, timeout)</span><br><span class="line">        <span class="keyword">if</span> (cid &gt; <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, timeout):</span><br><span class="line">                result = self.result(cid)</span><br><span class="line">                <span class="keyword">if</span> (result != <span class="string">''</span>):</span><br><span class="line">                    <span class="keyword">return</span> cid, result</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-3003</span>, <span class="string">''</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> cid, <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report</span><span class="params">(self, cid)</span>:</span></span><br><span class="line">        data = &#123;<span class="string">'method'</span>: <span class="string">'report'</span>, <span class="string">'username'</span>: self.username, <span class="string">'password'</span>: self.password, <span class="string">'appid'</span>: self.appid, <span class="string">'appkey'</span>: self.appkey, <span class="string">'cid'</span>: str(cid), <span class="string">'flag'</span>: <span class="string">'0'</span>&#125;</span><br><span class="line">        response = self.request(data)</span><br><span class="line">        <span class="keyword">if</span> (response):</span><br><span class="line">            <span class="keyword">return</span> response[<span class="string">'ret'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-9001</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post_url</span><span class="params">(self, url, fields, files=[])</span>:</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> files:</span><br><span class="line">            files[key] = open(files[key], <span class="string">'rb'</span>);</span><br><span class="line">        res = requests.post(url, files=files, data=fields)</span><br><span class="line">        <span class="keyword">return</span> res.text</span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户名</span></span><br><span class="line">username    = <span class="string">'jeremy0820'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 密码</span></span><br><span class="line">password    = <span class="string">'0820_ab'</span>                            </span><br><span class="line"></span><br><span class="line"><span class="comment"># 软件ＩＤ，开发者分成必要参数。登录开发者后台【我的软件】获得！</span></span><br><span class="line">appid       = <span class="number">7608</span>                                    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 软件密钥，开发者分成必要参数。登录开发者后台【我的软件】获得！</span></span><br><span class="line">appkey      = <span class="string">'106f27ed6a4ef2c97652c68a76a505f9'</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 图片文件</span></span><br><span class="line">filename    = <span class="string">'./code.jpg'</span>                        </span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证码类型，# 例：1004表示4位字母数字，不同类型收费不同。请准确填写，否则影响识别率。在此查询所有类型 http://www.yundama.com/price.html</span></span><br><span class="line">codetype    = <span class="number">1004</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 超时时间，秒</span></span><br><span class="line">timeout     = <span class="number">60</span>                                    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查</span></span><br><span class="line"><span class="keyword">if</span> (username == <span class="string">'username'</span>):</span><br><span class="line">    print(<span class="string">'请设置好相关参数再测试'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    yundama = YDMHttp(username, password, appid, appkey)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 登陆云打码</span></span><br><span class="line">    uid = yundama.login();</span><br><span class="line">    print(<span class="string">'uid: %s'</span> % uid)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询余额</span></span><br><span class="line">    balance = yundama.balance();</span><br><span class="line">    print(<span class="string">'balance: %s'</span> % balance)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始识别，图片路径，验证码类型ID，超时时间（秒），识别结果</span></span><br><span class="line">    cid, result = yundama.decode(filename, codetype, timeout);</span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line">print(<span class="string">"验证码识别结果:"</span>, result)</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"__VIEWSTATE"</span>: __VIEWSTATE,</span><br><span class="line">    <span class="string">"__VIEWSTATEGENERATOR"</span>: __VIEWSTATEGENERATOR,</span><br><span class="line">    <span class="string">"from"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"email"</span>: <span class="string">"yujeremy0820@gmail.com"</span>,</span><br><span class="line">    <span class="string">"pwd"</span>: <span class="string">"0820@ab"</span>,</span><br><span class="line">    <span class="string">"code"</span>: result,</span><br><span class="line">    <span class="string">"denglu"</span>: <span class="string">"登录"</span>,</span><br><span class="line">&#125;</span><br><span class="line">login =session.post(url=url, headers=headers, data=data)</span><br><span class="line">index_url = <span class="string">'https://so.gushiwen.org/user/collect.aspx'</span></span><br><span class="line">index_content = session.get(url=index_url, headers=headers).text</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./shi.html'</span>, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(<span class="string">"开始写文件"</span>)</span><br><span class="line">    f.write(index_content)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>打码平台</tag>
      </tags>
  </entry>
  <entry>
    <title>多线程爬虫</title>
    <url>/Spider/Spider_id_12.html</url>
    <content><![CDATA[<h2 id="1、整体思路"><a href="#1、整体思路" class="headerlink" title="1、整体思路"></a>1、整体思路</h2><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">&gt; 队列保存变化的参数，即之前构建的类似页码的东西。</span><br><span class="line"></span><br><span class="line">&gt; 一个类实现：三个线程进行数据采集，依次从队列中获取参数，拼接url，请求到的网	页源码保存到新队列。</span><br><span class="line"></span><br><span class="line">&gt; 一个类实现 ：<span class="number">1.</span>  三个线程进行数据处理，依次从队列中获取源码，xpath定位元素	取出文本，构建字典。<span class="number">2.</span> 定义函数数据入库，pymongon数据插入数据即可</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">主程序 mian 分为 两 部分</span><br><span class="line"></span><br><span class="line">- 实例化队列，我们有两组线程在工作，初始队列一个，线程间通信需要一个，一共两个</span><br><span class="line"></span><br><span class="line">- 实例化线程，通过遍历实例化线程类，创建俩组三线程。</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">调用主程序</span><br></pre></td></tr></table></figure></div>



<ol start="2">
<li><p>具体部署，和相关知识点罗列</p>
<p>细节决定成败，必须搞清楚每一步的意义是什么，而不是说这里就应该这么写，没有那么多理所应当。</p>
<p>#####具体部署： </p>
<ul>
<li><p>定义第一个类：</p>
<ul>
<li><p>定义类：需要继承threading.Thread父类</p>
</li>
<li><p>类属性：想清楚传那些熟悉</p>
<ol>
<li><p>参数队列要传进来</p>
</li>
<li><p>子类重写初始化属性</p>
<p>先继承父类属性—-&gt;然后写自己要加的属性</p>
</li>
</ol>
</li>
<li><p>定义方法：</p>
<p>重写run方法</p>
<p>​    通过无限循环获取队列中的参数，实现请求多页面，</p>
<p>​    这个队列是被三个线程去访问的。</p>
</li>
</ul>
</li>
<li><p>定义第二个类：</p>
<p>​    需要考虑的和第一个类思路是一样的，这里有一个互斥锁的加入</p>
<p>​    就是在处理数据的时候加入，因为写入数据库的字段都一样，避免数据量过大</p>
<p>​    出错，导致数据错乱。</p>
</li>
<li><p>主程序代码</p>
<ul>
<li><p>实例队列对象</p>
<p>page_Queue = Queue() 构建参数</p>
<p>data_Queue = Queue() 负责两个主线程间的通信</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<pre><code>+ 实例互斥锁对象

  lock = Lock()



+ 构建两个主线程，一个线程负责采集数据，一个线程处理数据并入库

+ 当然都是用for循环来构建的，记得线程类需要传入那些属性</code></pre><ul>
<li><p>调用主程序</p>
<p>#####相关知识点： </p>
</li>
<li><p>重写父类同名方法需要注意:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParseTread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, threadName, dataQueue, lock)</span>:</span></span><br><span class="line">        <span class="comment"># 先把父类的方法继承下来</span></span><br><span class="line">        super(ParseTread, self).__init__()</span><br><span class="line">        <span class="comment"># 然后定义自己的方法</span></span><br><span class="line">        self.threadName = threadName</span><br><span class="line">        self.dataQueue = dataQueue</span><br><span class="line">        self.lock = lock</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>首先明白什么是进程什么是线程，线程和进程的区别？</p>
<p>线程（有时候称为轻量级进程）与进程类似，不过它们是在同一个进程下执行的，并共享相同的上下文。可以将它们认为是在一个主进程或“主线程”中并行运行的一些“迷你进程”。 </p>
<p>这里讲的很清楚<a href="https://www.cnblogs.com/chbo/p/7043660.html" target="_blank" rel="noopener">https://www.cnblogs.com/chbo/p/7043660.html</a> </p>
</li>
<li><p>我们的子线程为什么要设置join()，其实设置了守护线程才是join()出现的时机</p>
<p>如果是为了避免数据的恶性竞争的话，互斥锁是接这个的小能手。</p>
</li>
<li><p>为什么要设置守护线程</p>
<p>如果给线程设置守护线程，那么后台线程执行完毕就会杀死这些线程。大致的作用就是当你退出进程，后台线程关闭那么这些子线程也要同时关闭。</p>
</li>
<li><p>join()的作用，和其存在的意义</p>
<p>join()的功能是设置阻塞，之所以要设置join()就是有选择的设置守护线程，因为我们有的线程需要同步主线程结束而结束，而有的线程需要执行完毕菜行。设置了守护线程的子线程都会随着主线的结束而结束。</p>
<p>我们这里设置的join()是没有意义的，因为并没有设置守护线程，因此没必要设置阻塞。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> chaojiying <span class="keyword">import</span> Chaojiying_Client</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> re, threading</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CrawlThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, threadName, page_Queue, data_Queue)</span>:</span></span><br><span class="line">        super(CrawlThread, self).__init__()</span><br><span class="line">        self.threadName = threadName</span><br><span class="line">        self.pageQueue = page_Queue</span><br><span class="line">        self.dataQueue = data_Queue</span><br><span class="line">        self.headers = &#123;<span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"</span>,&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        url1 = <span class="string">'http://www.ziroom.com/z/nl/z3.html?p=%s'</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 如果队列为空 block 为 True 那么进入阻塞状态</span></span><br><span class="line">                <span class="comment"># 如果队列为控 block 为 false 那么会抛出异常</span></span><br><span class="line">                p = self.pageQueue.get(block=<span class="literal">False</span>)</span><br><span class="line">                print(<span class="string">'%s开始工作...'</span> % self.threadName)</span><br><span class="line">                response = requests.get(url=url1 % p, headers=self.headers)</span><br><span class="line">                content = response.text</span><br><span class="line">                self.dataQueue.put(content)</span><br><span class="line">                <span class="comment"># print(self.dataQueue.qsize())</span></span><br><span class="line">                print(<span class="string">'%s工作结束...'</span> % self.threadName)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParseTread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, threadName, dataQueue, lock)</span>:</span></span><br><span class="line">        super(ParseTread, self).__init__()</span><br><span class="line">        self.threadName = threadName</span><br><span class="line">        self.dataQueue = dataQueue</span><br><span class="line">        self.lock = lock</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                html = self.dataQueue.get(block=<span class="literal">False</span>)</span><br><span class="line">                print(<span class="string">'%s开始处理数据........'</span> % self.threadName)</span><br><span class="line">                self.get_price_list(html)</span><br><span class="line">                print(<span class="string">'%s数据处理完毕........'</span> % self.threadName)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(e)</span><br><span class="line">                <span class="comment"># print('出错了')</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_price_list</span><span class="params">(self, html)</span>:</span></span><br><span class="line">        <span class="comment"># 正则匹配图片地址，超级鹰打码，获取列表两个参数 code 下标列表</span></span><br><span class="line">        price_image = re.findall(<span class="string">r'"image":"(.*?)"'</span>, html)[<span class="number">0</span>]</span><br><span class="line">        index_list = re.findall(<span class="string">r'"offset":(.*?)&#125;;'</span>, html)[<span class="number">0</span>]</span><br><span class="line">        index_list = eval(index_list)</span><br><span class="line">        <span class="comment"># print(index_list)</span></span><br><span class="line">        price_image_link = <span class="string">'http:'</span> + price_image</span><br><span class="line">        <span class="comment"># print(price_image_link)</span></span><br><span class="line">        request.urlretrieve(price_image_link, <span class="string">'./im.jpg'</span>)</span><br><span class="line">        <span class="comment"># 超级鹰打码，获取到图片中的数字</span></span><br><span class="line">        chaojiying = Chaojiying_Client(<span class="string">'ipython'</span>, <span class="string">'123456789'</span>, <span class="string">'96001'</span>)</span><br><span class="line">        im = open(<span class="string">'im.jpg'</span>, <span class="string">'rb'</span>).read()</span><br><span class="line">        code = chaojiying.PostPic(im, <span class="number">4111</span>)[<span class="string">'pic_str'</span>]</span><br><span class="line">        price_list = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> index_list:</span><br><span class="line">            <span class="comment"># print(j)</span></span><br><span class="line">            str1 = <span class="string">''</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> j:</span><br><span class="line">                str1 += code[int(i)]</span><br><span class="line">            <span class="comment"># print(code)</span></span><br><span class="line">            <span class="comment"># print(str1)</span></span><br><span class="line">            price_list.append(int(str1))</span><br><span class="line">        self.get_detail_list(html, price_list)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_detail_list</span><span class="params">(self, html, price_list)</span>:</span></span><br><span class="line">        html = etree.HTML(html)</span><br><span class="line">        data_list = html.xpath(<span class="string">'//ul[@id="houseList"]/li'</span>)</span><br><span class="line">        a = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> data_list:</span><br><span class="line">            item = &#123;&#125;</span><br><span class="line">            title = i.xpath(<span class="string">'.//h3/a[@class="t1"]/text()'</span>)[<span class="number">0</span>]</span><br><span class="line">            size_detail = i.xpath(<span class="string">'.//div[@class="detail"]/p'</span>)[<span class="number">0</span>].xpath(<span class="string">'.//span/text()'</span>)</span><br><span class="line">            position = i.xpath(<span class="string">'.//div[@class="detail"]/p'</span>)[<span class="number">1</span>].xpath(<span class="string">'.//span/text()'</span>)[<span class="number">0</span>]</span><br><span class="line">            item = &#123;<span class="string">'标题'</span>: title, <span class="string">'面积'</span>: size_detail, <span class="string">'位置'</span>: position, <span class="string">'价格'</span>: price_list[a]&#125;</span><br><span class="line">            a += <span class="number">1</span></span><br><span class="line">            <span class="keyword">with</span> self.lock:</span><br><span class="line">                self.save(item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        conn = pymongo.MongoClient(<span class="string">"localhost"</span>,<span class="number">27017</span>)</span><br><span class="line">        db = conn.qiubai</span><br><span class="line">        table = db.qiubai</span><br><span class="line">        table.insert(item)</span><br><span class="line">       </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(n)</span>:</span></span><br><span class="line">    page_Queue = Queue()</span><br><span class="line">    data_Queue = Queue()</span><br><span class="line">    lock = Lock()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,n+<span class="number">1</span>):</span><br><span class="line">        page_Queue.put(i)</span><br><span class="line"></span><br><span class="line">    crawlList = &#123;<span class="string">'长征1号'</span>, <span class="string">'长征2号'</span>, <span class="string">'长征3号'</span>&#125;</span><br><span class="line">    TreadCrawl = []</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> crawlList:</span><br><span class="line">        c = CrawlThread(var, page_Queue, data_Queue)</span><br><span class="line">        c.start()</span><br><span class="line">        TreadCrawl.append(c)</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> TreadCrawl:</span><br><span class="line">        var.join()</span><br><span class="line">    parseList = [<span class="string">'嫦娥1号'</span>, <span class="string">'嫦娥2号'</span>, <span class="string">'嫦娥3号'</span>]</span><br><span class="line">    TreadParse = []</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> parseList:</span><br><span class="line">        p = ParseTread(var, data_Queue, lock)</span><br><span class="line">        p.start()</span><br><span class="line">        TreadParse.append(p)</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> TreadParse:</span><br><span class="line">        var.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main(<span class="number">10</span>)</span><br></pre></td></tr></table></figure></div>



</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>多线程爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>xpath使用</title>
    <url>/Spider/Spider_id_07.html</url>
    <content><![CDATA[<h2 id="1、xpath解析库"><a href="#1、xpath解析库" class="headerlink" title="1、xpath解析库"></a>1、xpath解析库</h2><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Xpath解析库介绍:</span></span><br><span class="line">	数据解析的过程中使用过正则表达式, 但正则表达式想要进准匹配难度较高, 一旦正则表达式书写错误, 匹配的数据也会出错.</span><br><span class="line">    网页由三部分组成: HTML, Css, JavaScript, HTML页面标签存在层级关系, 即DOM树, 在获取目标数据时可以根据网页层次关系定位标签, 在获取标签的文本或属性.</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># xpath解析库解析数据原理:</span></span><br><span class="line"><span class="number">1.</span> 根据网页DOM树定位节点标签</span><br><span class="line"><span class="number">2.</span> 获取节点标签的正文文本或属性值</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># xpath安装, 初体验 --&gt; 使用步骤:	xpath解析网络网页</span></span><br><span class="line"><span class="number">1.</span>xpath安装: pip install lxml</span><br><span class="line"><span class="number">2.</span>requests模块爬取壁纸:</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 获取请求地址，第一页内容---第五页内容</span></span><br><span class="line">url_list = [<span class="string">'http://www.win4000.com/zt/gaoqing_%d.html'</span> % num <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">6</span>)]</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 遍历网页 获取每一个网页的文本</span></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> url_list:</span><br><span class="line">    res = requests.get(url=url,headers=headers).text</span><br><span class="line">    <span class="comment"># 创建对象，变量tree接收</span></span><br><span class="line">    tree = etree.HTML(res)</span><br><span class="line">    <span class="comment"># 从对象中获取需要的图片地址，使用变量url2_list接收</span></span><br><span class="line">    url2_list = tree.xpath(<span class="string">'//ul[@class="clearfix"]/li/a/img/@data-original'</span>)</span><br><span class="line">    <span class="comment"># 遍历图片地址对象，获取每一个地址</span></span><br><span class="line">    <span class="keyword">for</span> url2 <span class="keyword">in</span> url2_list:</span><br><span class="line">        <span class="comment"># 获取每一个页面的二进制流</span></span><br><span class="line">        content = requests.get(url=url2,headers=headers).content</span><br><span class="line">        name = url2.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'./src/%s'</span>%name,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            print(name)</span><br><span class="line">            f.write(content)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># xpath解析本地文件</span></span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">tree = etree.parse(<span class="string">'./qb.html'</span>, etree.HTMLParser())</span><br><span class="line">title_lst = tree.xpath(<span class="string">'//ul/li/div/a/text()'</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> title_lst:</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># xpath语法:</span></span><br><span class="line"><span class="number">1.</span>常用规则:</span><br><span class="line">      <span class="number">1.</span>  nodename:		  节点名定位</span><br><span class="line">      <span class="number">2.</span>  //:			  从当前节点选取子孙节点</span><br><span class="line">      <span class="number">3.</span>  /:			  从当前节点选取直接子节点</span><br><span class="line">      <span class="number">4.</span>  nodename[@attribute=<span class="string">"..."</span>]  根据属性定位标签</span><br><span class="line">      <span class="number">5.</span>  @attributename:  获取属性 </span><br><span class="line">      <span class="number">6.</span>  text():		   获取文本</span><br><span class="line">   </span><br><span class="line"><span class="number">2.</span>属性匹配两种情况: 多属性匹配 &amp;  单属性多值匹配  </span><br><span class="line">     <span class="number">2.2</span> 多属性匹配</span><br><span class="line">    示例: tree.xpath(<span class="string">'//div[@class="item" and @name="test"]/text()'</span>) 	</span><br><span class="line">    <span class="number">2.1</span> 单属性多值匹配</span><br><span class="line">    示例: tree.xpath(<span class="string">'//div[contains(@class, "dc")]/text()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>按序选择:</span><br><span class="line">    <span class="number">3.1</span> 索引定位: 从<span class="number">1</span>开始</span><br><span class="line">    <span class="number">3.2</span> last()函数</span><br><span class="line">    <span class="number">3.3</span> position()函数</span><br></pre></td></tr></table></figure></div>

<h2 id="解析示例-示例解析的是本地文件"><a href="#解析示例-示例解析的是本地文件" class="headerlink" title="解析示例: 示例解析的是本地文件"></a>解析示例: 示例解析的是本地文件</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Xpath练习文件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"007"</span>&gt;</span></span><br><span class="line">    "我是div标签的文字内容, 和下面的p标签还有div标签是同级的哦"</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是p标签内的文字内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>这是p标签同级的div标签<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divtag"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>第1个li标签<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>第2个li标签<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>第3个li标签<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>第4个li标签<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>第5个li标签<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.baidu.com"</span>&gt;</span>这是百度的跳转连接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"c1"</span> <span class="attr">name</span>=<span class="string">"laoda"</span>&gt;</span>老大在此<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"c1 c3"</span> <span class="attr">name</span>=<span class="string">"laoer"</span>&gt;</span>老二任性, class有两个值<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"c1"</span> <span class="attr">name</span>=<span class="string">"laosan"</span>&gt;</span>我是老三<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">tree = etree.parse(<span class="string">'./x.html'</span>, etree.HTMLParser())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.根据节点名, 即nodename定位title标签, 获取标签内文字</span></span><br><span class="line">title_text = tree.xpath(<span class="string">'//title/text()'</span>)</span><br><span class="line">print(title_text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.根据节点属性定位: 定位id为007的div标签</span></span><br><span class="line">div_007 = tree.xpath(<span class="string">'//div[@id="007"]'</span>)</span><br><span class="line">print(div_007)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.示例直接子节点与子孙节点:/, //</span></span><br><span class="line">div_007_one = tree.xpath(<span class="string">'//div[@id="007"]/text()'</span>)</span><br><span class="line">print(div_007_one)</span><br><span class="line">div_007_two = tree.xpath(<span class="string">'//div[@id="007"]//text()'</span>)</span><br><span class="line">print(div_007_two)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.获取a标签的href属性</span></span><br><span class="line">a_href = tree.xpath(<span class="string">'//div[@class="divtag"]/a/@href'</span>)</span><br><span class="line">print(a_href)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.多属性定位: 根据class属性和name属性定位div标签</span></span><br><span class="line">div_two_attr = tree.xpath(<span class="string">'//div[@class="c1" and @name="laoda"]/text()'</span>)</span><br><span class="line">print(div_two_attr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.属性多值定位: 定位所有class中有c1的div标签</span></span><br><span class="line">div_c1 = tree.xpath(<span class="string">'//div[contains(@class, "c1")]'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.按序定位</span></span><br><span class="line">li_first = tree.xpath(<span class="string">'//div[@class="divtag"]/ul/li[1]/text()'</span>)  <span class="comment"># 定位第一个li标签, 获取其文本</span></span><br><span class="line">print(li_first)</span><br><span class="line"></span><br><span class="line">li_last = tree.xpath(<span class="string">'//div[@class="divtag"]/ul/li[last()]/text()'</span>)  <span class="comment"># 定位最后一个li标签</span></span><br><span class="line">print(li_last)</span><br><span class="line"></span><br><span class="line">li_daotwo = tree.xpath(<span class="string">'//div[@class="divtag"]/ul/li[last()-1]/text()'</span>)  <span class="comment"># 定位倒数第二个li标签</span></span><br><span class="line">print(li_daotwo)</span><br><span class="line"></span><br><span class="line">li_qianthree = tree.xpath(<span class="string">'//div[@class="divtag"]/ul/li[position()&lt;4]/text()'</span>)  <span class="comment"># 定位前三个li标签</span></span><br><span class="line">print(li_qianthree)</span><br></pre></td></tr></table></figure></div>

<h2 id="作业"><a href="#作业" class="headerlink" title="作业:"></a>作业:</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>爬取糗事百科, 热门前两页的每一项标题, 详情页链接, 好笑指数及评论数</span><br><span class="line"><span class="number">2.</span>默写</span><br><span class="line">res = requests.get(url=url, headers=headers, params=params, proxies=proxies)</span><br><span class="line">res = requests.post(url=url, headers=headers, data=data, proxies=proxies)</span><br><span class="line">代理类型:</span><br><span class="line">    透明代理:</span><br><span class="line">    匿名代理:</span><br><span class="line">    高匿代理:</span><br><span class="line">    </span><br><span class="line">获取响应数据内容:</span><br><span class="line">		res.text		获取HTML文本</span><br><span class="line">		res.content		获取二进制流</span><br><span class="line">		res.json()		获取json数据</span><br><span class="line">xpath常用规则:</span><br><span class="line">      <span class="number">1.</span>  nodename:		  节点名定位</span><br><span class="line">      <span class="number">2.</span>  //:			  从当前节点选取子孙节点</span><br><span class="line">      <span class="number">3.</span>  /:			  从当前节点选取直接子节点</span><br><span class="line">      <span class="number">4.</span>  nodename[@attribute=<span class="string">"..."</span>]  根据属性定位标签</span><br><span class="line">      <span class="number">5.</span>  @attributename:  获取属性 </span><br><span class="line">      <span class="number">6.</span>  text():		   获取文本</span><br></pre></td></tr></table></figure></div>



]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Xpath</tag>
      </tags>
  </entry>
  <entry>
    <title>selenuim模块的使用</title>
    <url>/Spider/Spider_id_06.html</url>
    <content><![CDATA[<h2 id="1、selenium介绍"><a href="#1、selenium介绍" class="headerlink" title="1、selenium介绍"></a>1、selenium介绍</h2><a id="more"></a>

<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>selenium是一个web自动化测试用的框架. 程序员可以通过代码实现对浏览器的控制, 比如打开网页, 点击网页中的元素, 实现鼠标滚动等操作.</span><br><span class="line"><span class="number">2.</span>它支持多款浏览器, 如谷歌浏览器, 火狐浏览器等等, 当然也支持无头浏览器.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目的:</span></span><br><span class="line">在爬取数据的过程中, 经常遇到动态数据加载, 一般动态数据加载有两种, 一种通过ajax请求加载数据, 另一种通过js代码加载动态数据. selenium可以模拟人操作真实浏览器, 获取加载完成的页面数据</span><br><span class="line">ajax:</span><br><span class="line">    url有规律且未加密, 直接构建url连接请求</span><br><span class="line">    url加密过无法破解规律 --&gt; selenium</span><br><span class="line">js动态数据加载 --&gt;  selenium</span><br></pre></td></tr></table></figure>

<h2 id="2、selenium安装"><a href="#2、selenium安装" class="headerlink" title="2、selenium安装"></a>2、selenium安装</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">三要素: 浏览器, 驱动程序, selenium框架</span><br><span class="line">	浏览器: 推荐谷歌浏览器, 标准稳定版本</span><br><span class="line">	谷歌浏览器驱动程序chromedriver.exe下载地址:http://chromedriver.storage.googleapis.com/index.html</span><br><span class="line">         火狐浏览器驱动chromedriver.exe下载地址:https://github.com/mozilla/geckodriver/releases</span><br><span class="line">            <span class="comment"># 将下载的驱动放在python环境的scirpt文件中，不需要导入使用，或者放在跟py文件同级的目录中，但是每次需导入使用</span></span><br><span class="line">	pip install selenium   <span class="comment"># 安装selenium模块</span></span><br><span class="line"><span class="comment"># 测试:</span></span><br><span class="line">url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser = webdriver.Chrome(<span class="string">'./webdriver'</span>)   <span class="comment"># 将驱动放在脚本所在的文件夹</span></span><br><span class="line">browser.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果报错---cannot find Chrome binary</span></span><br><span class="line">则使用如下测试</span><br><span class="line">url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line">option = webdriver.ChromeOptions()</span><br><span class="line">option.binary_location = <span class="string">"D:\software\Google\Chrome\Application\chrome.exe"</span></span><br><span class="line">browser = webdriver.Chrome(options=option)</span><br><span class="line">browser.get(url)</span><br></pre></td></tr></table></figure></div>

<h2 id="3、selenium常用操作"><a href="#3、selenium常用操作" class="headerlink" title="3、selenium常用操作"></a>3、selenium常用操作</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 实例化浏览器对象:</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser = webdriver.Chrome(<span class="string">'driverpath'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送get请求:</span></span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取页面元素:</span></span><br><span class="line">find_element_by_id(<span class="string">'ID名'</span>):根据元素的id</span><br><span class="line">find_element_by_name():根据元素的name属性</span><br><span class="line">find_element_by_xpath():根据xpath表达式</span><br><span class="line">find_element_by_class_name():根据<span class="class"><span class="keyword">class</span>的值</span></span><br><span class="line"><span class="class"><span class="title">find_element_by_css_selector</span><span class="params">()</span>:</span>根据css选择器</span><br><span class="line">find_element_by_link_text(<span class="string">'text'</span>):根据超链接的文本进行定位</span><br><span class="line">find_element_by_partial_link_text(<span class="string">'a part of text'</span>):根据超文本的文本进行模块匹配</span><br><span class="line"></span><br><span class="line"><span class="comment"># 节点交互操作:</span></span><br><span class="line">click(): 点击</span><br><span class="line">send_keys(): 输入内容</span><br><span class="line">clear(): 清空操作</span><br><span class="line">browser.forword():前进</span><br><span class="line">browser.back():后退</span><br><span class="line"></span><br><span class="line">execute_script(js): 执行指定的js代码</span><br><span class="line"><span class="comment"># JS代码: window.scrollTo(0, document.body.scrollHeight)可以模拟鼠标滚动一屏高度</span></span><br><span class="line">quit(): 退出浏览器</span><br><span class="line">    I quit! 我不干!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取网页的数据:</span></span><br><span class="line">browser.page_source   ---&gt;  获取网页源代码---str类型</span><br><span class="line">获取元素属性：get_attribute()</span><br><span class="line">获取元素文本：get_text()</span><br><span class="line">获取元素位置：element.location</span><br><span class="line">获取元素尺寸：element.size</span><br><span class="line"></span><br><span class="line"><span class="comment"># frame</span></span><br><span class="line">switch_to.frame(<span class="string">'frameid'</span>) </span><br><span class="line">switch_to.default_coutent()</span><br></pre></td></tr></table></figure></div>

<h2 id="4、qq空间模拟登陆"><a href="#4、qq空间模拟登陆" class="headerlink" title="4、qq空间模拟登陆"></a>4、qq空间模拟登陆</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># 实例化浏览器对象</span></span><br><span class="line">browser = webdriver.Chrome(<span class="string">'./chromedriver.exe'</span>)</span><br><span class="line"><span class="comment"># 打开qq空间登陆页面</span></span><br><span class="line">browser.get(<span class="string">'https://qzone.qq.com/'</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 转至frame子页面</span></span><br><span class="line">browser.switch_to.frame(<span class="string">'login_frame'</span>)</span><br><span class="line"><span class="comment"># 获取密码登陆选项并点击</span></span><br><span class="line">a_tag = browser.find_element_by_id(<span class="string">'switcher_plogin'</span>)</span><br><span class="line">a_tag.click()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 获取账号输入框并输入账号</span></span><br><span class="line">browser.find_element_by_id(<span class="string">'u'</span>).clear()</span><br><span class="line">user = browser.find_element_by_id(<span class="string">'u'</span>)</span><br><span class="line">user.send_keys(<span class="string">'3338003899'</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 获取密码输入框并输入密码</span></span><br><span class="line">browser.find_element_by_id(<span class="string">'p'</span>).clear()</span><br><span class="line">pwd = browser.find_element_by_id(<span class="string">'p'</span>)</span><br><span class="line">pwd.send_keys(<span class="string">'qq123456'</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 获取登陆按钮并单击</span></span><br><span class="line">button = browser.find_element_by_id(<span class="string">'login_button'</span>)</span><br><span class="line">button.click()</span><br></pre></td></tr></table></figure></div>

<h2 id="5、PhantomJS浏览器使用"><a href="#5、PhantomJS浏览器使用" class="headerlink" title="5、PhantomJS浏览器使用"></a>5、PhantomJS浏览器使用</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># PhantomJS下载及配置环境变量</span></span><br><span class="line">	- 下载, 直接解压</span><br><span class="line">	- 将解压文件的bin目录添加至环境变量</span><br><span class="line">    </span><br><span class="line"><span class="comment"># PhantomJS无界面浏览器</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser = webdriver.PhantomJS()</span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'baidu_phantomjs.html'</span>, <span class="string">'w'</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(browser.page_source)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 谷歌无头浏览器</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">'--headless'</span>)</span><br><span class="line">chrome_options.add_argument(<span class="string">'--disable-gpu'</span>)</span><br><span class="line">browser = webdriver.Chrome(chrome_options=chrome_options)</span><br><span class="line">browser.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">print(browser.page_source)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'baidu_headerless.html'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(browser.page_source)</span><br></pre></td></tr></table></figure></div>

<h2 id="6、图片懒加载"><a href="#6、图片懒加载" class="headerlink" title="6、图片懒加载"></a>6、图片懒加载</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">url = <span class="string">'http://sc.chinaz.com/tupian/index.html'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"USer-Agent"</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url=url, headers=headers)</span><br><span class="line">res.encoding = <span class="string">'utf-8'</span></span><br><span class="line"><span class="comment"># print(res.text)</span></span><br><span class="line">tree = etree.HTML(res.text)</span><br><span class="line"></span><br><span class="line">src_list = tree.xpath(<span class="string">'//div[contains(@class,"box")]/div/a/img/@src2'</span>)</span><br><span class="line"><span class="keyword">for</span> url_img <span class="keyword">in</span> src_list:</span><br><span class="line">    request.urlretrieve(url_img,<span class="string">'%s.jpg'</span>%src_list.index(url_img))</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome(<span class="string">'./chromedriver.exe'</span>)</span><br><span class="line">browser.get(<span class="string">'http://image.baidu.com/'</span>)</span><br><span class="line">search = browser.find_element_by_id(<span class="string">'kw'</span>)</span><br><span class="line">search.send_keys(<span class="string">'安琪拉'</span>)</span><br><span class="line">button = browser.find_element_by_class_name(<span class="string">'s_search'</span>)</span><br><span class="line">button.click()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    browser.execute_script(<span class="string">'window.scrollTo(0, document.body.scrollHeight)'</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">text = browser.page_source</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'baidu_pic.html'</span>, <span class="string">'w'</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(open(<span class="string">'./baidu_pic.html'</span>, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>), <span class="string">'lxml'</span>)</span><br><span class="line">li_list = soup.select(<span class="string">'.imgpage ul li'</span>)</span><br><span class="line"><span class="keyword">for</span> url_img <span class="keyword">in</span> li_list:</span><br><span class="line">    url_img = url_img[<span class="string">'data-objurl'</span>]</span><br><span class="line">    print(url_img)</span><br></pre></td></tr></table></figure></div>

<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 作业:雪球网首页, 抓取推荐咨询的每一条标题与详情页链接(使用selenium模拟鼠标向下滑动)</span></span><br><span class="line">https://xueqiu.com/</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 默写:</span></span><br><span class="line">    <span class="comment"># 实例化浏览器对象:</span></span><br><span class="line">    <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">    browser = webdriver.Chrome(<span class="string">'driverpath'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送get请求:</span></span><br><span class="line">    browser.get(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取页面元素:</span></span><br><span class="line">    find_element_by_id</span><br><span class="line">    find_element_by_xpath</span><br><span class="line">    find_element_by_name</span><br><span class="line">    find_element_by_class_name</span><br><span class="line">    find_element_by_css_selector</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 交互操作:</span></span><br><span class="line">    click(): 点击</span><br><span class="line">    send_keys(): 输入内容</span><br><span class="line">    clear(): 清空操作</span><br><span class="line">    execute_script(js): 执行指定的js代码</span><br><span class="line">    <span class="comment"># JS代码: window.scrollTo(0, document.body.scrollHeight)可以模拟鼠标滚动一屏高度</span></span><br><span class="line">    quit(): 退出浏览器</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取网页的数据:</span></span><br><span class="line">    browser.page_source   ---&gt;  str类型</span><br></pre></td></tr></table></figure>

<h2 id="7、扩展鼠标操作"><a href="#7、扩展鼠标操作" class="headerlink" title="7、扩展鼠标操作"></a>7、扩展鼠标操作</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">ActionChains类里面的方法行为：</span><br><span class="line">初始化的时候需要传driver 对象，内置的一个空列表中：（译：）</span><br><span class="line"></span><br><span class="line">    perform：执行所有的行为</span><br><span class="line">        （译：泼峰）执行所有存储的操作</span><br><span class="line">    reset_actions：将整个列表清空</span><br><span class="line">        （译：瑞斯特.安可深思）清除已在本地和远程端存储的操作　　</span><br><span class="line">    click：点击</span><br><span class="line">        （译：可立克）点击一个元素。　　</span><br><span class="line">    click_and_hold：拖拽</span><br><span class="line">        （译：可立克.按得.后的）按住元素上的鼠标左键。不松　　</span><br><span class="line">    context_click：右击</span><br><span class="line">        （译：康泰克斯特.可立克）对元素执行上下文单击(右击)。　　</span><br><span class="line">    double_click：双击</span><br><span class="line">        （译：大泊儿.可立克）双击其中的一个元素。</span><br><span class="line">    drag_and_drop：拖拽到目标后松开</span><br><span class="line">        （译：转个.按得.赵坡）按住源元素上的鼠标左键，然后移动到目标元素并释放鼠标按钮。　　　　</span><br><span class="line">    drag_and_drop_by_offset：偏移拖拽</span><br><span class="line">        （译：转个.按得.赵坡.白.奥佛赛特）按住源元素上的鼠标左键，然后移动到目标偏移量并释放鼠标按钮。　　　</span><br><span class="line">    key_down：在一个元素上按住一个键不松</span><br><span class="line">        （译：k当）只发送一个按键，不释放它。只能与修改键(控制，Ctrl、Alt和Shift)一起使用。　　</span><br><span class="line">    key_up： 松开按键</span><br><span class="line">        （译：K阿婆）释放修改键。　　</span><br><span class="line">    move_by_offset：鼠标移动</span><br><span class="line">        （译：目.白.奥佛赛特）将鼠标移动到当前鼠标位置的偏移量。　　</span><br><span class="line">    move_to_element：鼠标悬浮</span><br><span class="line">        （译：目.图.按了们特）将鼠标移动到元素的中间。　　</span><br><span class="line">    move_to_element_with_offset：鼠标坐标偏移</span><br><span class="line">        （译：目.图.按了们特.位子.奥佛赛特）将鼠标移动指定元素的偏移量。偏移量相对于元素的左上角。　　</span><br><span class="line">    pause：暂停</span><br><span class="line">        （译：普斯）在指定的持续时间内暂停所有输入(以秒为单位)--每个动作执行后需要暂停几秒不执行之后操作　　</span><br><span class="line">    release：松开</span><br><span class="line">        （译：瑞丽斯）释放元素上被按住的鼠标按钮。　　</span><br><span class="line">    send_keys：输入</span><br><span class="line">        （译：森德.K死）向元素发送键。　　</span><br><span class="line">    send_keys_to_element：在元素上输入文本</span><br><span class="line">        （译：森德.K死.图.按了们特）</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">案例：登录自动验证滑块验证码</span><br><span class="line">url = <span class="string">"http://localhost:8080/login"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 本人使用的是火狐浏览器</span></span><br><span class="line">browser = webdriver.Firefox()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动访问爬取页面</span></span><br><span class="line">browser.get(url=url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取username输入框</span></span><br><span class="line">username = browser.find_element_by_xpath(<span class="string">'/html/body/div/div/section/div/div[1]/input'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取password输入框</span></span><br><span class="line">password = browser.find_element_by_xpath(<span class="string">'/html/body/div/div/section/div/div[2]/input'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取滑动块按钮，注意：获取的是滑动块中那个会移动的按钮，并未滑动块</span></span><br><span class="line">div = browser.find_element_by_xpath(<span class="string">"/html/body/div/div/section/div/center/div/div/div[3]"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取登录按钮</span></span><br><span class="line">login = browser.find_element_by_xpath(<span class="string">"/html/body/div/div/section/div/div[3]/button"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户为123，自动填充到用户框中</span></span><br><span class="line">username.send_keys(“<span class="number">123</span>”)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密码为123，自动填充到密码框中</span></span><br><span class="line">password.send_keys(“<span class="number">123</span>”)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用鼠标操作模块ActionChains，详情请访问链接：https://www.cnblogs.com/shouhu/p/12205169.html</span></span><br><span class="line">active = ActionChains(browser)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 鼠标左键点击目标，且不松开</span></span><br><span class="line">active.click_and_hold(div).perform()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将滑动按钮移动到目标位置后松开鼠标左键，release()方法为松开鼠标左键</span></span><br><span class="line"><span class="comment"># 参数xoffset为滑动的左右长度及横轴，yoffset为滑动的上下的高度及纵轴</span></span><br><span class="line">active.move_by_offset(xoffset=<span class="number">250</span>, yoffset=<span class="number">0</span>).release().perform()</span><br><span class="line"><span class="comment"># 自动点击登录</span></span><br><span class="line">login.click()</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Selenuim</tag>
      </tags>
  </entry>
  <entry>
    <title>sceapy框架</title>
    <url>/Spider/Spider_id_05.html</url>
    <content><![CDATA[<h2 id="1、scrapy安装与环境依赖"><a href="#1、scrapy安装与环境依赖" class="headerlink" title="1、scrapy安装与环境依赖"></a>1、scrapy安装与环境依赖</h2><p>　　1.在安装scrapy前需要安装好相应的依赖库, 再安装scrapy, 具体安装步骤如下:</p>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>).安装lxml库: pip install lxml</span><br><span class="line">(<span class="number">2</span>).安装wheel: pip install wheel</span><br><span class="line">(<span class="number">3</span>).安装twisted: pip install twisted文件路径</span><br><span class="line">	(twisted需下载后本地安装,下载地址:http://www.lfd.uci.edu/~gohlke/pythonlibs/<span class="comment">#twisted)</span></span><br><span class="line">	(版本选择如下图,版本后面有解释,请根据自己实际选择)</span><br><span class="line">(<span class="number">4</span>).安装pywin32: pip install pywin32</span><br><span class="line">	(注意:以上安装步骤一定要确保每一步安装都成功,没有报错信息,如有报错自行百度解决)</span><br><span class="line">(<span class="number">5</span>).安装scrapy: pip install scrapy</span><br><span class="line">	(注意:以上安装步骤一定要确保每一步安装都成功,没有报错信息,如有报错自行百度解决)</span><br><span class="line">(<span class="number">6</span>).成功验证:在cmd命令行输入scrapy,显示Scrapy1<span class="number">.6</span><span class="number">.0</span>-no active project,证明安装成功</span><br></pre></td></tr></table></figure></div>

<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/sceapy.png">

<h2 id="2、创建项目"><a href="#2、创建项目" class="headerlink" title="2、创建项目"></a>2、创建项目</h2><p>　　1.手动创建一个目录test<br>　　2.在test文件夹下创建爬虫项目为spiderpro: scrapy startproject spiderpro<br>　　3.进入项目文件夹: cd spiderpro<br>　　4.创建爬虫文件: scrapy genspider 爬虫名 域名</p>
<h2 id="3、项目目录介绍"><a href="#3、项目目录介绍" class="headerlink" title="3、项目目录介绍"></a>3、项目目录介绍</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">spiderpro</span><br><span class="line">　　spiderpro <span class="comment"># 项目目录</span></span><br><span class="line">　　　　__init__</span><br><span class="line">　　　　spiders:爬虫文件目录</span><br><span class="line">　　　　　　__init__</span><br><span class="line">　　　　　　tests.py:爬虫文件</span><br><span class="line">　　　　items.py:定义爬取数据持久化的数据结构</span><br><span class="line">　　　　middlewares.py:定义中间件</span><br><span class="line">　　　　pipelines.py:管道,持久化存储相关</span><br><span class="line">　　　　settings.py:配置文件</span><br><span class="line">　　venv:虚拟环境目录</span><br><span class="line">　 scrapy.cfg: scrapy项目配置文件</span><br></pre></td></tr></table></figure></div>

<h2 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h2><p>　　(1).spiders:其内包含一个个Spider的实现, 每个Spider是一个单独的文件<br>　　(2).items.py:它定义了Item数据结构, 爬取到的数据存储为哪些字段<br>　　(3).pipelines.py:它定义Item Pipeline的实现<br>　　(4).settings.py:项目的全局配置<br>　　(5).middlewares.py:定义中间件, 包括爬虫中间件和下载中间件<br>　　(6).scrapy.cfg:它是scrapy项目的配置文件, 其内定义了项目的配置路径, 部署相关的信息等</p>
<h2 id="4、scrapy框架介绍-5大核心组件与数据流向"><a href="#4、scrapy框架介绍-5大核心组件与数据流向" class="headerlink" title="4、scrapy框架介绍: 5大核心组件与数据流向"></a>4、scrapy框架介绍: 5大核心组件与数据流向</h2><img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/sceapy2.png" style="zoom:70%">

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>).架构:</span><br><span class="line"></span><br><span class="line">　　Scrapy Engine: 这是引擎，负责Spiders、ItemPipeline、Downloader、Scheduler中间的通讯，信号、数据传递等等!</span><br><span class="line"></span><br><span class="line">　　Scheduler(调度器): 它负责接受引擎发送过来的requests请求，并按照一定的方式进行整理排列，入队、并等待Scrapy Engine(引擎)来请求时，交给引擎。</span><br><span class="line"></span><br><span class="line">　　Downloader（下载器)：负责下载Scrapy Engine(引擎)发送的所有Requests请求，并将其获取到的Responses交还给Scrapy Engine(引擎)，由引擎交给Spiders来处理，</span><br><span class="line"></span><br><span class="line">　　Spiders：它负责处理所有Responses,从中分析提取数据，获取Item字段需要的数据，并将需要跟进的URL提交给引擎，再次进入Scheduler(调度器)，</span><br><span class="line"></span><br><span class="line">　　Item Pipeline：它负责处理Spiders中获取到的Item，并进行处理，比如去重，持久化存储（存数据库，写入文件，总之就是保存数据用的）</span><br><span class="line"></span><br><span class="line">　　Downloader Middlewares(下载中间件)：你可以当作是一个可以自定义扩展下载功能的组件</span><br><span class="line"></span><br><span class="line">　　Spider Middlewares(Spider中间件)：你可以理解为是一个可以自定扩展和操作引擎和Spiders中间‘通信‘的功能组件（比如进入Spiders的Responses;和从Spiders出去的Requests）</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">(<span class="number">2</span>).工作流:</span><br><span class="line"></span><br><span class="line">　　<span class="number">1.</span>spider将请求发送给引擎, 引擎将request发送给调度器进行请求调度</span><br><span class="line"></span><br><span class="line">　　<span class="number">2.</span>调度器把接下来要请求的request发送给引擎, 引擎传递给下载器, 中间会途径下载中间件</span><br><span class="line"></span><br><span class="line">　　<span class="number">3.</span>下载携带request访问服务器, 并将爬取内容response返回给引擎, 引擎将response返回给spider</span><br><span class="line"></span><br><span class="line">　　<span class="number">4.</span>spider将response传递给自己的parse进行数据解析处理及构建item一系列的工作, 最后将item返回给引擎, 引擎传递个pipeline</span><br><span class="line"></span><br><span class="line">　　<span class="number">5.</span>pipe获取到item后进行数据持久化</span><br><span class="line"></span><br><span class="line">　　<span class="number">6.</span>以上过程不断循环直至爬虫程序终止</span><br></pre></td></tr></table></figure></div>

<h2 id="5、使用scrapy框架爬取糗百"><a href="#5、使用scrapy框架爬取糗百" class="headerlink" title="5、使用scrapy框架爬取糗百"></a>5、使用scrapy框架爬取糗百</h2><p>　　需求: 爬取糗事百科热门板块,每一条的标题,好笑,评论条数及作者信息,解析爬取的信息数据,定制item数据存储结构,最终将数据存储于MongoDB数据库中.<br>　　创建项目:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">scrapy startproject qsbk <span class="comment"># 创建项目</span></span><br><span class="line">cd qsbk <span class="comment"># 切换到项目目录</span></span><br><span class="line">scrapy genspider qsbk_hot www.qiushibaike.com <span class="comment"># 创建爬虫文件, qsbk_hot为爬虫名, www...com为爬取范围</span></span><br></pre></td></tr></table></figure></div>

<p>　　item文件定义数据存储的字段:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QsbkItem</span><span class="params">(scrapy.Item)</span>:</span></span><br><span class="line">    title = scrapy.Field()  <span class="comment"># 标题</span></span><br><span class="line">    lau = scrapy.Field()  <span class="comment"># 好笑数</span></span><br><span class="line">    comment = scrapy.Field()  <span class="comment"># 评论数</span></span><br><span class="line">    auth = scrapy.Field()  <span class="comment"># 作者</span></span><br></pre></td></tr></table></figure></div>

<p>　　spider文件中定义解析数据的方法</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QsbkHotSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">	name =<span class="string">'qsbk_hot'</span></span><br><span class="line">	<span class="comment"># allowed_domains = ['www.qiushibaike.com'] # 无用, 可注释掉</span></span><br><span class="line">	start_urls =[<span class="string">'http://www.qiushibaike.com/'</span>]</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 思路:一条热点数据在前端中对应一个li标签, 将一页中的所有li标签取出, 再进一步操作</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line"></span><br><span class="line">		li_list = response.selector.xpath(<span class="string">'//div[@class="recommend-article"]/ul/li'</span>)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 循环li标签组成的列表, 先实例化item, 再取需要的字段, 并该item对象的相应属性赋值</span></span><br><span class="line">		<span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line"></span><br><span class="line">			<span class="comment"># 实例化item对象</span></span><br><span class="line">			item =QsbkItem()</span><br><span class="line"></span><br><span class="line">			<span class="comment"># 解析获取title(标题), lau(好笑数), comment(评论数), auth(作者)等信息</span></span><br><span class="line">			title = li.xpath(<span class="string">'./div[@class="recmd-right"]/a/text()'</span>).extract_first()</span><br><span class="line">			lau = li.xpath(<span class="string">'./div[@class="recmd-right"]/div[@class="recmd-detail clearfix"]/div/span[1]/text()'</span>).extract_first()</span><br><span class="line">			comment = li.xpath(<span class="string">'./div[@class="recmd-right"]/div[@class="recmd-detail clearfix"]/div/span[4]/text()'</span>).extract_first()</span><br><span class="line">			auth = li.xpath(<span class="string">'./div[@class="recmd-right"]/div[@class="recmd-detail clearfix"]/a/span/text()'</span>).extract_first()</span><br><span class="line"></span><br><span class="line">			<span class="comment"># 因为部分热点数据还没有评论和好笑数, 所以需对数据进行处理</span></span><br><span class="line">			<span class="keyword">if</span> <span class="keyword">not</span> lau:</span><br><span class="line">				lau =<span class="literal">None</span></span><br><span class="line">			<span class="keyword">if</span> <span class="keyword">not</span> comment:</span><br><span class="line">				comment =<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">			<span class="comment"># 将字段的值存储在item的属性中</span></span><br><span class="line">            item[<span class="string">"title"</span>]= title</span><br><span class="line">            item[<span class="string">"lau"</span>]= lau</span><br><span class="line">            item[<span class="string">"comment"</span>]= comment</span><br><span class="line">            item[<span class="string">"auth"</span>]= auth</span><br><span class="line"></span><br><span class="line">			<span class="comment"># 返回item, 框架会自动将item传送至pipeline中的指定类</span></span><br><span class="line">			<span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure></div>

<p>　　在pipeline中定义管道类进行数据的存储</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">classQsbkPipeline(object):</span><br><span class="line">　　<span class="comment"># 连接MongoDB数据库</span></span><br><span class="line">	conn = pymongo.MongoClient(<span class="string">"localhost"</span>, <span class="number">27017</span>)</span><br><span class="line">	db = conn.qiubai</span><br><span class="line">	table = db.qb_hot</span><br><span class="line"></span><br><span class="line">　　<span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">　　　　<span class="comment"># 向数据库中出入数据</span></span><br><span class="line">　　　　self.table.insert(dict(item))</span><br><span class="line"></span><br><span class="line">　　　　<span class="comment"># 此处return item是为了下一个管道类能够接收到item进行存储</span></span><br><span class="line">　　　　<span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">　　<span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self)</span>:</span></span><br><span class="line">　　　　<span class="comment"># 关闭数据库连接</span></span><br><span class="line">　　　　self.conn.close()</span><br></pre></td></tr></table></figure></div>

<p>　　此示例中配置文件中的配置的项, 注意是不是全部的配置, 是针对该项目增加或修改的配置项</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 忽略robots协议</span></span><br><span class="line">ROBOTSTXT_OBEY =<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># UA伪装</span></span><br><span class="line">USER_AGENT = <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.87 Safari/537.36'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 管道类的注册配置</span></span><br><span class="line">ITEM_PIPELINES =&#123;</span><br><span class="line"><span class="string">'qsbk.pipelines.QsbkPipeline'</span>:<span class="number">300</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="6、scrapy爬取校花网人名与图片下载链接"><a href="#6、scrapy爬取校花网人名与图片下载链接" class="headerlink" title="6、scrapy爬取校花网人名与图片下载链接"></a>6、scrapy爬取校花网人名与图片下载链接</h2><p>　　需求: 爬取校花网大学校花的默认的第一页的所有图片src和人名, 并通过管道存入mongodb数据库<br>　　创建项目:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">scrapy startproject xiaohuaspider <span class="comment"># 创建项目</span></span><br><span class="line">cd xiaohuaspider <span class="comment"># 切换到项目目录</span></span><br><span class="line">scrapy genspider hua www.baidu.com <span class="comment"># 创建爬虫文件, hua为爬虫名, www.baidu.com为爬取范围</span></span><br></pre></td></tr></table></figure></div>

<p>　　创建item类, 用于存储解析出的数据</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XiaohuaspiderItem</span><span class="params">(scrapy.Item)</span>:</span></span><br><span class="line">    name = scrapy.Field()</span><br><span class="line">    src = scrapy.Field()</span><br></pre></td></tr></table></figure></div>

<p>　　spider中定义爬取的行为与解析数据的操作</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> ..items <span class="keyword">import</span> XiaohuaspiderItem</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HuaSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'hua'</span></span><br><span class="line">    <span class="comment"># allowed_domains = ['www.baidu.com']</span></span><br><span class="line">    start_urls = [<span class="string">'http://www.xiaohuar.com/hua/'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        div_list = response.xpath(<span class="string">'//div[@class="img"]'</span>)</span><br><span class="line">        <span class="keyword">for</span> div <span class="keyword">in</span> div_list:</span><br><span class="line">            item = XiaohuaspiderItem()</span><br><span class="line">            name = div.xpath(<span class="string">'.//span/text()'</span>).extract_first()</span><br><span class="line">            src = div.xpath(<span class="string">'./a/img/@src'</span>).extract_first()</span><br><span class="line">            item[<span class="string">"name"</span>] = name</span><br><span class="line">            item[<span class="string">"src"</span>] = src</span><br><span class="line">            <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure></div>

<p>　　itemPipeline编码, 持久化数据到本地</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XiaohuaspiderPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line">    conn = pymongo.MongoClient(<span class="string">'localhost'</span>, <span class="number">27017</span>)</span><br><span class="line">    db = conn.xiaohua</span><br><span class="line">    table = db.hua</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        self.table.insert(dict(item))</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.conn.close()</span><br></pre></td></tr></table></figure></div>

<p>　　配置项:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># UA伪装:</span></span><br><span class="line">USER_AGENT = <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.87 Safari/537.36'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略robots协议:</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启管道类</span></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">'xiaohuaspider.pipelines.XiaohuaspiderPipeline'</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Sceapy</tag>
      </tags>
  </entry>
  <entry>
    <title>requests高级部分 &amp; urllib简单介绍 &amp; 正则</title>
    <url>/Spider/Spider_id_04.html</url>
    <content><![CDATA[<h2 id="1、requests高级用法"><a href="#1、requests高级用法" class="headerlink" title="1、requests高级用法"></a>1、requests高级用法</h2><a id="more"></a>

<h2 id="1、1-文件上传功能"><a href="#1、1-文件上传功能" class="headerlink" title="1、1  文件上传功能"></a>1、1  文件上传功能</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义上传文件数据, 键为file, 值为文件句柄</span></span><br><span class="line">files = &#123;</span><br><span class="line"><span class="string">'file'</span>: open(<span class="string">'favicon.ico'</span>, <span class="string">'rb'</span>)</span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(<span class="string">'http://httpbin.org/post'</span>, files=files)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure></div>

<h2 id="1、2-cookie处理"><a href="#1、2-cookie处理" class="headerlink" title="1、2  cookie处理"></a>1、2  cookie处理</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 手动处理cookie：</span></span><br><span class="line">	<span class="number">1.</span>headers添加cookie键值对</span><br><span class="line">	<span class="number">2.</span>RequestsCookieJar对象</span><br><span class="line"><span class="comment"># 自动处理cookie：Session</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># headers内添加cookie键值对处理cookie</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">'Cookie'</span>:<span class="string">'BIDUPSID=E01FE1A1E9555174ABC136FBFBFDE674; PSTM=1575031812; BD_UPN=12314753; BAIDUID=580A55392F38BF9168294CCFB5F408C8:FG=1; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; yjs_js_security_passport=fed4dfca16fcc236aa3827bce130a90fcb7407bd_1576809267_js; COOKIE_SESSION=7114_0_9_7_8_5_0_0_9_3_0_0_7493_0_2_0_1576828833_0_1576828831%7C9%23951_22_1576726592%7C4; delPer=0; H_PS_PSSID=1458_21104_30211_30284_26350; BDUSS=VA4dG9aTExqY0ZsQkVPYkk2a3Z-TTlseWEteW9-ZkFZOHZ6TGZoN2VyRXVIU1JlRUFBQUFBJCQAAAAAAAAAAAEAAAB45WVmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC6Q~F0ukPxdd; BD_HOME=1'</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">res = requests.get(url = url , headers = headers)</span><br><span class="line">res.encoding = <span class="string">'urf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'baidu_login.html'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.text)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># RequestsCookieJar对象处理cookie: 用cookie维持百度登陆</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">cookies = <span class="string">'BIDUPSID=E01FE1A1E9555174ABC136FBFBFDE674; PSTM=1575031812; BD_UPN=12314753; BAIDUID=580A55392F38BF9168294CCFB5F408C8:FG=1; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; yjs_js_security_passport=fed4dfca16fcc236aa3827bce130a90fcb7407bd_1576809267_js; COOKIE_SESSION=7114_0_9_7_8_5_0_0_9_3_0_0_7493_0_2_0_1576828833_0_1576828831%7C9%23951_22_1576726592%7C4; delPer=0; H_PS_PSSID=1458_21104_30211_30284_26350; BDUSS=VA4dG9aTExqY0ZsQkVPYkk2a3Z-TTlseWEteW9-ZkFZOHZ6TGZoN2VyRXVIU1JlRUFBQUFBJCQAAAAAAAAAAAEAAAB45WVmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC6Q~F0ukPxdd; BD_HOME=1'</span></span><br><span class="line">jar = requests.cookies.RequestsCookieJar()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cookies.split(<span class="string">';'</span>):</span><br><span class="line">    key,value = item.split(<span class="string">'='</span>,<span class="number">1</span>)</span><br><span class="line">    jar.set(key,value)</span><br><span class="line"></span><br><span class="line">res = requests.get(url = url , headers = headers , cookies = jar)</span><br><span class="line">res.encoding = <span class="string">'utf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'baidu.html'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.text)	 <span class="comment"># 响应数据中包含用户名信息, 说明cookie生效</span></span><br></pre></td></tr></table></figure></div>

<h2 id="1、3-会话维持"><a href="#1、3-会话维持" class="headerlink" title="1、3  会话维持"></a>1、3  会话维持</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># HTTP无状态:</span></span><br><span class="line">	使用requests模块中的get()和post()方法请求网页时, 每一次请求都是独立的, 没有连续请求之间的状态保持. 假象, 如果你登陆了淘宝后向查看订单, 那么如果没有状态的维持就无法实现.</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 会话的维持: Session对象</span></span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Session</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.renren.com/ajaxLogin/login?1=1&amp;uniqueTimestamp=20191151116375'</span></span><br><span class="line">session = Session()</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'email'</span>: <span class="string">'17679962330'</span>,</span><br><span class="line">    <span class="string">'icode'</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="string">'origURL'</span>: <span class="string">'http://www.renren.com/home'</span>,</span><br><span class="line">    <span class="string">'domain'</span>: <span class="string">'renren.com'</span>,</span><br><span class="line">    <span class="string">'key_id'</span>: <span class="string">'1'</span>,</span><br><span class="line">    <span class="string">'captcha_type'</span>: <span class="string">'web_login'</span>,</span><br><span class="line">    <span class="string">'password'</span>: <span class="string">'4f099e818abe7310b77aa1b5f45e5e4084e4af309d90750e1d88bae39e85c828'</span>,</span><br><span class="line">    <span class="string">'rkey'</span>: <span class="string">'080f2e6d6b76e31a7ebc070c15096350'</span>,</span><br><span class="line">    <span class="string">'f'</span>: <span class="string">'http%3A%2F%2Fwww.renren.com%2F973125645%2Fnewsfeed%2Fphoto'</span>,</span><br><span class="line">&#125;</span><br><span class="line">res = session.post(url=url, headers=headers, data=data)</span><br><span class="line">ret = session.get(url=<span class="string">'http://www.renren.com/972036549/profile'</span>,data=data)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'renren.html'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(ret.text)</span><br></pre></td></tr></table></figure></div>

<h2 id="1、4-SSL证书验证"><a href="#1、4-SSL证书验证" class="headerlink" title="1、4  SSL证书验证"></a>1、4  SSL证书验证</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.SSL证书验证</span></span><br><span class="line">requests提供了证书验证的功能. 当发起HTTP请求时, 模块会检查SSL证书. 但检查的行为可以用verify参数来控制.</span><br><span class="line">	verify = <span class="literal">False</span>  <span class="comment"># 不检查SSL证书</span></span><br><span class="line">	verify = <span class="literal">True</span>  <span class="comment"># 检查SSL证书</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.异常</span></span><br><span class="line">如果使用requests模块的SSL验证, 验证不通过会抛出异常, 此时可以将verify参数设置为<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.https://www.tutumanhua.com的证书验证</span></span><br><span class="line"><span class="comment"># 会抛出异常	requests.exceptions.SSLError</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'https://www.tutumanhua.com'</span>)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不抛异常, 但会出现警告</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'https://www.tutumanhua.com'</span>, verify=<span class="literal">False</span>)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止警告</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.packages <span class="keyword">import</span> urllib3</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line">response = requests.get(url=<span class="string">'https://www.tutumanhua.com'</span>, verify=<span class="literal">False</span>)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最终版</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://www.tutumanhua.com'</span></span><br><span class="line">requests.packages.urllib3.disable_warnings() </span><br><span class="line">res = requests.get(url=url, headers=headers, verify=<span class="literal">False</span>)</span><br><span class="line">print(res.status_code)</span><br></pre></td></tr></table></figure></div>

<h2 id="1、5-代理设置"><a href="#1、5-代理设置" class="headerlink" title="1、5  代理设置"></a>1、5  代理设置</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 代理: 代理即代理ip</span></span><br><span class="line">代理ip是指在请求的过程中使用非本机ip进行请求, 避免大数据量频繁请求的过程中出现ip封禁, 限制数据的爬取.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理ip分类:</span></span><br><span class="line">	<span class="number">1.</span>透明代理ip: 请求时, 服务器知道请求的真实ip, 知道请求使用了代理</span><br><span class="line">	<span class="number">2.</span>匿名代理ip: 请求时, 服务器知道请求使用了代理, 但不知道请求的真实ip</span><br><span class="line">	<span class="number">3.</span>高匿代理ip: 请求时, 服务器不知道请求使用了代理, 也不知道请求的真实ip</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'https://www.baidu.com/s?ie=utf-8&amp;f=8&amp;rsv_bp=1&amp;rsv_idx=1&amp;tn=baidu&amp;wd=ip&amp;rsv_pq=a834758700059ab8&amp;rsv_t=60b33hUYnp%2F0I7P%2BFsy%2Fe0GZ9wIALM9f5WL12gftyn1dJvP7j9kOrAvyK7I&amp;rqlang=cn&amp;rsv_enter=1&amp;rsv_dl=tb&amp;rsv_sug3=3&amp;rsv_sug1=3&amp;rsv_sug7=101&amp;rsv_sug2=0&amp;prefixsug=ip&amp;rsp=2&amp;inputT=1808&amp;rsv_sug4=2550'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'https'</span> : <span class="string">'http://122.5.109.231:9999'</span>	<span class="comment"># 不管键是https，还是Http,后面的值都是http</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url=url,headers=headers,proxies=proxies)</span><br><span class="line">res.encoding = <span class="string">'utf-8'</span></span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure></div>

<h2 id="1、6-超时设置"><a href="#1、6-超时设置" class="headerlink" title="1、6  超时设置"></a>1、6  超时设置</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 超时设置:</span></span><br><span class="line">	由于网络状况的不同, 服务器配置差异以及服务器处理并发的能力不同, 有时会出现服务器的响应时间过长, 甚至无法获取响应而抛出异常. requests模块发送请求可以设置超时时间, 在超时时间内未得到响应, 便会抛出异常.</span><br><span class="line">    一方面, 减少了请求的阻塞时间, 一方面, 可以进行异常处理, 执行相应的操作.</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    res = requests.get(url=url, headers=headers,timeout=<span class="number">0.1</span>)</span><br><span class="line">    res.encoding = <span class="string">'utf-8'</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'baidu_1.html'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(res.text)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'爬取超时'</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="1、7-构建Request对象"><a href="#1、7-构建Request对象" class="headerlink" title="1、7  构建Request对象"></a>1、7  构建Request对象</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.Prepared Request</span></span><br><span class="line">利用 Prepared Request 数据结构构件Request对象. 其构建及使用步骤如下:</span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Request, Session</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建Request对象</span></span><br><span class="line">url = <span class="string">'...'</span></span><br><span class="line">data = &#123;...</span><br><span class="line">&#125;</span><br><span class="line">params = &#123;...</span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;...</span><br><span class="line">&#125;</span><br><span class="line">session = Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建post请求:</span></span><br><span class="line">req_post = Request(method=<span class="string">'POST'</span>, url=url, headers=headers, data=data)</span><br><span class="line">req_obj_post = session.prepare_request(req_post)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建get请求:</span></span><br><span class="line">req_get = Request(method=<span class="string">'GET'</span>, url=url, headers=headers, params=params)</span><br><span class="line">req_obj_get = session.prepare_request(req_get)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用构建的请求对象, 向服务器发送请求</span></span><br><span class="line">res = session.send(req_obj_post)</span><br><span class="line">res = session.send(req_obj_get)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用:</span></span><br><span class="line">通过此方法, 我们可以构建一个独立的request对象, 当需要请求的url很多时, 我们可以为每一个url构建一个request对象, 将所有request对象置于队列中, 便于调度.</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 构建request对象, 请求糗事百科获取页面</span></span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Request, Session</span><br><span class="line">url = <span class="string">'https://www.qiushibaike.com/'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">session = Session()</span><br><span class="line">req_get = Request(url=url, headers=headers, method=<span class="string">'GET'</span>)</span><br><span class="line">req_get_obj = session.prepare_request(req_get)</span><br><span class="line">res = session.send(req_get_obj)</span><br><span class="line">res.encoding = <span class="string">'utf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'qb_reqobj.html'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.text)</span><br></pre></td></tr></table></figure></div>

<h2 id="2、urllib简单介绍"><a href="#2、urllib简单介绍" class="headerlink" title="2、urllib简单介绍"></a>2、urllib简单介绍</h2><p>　　1.urllib模块是Python的一个请求模块<br>　　2.Python2中是urllib和urllib2相结合实现请求的发送. Python3中同一为urllib库<br>　　3.urllib是Python内置的请求库, 其包含4个模块:<br>　　　　(1).request模块: 模拟发送请求<br>　　　　(2).error模块: 异常处理模块<br>　　　　(3).parse模块: 工具模块, 提供关于URL的处理方法, 如拆分, 解析, 合并等<br>　　　　(4).robotparser模块: 识别robots协议</p>
<h2 id="3-正则"><a href="#3-正则" class="headerlink" title="3.正则"></a>3.正则</h2><h2 id="3、1-元字符匹配"><a href="#3、1-元字符匹配" class="headerlink" title="3、1  元字符匹配"></a>3、1  元字符匹配</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">.     匹配任意字符，除了换行符</span><br><span class="line"></span><br><span class="line">[]    用来表示一组字符,单独列出：[abc] 匹配 <span class="string">'a'</span>，<span class="string">'b'</span>或<span class="string">'c'</span></span><br><span class="line"></span><br><span class="line">[^...]	匹配除了字符组中字符的所有字符</span><br><span class="line"></span><br><span class="line">\d    匹配任意数字，等价于 [<span class="number">0</span><span class="number">-9</span>].</span><br><span class="line"></span><br><span class="line">\D    匹配任意非数字</span><br><span class="line"></span><br><span class="line">\w    匹配字母数字及下划线</span><br><span class="line"></span><br><span class="line">\W    匹配非字母数字及下划线</span><br><span class="line"></span><br><span class="line">\s    匹配任意空白字符，等价于 [\t\n\r\f].</span><br><span class="line"></span><br><span class="line">\S    匹配任意非空字符</span><br></pre></td></tr></table></figure></div>

<h2 id="3、2-字符组-要求在一个位置匹配的字符可能出现很多种情况-各种情况组成一个组"><a href="#3、2-字符组-要求在一个位置匹配的字符可能出现很多种情况-各种情况组成一个组" class="headerlink" title="3、2  字符组: 要求在一个位置匹配的字符可能出现很多种情况, 各种情况组成一个组"></a>3、2  字符组: 要求在一个位置匹配的字符可能出现很多种情况, 各种情况组成一个组</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">[<span class="number">0123456789</span>]: 匹配<span class="number">0</span>到<span class="number">9</span>任意字符</span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>]: 同上</span><br><span class="line">[a-z]: 匹配a到z的任意小写字母</span><br><span class="line">[A-Z]: 匹配A到Z的任意大写字母</span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>a-fA-F]: 以上三种的组合, 匹配<span class="number">0</span><span class="number">-9</span>任意数组或a到f之间任意字母, 不区分大小写</span><br><span class="line">自定义字符组:[a3h5]  ---&gt;  代表匹配a, 3, h, 5等字符</span><br></pre></td></tr></table></figure>

<h2 id="3、3-量词"><a href="#3、3-量词" class="headerlink" title="3、3  量词:"></a>3、3  量词:</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">*  		重复零次或更多次</span><br><span class="line">+		重复一次或更多次</span><br><span class="line">?		重复零次或一次</span><br><span class="line">&#123;n&#125;		重复n次</span><br><span class="line">&#123;n,&#125;	重复n次或更多次</span><br><span class="line">&#123;n,m&#125;	重复n到m次</span><br></pre></td></tr></table></figure></div>

<h2 id="3、4-边界修饰符"><a href="#3、4-边界修饰符" class="headerlink" title="3、4  边界修饰符"></a>3、4  边界修饰符</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">^		匹配开始</span><br><span class="line">$		匹配结尾</span><br></pre></td></tr></table></figure></div>

<h2 id="3、5-分组"><a href="#3、5-分组" class="headerlink" title="3、5  分组"></a>3、5  分组</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">在正则表达式中添加(), 就形成了一个分组, 在re模块中优先匹配显示分组内容</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">s = <span class="string">"&lt;a href='www.baidu.com'&gt;正则匹配实验&lt;/a&gt;"</span></span><br><span class="line">res = re.findall(<span class="string">"href='(.*)'&gt;"</span>, s)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure></div>

<h2 id="3、6-匹配模式"><a href="#3、6-匹配模式" class="headerlink" title="3、6  匹配模式"></a>3、6  匹配模式</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">re.S  单行模式</span><br><span class="line">re.M  多行模式	</span><br><span class="line">re.I   忽略大小写</span><br></pre></td></tr></table></figure></div>

<h2 id="3、7-婪匹配与非贪婪匹配"><a href="#3、7-婪匹配与非贪婪匹配" class="headerlink" title="3、7  婪匹配与非贪婪匹配"></a>3、7  婪匹配与非贪婪匹配</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">贪婪匹配是指: 在使用量词:  * ,  +  等时, 尽可能多的匹配内容</span><br><span class="line">非贪婪匹配是指: 使用?对正则表达式进行修饰, 使量词的匹配尽可能少, 如+代表匹配1次或多次, 在?的修饰下, 只匹配1次.</span><br></pre></td></tr></table></figure>

<h2 id="3、8-re模块"><a href="#3、8-re模块" class="headerlink" title="3、8  re模块"></a>3、8  re模块</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>re.findall(<span class="string">'正则表达式'</span>, <span class="string">'待匹配字符串'</span>): 以列表形式返回所有满足匹配条件的结果, </span><br><span class="line"><span class="number">2.</span>re.search(<span class="string">'正则表达式'</span>, <span class="string">'带匹配字符串'</span>): 匹配到第一个就返回一个对象, 该对象使用group()进行取值, 如果未匹配到则返回<span class="literal">None</span></span><br><span class="line"><span class="number">3.</span>re.match(<span class="string">'正则表达式'</span>, <span class="string">'待匹配字符串'</span>): 从字符串开头进行匹配, 如果匹配成功返回一个对象,同样使用group()进行取值, 匹配不成功返回<span class="literal">None</span></span><br><span class="line"><span class="number">4.</span>re.compile(<span class="string">'正则表达式'</span>): 将正则表达式编译为对象, 但需要按该正则表达式匹配是可以在直接使用该对象调用以上方法即可.</span><br></pre></td></tr></table></figure></div>

<h2 id="3、9-利用正则表达式抓取图片"><a href="#3、9-利用正则表达式抓取图片" class="headerlink" title="3、9  利用正则表达式抓取图片"></a>3、9  利用正则表达式抓取图片</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 请求url, 抓取页面</span></span><br><span class="line">url = <span class="string">'http://www.win4000.com/zt/gaoqing.html'</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url=url, headers=headers)</span><br><span class="line"><span class="comment"># 利用正则匹配页面中的img标签, 获取其src属性值</span></span><br><span class="line">ret = re.findall(<span class="string">r'&lt;ul class="clearfix"&gt;.*?&lt;/ul&gt;'</span>,res.text,re.S)[<span class="number">1</span>]</span><br><span class="line">url1 = re.findall(<span class="string">r'http://pic1.win4000.com/.*?\.jpg'</span>,ret)</span><br><span class="line"><span class="comment"># 遍历获取到的图片连接, 处理连接为完整的url, 再次请求抓取图片二进制流数据, 写入文件</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> url1:</span><br><span class="line">    content = requests.get(url=url,headers=headers).content</span><br><span class="line">    name = i.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">    print(name)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'./imgs/%name'</span> % name,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(content)</span><br></pre></td></tr></table></figure></div>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Requests</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB的使用</title>
    <url>/Spider/Spider_id_02.html</url>
    <content><![CDATA[<h2 id="1、MongoDB数据库操作"><a href="#1、MongoDB数据库操作" class="headerlink" title="1、MongoDB数据库操作"></a>1、MongoDB数据库操作</h2><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;常用操作:</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 1.查看数据库</span><br><span class="line">show dbs</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 2.创建并使用数据库</span><br><span class="line">use tst</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 3.查看当前工作的数据库</span><br><span class="line">db</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 创建表</span><br><span class="line">db.createCollection(&#39;表名&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 4.创建集合并插入一条数据</span><br><span class="line">db.goods.insert(&#123;&quot;name&quot;:&quot;辣条&quot;, &quot;price&quot;:0.5&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 5.查看所有表</span><br><span class="line">show tables</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 6.查询表中所有数据</span><br><span class="line">db.goods.find()</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 格式化输出查询数据(可以按格式输出查询数据)</span><br><span class="line">db.goods.find().pretty()</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 7.删除表操作</span><br><span class="line">db.goods.drop()</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 8.删除数据库</span><br><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 增加数据操作:</span></span><br><span class="line">db.tablename.insert(&#123;dict&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例: 增加数据操作:</span></span><br><span class="line">db.goods.insert(&#123;<span class="string">"name"</span>:<span class="string">"辣条"</span>, <span class="string">"price"</span>:<span class="number">0.5</span>&#125;)</span><br><span class="line">db.goods.insert(&#123;<span class="string">"name"</span>:<span class="string">"辣条"</span>, <span class="string">"price"</span>:<span class="number">1</span>&#125;)</span><br><span class="line">db.goods.insert(&#123;<span class="string">"name"</span>:<span class="string">"干脆面"</span>, <span class="string">"price"</span>:<span class="number">0.5</span>&#125;)</span><br><span class="line">db.goods.insertOne(&#123;<span class="string">"name"</span>:<span class="string">"单身狗粮"</span>, <span class="string">"price"</span>:<span class="number">4.5</span>&#125;)</span><br><span class="line">db.goods.insertMany([&#123;<span class="string">"name"</span>:<span class="string">"小洋人"</span>, <span class="string">"price"</span>:<span class="number">3.5</span>&#125;, &#123;<span class="string">"name"</span>:<span class="string">"麦香鸡块"</span>, <span class="string">"price"</span>:<span class="number">5.5</span>&#125;])</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查询数据操作:</span></span><br><span class="line">db.tablename.find(&#123;dict&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例:查询操作</span></span><br><span class="line">    <span class="comment"># 1.简单查询操作:</span></span><br><span class="line">    db.goods.find().limit(<span class="number">4</span>).sort(&#123;<span class="string">"price"</span>:<span class="number">1</span>&#125;)        // sort(<span class="string">"定位的键"</span>:+<span class="number">-1</span>):用于对查询结果进行排序, <span class="number">1</span>升序, <span class="number">-1</span>降序</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.条件查询:db.tablename.find(&#123;"定位的键":"值"&#125;)</span></span><br><span class="line">    db.goods.find(&#123;<span class="string">"name"</span>:<span class="string">"辣条"</span>&#125;)  // 等值查询</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.and 与 or</span></span><br><span class="line">    db.goods.find(&#123;<span class="string">"name"</span>:<span class="string">"辣条"</span>, <span class="string">"price"</span>:<span class="number">0.5</span>&#125;)  // <span class="keyword">and</span>查询:根据多个条件共同定位数据</span><br><span class="line">    db.goods.find(&#123;$<span class="keyword">or</span>:[&#123;<span class="string">"name"</span>:<span class="string">"辣条"</span>&#125;,&#123;<span class="string">"price"</span>:<span class="number">3.5</span>&#125;]&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.非等值查询:db.goods.find(&#123;"定位的键":&#123;$...:"值"&#125;)</span></span><br><span class="line">    db.goods.find(&#123;<span class="string">"price"</span>:&#123;$gt:<span class="number">0.5</span>&#125;&#125;)     // 大于: $gt   </span><br><span class="line"></span><br><span class="line">    db.goods.find(&#123;<span class="string">"price"</span>:&#123;$gte:<span class="number">4.5</span>&#125;&#125;)    // 大于等于: $gte</span><br><span class="line"></span><br><span class="line">    db.goods.find(&#123;<span class="string">"price"</span>:&#123;$lt:<span class="number">4.5</span>&#125;&#125;)     // 小于: $lt</span><br><span class="line"></span><br><span class="line">    db.goods.find(&#123;<span class="string">"price"</span>:&#123;$lte:<span class="number">4.5</span>&#125;&#125;)    // 小于等于: $lte</span><br><span class="line"></span><br><span class="line">    db.goods.find(&#123;<span class="string">"price"</span>:&#123;$ne:<span class="number">5.5</span>&#125;&#125;)    // 不等于: $ne</span><br><span class="line"></span><br><span class="line">    db.goods.find(&#123;<span class="string">"price"</span>:&#123;$lt:<span class="number">5.5</span>, $gt:<span class="number">0.5</span>&#125;&#125;)  //上下限范围查询</span><br><span class="line"></span><br><span class="line">    db.goods.find(&#123;$<span class="keyword">or</span>:[&#123;<span class="string">"price"</span>:&#123;$lt:<span class="number">3.5</span>&#125;&#125;, &#123;<span class="string">"price"</span>:&#123;$gt:<span class="number">4.5</span>&#125;&#125;]&#125;) // 非上下限范围查询</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 更新数据操作:</span></span><br><span class="line">db.table.update(&#123;定位字典&#125;, &#123;指定修改的键值&#125;)</span><br><span class="line"><span class="comment"># 示例:更新数据操作:</span></span><br><span class="line">	db.goods.update(&#123;<span class="string">"price"</span>:<span class="number">0.5</span>&#125;,&#123;$set:&#123;<span class="string">"price"</span>:<span class="number">5</span>&#125;&#125;)  </span><br><span class="line">        <span class="comment"># 参数中的第一个字典用于定位要修改的数据</span></span><br><span class="line">        <span class="comment"># 参数中的第二个字典是指定要更新已定位的数据</span></span><br><span class="line">        <span class="comment"># 第二个参数中的字典是指定要将哪个字段的修改为什么</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 删除数据操作:</span></span><br><span class="line">db.tablename.remove(&#123;定位字典&#125;)</span><br><span class="line"><span class="comment"># 示例:删除数据操作:</span></span><br><span class="line">db.goods.remove(&#123;<span class="string">"price"</span>:<span class="number">5</span>&#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="2、Python与mongo交互"><a href="#2、Python与mongo交互" class="headerlink" title="2、Python与mongo交互"></a>2、Python与mongo交互</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入模块</span></span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接MongoDB数据库</span></span><br><span class="line">conn = pymongo.MongoClient(<span class="string">'localhost'</span>, <span class="number">27017</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建库</span></span><br><span class="line">db = conn.goods</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建集合</span></span><br><span class="line">table = db.snacks</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据操作: 插入数据</span></span><br><span class="line">table.insert(dict)</span><br><span class="line">table.insert_one(dict)</span><br><span class="line">table.insert_many([dict1, dict2, dict3])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据操作: 查询数据</span></span><br><span class="line">table.find_one(&#123;dict&#125;)   <span class="comment"># 返回一个字典形式数据</span></span><br><span class="line">table.find()  <span class="comment"># 返回一个mongo对象, 需要使用for循环遍历取值</span></span><br><span class="line">table.find(&#123;dict&#125;)  <span class="comment"># 同上</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 示例:</span></span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line">conn = pymongo.MongoClient(<span class="string">"localhost"</span>, <span class="number">27017</span>)</span><br><span class="line">db = conn.tst</span><br><span class="line">table = db.goods</span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line">table.insert(&#123;<span class="string">'name'</span>: <span class="string">"安慕希"</span>, <span class="string">"price"</span>:<span class="number">6</span>&#125;)</span><br><span class="line">table.insert_one(&#123;<span class="string">'name'</span>: <span class="string">"老干妈"</span>, <span class="string">"price"</span>:<span class="number">5.5</span>&#125;)</span><br><span class="line">table.insert_many([&#123;<span class="string">"name"</span>:<span class="string">"小浣熊"</span>, <span class="string">"price"</span>:<span class="number">1</span>&#125;, &#123;<span class="string">"name"</span>:<span class="string">"脉动"</span>, <span class="string">"price"</span>:<span class="number">4.5</span>&#125;])</span><br><span class="line">print(dir(table))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询数据:</span></span><br><span class="line">res_one = table.find_one(&#123;<span class="string">"name"</span>:<span class="string">"辣条"</span>&#125;)</span><br><span class="line">print(<span class="string">"find_one的查询结果:"</span>, res_one)</span><br><span class="line"></span><br><span class="line">res = table.find(&#123;<span class="string">"name"</span>:<span class="string">"辣条"</span>&#125;)  <span class="comment"># res = table.find()获得的查询结果类型及取值操作一样</span></span><br><span class="line">print(res)</span><br><span class="line">print(type(res))</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> res:</span><br><span class="line">    print(item)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 更新数据:</span></span><br><span class="line">table.update(&#123;<span class="string">"name"</span>:<span class="string">"单身狗粮"</span>&#125;,&#123;<span class="string">"$set"</span>:&#123;<span class="string">"name"</span>:<span class="string">"单身狗凉凉"</span>&#125;&#125;)</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>BS4模块的使用</title>
    <url>/Spider/Spider_id_01.html</url>
    <content><![CDATA[<h2 id="1、BS4库介绍及安装"><a href="#1、BS4库介绍及安装" class="headerlink" title="1、BS4库介绍及安装"></a>1、BS4库介绍及安装</h2><a id="more"></a>

<p>　　BeautifulSoup库介绍:<br>　　BeautifulSoup也是一个解析库<br>　　BS解析数据是依赖解析器的, BS支持的解析器有html.parser, lxml, xml, html5lib等, 其中lxml解析器解析速度快, 容错能力强.<br>　　BS现阶段应用的解析器多数是lxml<br>　　安装bs4：pip install bs4</p>
<h2 id="2、BS4编码流程"><a href="#2、BS4编码流程" class="headerlink" title="2、BS4编码流程"></a>2、BS4编码流程</h2><p>　　bs4 的编码流程:<br>　　from bs4 import BeautifulSoup<br>　　soup = BeautifulSoup(res.text, ‘lxml’)<br>　　tag = soup.select(“CSS选择器表达式”)   # 返回一个列表<br>　　tab = soup.find_all(name , attrs , text)</p>
<h2 id="3、选择器介绍"><a href="#3、选择器介绍" class="headerlink" title="3、选择器介绍"></a>3、选择器介绍</h2><p>　　选择器介绍：<br>　　　　1、节点选择器<br>　　　　2、方法选择器<br>　　　　3、CSS选择器</p>
<h2 id="3、1-节点选择器"><a href="#3、1-节点选择器" class="headerlink" title="3、1  节点选择器"></a>3、1  节点选择器</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang="en"&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset="UTF-8"&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Title&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;a href="https://www.baidu.com"&gt;跳转到百度&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">ret = soup.select(<span class="string">'a'</span>)[<span class="number">0</span>]</span><br><span class="line">print(ret.string)	       <span class="comment"># 第一种方法---获取文本</span></span><br><span class="line">print(ret.get_text())	<span class="comment"># 第二种方法--获取文本</span></span><br><span class="line">print(ret[<span class="string">'href'</span>])		<span class="comment"># 获取链接</span></span><br></pre></td></tr></table></figure></div>

<h2 id="3、2-方法选择器"><a href="#3、2-方法选择器" class="headerlink" title="3、2  方法选择器"></a>3、2  方法选择器</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">    &lt;div class="panel"&gt;</span></span><br><span class="line"><span class="string">        &lt;div class="panel-heading"&gt;</span></span><br><span class="line"><span class="string">            &lt;h4&gt;BeautifulSoup练习&lt;/h4&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">        	这是一个div的直接子文本</span></span><br><span class="line"><span class="string">        	&lt;p&gt;这是一个段落&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">		&lt;a href="https://www.baidu.com"&gt;这是百度的跳转连接&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;div class="panel-body"&gt;</span></span><br><span class="line"><span class="string">            &lt;ul class="list" id="list-1"&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element ele"&gt;第一个li标签&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element"&gt;第二个li标签&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element"&gt;第三个li标签&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;ul class="list list-small"&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element" name="english"&gt;one&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element"&gt;two&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element"&gt;123456789&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;测试多层级选择器&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="comment"># 方法选择器: find_all(name, attrs, text)</span></span><br><span class="line">ret1 = soup.find_all(name=<span class="string">'h4'</span>)[<span class="number">0</span>].string	<span class="comment"># find_all	name通过标签获取的是一个列表对象，[0]是取列表中的第一个元素，String是获取字符串文本</span></span><br><span class="line">print(ret1)	</span><br><span class="line">ret5 = soup.find(name=<span class="string">'h4'</span>).string		<span class="comment"># find	name通过标签获取的是一个字符串对象，string是获取字符串文本</span></span><br><span class="line">print(ret5)	</span><br><span class="line">ret2 = soup.find_all(attrs=&#123;<span class="string">'class'</span>: <span class="string">'element'</span>&#125;, limit=<span class="number">3</span>)	<span class="comment"># attrs是通过类对象获取对象，limit=3是只获取前三条</span></span><br><span class="line">print(ret2)</span><br><span class="line">ret3 = soup.find_all(text=<span class="string">'这是百度的跳转连接'</span>)	<span class="comment"># text是通过文本获取文本内容	(有点鸡肋)</span></span><br><span class="line">ret4 = soup.find_all(text=re.compile(<span class="string">r'\d+'</span>))	<span class="comment"># 正则表达式，获取数字文本</span></span><br><span class="line">print(ret4)</span><br></pre></td></tr></table></figure></div>

<h2 id="3、3-CSS选择器"><a href="#3、3-CSS选择器" class="headerlink" title="3、3  CSS选择器"></a>3、3  CSS选择器</h2><p>　　1.根据节点名及节点层次关系定位标签: 标签选择器 、类选择器、ID选择器、 层级选择器：单层级选择器、多层级选择器、嵌套选择</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">soup.select(<span class="string">'title'</span>)</span><br><span class="line">soup.select(<span class="string">'div &gt; ul &gt; li'</span>)   <span class="comment"># 单层级选择器</span></span><br><span class="line">soup.select(<span class="string">'div li'</span>)  <span class="comment"># 多层级选择器</span></span><br></pre></td></tr></table></figure></div>

<p>　　2.根据节点的class属性定位标签: class选择器(classical)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">soup.select(<span class="string">'.panel'</span>)</span><br></pre></td></tr></table></figure></div>

<p>　　3.根据id属性定位标签: id选择器</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">soup.select(<span class="string">'#item'</span>)</span><br></pre></td></tr></table></figure></div>

<p>　　4.嵌套选择:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">ul_list = soup.select(<span class="string">'ul'</span>)</span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> ul_list:</span><br><span class="line">  print(ul.select(<span class="string">'li'</span>))</span><br></pre></td></tr></table></figure></div>

<p>　　5.获取节点的文本或属性:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">tag_obj.string: 获取直接子文本--&gt;如果节点内有与直系文本平行的节点, 该方法拿到的是None</span><br><span class="line">tag_obj.get_text(): 获取子孙节点的所有文本</span><br><span class="line">tag_obj[<span class="string">'attribute'</span>]: 获取节点属性</span><br></pre></td></tr></table></figure></div>

<h2 id="练习示例"><a href="#练习示例" class="headerlink" title="练习示例:"></a>练习示例:</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">    &lt;div class="panel"&gt;</span></span><br><span class="line"><span class="string">        &lt;div class="panel-heading"&gt;</span></span><br><span class="line"><span class="string">            &lt;h4&gt;BeautifulSoup练习&lt;/h4&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class="divtag"&gt;</span></span><br><span class="line"><span class="string">        	这是一个div的直接子文本</span></span><br><span class="line"><span class="string">        	&lt;p&gt;这是一个段落&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">		&lt;a href="https://www.baidu.com"&gt;这是百度的跳转连接&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;div class="panel-body"&gt;</span></span><br><span class="line"><span class="string">            &lt;ul class="list xxx" id="list-1"&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element ele"&gt;第一个li标签&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element"&gt;第二个li标签&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element"&gt;第三个li标签&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;ul class="list list-small"&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element"&gt;one&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li class="element"&gt;two&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;测试多层级选择器&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;div class="element"&gt;我是div标签.....&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="comment"># 类选择器</span></span><br><span class="line">ret1 = soup.select(<span class="string">'.element'</span>)</span><br><span class="line">print(ret1)</span><br><span class="line"><span class="comment"># ID 选择器</span></span><br><span class="line">ret2 = soup.select(<span class="string">'#list-1'</span>)</span><br><span class="line">print(ret2)</span><br><span class="line"><span class="comment"># 多层级选择器: div &gt; ul &gt; li</span></span><br><span class="line">ret3 = soup.select(<span class="string">'.panel-body &gt; ul &gt; li'</span>)</span><br><span class="line">print(ret3)</span><br><span class="line"><span class="comment"># 单层级选择器</span></span><br><span class="line">ret4 = soup.select(<span class="string">'.panel-body li'</span>)</span><br><span class="line">print(ret4)</span><br><span class="line"><span class="comment"># 嵌套选择</span></span><br><span class="line">ul_list = soup.select(<span class="string">'.panel-body ul'</span>)</span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> ul_list:</span><br><span class="line">    xxx = ul.select(<span class="string">'li'</span>)</span><br><span class="line">    print(xxx)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取文本的: string及get_text()</span></span><br><span class="line">text_string = soup.select(<span class="string">'h4'</span>)[<span class="number">0</span>].string</span><br><span class="line">print(text_string)</span><br><span class="line">text_string_1 = soup.select(<span class="string">'.divtag'</span>)[<span class="number">0</span>].get_text().replace(soup.select(<span class="string">'.divtag p'</span>)[<span class="number">0</span>].string, <span class="string">""</span>).strip()</span><br><span class="line">print(text_string_1)</span><br><span class="line"><span class="comment"># 获取属性:</span></span><br><span class="line">ret5 = soup.select(<span class="string">'#list-1'</span>)[<span class="number">0</span>][<span class="string">'class'</span>]</span><br></pre></td></tr></table></figure></div>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>BS4</tag>
      </tags>
  </entry>
  <entry>
    <title>简单的购物车</title>
    <url>/Django/Django_id_26.html</url>
    <content><![CDATA[<p>　加入购物车，进入购物车，你感觉哪个简单？对，相对于加入购物车，进入购物车只需要一个简简单单的a标签就可以搞定了</p>
<a id="more"></a>
<p>今天要写的是一个保存到localStorage中的简单购物车逻辑</p>
<h2 id="点击购物车需要准备什么？"><a href="#点击购物车需要准备什么？" class="headerlink" title="点击购物车需要准备什么？"></a>点击购物车需要准备什么？</h2><p> 　　<strong>当我们点击购物车按钮时，需要实现的逻辑都有些什么呢？</strong></p>
<ol>
    <li>将需要的商品信息添加到购物车中(如：商品数量，商品名称，商品价格，商品图片等等)</li>
    <li>查看购物车中是否存在该商品：<span style="color:red">不存在</span>:则将此商品放入购物车中，默认添加数量为1;
        <span style="color:green">存在</span>:则将该商品的数量+1</li>
    <li>将商品转换成字符串(因为localStorage中只能保存字符串类型数据)</li>
    <li>将需要加入购物车的商品写入到localStorage中进行持久化存储</li>
</ol>

<p>　　<strong>我们将这些需要在点击加入购物车时需要实现的逻辑，全部放在绑定事件中</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 加入购物车事件</span></span><br><span class="line">addcart() &#123;</span><br><span class="line">	<span class="keyword">let</span> find = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// 遍历购物车</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.cart_list.length; i++) &#123;</span><br><span class="line">		<span class="comment">// 如果找到了</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.gid === <span class="keyword">this</span>.cart_list[i][<span class="string">'gid'</span>]) &#123;</span><br><span class="line">			<span class="comment">// 将该商品的数量+1</span></span><br><span class="line">			<span class="keyword">this</span>.cart_list[i][<span class="string">'num'</span>]++;</span><br><span class="line">			find = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 如果没找到</span></span><br><span class="line">	<span class="keyword">if</span> (find === <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="comment">// 将该商品放入购物车列表</span></span><br><span class="line">		<span class="keyword">this</span>.cart_list.push(&#123; <span class="string">'name'</span>: <span class="keyword">this</span>.name, <span class="string">'gid'</span>: <span class="keyword">this</span>.gid, <span class="string">'price'</span>: <span class="keyword">this</span>.price, <span class="string">'num'</span>: <span class="number">1</span>, <span class="string">'img'</span>: <span class="keyword">this</span>.img &#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.cart_list)</span><br><span class="line">	<span class="comment">// 存入localStorage中</span></span><br><span class="line">	localStorage[<span class="string">'cart'</span>] = <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.cart_list)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<h2 id="当做完这些之后需要注意什么？"><a href="#当做完这些之后需要注意什么？" class="headerlink" title="当做完这些之后需要注意什么？"></a>当做完这些之后需要注意什么？</h2><p>　　<strong>将购物车写入到localStorage中后，如果你将localStorage中的购物车手动删除，或者需要清除缓存来刷新页面时会产生什么呢？</strong><br>(就好比一个马蜂窝好好的在树上挂着，而你非要用竹竿去捅它下来一样，一发不可收拾)<br>当你刷新页面之后，控制台迎接而来的是一片红，为什么呢？因为我们做的购物车是存在localStorage中的，而我们展示购物车中商品是写在myheader公用组件中的，<br>所以，不管你在哪个页面，当你清除之后，就会报出很多异常</p>
<p>　　<strong>解决此问题，我们需要在mounted钩子函数中添加初始化购物车逻辑</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化购物车逻辑</span></span><br><span class="line">init_cart() &#123;</span><br><span class="line">	<span class="keyword">let</span> cart = <span class="built_in">JSON</span>.parse(localStorage[<span class="string">'cart'</span>])</span><br><span class="line">	<span class="keyword">if</span> (cart) &#123;</span><br><span class="line">		<span class="comment">// 将localstorage的数据给cart_list</span></span><br><span class="line">		<span class="keyword">this</span>.cart_list = <span class="built_in">JSON</span>.parse(localStorage[<span class="string">'cart'</span>])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django,Cart</tag>
      </tags>
  </entry>
  <entry>
    <title>基于Redis的排行榜</title>
    <url>/Python/Python_id_03.html</url>
    <content><![CDATA[<p>　　所谓排行榜，就是要将一组数据根据某种条件来进行排序，就好比游戏，可以根据经验值，等级来进行递减排行，电影，可以根据热度或者评分来进行排行<br>今天我们学习的内容就是做一个基于redis的商品点击量排行榜</p>
<a id="more"></a>

<h2 id="1、新的商品参与排名接口"><a href="#1、新的商品参与排名接口" class="headerlink" title="1、新的商品参与排名接口"></a>1、新的商品参与排名接口</h2><p>　　接口作用：<br>　　　　如果此商品是第一次被访问，那么此时该商品的访问次数，就默认从1开始<br>　　　　如果此商品非第一次被访问，那么此时该商品的访问次数会在原有的次数上面+1</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入redis</span></span><br><span class="line">host = <span class="string">'localhost'</span></span><br><span class="line">port = <span class="number">6379</span></span><br><span class="line">r = redis.Redis(host=host, port=port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新的商品参与排名</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsClick</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="comment"># 接收参数</span></span><br><span class="line">        gid = request.GET.get(<span class="string">'gid'</span>,<span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># 修改商品的点击数</span></span><br><span class="line">        r.zincrby(<span class="string">"good_rank"</span>,<span class="number">1</span>,int(gid))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">"message"</span>:<span class="string">"访问+1"</span>&#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="1、2-前端调用参与排名接口"><a href="#1、2-前端调用参与排名接口" class="headerlink" title="1、2  前端调用参与排名接口"></a>1、2  前端调用参与排名接口</h2><p>　　新的商品参与排名接口，可以放在前端的商品详情页面(item.vue)的mounted钩子中，这样每次进入详情页，都可以为该商品增加一次访问量</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">  </span><br><span class="line">  mounted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取请求详情信息的商品id</span></span><br><span class="line">    <span class="keyword">this</span>.gid = <span class="keyword">this</span>.$route.query.gid;</span><br><span class="line">    <span class="comment">// 调用增加访问接口</span></span><br><span class="line">    <span class="keyword">this</span>.add_rank();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">    <span class="comment">// 访问一次增加一次访问数</span></span><br><span class="line">	add_rank() &#123;</span><br><span class="line">		<span class="keyword">this</span>.axios(&#123;</span><br><span class="line">			url: config[<span class="string">'baseurl'</span>] + <span class="string">'goodsclick/'</span>,</span><br><span class="line">			params: &#123;</span><br><span class="line">				gid: <span class="keyword">this</span>.gid</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">"偷偷+1"</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="2、排行榜数据进行展示接口及定义工具方法"><a href="#2、排行榜数据进行展示接口及定义工具方法" class="headerlink" title="2、排行榜数据进行展示接口及定义工具方法"></a>2、排行榜数据进行展示接口及定义工具方法</h2><p>　　接口作用：<br>　　　　将获取到的数据返回，由前端获取到后进行展示<br>　　工具的作用：<br>　　　　该工具方法用来获取排行榜前N名的数据</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 工具方法，获取前N名的数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_top_n</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="comment"># 获取redis中的数据</span></span><br><span class="line">    goods_click = r.zrange(<span class="string">"good_rank"</span>,<span class="number">0</span>,<span class="number">-1</span>,desc=<span class="literal">True</span>,withscores=<span class="literal">True</span>)[:num]</span><br><span class="line">    <span class="comment"># 获取mysql中数据</span></span><br><span class="line">    goods = Goods.objects.in_bulk([int(item[<span class="number">0</span>]) <span class="keyword">for</span> item <span class="keyword">in</span> goods_click])</span><br><span class="line">    <span class="comment"># 合并操作</span></span><br><span class="line">    resp = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> goods_click:</span><br><span class="line">        <span class="comment"># 遍历列表</span></span><br><span class="line">        <span class="comment"># 捕获异常，防止mysql和redis数据不同步问题</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp.append(&#123;int(item[<span class="number">1</span>]): goods[int(item[<span class="number">0</span>])]&#125;)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 商品排行榜数据视图</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodRank</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="comment"># 获取排名前10的数据</span></span><br><span class="line">        get_resp = get_top_n(<span class="number">10</span>)</span><br><span class="line">        resp = []</span><br><span class="line">        <span class="comment"># 遍历进行序列化</span></span><br><span class="line">        <span class="keyword">for</span> dic <span class="keyword">in</span> get_resp:</span><br><span class="line">            <span class="keyword">for</span> k,v <span class="keyword">in</span> dic.items():</span><br><span class="line">                <span class="comment"># 序列化</span></span><br><span class="line">                data = GoodsSer(v).data</span><br><span class="line">                <span class="comment"># 将商品点击数附加到商品序列化数据中</span></span><br><span class="line">                data[<span class="string">'clicks'</span>] = k</span><br><span class="line">                resp.append(data)</span><br><span class="line">        <span class="comment"># 返回</span></span><br><span class="line">        <span class="keyword">return</span> Response(resp)</span><br></pre></td></tr></table></figure></div>

<h2 id="3、今天写商品排行榜遇到的bug"><a href="#3、今天写商品排行榜遇到的bug" class="headerlink" title="3、今天写商品排行榜遇到的bug"></a>3、今天写商品排行榜遇到的bug</h2><p>　　今天好像其它同学遇到了不同的问题，<br>有ORM框架报错的(卸载ORM框架后重新安装，问题解决)，<br>也有因为查找的商品不存在报错的(在工具方法的遍历中，添加一个捕获异常的功能，避免因为商品不存在而报错)<br>而我所遇到的问题是，获取到的排行榜，全部为同一商品，只是点击量不同，经与老师代码进行排除，发现问题出现在工具方法中</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在工具方法中，向resp中添加元素时，我将goods的值固定成了一个商品</span></span><br><span class="line">resp.append(&#123;int(item[<span class="number">1</span>]): goods[int(<span class="number">1</span>)]&#125;)</span><br><span class="line"><span class="comment"># 正确为：：</span></span><br><span class="line">resp.append(&#123;int(item[<span class="number">1</span>]): goods[int(item[<span class="number">0</span>])]&#125;)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>排行榜</tag>
      </tags>
  </entry>
  <entry>
    <title>国际化语言操作</title>
    <url>/Vue/Vue_id_11.html</url>
    <content><![CDATA[<p>　　好记性不如一颗烂笔头，古人诚不欺我也<br>之前一直没有写笔记，从而课堂上有些bug都差不多忘记了，从今天开始，每天一记</p>
<a id="more"></a>

<p>首先还是要先将一些没有忘记的bug写下来</p>
<h2 id="1、国际化语言操作"><a href="#1、国际化语言操作" class="headerlink" title="1、国际化语言操作"></a>1、国际化语言操作</h2><p>　　这是一个可以查看当前浏览器默认所使用的语言种类<br>　　在网页中按F12，打开Console控制台，可以选择将内容清空，然后在控制台输入查询语法：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CSS"><figure class="iseeu highlight /css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">window</span><span class="selector-class">.navigator</span><span class="selector-class">.language</span></span><br></pre></td></tr></table></figure></div>

<p>　　有了这个命令，你可以在写项目时先获取浏览器语言，让项目默认语言直接匹配浏览器语言，进行选择所要显示的语言</p>
<h2 id="1、1-做国际化语言操作时，首先要安装国际化组件"><a href="#1、1-做国际化语言操作时，首先要安装国际化组件" class="headerlink" title="1、1  做国际化语言操作时，首先要安装国际化组件"></a>1、1  做国际化语言操作时，首先要安装国际化组件</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CSS"><figure class="iseeu highlight /css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">install</span> <span class="selector-tag">vue-i18n</span> <span class="selector-tag">--save</span></span><br></pre></td></tr></table></figure></div>

<h2 id="1、2-然后在main-js入口中导入使用"><a href="#1、2-然后在main-js入口中导入使用" class="headerlink" title="1、2  然后在main.js入口中导入使用"></a>1、2  然后在main.js入口中导入使用</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CSS"><figure class="iseeu highlight /css"><table><tr><td class="code"><pre><span class="line">// 引入国际化组件</span><br><span class="line">import VueI18n from 'vue-i18n';</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">Vue</span><span class="selector-class">.use</span>(<span class="selector-tag">VueI18n</span>);</span><br><span class="line">// 调用语言包</span><br><span class="line">const i18n = new VueI18n(&#123;</span><br><span class="line">  //默认语言包(访问网页时先判断所使用的语言，然后将他写入到webStorage中，在入口直接进行获取)</span><br><span class="line">  <span class="selector-tag">locale</span>: <span class="selector-tag">localStorage</span><span class="selector-attr">[<span class="string">'locale'</span>]</span>,</span><br><span class="line">  // 默认使用中文</span><br><span class="line">  // locale: 'zh',</span><br><span class="line">  <span class="selector-tag">messages</span>: &#123;</span><br><span class="line">    'zh': require('./lang/zh'),</span><br><span class="line">    'en': require('./lang/en'),</span><br><span class="line">  &#125;,</span><br><span class="line">  silentTranslationWarn: true,  // 可以去掉Console控制台中的警告</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">new</span> <span class="selector-tag">Vue</span>(&#123;</span><br><span class="line">  // 装载语言包</span><br><span class="line">  <span class="selector-tag">i18n</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="1、3-然后分别创建zh-js-中文-语言包及en-js-英文-语言包-其它语言操作一样"><a href="#1、3-然后分别创建zh-js-中文-语言包及en-js-英文-语言包-其它语言操作一样" class="headerlink" title="1、3  然后分别创建zh.js(中文)语言包及en.js(英文)语言包(其它语言操作一样)"></a>1、3  然后分别创建zh.js(中文)语言包及en.js(英文)语言包(其它语言操作一样)</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CSS"><figure class="iseeu highlight /css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">zh</span><span class="selector-class">.js</span> 文件</span><br><span class="line">export const m = &#123;</span><br><span class="line">  chinese: '中文',</span><br><span class="line">  english: '英文',</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">en</span><span class="selector-class">.js</span>  文件</span><br><span class="line">export const m = &#123;</span><br><span class="line">  chinese: 'Chinese',</span><br><span class="line">  english: 'English',</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="1、4-在网页中引入使用格式"><a href="#1、4-在网页中引入使用格式" class="headerlink" title="1、4  在网页中引入使用格式"></a>1、4  在网页中引入使用格式</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 国际化语言开关 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h-switch</span> <span class="attr">v-model</span>=<span class="string">"lang"</span> @<span class="attr">change</span>=<span class="string">"lang_change"</span>&gt;</span>&#123;&#123; $t('m.chinese') &#125;&#125;/&#123;&#123; $t('m.english') &#125;&#125;<span class="tag">&lt;/<span class="name">h-switch</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="1、5-国际化语言所遇到的坑"><a href="#1、5-国际化语言所遇到的坑" class="headerlink" title="1、5  国际化语言所遇到的坑"></a>1、5  国际化语言所遇到的坑</h2><p>　　国际化语言js包的名称并不是可以随便取的，要根据语言种类来命名<br>就比如当时课堂创建中文js语言包时，命名为cn.js，这导致了语言切换时出现乱码的情况，当然，并不是所有都显示乱码，<br>个人理解：乱码原因可能是跟一些第三方组件产生语言冲突而导致的，就比如当时HeyUI中的分页器显示乱码，而其它地方并没有乱码，<br>也可能是个人未进行全面的实验，所以不知道吧，哈哈</p>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>　　现在做项目基本上都会涉及到国际化语言操作，所以，在写js语言包时，请务必查清楚各种语言的命名规范，以免出现乱码情况</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>国际化语言操作</tag>
      </tags>
  </entry>
  <entry>
    <title>商品检索智能提示功能</title>
    <url>/Django/Django_id_01.html</url>
    <content><![CDATA[<p>　　今天主要做的是商品的<strong>检索功能</strong>，其实检索功能你可以直接理解为<strong>搜索功能</strong>，而像我们在淘宝或者京东等等搜索需要购买的东西时，还有我们在百度搜索问题时，<br>都会根据你输入的内容，来为你推荐相关的商品或者问题，这个就是智能提示功能，这个功能是基于<strong>HeyUI</strong>第三方库<strong>AutoComplete 模糊匹配</strong>来实现的，<a href="https://www.heyui.top/component/data/plugin/autocomplete" target="_blank" rel="noopener">点击跳转</a>到HeyUI<br>查看效果</p>
<a id="more"></a>

<h2 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">npm install fetch-jsonp --save</span><br></pre></td></tr></table></figure></div>

<h2 id="在Vue中引入fetch-jsonp模块"><a href="#在Vue中引入fetch-jsonp模块" class="headerlink" title="在Vue中引入fetch-jsonp模块"></a>在Vue中引入fetch-jsonp模块</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模糊查询模块</span></span><br><span class="line"><span class="keyword">import</span> jsonp <span class="keyword">from</span> <span class="string">'fetch-jsonp'</span>;</span><br><span class="line"><span class="keyword">const</span> loadData = <span class="function"><span class="keyword">function</span> (<span class="params">filter, callback</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// this 为 option 配置</span></span><br><span class="line">        <span class="comment">// this.orgId 使用传递的参数获取数据，例：搜索某公司下的员工</span></span><br><span class="line">        jsonp(<span class="string">`https://suggest.taobao.com/sug?code=utf-8&amp;q=<span class="subst">$&#123;filter&#125;</span>`</span>)</span><br><span class="line">                .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">                .then(<span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">                        callback(d.result.map(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> r[<span class="number">0</span>];</span><br><span class="line">                        &#125;));</span><br><span class="line">        	&#125;);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></div>

<h2 id="添加变量"><a href="#添加变量" class="headerlink" title="添加变量"></a>添加变量</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                        <span class="comment">// 模糊查询变量</span></span><br><span class="line">                        value: <span class="string">''</span>,</span><br><span class="line">                        param: &#123;</span><br><span class="line">                                orgId: <span class="number">1</span>, <span class="comment">// 自定义参数传递</span></span><br><span class="line">                                loadData,</span><br><span class="line">                                minWord: <span class="number">1</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="添加方法"><a href="#添加方法" class="headerlink" title="添加方法"></a>添加方法</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">        <span class="comment">// 将数据传递给淘宝(关键词并更)</span></span><br><span class="line">        onChange(data, trigger) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data, trigger);</span><br><span class="line">                <span class="comment">// 跳转到search检索页面</span></span><br><span class="line">                <span class="keyword">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">'/search'</span>, <span class="attr">query</span>: &#123; <span class="attr">word</span>: data.value &#125; &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="添加智能提示标签"><a href="#添加智能提示标签" class="headerlink" title="添加智能提示标签"></a>添加智能提示标签</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">AutoComplete</span> <span class="attr">:option</span>=<span class="string">"param"</span> <span class="attr">v-model</span>=<span class="string">"value"</span> @<span class="attr">change</span>=<span class="string">"onChange"</span> <span class="attr">type</span>=<span class="string">"title"</span>&gt;</span><span class="tag">&lt;/<span class="name">AutoComplete</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>　　<strong>更多关于AutoComplete 模糊匹配的参数、事件及方法，可参考<a href="https://www.heyui.top/component/data/plugin/autocomplete" target="_blank" rel="noopener">官方文档</a></strong></p>
<h2 id="今天所踩的坑"><a href="#今天所踩的坑" class="headerlink" title="今天所踩的坑"></a>今天所踩的坑</h2><p>　　1、在搜索结果展示页面，再次进行搜索时，会出现网页无反应的情况，这是this.$router.push()网页跳转的一个弊端，在当前页面跳转到当前页面时，<br>它不会再帮你请求，所以，我们需要一个监听属性来帮我们解决此问题(该问题解决)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 监听属性</span></span><br><span class="line">watch: &#123;</span><br><span class="line">        $route(to, <span class="keyword">from</span>) &#123;</span><br><span class="line">            <span class="comment">// 强刷页面</span></span><br><span class="line">            <span class="keyword">this</span>.$router.go()</span><br><span class="line">        &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<p>　　2、当你在智能提示框中输入搜索的内容，按Enter键之后，无法获取到输入的内容，此问题直接导致我认为获取的方式有问题，从而进行了多次调试，<br>可是不管我如何调试，都无法获取到值(很无奈)，在这时，我无意间的一个动作，让我发现了原因，<strong>输入的内容，是为了智能提示而存在，并不能做为搜索值被返回，</strong><br><strong>而只有选择智能提示中的选项，才会被当做搜索值返回</strong>(一句MMP来发泄一下)(该问题解决)</p>
<p>　　3、这是智能提示的一个bug，当然，或许会有人说，谁会闲的去这样操作，但是我就要说，就因为这个，它就是有问题的，就是有缺陷的，当你在智能提<br>示框中输入内容时，<strong>打字时不要用空格来生成文字，用鼠标来选择你要输出的字</strong>，你会发现，提示框会告诉你<strong>未搜索到相关数据</strong>，也或者会匹配到跟你输入<br>的内容完全不搭边的数据，所以说，此功能的bug还是挺多的，希望HeyUI官方可以做的越来越好吧，必定是免费的，哈哈</p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>商品检索智能提示</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue中的自定义过滤器</title>
    <url>/Vue/Vue_id_07.html</url>
    <content><![CDATA[<p>　　现在很多页面显示的时间、金钱等等都需要转换格式后再进行展示，而如何进行转换呢？我想很多人都想到了—自定义过滤器</p>
<a id="more"></a>

<h2 id="１、自定义过滤器"><a href="#１、自定义过滤器" class="headerlink" title="１、自定义过滤器"></a>１、自定义过滤器</h2><p>　　今天课堂上，我们做了一个uid转换成username来展示的点</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"item in commentlist"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引用过滤器--myfilter --&gt;</span></span><br><span class="line">        &#123;&#123; item.uid | myfilter &#125;&#125;:&#123;&#123; item.content &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="2、过滤器错误写法"><a href="#2、过滤器错误写法" class="headerlink" title="2、过滤器错误写法"></a>2、过滤器错误写法</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">filters: &#123;</span><br><span class="line">  <span class="comment">// 自定用户义方法</span></span><br><span class="line">  user_filter(value) &#123;</span><br><span class="line">    <span class="comment">// 通过key(用户id)取用户名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.myuser[value]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></div>

<h2 id="3、过滤器语法规范"><a href="#3、过滤器语法规范" class="headerlink" title="3、过滤器语法规范"></a>3、过滤器语法规范</h2><p>　　当过滤器return用this语法来写时，Console控制台会报出this is undefined，顾名思义，this未定义，因为过滤器中不支持this语法<br>　　这时，我们应该在mounted请求中，先声明一个变量来代替this</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">mounted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 声明变量</span></span><br><span class="line">  <span class="built_in">window</span>.that = <span class="keyword">this</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<h2 id="4、过滤器正确写法"><a href="#4、过滤器正确写法" class="headerlink" title="4、过滤器正确写法"></a>4、过滤器正确写法</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">filters: &#123;</span><br><span class="line">  <span class="comment">// 自定用户义方法</span></span><br><span class="line">  user_filter(value) &#123;</span><br><span class="line">    <span class="comment">// 通过key(用户id)取用户名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>.that.myuser[value]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>过滤器</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS8查看监听端口</title>
    <url>/CentOS/CentOS_id_02.html</url>
    <content><![CDATA[<h4 id="1、CentOS-8停用、启用、查看当前启用的端口"><a href="#1、CentOS-8停用、启用、查看当前启用的端口" class="headerlink" title="1、CentOS 8停用、启用、查看当前启用的端口"></a>1、CentOS 8停用、启用、查看当前启用的端口</h4><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=5672/tcp --permanent   <span class="comment"># 开放5672端口</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --remove-port=5672/tcp --permanent  <span class="comment">#关闭5672端口</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --reload   <span class="comment"># 配置立即生效</span></span><br></pre></td></tr></table></figure></div>

<h4 id="2、查看防火墙所有开放的端口"><a href="#2、查看防火墙所有开放的端口" class="headerlink" title="2、查看防火墙所有开放的端口"></a>2、查看防火墙所有开放的端口</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure></div>

<h4 id="3-、关闭防火墙"><a href="#3-、关闭防火墙" class="headerlink" title="3.、关闭防火墙"></a>3.、关闭防火墙</h4><p>如果要开放的端口太多，嫌麻烦，可以关闭防火墙，安全性自行评估</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure></div>

<h4 id="4、查看防火墙状态"><a href="#4、查看防火墙状态" class="headerlink" title="4、查看防火墙状态"></a>4、查看防火墙状态</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">firewall-cmd --state</span><br></pre></td></tr></table></figure></div>

<h4 id="5、查看监听的端口"><a href="#5、查看监听的端口" class="headerlink" title="5、查看监听的端口"></a>5、查看监听的端口</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">netstat -lnpt</span><br></pre></td></tr></table></figure></div>

<p><strong>PS:centos7默认没有 netstat 命令，需要安装 net-tools 工具，yum install -y net-tools</strong></p>
<h4 id="6、检查端口被哪个进程占用"><a href="#6、检查端口被哪个进程占用" class="headerlink" title="6、检查端口被哪个进程占用"></a>6、检查端口被哪个进程占用</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">netstat -lnpt |grep 5672</span><br></pre></td></tr></table></figure></div>

<h4 id="7、查看进程的详细信息"><a href="#7、查看进程的详细信息" class="headerlink" title="7、查看进程的详细信息"></a>7、查看进程的详细信息</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">ps 6832</span><br></pre></td></tr></table></figure></div>

<h4 id="8、中止进程"><a href="#8、中止进程" class="headerlink" title="8、中止进程"></a>8、中止进程</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 6832</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu18.04配置mysql</title>
    <url>/Ubuntu/Ubuntu_id_03.html</url>
    <content><![CDATA[<p>　　设置Ubuntu 18.04版本系统配置mysql</p>
<a id="more"></a>

<h2 id="1、安装mysql命令"><a href="#1、安装mysql命令" class="headerlink" title="1、安装mysql命令"></a>1、安装mysql命令</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install mysql-server</span><br></pre></td></tr></table></figure></div>

<h2 id="2、配置mysql"><a href="#2、配置mysql" class="headerlink" title="2、配置mysql"></a>2、配置mysql</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo mysql_secure_installation</span><br></pre></td></tr></table></figure></div>

<h2 id="3、检查mysql服务状态"><a href="#3、检查mysql服务状态" class="headerlink" title="3、检查mysql服务状态"></a>3、检查mysql服务状态</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">systemctl status mysql.service</span><br></pre></td></tr></table></figure></div>

<h2 id="4、查看初始密码"><a href="#4、查看初始密码" class="headerlink" title="4、查看初始密码"></a>4、查看初始密码</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo cat /etc/mysql/debian.cnf</span><br></pre></td></tr></table></figure></div>

<h2 id="5、启动mysql报错-ERROR-1698-28000-Access-denied-for-user-‘root’-’localhost"><a href="#5、启动mysql报错-ERROR-1698-28000-Access-denied-for-user-‘root’-’localhost" class="headerlink" title="5、启动mysql报错 ERROR 1698 (28000): Access denied for user ‘root’@’localhost"></a>5、启动mysql报错 ERROR 1698 (28000): Access denied for user ‘root’@’localhost</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class="line"><span class="comment"># 添加</span></span><br><span class="line">skip-grant-tables	(跳过密码验证)</span><br></pre></td></tr></table></figure></div>

<p>保存:wq，退出。输入：service mysql restart，重新启动mysql<br>重新连接mysql，提示需要输入密码时，直接按回车键跳过<br>进入mysql之后，执行</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">use mysql; 然后敲回车</span><br><span class="line">update user <span class="built_in">set</span> authentication_string=password(“你的密码”) <span class="built_in">where</span> user=“root” 然后敲回车</span><br><span class="line">flush privileges 然后敲回车</span><br><span class="line">select user,plugin from user;	<span class="comment"># 看到root后面对应的是auth_socket</span></span><br><span class="line"><span class="comment"># 执行命令修改(改成%则代表设置成所有主机都可以连接)</span></span><br><span class="line">update user <span class="built_in">set</span> authentication_string=password(<span class="string">"xiaojian"</span>),plugin=<span class="string">'%'</span> <span class="built_in">where</span> user=<span class="string">'root'</span>;</span><br><span class="line"><span class="comment"># 如果上面命令执行失败，可先执行</span></span><br><span class="line">update user <span class="built_in">set</span> authentication_string=password(<span class="string">"ln122920"</span>),plugin=<span class="string">'mysql_native_password'</span> <span class="built_in">where</span> user=<span class="string">'root'</span></span><br><span class="line"><span class="comment"># 再执行</span></span><br><span class="line">update user <span class="built_in">set</span> plugin=<span class="string">'mysql_native_password'</span> <span class="built_in">where</span> user=<span class="string">'root'</span>;</span><br><span class="line"><span class="comment"># 再次查看</span></span><br><span class="line">select user,plugin from user	<span class="comment"># 如果改掉了，就成功了</span></span><br></pre></td></tr></table></figure></div>

<h2 id="6、退出mysql，重新进入配置文件"><a href="#6、退出mysql，重新进入配置文件" class="headerlink" title="6、退出mysql，重新进入配置文件"></a>6、退出mysql，重新进入配置文件</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class="line"><span class="comment"># 将在第四步添加的内容删除掉或注释掉</span></span><br><span class="line">skip-grant-tables	(跳过密码验证)</span><br></pre></td></tr></table></figure></div>

<p>保存:wq，退出。</p>
<p><strong>再次启动mysql时，不会再报错误</strong></p>
]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu18.04系统一些常见问题</title>
    <url>/Ubuntu/Ubuntu_id_02.html</url>
    <content><![CDATA[<p>　　Ubuntu 18.04版本系统的一些常见问题</p>
<a id="more"></a>

<h2 id="一、安装vim命令时的问题"><a href="#一、安装vim命令时的问题" class="headerlink" title="一、安装vim命令时的问题"></a>一、安装vim命令时的问题</h2><p><strong>提示找不到安装包，或安装包已被占用</strong></p>
<p>设置国内原、可解决次问题<a href="/2020/04/23/Ubuntu18.04设置国内源/">Ubuntu设置国内原</a></p>
]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu18.04设置分辨率</title>
    <url>/Ubuntu/Ubuntu_id_04.html</url>
    <content><![CDATA[<p>　　设置Ubuntu 18.04版本系统的分辨率为1920x1080</p>
<a id="more"></a>

<p>1、打开终端命令窗口</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">Ctrl + Alt + T</span><br></pre></td></tr></table></figure></div>

<p>2、执行以下命令</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo xrandr --newmode <span class="string">"1920x1080_60.00"</span> 173.00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync</span><br><span class="line">sudo xrandr --addmode Virtual1 <span class="string">"1920x1080_60.00"</span>	<span class="comment"># Virtual1是Ubuntu系统的显示器名称</span></span><br><span class="line"><span class="comment"># 此时系统设置里已经有 1920*1080 的分辨率选项</span></span><br></pre></td></tr></table></figure></div>

<p>3、打开开机启动配置</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="VIM"><figure class="iseeu highlight /vim"><table><tr><td class="code"><pre><span class="line">sudo <span class="keyword">vim</span> /etc/<span class="keyword">profile</span></span><br></pre></td></tr></table></figure></div>

<p>　　按键 i 进入编辑模式, 按箭头下键把光标移动到文件最底部添加下面的内容</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">xrandr --newmode <span class="string">"1920x1080_60.00"</span> 173.00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync</span><br><span class="line">xrandr --addmode Virtual1 <span class="string">"1920x1080_60.00"</span></span><br></pre></td></tr></table></figure></div>

<p>　　按键 Esc 然后输入 :wq 回车, 保存退出.</p>
<p>　　重启</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7服务器配置redis主从与哨兵</title>
    <url>/CentOS/CentOS_id_03.html</url>
    <content><![CDATA[<h2 id="这次是配置redis主从"><a href="#这次是配置redis主从" class="headerlink" title="这次是配置redis主从"></a>这次是配置redis主从</h2><a id="more"></a>

<ol>
<li><p>主redis数据库配置方式省略,因为只是正常的配置redis外网访问的流程,  <del>并不是作者忘了</del></p>
</li>
<li><p>在完成上述操作之后,使用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">redis-server info</span><br></pre></td></tr></table></figure></div>

<p>可以查看当前redis运行状况,replication中显示的role为当前数据库身份,主数据库显示master,即为启动配置主数据库成功</p>
</li>
<li><p>配置从数据库</p>
<ul>
<li><p>这里的配置不同于主数据库,并不需要太过于复杂</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">protected-mode no # 把保护模式设置为no，如果这里是yes，那么修改为no</span><br><span class="line">port 6379  #端口号6379保持不变</span><br><span class="line">daemonize no  #这里修改为no，表示redis服务可以后台运行</span><br><span class="line">slaveof 192.168.124.20 6379  #由于是从服务器，所以要配置其主服务器，配置格式：slaveof  主IP  主端口号</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>配置好之后,启动从数据库</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AXAPTA"><figure class="iseeu highlight /axapta"><table><tr><td class="code"><pre><span class="line">redis-<span class="keyword">server</span> redis.conf</span><br><span class="line"><span class="meta"># 这里必须指定我们设定的conf文件进行启动,否则之前的修改将不生效</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>再次输入</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PGSQL"><figure class="iseeu highlight /pgsql"><table><tr><td class="code"><pre><span class="line">redis-<span class="keyword">server</span> <span class="keyword">info</span></span><br></pre></td></tr></table></figure></div>

<p>查看,可看到显示role为slave</p>
</li>
</ul>
</li>
</ol>
<h3 id="设置哨兵集群的方式"><a href="#设置哨兵集群的方式" class="headerlink" title="设置哨兵集群的方式"></a>设置哨兵集群的方式</h3><ol>
<li><p>在redis根目录创建文件sentinel.conf</p>
<ul>
<li><pre><code># 当前Sentinel服务运行的端口
port 26379
# 保护模式 no
protected-mode no

# Sentinel去监视一个名为mymaster的主redis实例，
# 这个主实例的IP地址为本机地址127.0.0.1，端口号为6379，
# 而将这个主实例判断为失效至少需要2个Sentinel进程的同意，只要同意Sentinel的数量不达标，自动failover就不会执行
# 如果提供外网访问，实例的IP地址为服务器地址10.0.128.144。
sentinel myid ca7a3602308b20f77464a51bd29e26e48055fd1a

# down-after-milliseconds指定了Sentinel认为Redis实例已经失效所需的毫秒数。
# 当实例超过该时间没有返回PING，或者直接返回错误，那么Sentinel将这个实例标记为主观下线。
# 只有一个Sentinel进程将实例标记为主观下线并不一定会引起实例的自动故障迁移：只有在足够数量的Sentinel都将一个实例标记为主观下线之后，实例才会被标记为客观下线。
# 这时自动故障迁移才会执行
sentinel deny-scripts-reconfig yes

# parallel-syncs指定了在执行故障转移时，最多可以有多少个从Redis实例在同步新的主实例，
# 在从Redis实例较多的情况下这个数字越小，同步的时间越长，完成故障转移所需的时间就越长
sentinel monitor mymaster 120.26.175.79 6379 2

# 如果在failover-timeout该时间（ms）内未能完成failover操作，则认为该failover失败
sentinel down-after-milliseconds mymaster 5000
# Generated by CONFIG REWRITE
dir &quot;C:\\Users\\Administrator&quot;
sentinel failover-timeout mymaster 15000
sentinel config-epoch mymaster 0
sentinel leader-epoch mymaster 0
sentinel known-slave mymaster 115.59.41.123 6379
sentinel current-epoch 0

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2.</span> 使用此文件启动哨兵</span><br></pre></td></tr></table></figure></div>
redis-server sentinel.conf --sentinel</code></pre></li>
</ul>
</li>
<li><p>重复以上步骤,即可实现哨兵集群</p>
</li>
</ol>
<p>相比较起来, 部署还是比较简单的.</p>
<p>不过需要注意的是,  windows版本的redis仅仅只到3.2, redis官方并未继续编译后续版本的redis, 也就是说,如果你使用的主数据库为linux的高版本的话,可能会出现无法解析rdb文件的情况.</p>
<p>这种情况的话,推荐下载高版本的redis安装包.</p>
<p><a href="https://github.com/tporadowski/redis/releases" target="_blank" rel="noopener">高版本下载</a></p>
<p>非官方编译, 酌情下载.</p>
<p>诸君自行考量其中利弊,  我在这里就不多言了.</p>
<p>以上.</p>
]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7服务器配置汇总</title>
    <url>/CentOS/CentOS_id_04.html</url>
    <content><![CDATA[<ol>
<li><p>构建centos7环境</p>
<p>服务器构建centos7环境,没啥好写的,毕竟只需要在控制台操作一下就可以自动进行系统重装.</p>
<a id="more"></a>

<p>这里要注意的是, 阿里云安装的centos7系统与正常你在自己虚拟机上安装的centos不同,在安装了图形化界面之后,使用init 5 和startX都是无法直接开启图形化界面的.</p>
<p>这里需要进入阿里云控制台中,在远程连接选项中选择VNC连接, 这样才能进行图形化界面操作.</p>
<p>值得一提的是,请务必记住你第一次进行VNC连接时生成的连接密码,它关系到你每次能否连接,如果你忘记了…..</p>
<p>还是重装系统吧</p>
</li>
<li><p>配置python环境</p>
<ol>
<li><p>这个的话,应该也没什么好说的吧,毕竟,centos本身自带了python环境(2.7)</p>
</li>
<li><p>如果有需要升级的话,可以参考下列操作</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="VALA"><figure class="iseeu highlight /vala"><table><tr><td class="code"><pre><span class="line">wget  https:<span class="comment">//www.python.org/ftp/python/3.7.1/Python-3.7.1.tgz </span></span><br><span class="line"><span class="meta"># 下载python 3.7.1 安装包</span></span><br><span class="line">tar -zxvf Python<span class="number">-3.7</span><span class="number">.1</span>.tgz  -C  /usr/local/</span><br><span class="line"><span class="meta"># 解压安装包</span></span><br><span class="line">cd Python<span class="number">-3.7</span><span class="number">.1</span></span><br><span class="line"><span class="meta"># 切换路径至python文件夹</span></span><br><span class="line">./configure --prefix=/usr/local/Python<span class="number">-3.7</span><span class="number">.1</span>  --enable-shared CFLAGS=-fPIC</span><br><span class="line"><span class="meta"># 配置编译</span></span><br><span class="line">make&amp;&amp;make install</span><br><span class="line"><span class="meta"># 编译源码,执行安装</span></span><br><span class="line">python <span class="number">3</span></span><br><span class="line"><span class="meta"># 查看是否安装成功</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/fcg22450.github.io/img/online_course/centos_python.png" alt="安装成功的显示"></p>
</li>
</ol>
</li>
<li><p>配置mysql数据库 + 主从复制</p>
<p> 这里可以参考我的博客:    <a href="/fcg22450.github.io/2020/05/10/online_course/003/">Centos7 环境下配置mysql主从服务</a></p>
</li>
<li><p>配置redis数据库 + 主从复制 + 哨兵集群</p>
<p>这个问题我同样有另外一篇博客,就不在这里多说了:  <a href="/fcg22450.github.io/2020/05/11/online_course/005/">centos7服务器配置redis主从与哨兵集群</a></p>
</li>
<li><p>配置node环境</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CRMSH"><figure class="iseeu highlight /crmsh"><table><tr><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v10.<span class="number">13.0</span>/<span class="keyword">node</span><span class="title">-v10</span>.<span class="number">13.0</span>-linux-x64.tar.xz</span><br><span class="line"><span class="comment"># 下载nodejs安装包</span></span><br><span class="line">tar xvf <span class="keyword">node</span><span class="title">-v10</span>.<span class="number">13.0</span>-linux-x64.tar.xz </span><br><span class="line"><span class="comment"># 解压缩</span></span><br><span class="line">mv <span class="keyword">node</span><span class="title">-v10</span>.<span class="number">13.0</span>-linux-x64 <span class="keyword">node</span><span class="title">-v10</span>.<span class="number">13</span> </span><br><span class="line"><span class="comment"># 重命名</span></span><br><span class="line">cd <span class="keyword">node</span><span class="title">-v10</span>.<span class="number">13</span>/bin</span><br><span class="line">./<span class="keyword">node</span> <span class="title">-v</span></span><br><span class="line"><span class="comment"># 进入目录查看其版本</span></span><br></pre></td></tr></table></figure></div>

<p>进入etc/profile 修改环境变量,使node命令能在任意目录运行:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PROPERTIES"><figure class="iseeu highlight /properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">vim</span> <span class="string">/etc/profile</span></span><br><span class="line"><span class="attr">//环境变量</span></span><br><span class="line"><span class="attr">NODE_HOME</span>=<span class="string">/你的安装路径/node-v10.13</span></span><br><span class="line"><span class="attr">PATH</span>=<span class="string">$NODE_HOME/bin:$PATH</span></span><br><span class="line"><span class="attr">export</span> <span class="string">NODE_HOME</span></span><br><span class="line"><span class="attr">export</span> <span class="string">PATH</span></span><br></pre></td></tr></table></figure></div>

<p>重启服务器:  reboot</p>
</li>
</ol>
<p>以上.</p>
]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7服务器配置主从之后的一些操作</title>
    <url>/CentOS/CentOS_id_06.html</url>
    <content><![CDATA[<h2 id="今天配置主从-简直脑袋爆炸-网路上各种虚虚实实的攻略一个比一个扯淡-踩坑踩了一堆-在这里记录一下-免得下次遇到同样的情况导致无法处理"><a href="#今天配置主从-简直脑袋爆炸-网路上各种虚虚实实的攻略一个比一个扯淡-踩坑踩了一堆-在这里记录一下-免得下次遇到同样的情况导致无法处理" class="headerlink" title="今天配置主从,  简直脑袋爆炸,  网路上各种虚虚实实的攻略一个比一个扯淡,  踩坑踩了一堆,  在这里记录一下,  免得下次遇到同样的情况导致无法处理"></a>今天配置主从,  简直脑袋爆炸,  网路上各种虚虚实实的攻略一个比一个扯淡,  踩坑踩了一堆,  在这里记录一下,  免得下次遇到同样的情况导致无法处理</h2><a id="more"></a>

<ol>
<li><p>首先说说配置主从数据库的问题</p>
<ul>
<li><p>首先,主从数据库的版本必须一样,  实测确实如此,  虽然我也不确定最开始是不是我不熟练导致的就是了.</p>
</li>
<li><p>第二点, 不要用官网给的安装包,要用zip! zip! 虽然配置起来得手动,  但是说实话,  所有配置文件自己设定这一点就足够让人特意去费这番功夫了.主从需要在配置文件中进行修改,  我一开始装了一个安装包的mysql, 各种出错,最重要的是,修改了配置选项之后并不起作用,这一点拖了我一个小时,最终一气之下选择卸载,重新卸载了官网的zip安装包,解压后手动配置了my.ini文件,方才完成了从属服务器的配置.</p>
</li>
<li><p>第三点,启动之后报错,这里一共遇到了两种报错</p>
<ul>
<li><p>第一种:   Slave_SQL_Running: No</p>
<ul>
<li>这个属性和另外一个属性(Slave_IO_Running)一样重要,可以说,这两个中只要有一个值为no,就意味着你的从数据库挂了,就这么恐怖</li>
</ul>
</li>
<li><p>第二种:   Error executing row event: ‘Table ‘lab.django_migrations’ doesn’t exist’</p>
<ul>
<li>类似这种形式的报错</li>
<li>我一直以为是主数据库的问题,甚至想着要不要直接重置一下主数据库,但万万没想到问题居然会这样解决</li>
</ul>
</li>
<li><p>说说解决方案:</p>
<ul>
<li><p>网上搜索到的都是一个吊样,估计都是抄的同一篇文章,具体源头不可考据.</p>
</li>
<li><pre><code class="mysql">stop slave;  
SET GLOBAL SQL_SLAVE_SKIP_COUNTER=1;
start slave;
show slave status\G  </code></pre>
</li>
<li><p>嗯,就这四条,乍一运行没啥卵用,但是在我翻遍网上的文章之后,一哥们的文章吸引了我的注意力<img src="/fcg22450.github.io/img/online_course/slave_code.png" alt="截图"></p>
</li>
<li><p><del>够扯淡,我喜欢</del><img src="https://www./fcg22450.github.io/images/meme/%E5%A4%9F%E6%89%AF%E6%B7%A1.png" alt="够扯淡"></p>
</li>
<li><p>综上所述,  那时候基本不抱希望的我试了试…..</p>
</li>
<li><p>然后…..</p>
</li>
<li><img src="https://www.f322.xyz/images/meme/what.png" alt="what">
</li>
<li><p>居然是真的??????????</p>
</li>
</ul>
</li>
<li><p>总之,多写几遍就解决了,  就这么简单</p>
</li>
</ul>
</li>
<li><p>还能说什么</p>
</li>
</ul>
</li>
<li><p>然后就是关于一些在数据库中会用到的命令</p>
<ol>
<li><del>你是不是以为我会写一堆</del><img src="/fcg22450.github.io/images/meme/%E6%83%B3%E9%83%BD%E4%B8%8D%E8%A6%81%E6%83%B3.png" alt="想都不要想"></li>
</ol>
</li>
</ol>
<p>当然,以上纯属扯淡,哈哈哈哈,<del>虽然我就是这么想的</del>,那么,本期的记录到此结束,拜拜~~ヾ(•ω•`)o.</p>
]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7服务器配置主从</title>
    <url>/CentOS/CentOS_id_05.html</url>
    <content><![CDATA[<h2 id="Centos7-环境下配置mysql主从服务"><a href="#Centos7-环境下配置mysql主从服务" class="headerlink" title="Centos7 环境下配置mysql主从服务"></a>Centos7 环境下配置mysql主从服务</h2><a id="more"></a>

<ol>
<li><p>安装过程在这里不在赘述, 想要实现主从, 需要先配置好mysql的外网访问. 在配置号外网访问之后, 就可以开始着手设置主从复制了</p>
</li>
<li><p>首先在主数据库中创建一个同步账号,每个从数据库会使用一个mysql账号来连接主数据库,所以我们需要在主数据库中创建一个账号, 并授予该账号replication slave 权限, 这里可以为每一个从服务器创建一个账号,当然,也可以用同一个,  创建新账号使用 ‘create user’命令, 授予权限使用’grant’命令, </p>
<ol>
<li><p>创建一个账号:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">create user &#39;repl&#39;@&#39;%&#39; identified by &#39;repl_Pass1&#39;;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>授予权限:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">grant replication slave on *.* to &#39;repl&#39;@&#39;%&#39;;</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
</li>
</ol>
<ol start="3">
<li><p>配置主数据库</p>
<ol>
<li><p>编辑my.cnf文件内容</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="INI"><figure class="iseeu highlight /ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在[mysqld]下面添加一下内容</span></span><br><span class="line"><span class="attr">server-id</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">log_bin</span> = master-bin</span><br><span class="line"><span class="attr">log_bin_index</span> = master-bin.index</span><br><span class="line"><span class="comment"># binlog_do_db 为要复制的数据库</span></span><br><span class="line"><span class="attr">binlog_do_db</span> = test</span><br><span class="line"><span class="comment"># binlog_ignore_db 为忽略的数据库,可以写多条</span></span><br><span class="line"><span class="attr">binlog_ignore_db</span> = mysql</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
</li>
</ol>
<ol start="2">
<li>通常情况下,centos7的默认数据库配置文件为  /etc/my.cnf</li>
</ol>
<ol start="4">
<li><p>配置完成之后,重启数据库</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="EBNF"><figure class="iseeu highlight /ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">systemctl restart mysqld</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>进入数据库,查看主服务器状态</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure></div>

<p><img src="/fcg22450.github.io/img/online_course/mysql_slave.png" alt="状态"></p>
<p>注意这里的file 和  position 两个字段的内容,将会在从服务器配置时用到.</p>
</li>
</ol>
<hr>
<p>从服务器配置:</p>
<ol>
<li><p>同样的,在数据库配置文件[mysqld]后面添加一下内容</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STATA"><figure class="iseeu highlight /stata"><table><tr><td class="code"><pre><span class="line">server-id = 2</span><br><span class="line"># replicate-<span class="keyword">do</span>-<span class="keyword">db</span> 要同步的数据库名称</span><br><span class="line">replicate-<span class="keyword">do</span>-<span class="keyword">db</span>=<span class="keyword">test</span></span><br><span class="line"># replicate-wild-<span class="keyword">do</span>-<span class="keyword">table</span>  单独同步某一个表时使用</span><br><span class="line">replicate-wild-<span class="keyword">do</span>-<span class="keyword">table</span> =<span class="keyword">test</span>.<span class="keyword">test</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>重新启动从数据库</p>
</li>
<li><p>指定主库</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">change master to master_host&#x3D;&#39;120.26.175.79&#39;, master_port&#x3D;3306, master_user&#x3D;&#39;lab_admin&#39;, master_password&#x3D;&#39;lab123&#39;, master_log_file&#x3D;&#39;master-bin.000001&#39;, master_log_pos&#x3D;154;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>启动复制功能</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查看从数据库状态</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">show slave status \G;</span><br></pre></td></tr></table></figure></div>





</li>
</ol>
<p>以上配置完成之后,从服务器将会自动从主服务器上同步数据库</p>
<p>以上,就是mysql主从配置的操作</p>
]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Datetime模块常用方法</title>
    <url>/Python/Python_id_01.html</url>
    <content><![CDATA[<p>　　<strong>Datetime模块常用方法</strong></p>
<a id="more"></a>

<h4 id="Datetime格式"><a href="#Datetime格式" class="headerlink" title="Datetime格式"></a>Datetime格式</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">%Y 年份 e.g. <span class="number">1970</span>, <span class="number">1988</span>, <span class="number">2001</span>, <span class="number">2013</span></span><br><span class="line">%y 年份（未带世纪） e.g. <span class="number">00</span>, <span class="number">01</span>, …, <span class="number">99</span></span><br><span class="line">%m 月份 e.g. <span class="number">01</span>, <span class="number">02</span>, …, <span class="number">12</span></span><br><span class="line">%b 月份 e.g. Jan, Feb, …, Dec</span><br><span class="line">%d 天 e.g. <span class="number">01</span>, <span class="number">02</span>, …, <span class="number">31</span></span><br><span class="line">%j 天（decimal number）e.g. <span class="number">001</span>, <span class="number">002</span>, …, <span class="number">366</span></span><br><span class="line">%a 星期 e.g. Sun, Mon, …, Sat (en_US)</span><br><span class="line">%A 星期 e.g. Sunday, Monday, …, Saturday (en_US)</span><br><span class="line">%w 星期 e.g. <span class="number">0</span>, <span class="number">1</span>, …, <span class="number">6</span></span><br><span class="line">%H 小时(<span class="number">24</span>小时制) e.g. <span class="number">00</span>, <span class="number">01</span>, …, <span class="number">23</span></span><br><span class="line">%I 小时(<span class="number">12</span>小时制) e.g. <span class="number">01</span>, <span class="number">02</span>, …, <span class="number">12</span></span><br><span class="line">%p 上/下午标识 e.g. AM, PM</span><br><span class="line">%M 分钟 e.g. <span class="number">00</span>, <span class="number">01</span>, …,<span class="number">59</span></span><br><span class="line">%S 秒 e.g. <span class="number">00</span>, <span class="number">01</span>, …, <span class="number">59</span></span><br><span class="line">%f 微秒（<span class="number">6</span>位长度） e.g. <span class="number">000000</span>, <span class="number">000001</span>, …, <span class="number">999999</span></span><br><span class="line">=====================</span><br><span class="line">%W 一年的第几周 e.g. <span class="number">00</span>, <span class="number">01</span>, …, <span class="number">53</span></span><br><span class="line">%% 标识字符%</span><br></pre></td></tr></table></figure></div>

<h4 id="年的加减"><a href="#年的加减" class="headerlink" title="年的加减"></a>年的加减</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> dateutil.relativedelta <span class="keyword">import</span> relativedelta</span><br><span class="line"><span class="comment"># 当前时间+3年</span></span><br><span class="line">date_time = datetime.datetime.date(datetime.datetime.now()) + relativedelta(years=<span class="number">3</span>)</span><br><span class="line">print(date_time)</span><br><span class="line"><span class="comment"># 当前时间-3年</span></span><br><span class="line">date_time = datetime.datetime.date(datetime.datetime.now()) + relativedelta(years=<span class="number">-3</span>)</span><br><span class="line">print(date_time)</span><br></pre></td></tr></table></figure></div>

<h4 id="月的加减"><a href="#月的加减" class="headerlink" title="月的加减"></a>月的加减</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> dateutil.relativedelta <span class="keyword">import</span> relativedelta</span><br><span class="line"><span class="comment"># 当前时间+3月</span></span><br><span class="line">date_time = datetime.datetime.now() + relativedelta(months=<span class="number">3</span>)</span><br><span class="line">print(date_time)</span><br><span class="line"><span class="comment"># 当前时间-3月</span></span><br><span class="line">date_time = datetime.datetime.now() + relativedelta(months=<span class="number">-3</span>)</span><br><span class="line">print(date_time)</span><br></pre></td></tr></table></figure></div>

<h4 id="日的加减"><a href="#日的加减" class="headerlink" title="日的加减"></a>日的加减</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment"># 当前时间+3天</span></span><br><span class="line">date_time = datetime.datetime.now() + datetime.timedelta(days=<span class="number">3</span>)</span><br><span class="line">print(date_time)</span><br><span class="line"><span class="comment"># 当前时间-3天</span></span><br><span class="line">date_time = datetime.datetime.now() + datetime.timedelta(days=<span class="number">-3</span>)</span><br><span class="line">print(date_time)</span><br></pre></td></tr></table></figure></div>

<h4 id="小时的加减"><a href="#小时的加减" class="headerlink" title="小时的加减"></a>小时的加减</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment"># 当前时间+3小时</span></span><br><span class="line">date_time = datetime.datetime.now() + datetime.timedelta(hours=<span class="number">3</span>)</span><br><span class="line">print(date_time)</span><br><span class="line"><span class="comment"># 当前时间-3小时</span></span><br><span class="line">date_time = datetime.datetime.now() + datetime.timedelta(hours=<span class="number">-3</span>)</span><br><span class="line">print(date_time)</span><br></pre></td></tr></table></figure></div>

<h4 id="分钟的加减"><a href="#分钟的加减" class="headerlink" title="分钟的加减"></a>分钟的加减</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment"># 当前时间+3分钟</span></span><br><span class="line">date_time = datetime.datetime.now() + datetime.timedelta(minutes=<span class="number">3</span>)</span><br><span class="line">print(date_time)</span><br><span class="line"><span class="comment"># 当前时间-3分钟</span></span><br><span class="line">date_time = datetime.datetime.now() + datetime.timedelta(minutes=<span class="number">-3</span>)</span><br><span class="line">print(date_time)</span><br></pre></td></tr></table></figure></div>

<h4 id="时间与字符串的转换"><a href="#时间与字符串的转换" class="headerlink" title="时间与字符串的转换"></a>时间与字符串的转换</h4><p>　　<strong>特殊的字符串类型</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">date_time = <span class="string">'2012-05-29T19:30:03.283Z'</span></span><br><span class="line">date_time = datetime.datetime.strptime(date_time, <span class="string">"%Y-%m-%dT%H:%M:%S.%fZ"</span>)</span><br><span class="line">print(date_time)</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>常见的字符串类型</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">date_time = <span class="string">'2012-05-29 19:30:03'</span></span><br><span class="line">date_time = datetime.datetime.strptime(date_time, <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br></pre></td></tr></table></figure></div>

<p>　　<strong>时间转换成字符串</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">date_time = str(datetime.datetime.now())</span><br><span class="line">print(date_time)</span><br></pre></td></tr></table></figure></div>

<h4 id="两个日期计算相差多少天"><a href="#两个日期计算相差多少天" class="headerlink" title="两个日期计算相差多少天"></a>两个日期计算相差多少天</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">d1 = datetime.datetime(<span class="number">2005</span>, <span class="number">2</span>, <span class="number">16</span>)</span><br><span class="line">d2 = datetime.datetime(<span class="number">2004</span>, <span class="number">12</span>, <span class="number">31</span>)</span><br><span class="line">print((d1 - d2).days)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Datetime</tag>
      </tags>
  </entry>
  <entry>
    <title>支付宝沙箱支付</title>
    <url>/Python/Python_id_05.html</url>
    <content><![CDATA[<p>　　Python支付宝沙箱支付代码接口</p>
<a id="more"></a>

<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> python-alipay-sdk <span class="comment">--upgrade</span></span><br></pre></td></tr></table></figure></div>

<h2 id="请求支付页面"><a href="#请求支付页面" class="headerlink" title="请求支付页面"></a>请求支付页面</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 沙箱支付</span></span><br><span class="line"><span class="comment"># 进入支付页面</span></span><br><span class="line"><span class="comment"># 沙箱支付所需包</span></span><br><span class="line"><span class="keyword">from</span> alipay <span class="keyword">import</span> AliPay</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alipay</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment"># 随机生成订单号</span></span><br><span class="line">        order = datetime.datetime.now().strftime(<span class="string">"%Y%m%d%H%M%S"</span>) + str(random.randint(<span class="number">10</span>, <span class="number">99</span>))</span><br><span class="line">        <span class="comment"># 判断订单是否存在</span></span><br><span class="line">        order_id = Order.objects.filter(order=order).first()</span><br><span class="line">        <span class="keyword">if</span> order_id:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">"code"</span>:<span class="number">405</span>,<span class="string">"message"</span>:<span class="string">"该订单已存在，请重新下单"</span>&#125;)</span><br><span class="line">        <span class="comment"># 获取支付价格</span></span><br><span class="line">        price = request.GET.get(<span class="string">"price"</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># 获取token</span></span><br><span class="line">        jwt_token = request.GET.get(<span class="string">"token"</span>,<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user_json = jwt_decode_handler(jwt_token)</span><br><span class="line">            <span class="comment"># 获取token中的uid</span></span><br><span class="line">            user_id = user_json[<span class="string">'user_id'</span>]</span><br><span class="line">            r.set(<span class="string">"payuid"</span>,user_id)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            r.set(<span class="string">"payuid"</span>,str())</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">"code"</span>:<span class="number">405</span>,<span class="string">"message"</span>:<span class="string">"用户信息已失效，请重新登录"</span>&#125;)</span><br><span class="line">        <span class="comment"># 读取私钥及公钥</span></span><br><span class="line">        app_private_key_string = open(<span class="string">"pay/private.txt"</span>).read()</span><br><span class="line">        alipay_public_key_string = open(<span class="string">"pay/public.txt"</span>).read()</span><br><span class="line"></span><br><span class="line">        alipay = AliPay(</span><br><span class="line">            appid=<span class="string">"2016102400753303"</span>,</span><br><span class="line">            app_notify_url= <span class="literal">None</span>,  <span class="comment"># 默认回调url</span></span><br><span class="line">            app_private_key_string=app_private_key_string,</span><br><span class="line">            alipay_public_key_string=alipay_public_key_string,</span><br><span class="line">            <span class="comment"># 支付宝的公钥，验证支付宝回传消息使用，不是你自己的公钥,</span></span><br><span class="line">            sign_type=<span class="string">"RSA2"</span>,  <span class="comment"># RSA 或者 RSA2</span></span><br><span class="line">            debug=<span class="literal">True</span>  <span class="comment"># 默认False</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 电脑网站支付，需要跳转到https://openapi.alipay.com/gateway.do? + order_string</span></span><br><span class="line">        order_str = alipay.api_alipay_trade_page_pay(</span><br><span class="line">            subject=<span class="string">"实验楼消费"</span>,</span><br><span class="line">            notify_url=<span class="literal">None</span>,</span><br><span class="line">            out_trade_no=order,      <span class="comment"># 订单号</span></span><br><span class="line">            total_amount=price,         <span class="comment"># 订单价格</span></span><br><span class="line">            return_url=<span class="string">"http://127.0.0.1:8000/get_alipy/"</span></span><br><span class="line">        )</span><br><span class="line">	<span class="comment"># 拼接支付宝支付页面网址url</span></span><br><span class="line">        request_url = <span class="string">'https://openapi.alipaydev.com/gateway.do?'</span> + order_str</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;</span><br><span class="line">            <span class="string">"code"</span>: <span class="number">200</span>,</span><br><span class="line">            <span class="string">"msg"</span>: <span class="string">"请求成功，跳转支付页面"</span>,</span><br><span class="line">            <span class="string">"data"</span>: request_url</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="获取回调网址-returnURL-中的参数"><a href="#获取回调网址-returnURL-中的参数" class="headerlink" title="获取回调网址(returnURL)中的参数"></a>获取回调网址(returnURL)中的参数</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 支付回调(获取回调网址中的参数)</span></span><br><span class="line"><span class="comment"># 使用悲观锁修改数据</span></span><br><span class="line"><span class="comment"># 悲观锁包</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Get_Alipy</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        user = request.query_params</span><br><span class="line">        <span class="comment"># 获取支付用户id</span></span><br><span class="line">        uid = r.get(<span class="string">"payuid"</span>)</span><br><span class="line">        <span class="comment"># 获取订单号及价格  并将单位换算成分</span></span><br><span class="line">        price = int(float(user[<span class="string">"total_amount"</span>])*<span class="number">100</span>)</span><br><span class="line">        order = user[<span class="string">"out_trade_no"</span>]</span><br><span class="line">        <span class="comment"># 订单表中生成订单</span></span><br><span class="line">        Order.objects.create(uid=int(uid),order=order,price=price)</span><br><span class="line">        <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">            save =transaction.savepoint()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 获取该价格在会员中的等级</span></span><br><span class="line">                price = VIP.objects.filter(price=price).first()</span><br><span class="line">                <span class="comment"># 修改该用户的会员等级</span></span><br><span class="line">                user = User.objects.select_for_update().get(id=int(uid))</span><br><span class="line">                <span class="comment"># 修改用户的vip等级</span></span><br><span class="line">                user.vid = price.id</span><br><span class="line">                <span class="comment"># 修改后进行保存</span></span><br><span class="line">                user.save()</span><br><span class="line">                <span class="comment"># 提交所有修改</span></span><br><span class="line">                transaction.savepoint_commit(save)</span><br><span class="line">                <span class="keyword">return</span> HttpResponseRedirect(<span class="string">'http://127.0.0.1:8080/vip'</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="comment"># 失败全部回滚</span></span><br><span class="line">                transaction.savepoint_rollback(save)</span><br><span class="line">        r.delete(<span class="string">"payuid"</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">"code"</span>:<span class="number">500</span>,<span class="string">"message"</span>:<span class="string">"修改失败"</span>&#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="向支付宝发起确认支付结果请求"><a href="#向支付宝发起确认支付结果请求" class="headerlink" title="向支付宝发起确认支付结果请求"></a>向支付宝发起确认支付结果请求</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 向支付宝确认支付结果</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Get_Alipy</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment"># 订单号</span></span><br><span class="line">        order = request.GET.get(<span class="string">"order"</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># 获取token</span></span><br><span class="line">        jwt_token = request.GET.get(<span class="string">"token"</span>, <span class="literal">None</span>)</span><br><span class="line">        user_json = jwt_decode_handler(jwt_token)</span><br><span class="line">        <span class="comment"># 获取token中的uid</span></span><br><span class="line">        user_id = user_json.get(<span class="string">"user_id"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 判断是否登录</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user_id:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">"code"</span>: <span class="number">405</span>, <span class="string">"message"</span>: <span class="string">"用户信息已失效，请重新登录"</span>&#125;)</span><br><span class="line">            <span class="comment"># 查询订单是否存在，或订单是否已经支付过</span></span><br><span class="line">        order_id = Order.objects.filter(order=order, uid=int(user_id)).first()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> order_id <span class="keyword">or</span> order_id.is_succeed == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">"code"</span>: <span class="number">405</span>, <span class="string">"message"</span>: <span class="string">"订单不存在或已付款，请刷新后查看"</span>&#125;)</span><br><span class="line"></span><br><span class="line">        alipay = AliPay(</span><br><span class="line">            appid=<span class="string">"2016102400753303"</span>,</span><br><span class="line">            app_notify_url=<span class="literal">None</span>,  <span class="comment"># 默认回调url</span></span><br><span class="line">            app_private_key_string=app_private_key_string,</span><br><span class="line">            alipay_public_key_string=alipay_public_key_string,</span><br><span class="line">            <span class="comment"># 支付宝的公钥，验证支付宝回传消息使用，不是你自己的公钥,</span></span><br><span class="line">            sign_type=<span class="string">"RSA2"</span>,  <span class="comment"># RSA 或者 RSA2</span></span><br><span class="line">            debug=<span class="literal">True</span>  <span class="comment"># 默认False</span></span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># 支付宝交易查询接口：alipay.api_alipay_trade_query(订单号)</span></span><br><span class="line">        response = alipay.api_alipay_trade_query(order)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> response.get(<span class="string">"code"</span>) != <span class="string">"10000"</span> <span class="keyword">or</span> response.get(<span class="string">"trade_status"</span>) != <span class="string">"TRADE_SUCCESS"</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">"code"</span>: <span class="number">405</span>, <span class="string">"message"</span>: <span class="string">"开通失败"</span>&#125;)</span><br><span class="line">        order_id = Order.objects.filter(order=order, uid=int(user_id)).first()</span><br><span class="line">        <span class="comment"># 将支付状态修改为已支付</span></span><br><span class="line"></span><br><span class="line">        order_id.is_succeed = <span class="number">1</span></span><br><span class="line">        <span class="comment"># 查询开通的会员级别</span></span><br><span class="line">        vip = VIP.objects.filter(grade=order_id.behoof).first()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 修改对应用户的vip级别</span></span><br><span class="line">        user = User.objects.get(id=int(user_id))</span><br><span class="line">        user.vid = vip.id</span><br><span class="line"></span><br><span class="line">        user.vip_start_time = datetime.datetime.now()</span><br><span class="line"></span><br><span class="line">        order_id.save()</span><br><span class="line">        user.save()</span><br><span class="line">        <span class="comment"># 提交所有修改</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">"code"</span>: <span class="number">200</span>, <span class="string">"message"</span>: <span class="string">"恭喜您，会员开通成功"</span>&#125;)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>支付宝</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu命令大全</title>
    <url>/Ubuntu/Ubuntu_id_06.html</url>
    <content><![CDATA[<p>cd .. // 返回上一级目录</p>
<a id="more"></a>

<p>cd - // 返回上一次目录</p>
<p>cd或cd ~ // 返回家目录</p>
<p>cd / // 进入根目录</p>
<p>pwd // 显示当前目录</p>
<p>ls // 显示当前目录文件</p>
<p>ls localrepo/ // 显示指定目录的文件</p>
<p>ll // 查看目录文件的的详细信息</p>
<p>la // 查看全部包括隐藏的目录文件</p>
<p>tree // 查看当前目录文件树</p>
<p>tree mydir // 查看指定目录的文件树</p>
<p>touch hello.py // 创建空文件</p>
<p>mkdir mydir // 创建文件夹</p>
<p>mkdir -p a/b/c // 创建层级目录</p>
<p>mkdir -p a/{b,c}/{d,e} // 同一级创建多个文件夹</p>
<p>cp hello.py ~/hello2.py // 拷贝文件</p>
<p>cp hello.py -i hello2.py // 拷贝文件，如果有同名文件询问是否覆盖</p>
<p>cp hello.py -f hello2.py // 拷贝文件，如果有同名文件强制覆盖</p>
<p>cp hello.py -n hello2.py // 拷贝文件，如果有同名文件不覆盖</p>
<p>mv hello2.py hellocp.py // 重命名文件</p>
<p>mv hello.py ~/Desktop // 移动文件</p>
<p>rm hellocp.py // 删除文件</p>
<p>rm -rf localrepo/ // 递归删除目录</p>
<p>find ~/Desktop/ -name ‘*.py’ // 在指定目录中查找文件</p>
<p>whereis python // 查找可执行程序</p>
<p>which python // 查看当前使用的是哪个目录中的python</p>
<p>ln -s /usr/bin/python ./mypylink // 创建可执行程序的软链接</p>
<p>alias rrm=’rm -rf’ // 给命令起别名，需要root权限(不建议使用)</p>
<p>history // 查看命令历史</p>
<p>clear // 清屏(快捷键Ctrl+l)</p>
<p><strong>@命令速查</strong></p>
<p>rm –help // 查看rm命令帮助</p>
<p>man rm // 查看rm命令的手册解释</p>
<p>info rm // 查看rm命令详细信息</p>
<p><strong>@更多查找</strong></p>
<p>find ~/ -name ‘*.py’ -exec rm {} ;    查找家目录下所有的py文件并删除，{}与exec结合匹配所有文件</p>
<p>find ~/ -name ‘*.py’ -exec chown wife {} ;        查找家目录下所有py文件并将所有权转让给wife用户</p>
<p>find ~/ -name ‘*.py’ -exec cat {} ;&gt; record.txt    查找文件并将全部内容拼接并写入文件中</p>
<p>find ~/ -name ‘*.py’ -exec cp {} mydir ;        查找文件并拷贝到指定目录</p>
<p>grep ‘def.*’ a.py    在a.py中查找指定内容</p>
<p>grep ‘def.*’ a.py b.py c.py    在多个文件中寻找指定内容</p>
<p>grep -v ‘def.*’ a.py    在a.py中查找指定内容以外的内容</p>
<p>grep -i “HELLO” a.py    在a.py中查找指定内容并忽略大小写</p>
<p>grep -E “[1-9]+” a.py    在a.py中查找正则表达式匹配的内容（匹配1到多个数字）</p>
<p>grep -F “[1-9]+” a.py    在a.py中查找纯文本内容（严格匹配字符串”[1-9]+”）</p>
<p>grep -e “def.*” -e “class.*” a.py    在a.py中查找多个内容</p>
<p>grep “text” ./ -r -n    在当前目录下递归查找内容</p>
<p><strong>@系统管理</strong></p>
<p>poweroff    关机</p>
<p>reboot    重启</p>
<p>shutdown -h 12:00    定时关机</p>
<p>shutdown -h now        立刻关机</p>
<p>shutdown -c            取消定时关机</p>
<p>#结合1,查看所有CPU平均负载/每个CPU的具体负载</p>
<p>#结合M/P/T,按内存占用/CPU占用/运行时间的降序，查看进程信息</p>
<p>top                    显示所有系统任务</p>
<p>free -m             查看内存占用，以M为单位</p>
<p>uname -a            打印操作系统信息</p>
<p>uptime -p            查看系统运行时间</p>
<p>echo $PATH            查看环境变量</p>
<p>export PATH=$PATH:/home/sirouyang/Desktop/    追加环境变量</p>
<p>lsof | head -n 10    查看进程打开的文件（一切皆文件，数据文件、网络连接、硬件设备）</p>
<p>lscpu                查看CPU信息</p>
<p>time lsof        统计命令执行时间</p>
<p>cal/date            查看日历和时间</p>
<p>date +%y-%m-%d-%H-%M-%S    格式化地查看时间</p>
<p># 0-6:0停机-1单用户安全模式-2多用户安全模式-3多用户网络模式-4系统保留级别-5图形界面-6重启</p>
<p>runlevel        显示当前运行级别</p>
<p>init 6            切换运行级别</p>
<p><strong>@软件安装</strong></p>
<p>//方式一：通过包管理工具apt进行管理</p>
<p>sudo apt update // 更新软件源</p>
<p>sudo apt search xxx//查找xxx软件包</p>
<p>sudo apt install net-tools //安装net-tools</p>
<p>sudo apt remove –purge net-tools //彻底卸载net-tools</p>
<p>//方式二：编译源码</p>
<p>wget “http://………..xxx.tar.gz” //下载源码包</p>
<p>tar -zxvf xxx.tar.gz //解压源码包</p>
<p>make clean    清除编译的垃圾</p>
<p>make        执行编译</p>
<p>make install    安装</p>
<p>make uninstall    卸载</p>
<p>可选：./configure    如果源码包中自带配置程序则执行之</p>
<p>可选：sudo apt search libxxx //如果编译失败通常会提示缺少xxx依赖，此时应该搜索并安装该依赖</p>
<p>可选：sudo apt install libxxx-dev //安装检索到的依赖</p>
<p><strong>@文本命令</strong></p>
<p>cat hello.py // 查看文件</p>
<p>gedit hello.py // 使用gedit查看文件</p>
<p>head -n 10 hello.py // 查看前10行</p>
<p>tail -n 10 hello.py // 查看后10行</p>
<p>less hello.py // 一次查看少量内容，PageUp和PageDown键翻页</p>
<p>vim hello.py // 使用vim打开文件</p>
<p><strong>@管道与重定向</strong></p>
<p>sort hello.py | uniq -c // 排序后统计次数</p>
<p>sort hello.py | uniq -d // 排序后找出重复的行</p>
<p>cat /proc/cpuinfo | grep -c processor // 显示CPU核心数</p>
<p>echo ‘newline’ &gt; hello.py // 将结果写入文件（覆盖）</p>
<p>echo ‘newline’ &gt;&gt; hello.py // 将结果追加到文件</p>
<p>cat &lt; ~/proc/cpuinfo //将指定的文件作为cat的输入</p>
<p><strong>@压缩和解压</strong></p>
<p>tar -cvf /home/abc.tar /home/abc  只打包，不压缩（c=创建压缩包,v=打印信息,f=指定文件名）</p>
<p>tar -zcvf /home/abc.tar.gz /home/abc  打包，并用gzip压缩</p>
<p>tar -jcvf /home/abc.tar.bz2 /home/abc  打包，并用bzip2压缩</p>
<p>tar -xvf abc.tar 解压普通tar包(x=解压缩)</p>
<p>tar -zxvf abc.tar.gz 解压gz压缩包</p>
<p>tar -jxvf abc.tar.bz2 解压bz2压缩包</p>
<p>zip -r xxx.zip abc/* fuck/* temp/* 递归压缩多个文件夹到xxx.zip</p>
<p>unzip xxx.zip #解压zip压缩包</p>
<p><strong>@磁盘管理</strong></p>
<p>df -h /                    查看磁盘使用情况</p>
<p>sudo du -h ~            查看用户目录的磁盘使用情况</p>
<p>du -sh                    当前目录的总体占用情况</p>
<p>du abc.tar.gz abc.tar    查看文件和目录的磁盘占用</p>
<p>dd if=/dev/zero of=temp.txt bs=1K count=1024    写入一个充满0的文件，每块1K，共1024块，总大小1M</p>
<p>time dd if=/dev/zero of=temp.txt bs=1M count=1024    测试写入1G文件的时间（以此衡量磁盘的读写效率）</p>
<p><strong>@登录日志</strong></p>
<p>last 查看用户近期登陆情况</p>
<p>last -2 最近登陆的两个用户</p>
<p>last -2 root 查看root用户最近两次登陆情况</p>
<p>id    显示用户及其群组信息</p>
<p>groups    查看当前用户所加入的组</p>
<p>whoami    显示当前用户名称</p>
<p><strong>@用户与权限</strong></p>
<p>groups // 查看所属的工作组</p>
<p>whoami // 显示当前用户名称</p>
<p>sudo useradd -m wife // 新建wife用户，-m=自动创建家目录</p>
<p>sudo useradd -d /home/myson -m son //创建son用户，指定其家目录为/home/myson</p>
<p>sudo useradd -g guests -G root,adm -m him //创建him用户，属于group组，其次也属于adm,root组</p>
<p>sudo useradd -G guests,sudo -m -s /bin/bash mywife // 新增一个用户,-m=自动创建家目录,-s指定bash</p>
<p>userdel rose 删除rose 账号</p>
<p>userdel -r rose 删除用户及相关目录下的文件（/etc/passwd, /etc/shadow, /etc/group等）</p>
<p>usermod -s /bin/ksh -d /home/z –g developer him // 修改him用户的shell、家目录、所属组等信息</p>
<p>sudo passwd // 修改自己的密码</p>
<p>sudo passwd mywife // 修改mywife的密码</p>
<p>sudo su mywife // 切换用户</p>
<p>sudo su // 切换到root用户</p>
<p>sudo groupadd guests // 添加guests组</p>
<p>sudo groupadd -g 101 group1 //添加组group1，识别号为101</p>
<p>groupdel group1 //删除组</p>
<p>groupmod –g 10000 -n group3 group2 //将组group2的标识号改为10000，组名修改为group3</p>
<p>gpasswd -a u1 g1 将u1 加入到 g1 组</p>
<p>gpasswd -d u1 g1 将u1 退出 g1 组</p>
<p>gpasswd -A u1 g1 将g1 组的管理员指派给u1</p>
<p>chmod 421 hello.py // 设置自己、用户组、其他人的权限分别为只读、只写、只执行</p>
<p>chmod a+r,u+wx,g+x,o-wx hello.py // 详细修改全部用户、拥有者、用户组、其他人的权限</p>
<p>/etc/passwd文件说明：</p>
<p>是用户管理工作涉及的最重要的一个文件</p>
<p>内容包含7个字段，例如 him❌200:50:Sam san:/usr/sam:/bin/sh</p>
<p>含义分别为 用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell</p>
<p><strong>@网络管理</strong></p>
<p>sudo apt install net-tools 安装网络工具</p>
<p>ifconfig // 查看网卡状态</p>
<p>ping 192.168.59.129    // 检查网络是否连通</p>
<p>wget “<a href="http://download.redis.io/releases/redis-4.0.9.tar.gz&quot;" target="_blank" rel="noopener">http://download.redis.io/releases/redis-4.0.9.tar.gz&quot;</a> // 下载redis</p>
<p>sudo apt install traceroute 安装路径追踪工具</p>
<p>traceroute -m 100 <a href="http://www.sina.com" target="_blank" rel="noopener">www.sina.com</a>        追踪路由信息，最大100跳</p>
<p>netstat -t        列出所有TCP端口</p>
<p>netstat -r        显示路由表</p>
<p>netstat -i        显示接口（网卡）列表</p>
<p>netstat -tpnl    查看已连接的TCP端口和程序名</p>
<p>netstat -anp | grep 3306 -c        查看MySQL的连接数</p>
<p><strong>@远程登录</strong></p>
<p>//安装并启动ssh服务</p>
<p>sudo apt install openssh-server 安装openssh-server</p>
<p>sudo ps -ef | grep ssh 查看SSH服务是否启动，还可以netstat -tl | grep 22或systemctl status ssh</p>
<p>sudo systemctl start ssh 如果没有启动则启动SSH服务</p>
<p>//访问远程主机（前提：对方开启了ssh服务，且你知道对方的密码，或对方持有你的ssh公钥）</p>
<p>ssh <a href="mailto:root@127.0.0.1">root@127.0.0.1</a> 访问远程主机</p>
<p>exit 退出远程访问</p>
<p>//执行远程拷贝</p>
<p>scp -r <a href="mailto:sirouyang@192.168.158.129">sirouyang@192.168.158.129</a>:/abc /home/wife/Desktop/        从远程主机拷贝内容到本地</p>
<p>scp -r /abc <a href="mailto:sirouyang@192.168.158.129">sirouyang@192.168.158.129</a>:/home/sirouyang/Desktop/    从本地拷贝内容弄到远程主机（对方没有本地的公钥时需要密码认证）</p>
<p># ssh公钥交换过程：远程主机持有本地的公钥时，ssh以及scp可以免密执行</p>
<p>ssh-keygen -t rsa    生成ssh秘钥对</p>
<p>scp ~/.ssh/id_rsa.pub <a href="mailto:sirouyang@192.168.158.129">sirouyang@192.168.158.129</a>:/home/sirouyang/.ssh/    上传公钥给远程主机</p>
<p>ssh <a href="mailto:sirouyang@192.168.158.129">sirouyang@192.168.158.129</a>    ssh登录远程主机</p>
<p>cat Desktop/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys    操作远程主机添加公钥认证（今后远程对本地ssh免密）</p>
<p>//一站式让远程持有自己的公钥</p>
<p>ssh-copy-id <a href="mailto:sirouyang@192.168.158.128">sirouyang@192.168.158.128</a>    让远程持有自己的公钥（对方不必添加公钥到authorized_keys）</p>
<p>如果远程持有自己的公钥后依然无法免密登录，需要修改配置文件，请参考： <a href="https://blog.csdn.net/b_x_p/article/details/78534423" target="_blank" rel="noopener">https://blog.csdn.net/b_x_p/article/details/78534423</a></p>
<p><strong>@进程管理</strong></p>
<p>ps -ef // 查看所有进程（包括登录的其它用户的进程）</p>
<p>ps -aux //查看所有进程（仅当前用户的进程）</p>
<p>ps -ef | grep redis    // 查找redis进程</p>
<p>kill -9 77157    // 强行杀死指定pid的进程</p>
<p>kill -15 77157    // 终止指定进程</p>
<p><strong>@服务管理</strong></p>
<p>#chkconfig服务管理</p>
<p>apt-get install sysv-rc-conf    安装chkconfig服务</p>
<p>cp /usr/sbin/sysv-rc-conf /usr/sbin/chkconfig    重命名一下可执行程序</p>
<p>chkconfig –list            查看所有服务的开机启动状态</p>
<p>chkconfig –list mysqld        查看mysql的开机启动状态</p>
<p>chkconfig mysqld on            设置mysql开机启动</p>
<p>chkconfig mysqld off        禁止mysql开机启动</p>
<p>sudo apt install firewalld    安装firewalld</p>
<p>firewall-cmd –state        查看防火墙状态</p>
<p>#原生的service服务管理</p>
<p>service mysql start            启动mysql</p>
<p>service mysql stop            停止mysql</p>
<p>service mysql restart        重启mysql</p>
<p>/etc/init.d/mysql start        启动mysql</p>
<p>/etc/init.d/mysql stop        停止mysql</p>
<p>/etc/init.d/mysql restart    重启mysql</p>
<p>#systemctl服务管理（推荐方式）</p>
<p>systemctl status firewalld        查看服务状态</p>
<p>systemctl start firewalld         启动服务</p>
<p>systemctl stop firewalld         停止服务</p>
<p>systemctl restart firewalld     重启服务</p>
<p>systemctl is-enabled firewalld     查看是否开机启动</p>
<p>systemctl enable firewalld        设置服务开机自启</p>
<p>systemctl disable firewalld     禁止服务开机自启</p>
<p><strong>@其它命令</strong></p>
<p>ls -i /usr/bin/python //查看文件的inode</p>
<p>ln /usr/bin/python ./phln // 创建硬链接（共享文件入口）(硬链接不能跨磁盘)</p>
<p>source ~/.bashrc // 使修改后的bashrc生效</p>
<p><strong>@一键安装Ubuntu常用库</strong></p>
<p>sudo apt install man gcc make sudo lsof ssh openssl tree vim dnsutils iputils‑ping net‑</p>
<p>tools psmisc sysstat curl telnet traceroute wget libbz2‑dev libpcre3 libpcre3‑dev</p>
<p>libreadline‑dev libsqlite3‑dev libssl‑dev zlib1g‑dev git mysql‑server mysql‑client zip</p>
<p>p7zip golang-go libncurses5-dev libmysqlclient-dev</p>
]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu18.04设置国内源</title>
    <url>/Ubuntu/Ubuntu_id_05.html</url>
    <content><![CDATA[<p>　　Ubuntu本身的源使用的是国内的源，下载速度比较慢，不像CentOS一样yum安装的时候对镜像站点进项选择， </p>
<a id="more"></a>

<p>　　所以选择了更换成国内的源。<br>　　以下内容整合自网络</p>
<h2 id="备份-etc-apt-sources-list文件"><a href="#备份-etc-apt-sources-list文件" class="headerlink" title="备份/etc/apt/sources.list文件"></a>备份/etc/apt/sources.list文件</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">mv /etc/apt/sources.list /etc/apt/sourses.list.backup</span><br></pre></td></tr></table></figure></div>

<h2 id="新建-etc-apt-sources-list文件并添加以下内容"><a href="#新建-etc-apt-sources-list文件并添加以下内容" class="headerlink" title="新建/etc/apt/sources.list文件并添加以下内容"></a>新建/etc/apt/sources.list文件并添加以下内容</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="LSL"><figure class="iseeu highlight /lsl"><table><tr><td class="code"><pre><span class="line"># 新建sources.<span class="type">list</span></span><br><span class="line"><span class="section">touch</span> /etc/apt/sources.<span class="type">list</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 打开sources.list文件</span></span><br><span class="line"><span class="comment"># 如果没有安装vim命令，可以手动添加</span></span><br><span class="line">sudo gedit /etc/apt/sources.list</span><br><span class="line"><span class="comment"># 添加完成后保存，然后关闭</span></span><br><span class="line"><span class="comment"># 如果已经安装了vim命令，可以直接执行以下命令</span></span><br><span class="line">sudo vim /etc/apt/sources.list</span><br><span class="line"><span class="comment"># 输入i，进入编辑，添加一下代码：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#163源</span></span><br><span class="line">deb http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">添加后按Esc退出编辑模式</span><br><span class="line">输入：:wq    <span class="comment"># 保存退出</span></span><br></pre></td></tr></table></figure></div>

<h2 id="更改完成之后执行以下命令"><a href="#更改完成之后执行以下命令" class="headerlink" title="更改完成之后执行以下命令"></a>更改完成之后执行以下命令</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt upgrade</span><br></pre></td></tr></table></figure></div>

<h2 id="其他的一些apt命令"><a href="#其他的一些apt命令" class="headerlink" title="其他的一些apt命令"></a>其他的一些apt命令</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get update  更新源</span><br><span class="line">sudo apt-get install package 安装包</span><br><span class="line">sudo apt-get remove package 删除包</span><br><span class="line">sudo apt-cache search package 搜索软件包</span><br><span class="line">sudo apt-cache show package  获取包的相关信息，如说明、大小、版本等</span><br><span class="line">sudo apt-get install package --reinstall  重新安装包</span><br><span class="line">sudo apt-get -f install  修复安装</span><br><span class="line">sudo apt-get remove package --purge 删除包，包括配置文件等</span><br><span class="line">sudo apt-get build-dep package 安装相关的编译环境</span><br><span class="line">sudo apt-get upgrade 更新已安装的包</span><br><span class="line">sudo apt-get dist-upgrade 升级系统</span><br><span class="line">sudo apt-cache depends package 了解使用该包依赖那些包</span><br><span class="line">sudo apt-cache rdepends package 查看该包被哪些包依赖</span><br><span class="line">sudo apt-get <span class="built_in">source</span> package  下载该包的源代码</span><br><span class="line">sudo apt-get clean &amp;&amp; sudo apt-get autoclean 清理无用的包</span><br><span class="line">sudo apt-get check 检查是否有损坏的依赖</span><br></pre></td></tr></table></figure></div>

<h2 id="其他几个国内的源："><a href="#其他几个国内的源：" class="headerlink" title="其他几个国内的源："></a>其他几个国内的源：</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#中科大源</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"><span class="comment">#阿里云源</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"><span class="comment">#清华源</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>axios封装</title>
    <url>/Vue/Vue_id_02.html</url>
    <content><![CDATA[<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>　　封装请求的方式有多种多样，目的是可以管理vue项目中axios请求的路由。</p>
<a id="more"></a>

<h2 id="创建文件"><a href="#创建文件" class="headerlink" title="创建文件"></a>创建文件</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"># 在下面目录中创建文件</span><br><span class="line">components/axios_api/http.js</span><br></pre></td></tr></table></figure></div>

<h2 id="Vue-axios封装"><a href="#Vue-axios封装" class="headerlink" title="Vue-axios封装"></a>Vue-axios封装</h2><p>　　<strong>封装到文件：components/axios_api/http.js中</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line">axios.defaults.baseURL=<span class="string">"http://127.0.0.1:8000/"</span></span><br><span class="line">axios.defaults.timeout = <span class="number">10000</span>;</span><br><span class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/json'</span>;</span><br><span class="line">axios.defaults.headers.put[<span class="string">'Content-Type'</span>] = <span class="string">'application/json'</span>;</span><br><span class="line"></span><br><span class="line">axios.interceptors.request.use(    </span><br><span class="line">    config =&gt; &#123;</span><br><span class="line">        <span class="comment">// 每次发送请求之前判断是否存在token，如果存在，则统一在http请求的header都加上token，不用每次请求都手动添加了</span></span><br><span class="line">        <span class="comment">// 即使本地存在token，也有可能token是过期的，所以在响应拦截器中要对返回状态进行判断</span></span><br><span class="line">        <span class="keyword">const</span> token = sessionStorage.getItem(<span class="string">"jwt_token"</span>)        </span><br><span class="line">        token &amp;&amp; (config.headers.Authorization = token)        </span><br><span class="line">        <span class="keyword">return</span> config;    </span><br><span class="line">    &#125;,    </span><br><span class="line">    error =&gt; &#123;        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.error(error);    </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(    </span><br><span class="line">    <span class="comment">// 请求成功</span></span><br><span class="line">    res =&gt; res.status === <span class="number">200</span> ? <span class="built_in">Promise</span>.resolve(res) : <span class="built_in">Promise</span>.reject(res),    </span><br><span class="line">    <span class="comment">// 请求失败</span></span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; response &#125; = error;</span><br><span class="line">        <span class="keyword">if</span> (response) &#123;</span><br><span class="line">            <span class="comment">// 请求已发出，但是不在2xx的范围 </span></span><br><span class="line">            errorHandle(response.status, response.data.message);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 处理断网的情况</span></span><br><span class="line">            <span class="comment">// eg:请求超时或断网时，更新state的network状态</span></span><br><span class="line">            <span class="comment">// network状态在app.vue中控制着一个全局的断网提示组件的显示隐藏</span></span><br><span class="line">            <span class="comment">// 关于断网组件中的刷新重新获取数据，会在断网组件中说明</span></span><br><span class="line">            store.commit(<span class="string">'changeNetwork'</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_get</span>(<span class="params">url,params</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">        (resolve,reject)=&gt;&#123;</span><br><span class="line">            axios.get(url,&#123;<span class="attr">params</span>:params&#125;)</span><br><span class="line">            .then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"封装信息的的res"</span>,res)</span><br><span class="line">                resolve(res.data)</span><br><span class="line">            &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">                reject(err.data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_post</span>(<span class="params">url,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">        (resolve,reject)=&gt;&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data)</span><br><span class="line">            axios.post(url,<span class="built_in">JSON</span>.stringify(data))</span><br><span class="line">            .then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"封装信息的的res"</span>,res)</span><br><span class="line">                resolve(res.data)</span><br><span class="line">            &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">                reject(err.data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_put</span>(<span class="params">url,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">        (resolve,reject)=&gt;&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data)</span><br><span class="line">            axios.put(url,<span class="built_in">JSON</span>.stringify(data))</span><br><span class="line">            .then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"封装信息的的res"</span>,res)</span><br><span class="line">                resolve(res.data)</span><br><span class="line">            &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">                reject(err.data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_delete</span>(<span class="params">url,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">        (resolve,reject)=&gt;&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data)</span><br><span class="line">            axios.delete(url,&#123;<span class="attr">params</span>:data&#125;)</span><br><span class="line">            .then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"封装信息的的res"</span>,res)</span><br><span class="line">                resolve(res.data)</span><br><span class="line">            &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">                reject(err.data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="导出使用："><a href="#导出使用：" class="headerlink" title="导出使用："></a>导出使用：</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;axios_get,axios_post,axios_delete,axios_put&#125; <span class="keyword">from</span> <span class="string">'./http.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> jwt_send_get = <span class="function"><span class="params">p</span>  =&gt;</span> axios_get(<span class="string">"/appjwt/index01/"</span>,p)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>axios</tag>
      </tags>
  </entry>
  <entry>
    <title>Git配置密钥</title>
    <url>/Git/Git_id_05.html</url>
    <content><![CDATA[<p>1.本地安装好git；</p>
<p>2.桌面右键 Git Bash Here 打开git命令行；</p>
<a id="more"></a>

<p>3.ssh-keygen -t rsa -C “<a href="mailto:XXXXX@XXX.com">XXXXX@XXX.com</a>“   （你的邮箱,全部按enter）；</p>
<p>4.cd ~/.ssh   （如果没有执行第三步，则不会有这个文件夹）；</p>
<p>5.cat id_rsa.pub     在命令行打开这个文件，会直接输出密钥；</p>
<p>6.复制，打开github   ，点自己头像 &gt;&gt; settings &gt;&gt; SSH and GPG keys &gt;&gt;New SSH key </p>
<p>7.titile  随便写。  key里    粘贴第六步的内容；完成。</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git常用命令</title>
    <url>/Git/Git_id_04.html</url>
    <content><![CDATA[<h3 id="1-强制推送（慎用，除非你认为其他冲突等可以丢弃-或者不是很重要）"><a href="#1-强制推送（慎用，除非你认为其他冲突等可以丢弃-或者不是很重要）" class="headerlink" title="1.强制推送（慎用，除非你认为其他冲突等可以丢弃 或者不是很重要）"></a>1.强制推送（慎用，除非你认为其他冲突等可以丢弃 或者不是很重要）</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ADA"><figure class="iseeu highlight /ada"><table><tr><td class="code"><pre><span class="line">git push <span class="comment">-- force</span></span><br></pre></td></tr></table></figure></div>

<a id="more"></a>

<h3 id="2-创建文件等小命令"><a href="#2-创建文件等小命令" class="headerlink" title="2.创建文件等小命令"></a>2.创建文件等小命令</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STATA"><figure class="iseeu highlight /stata"><table><tr><td class="code"><pre><span class="line">touch a <span class="comment">// 创建一个a文件</span></span><br><span class="line">echo 1234 &gt;&gt; a <span class="comment">// 把1234这个内容放入a文件</span></span><br><span class="line"><span class="keyword">cat</span> a <span class="comment">// 打开a文件 读取出a文件中的内容</span></span><br><span class="line"><span class="keyword">mkdir</span> <span class="keyword">test</span> <span class="comment">// 创建test文件夹</span></span><br><span class="line"><span class="keyword">rm</span> 文件名 <span class="comment">// 删除文件</span></span><br><span class="line"><span class="keyword">pwd</span> <span class="comment">// 打印当前工作路径</span></span><br></pre></td></tr></table></figure></div>

<h3 id="3-安装git的时候-都会安装git-bash和git-GUI-我们完全也可以使用git-GUI来提交版本-与sourcetree等功能相同"><a href="#3-安装git的时候-都会安装git-bash和git-GUI-我们完全也可以使用git-GUI来提交版本-与sourcetree等功能相同" class="headerlink" title="3.安装git的时候 都会安装git bash和git GUI 我们完全也可以使用git GUI来提交版本 与sourcetree等功能相同"></a>3.安装git的时候 都会安装git bash和git GUI 我们完全也可以使用git GUI来提交版本 与sourcetree等功能相同</h3><figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">gitk <span class="comment">// 用git命令快速打开git GUI</span></span><br></pre></td></tr></table></figure>

<h3 id="4-文件信息"><a href="#4-文件信息" class="headerlink" title="4.文件信息"></a>4.文件信息</h3><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ls</span> <span class="string">//</span> 查看当前路径下面的所有文件名</span><br><span class="line"><span class="keyword">ls</span> 文件夹名 <span class="string">//</span> 查看对应文件夹中的内容</span><br><span class="line"><span class="keyword">ls</span> -l <span class="string">//</span> 拉出最近git提交记录以及对应修改的文件名</span><br><span class="line"><span class="keyword">ls</span> -l -a <span class="string">//</span> 拉出最近git提交记录以及对应修改的文件名，隐藏的文件也会显示</span><br></pre></td></tr></table></figure>

<h3 id="5-cd快速切换路径"><a href="#5-cd快速切换路径" class="headerlink" title="5.cd快速切换路径"></a>5.cd快速切换路径</h3><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> ~ <span class="string">//</span> 将工作路径快速切换到root</span><br><span class="line"><span class="keyword">cd</span> - <span class="string">//</span> 将工作路径切换到上一状态</span><br><span class="line"><span class="keyword">cd</span> <span class="string">../</span> <span class="string">//</span> 切回到上一个工作路径</span><br><span class="line"><span class="keyword">cd</span> 文件夹名 <span class="string">//</span> 进入某个目录</span><br><span class="line"><span class="keyword">cd</span> / <span class="string">//</span> 进入根目录</span><br></pre></td></tr></table></figure>

<h3 id="6-vim模式"><a href="#6-vim模式" class="headerlink" title="6.vim模式"></a>6.vim模式</h3><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">vim 文件名 <span class="string">//</span> 新建一个文件</span><br><span class="line">i 插入内容</span><br><span class="line">按下esc <span class="function">:wq</span> 保存并退出</span><br><span class="line">按下esc <span class="function">:q</span> 直接退出</span><br><span class="line">vim 模式下 文件中<span class="comment">#号开头的为注释</span></span><br><span class="line"><span class="string">.project</span> 忽略<span class="string">.project</span>文件</span><br><span class="line">*<span class="string">.obj</span> 或者 *<span class="string">.exe</span> 忽略一类文件 例如以<span class="string">.obj</span> <span class="string">.exe</span> 结尾的文件</span><br><span class="line">git check-ignore -v <span class="string">.project</span> 查看ignore中<span class="string">.project</span>的位置</span><br></pre></td></tr></table></figure>

<h3 id="7-常用git-命令"><a href="#7-常用git-命令" class="headerlink" title="7.常用git 命令"></a>7.常用git 命令</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CS"><figure class="iseeu highlight /cs"><table><tr><td class="code"><pre><span class="line">git init <span class="comment">// 初始化 在工作路径上创建主分支</span></span><br><span class="line">git clone 地址 <span class="comment">// 克隆远程仓库</span></span><br><span class="line">git clone -b 分支名 地址 <span class="comment">// 克隆分支的代码到本地</span></span><br><span class="line">git status <span class="comment">// 查看状态</span></span><br><span class="line">git <span class="keyword">add</span> 文件名 <span class="comment">// 将某个文件存入暂存区</span></span><br><span class="line">git <span class="keyword">add</span> b c <span class="comment">//把b和c存入暂存区</span></span><br><span class="line">git <span class="keyword">add</span> . <span class="comment">// 将所有文件提交到暂存区</span></span><br><span class="line">git <span class="keyword">add</span> -p 文件名 <span class="comment">// 一个文件分多次提交</span></span><br><span class="line">git stash -u -k <span class="comment">// 提交部分文件内容 到仓库 例如本地有3个文件 a b c 只想提交a b到远程仓库 git add a b 然后 git stash -u -k 再然后git commit -m "备注信息" 然后再push push之后 git stash pop 把之前放入堆栈的c拿出来 继续下一波操作</span></span><br><span class="line">git commit -m <span class="string">"提交的备注信息"</span>  <span class="comment">// 提交到仓库</span></span><br><span class="line">若已经有若干文件放入仓库，再次提交可以不用git <span class="keyword">add</span>和git commit -m <span class="string">"备注信息"</span> 这<span class="number">2</span>步， 直接用</span><br><span class="line">git commit -am <span class="string">"备注信息"</span> <span class="comment">// 将内容放至仓库 也可用git commit -a -m "备注信息"</span></span><br><span class="line"></span><br><span class="line">* git commit中的备注信息尽量完善 养成良好提交习惯 例如 git commit -m <span class="string">"变更(范围)：变更的内容"</span></span><br></pre></td></tr></table></figure></div>

<h3 id="8-存储密码凭证-设置别名-获取config信息以及配置"><a href="#8-存储密码凭证-设置别名-获取config信息以及配置" class="headerlink" title="8.存储密码凭证 设置别名 获取config信息以及配置"></a>8.存储密码凭证 设置别名 获取config信息以及配置</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="VERILOG"><figure class="iseeu highlight /verilog"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">config</span> --list <span class="comment">// 获取config信息</span></span><br><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> core<span class="variable">.safecrlf</span> false <span class="comment">// 去掉git add 命令后 出现的一堆CR LF提示信息</span></span><br><span class="line">其中CR是回车的意思 LF是换行</span><br><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> credential<span class="variable">.helper</span> wincred <span class="comment">// 存储凭证 (可用于输入一次用户密码后，不再输入 有时我们已经用SSH key 绑定关联好了 但是每次git提交的时候 还是需要你输入用户名密码 在这个时候 敲入这个命令 将凭证存储起来 用户名密码就不需要再次输入了)</span></span><br><span class="line">git <span class="keyword">config</span> --<span class="keyword">global</span> <span class="keyword">alias</span><span class="variable">.ci</span> commit <span class="comment">// 将commit命令设置别名ci git commit命令将由git ci来代替</span></span><br></pre></td></tr></table></figure></div>

<h3 id="9-查看git常用命令"><a href="#9-查看git常用命令" class="headerlink" title="9.查看git常用命令"></a>9.查看git常用命令</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DELPHI"><figure class="iseeu highlight /delphi"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">helper</span> -a <span class="comment">// 查看全部git子命令</span></span><br></pre></td></tr></table></figure></div>

<h3 id="10-逐行查看文件的修改历史"><a href="#10-逐行查看文件的修改历史" class="headerlink" title="10.逐行查看文件的修改历史"></a>10.逐行查看文件的修改历史</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">git blame 文件名 <span class="comment">// 查看该文件的修改历史</span></span><br><span class="line">git blame -L <span class="number">100</span>,<span class="number">10</span> 文件名 <span class="comment">// 从100行开始，到110行 逐行查看文件的修改历史</span></span><br></pre></td></tr></table></figure></div>

<h3 id="11-清除"><a href="#11-清除" class="headerlink" title="11.清除"></a>11.清除</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ASPECTJ"><figure class="iseeu highlight /aspectj"><table><tr><td class="code"><pre><span class="line">git clean -n <span class="comment">// 列出打算清除的档案(首先会对工作区的内容进行提示)</span></span><br><span class="line">git clean -f <span class="comment">// 真正的删除</span></span><br><span class="line">git clean -x -f <span class="comment">// 连.gitignore中忽略的档案也删除</span></span><br><span class="line">git status -sb (sb是 <span class="keyword">short</span> branch) <span class="comment">// 简洁的输出git status中的信息</span></span><br></pre></td></tr></table></figure></div>

<h3 id="12-删除放入暂存区文件的方法（已commit后）"><a href="#12-删除放入暂存区文件的方法（已commit后）" class="headerlink" title="12.删除放入暂存区文件的方法（已commit后）"></a>12.删除放入暂存区文件的方法（已commit后）</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line">git rm 文件名 // 将该文件从<span class="keyword">commit</span>后撤回到<span class="keyword">add</span>后</span><br><span class="line">git <span class="keyword">reset</span> <span class="keyword">HEAD</span>^ <span class="comment">--hard // 删除后 可以用git rm 文件名再回撤一步</span></span><br></pre></td></tr></table></figure></div>

<h3 id="13-查看提交内容"><a href="#13-查看提交内容" class="headerlink" title="13.查看提交内容"></a>13.查看提交内容</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">git hi <span class="number">-5</span> <span class="comment">// 查看前5条内容</span></span><br><span class="line">git hi --grep hello <span class="comment">// 过滤提交信息里有hello字眼的内容</span></span><br></pre></td></tr></table></figure></div>

<h3 id="14-修改文件名以及移动"><a href="#14-修改文件名以及移动" class="headerlink" title="14.修改文件名以及移动"></a>14.修改文件名以及移动</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STYLUS"><figure class="iseeu highlight /stylus"><table><tr><td class="code"><pre><span class="line">git mv <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="comment">// 把a文件名字改成b 并且直接放入git add后的暂存区</span></span><br><span class="line">git mv <span class="selector-tag">b</span> ./demos/ <span class="comment">// 把b文件移动到demos文件夹下</span></span><br></pre></td></tr></table></figure></div>

<h3 id="15-对比工作区，暂存区，仓库的差异"><a href="#15-对比工作区，暂存区，仓库的差异" class="headerlink" title="15.对比工作区，暂存区，仓库的差异"></a>15.对比工作区，暂存区，仓库的差异</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">git diff <span class="comment">// 查看变更 工作区与暂存区的差异比对</span></span><br><span class="line">git diff --cached <span class="comment">// 暂存区与提交版本的差异</span></span><br><span class="line">git diff HEAD <span class="comment">// 工作区与仓库中最后一次提交版本的差别</span></span><br><span class="line">git diff 版本哈希值 版本哈希值 <span class="comment">// 查看这2个版本哈希之间的区别</span></span><br><span class="line">或者 git diff HEAD~数字 HEAD~数字</span><br><span class="line"></span><br><span class="line">git tag tt HEAD~<span class="number">4</span> 给倒数第<span class="number">5</span>次提交打一个tag tag名字是tt</span><br><span class="line">git diff tt 就是倒数第<span class="number">5</span>个版本与第一个版本之间的差异</span><br><span class="line">git diff --cached tt 暂存区与倒数第<span class="number">5</span>个版本之间的比对</span><br></pre></td></tr></table></figure></div>

<h3 id="16-查看提交信息"><a href="#16-查看提交信息" class="headerlink" title="16.查看提交信息"></a>16.查看提交信息</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">show</span> <span class="keyword">HEAD</span> // 查看最后一次提交修改的详细信息 也可以用git <span class="keyword">show</span> 哈希值 查看对应的内容</span><br><span class="line">git <span class="keyword">show</span> <span class="keyword">HEAD</span>^ // 查看倒数第二次的提交修改详细信息</span><br><span class="line">git <span class="keyword">show</span> <span class="keyword">HEAD</span>^^ 或者git <span class="keyword">show</span> <span class="keyword">HEAD</span>~<span class="number">2</span> 查看前<span class="number">2</span>次变更</span><br><span class="line">git <span class="keyword">show</span> <span class="keyword">HEAD</span> 或 git <span class="keyword">show</span> 哈希值 或者git <span class="keyword">show</span> tag(标签名) 都可以查看最近一次提交的详细信息</span><br></pre></td></tr></table></figure></div>

<h3 id="17-查看信息"><a href="#17-查看信息" class="headerlink" title="17.查看信息"></a>17.查看信息</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="LIVECODESERVER"><figure class="iseeu highlight /livecodeserver"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> <span class="comment">--pretty=format:'%h %ad | %s%d [%an]' --graph --date=short</span></span><br><span class="line">// 获取git <span class="built_in">log</span>里的树形详细信息 包括hasg 日期 提交信息 提交人等</span><br><span class="line">git <span class="built_in">log</span> <span class="comment">--oneline //拉出所有提交信息 q是退出</span></span><br><span class="line">git <span class="built_in">log</span> <span class="number">-5</span><span class="comment"> // 查看前5次的提交记录</span></span><br><span class="line">git <span class="built_in">log</span> <span class="comment">--oneline -5 // 打印出的日志里面只有哈希值和修改的内容备注</span></span><br><span class="line">git <span class="built_in">log</span> 文件名<span class="comment"> // 查看该文件的提交</span></span><br><span class="line">git <span class="built_in">log</span> <span class="comment">--grep // 想过滤看到的内容   过滤日志</span></span><br><span class="line">git <span class="built_in">log</span> -n<span class="comment"> // 查看近期提交的n条信息内容</span></span><br><span class="line">git <span class="built_in">log</span> -p<span class="comment"> // 查看详细提交记录</span></span><br></pre></td></tr></table></figure></div>

<h3 id="18-变基操作，改写历史提交-把多次提交合并起来"><a href="#18-变基操作，改写历史提交-把多次提交合并起来" class="headerlink" title="18.变基操作，改写历史提交 把多次提交合并起来"></a>18.变基操作，改写历史提交 把多次提交合并起来</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">git rebase -i HEAD~<span class="number">3</span> 变基之后的哈希值与之前的不同 证明变基是重新做的提交 把多次提交合并成了几次提交</span><br></pre></td></tr></table></figure></div>

<h3 id="19-回撤操作"><a href="#19-回撤操作" class="headerlink" title="19.回撤操作"></a>19.回撤操作</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">commit</span> <span class="comment">--amend -m "提交信息" // 回撤上一次提交并与本次工作区一起提交</span></span><br><span class="line">git <span class="keyword">reset</span> <span class="keyword">HEAD</span>~<span class="number">2</span> <span class="comment">--hard // 回撤2步</span></span><br><span class="line">git <span class="keyword">reset</span> <span class="comment">--files // 从仓库回撤到暂存区</span></span><br><span class="line">git <span class="keyword">reset</span> <span class="keyword">HEAD</span> // 回撤暂存区内容到工作目录</span><br><span class="line">git <span class="keyword">reset</span> <span class="keyword">HEAD</span> <span class="comment">--soft 回撤提交到暂存区</span></span><br><span class="line">git <span class="keyword">reset</span> <span class="keyword">HEAD</span> <span class="comment">--hard // 回撤提交 放弃变更 (慎用)</span></span><br><span class="line">git <span class="keyword">reset</span> <span class="keyword">HEAD</span>^  // 回撤仓库最后一次提交</span><br><span class="line">git <span class="keyword">reset</span> <span class="comment">--hard commitid // 回撤到该次提交id的位置</span></span><br><span class="line"></span><br><span class="line">git push -f -u origin 分支名 所有内容都回撤完了 将回撤后的操作强制推送到远程分支</span><br></pre></td></tr></table></figure></div>

<h3 id="20-标签操作"><a href="#20-标签操作" class="headerlink" title="20.标签操作"></a>20.标签操作</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="LASSO"><figure class="iseeu highlight /lasso"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">tag</span> <span class="comment">// 查看列出所有打过的标签名</span></span><br><span class="line">git <span class="built_in">tag</span> <span class="params">-d</span> 标签名 <span class="comment">// 删除对应标签</span></span><br><span class="line">git <span class="built_in">tag</span> 标签名字 <span class="comment">// 在当前仓库打个标签</span></span><br><span class="line">git <span class="built_in">tag</span> foo <span class="params">-m</span> <span class="string">"message"</span> <span class="comment">// 在当前提交上，打标签foo 并给message信息注释</span></span><br><span class="line">git <span class="built_in">tag</span> 标签名 哈希值 <span class="params">-m</span> <span class="string">"message"</span> <span class="comment">// 在某个哈希值上打标签并且写上标签的信息</span></span><br><span class="line">git <span class="built_in">tag</span> foo HEAD~<span class="number">4</span> <span class="comment">// 在当前提交之前的第4个版本上 打标签foo</span></span><br><span class="line">git push origin -<span class="params">-tags</span> <span class="comment">// 把所有打好的标签推送到远程仓库</span></span><br><span class="line">git push origin 标签名 <span class="comment">// 把指定标签推送到远程仓库</span></span><br><span class="line">git stash <span class="comment">// 把暂存区的内容 暂时放在其他中 使暂存区变空</span></span><br><span class="line">git stash <span class="built_in">list</span> <span class="comment">// 查看stash了哪些存储</span></span><br><span class="line">git stash pop <span class="comment">// 将stash中的内容恢复到当前目录，将缓存堆栈中的对应stash删除</span></span><br><span class="line">git stash apply <span class="comment">// 将stash中的内容恢复到当前目录，不会将缓存堆栈中的对应stash删除</span></span><br><span class="line">git stash clear <span class="comment">// 删除所有缓存的stash</span></span><br><span class="line">git pull -<span class="params">-tags</span> <span class="comment">// 把远程仓库的标签也拉取下来</span></span><br><span class="line">git push origin :refs/tags/远程标签名 <span class="comment">// 删除远程仓库的标签</span></span><br></pre></td></tr></table></figure></div>

<h3 id="21-分支"><a href="#21-分支" class="headerlink" title="21.分支"></a>21.分支</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GROOVY"><figure class="iseeu highlight /groovy"><table><tr><td class="code"><pre><span class="line">git branch 分支名 <span class="comment">// 新建分支</span></span><br><span class="line">git branch <span class="comment">// 查看当前所有分支</span></span><br><span class="line">git checkout 分支名 <span class="comment">// 检出分支</span></span><br><span class="line">git checkout -b 分支名 <span class="comment">// 创建并切换分支</span></span><br><span class="line">git checkout commitId 文件名（文件路径下的文件名） 还原这个文件到对应的commitId的版本</span><br><span class="line">（例如src<span class="regexp">/page/</span>attendance<span class="regexp">/attendanceSum.vue我想把它还原到2个版本之前 首先git log src/</span>page<span class="regexp">/attendance/</span>attendanceSum.vue找到对应想要还原的版本</span><br><span class="line">复制版本提交的commitID 然后执行git checkout commitID src<span class="regexp">/page/</span>attendance/attendanceSum.vue</span><br><span class="line">这样就把attendanceSum.vue这个单个文件 还原到了对应版本）</span><br><span class="line">git branch -v <span class="comment">// 查看分支以及提交hash值和commit信息</span></span><br><span class="line">git merge 分支名 <span class="comment">// 把该分支的内容合并到现有分支上</span></span><br><span class="line">git branch -d 分支名 <span class="comment">// 删除分支</span></span><br><span class="line">git branch -D 分支名 <span class="comment">// 强制删除 若没有其他分支合并就删除 d会提示 D不会</span></span><br><span class="line">git branch -m 旧分支名 新分支名 <span class="comment">// 修改分支名</span></span><br><span class="line">git branch -M 旧分支名 新分支名 <span class="comment">// 修改分支名 M强制修改 若与其他分支有冲突也会创建(慎用)</span></span><br><span class="line">git branch -r <span class="comment">// 列出远程分支(远程所有分支名)</span></span><br><span class="line">git branch -a <span class="comment">// 查看远程分支(列出远程分支以及本地分支名)</span></span><br><span class="line">git fetch <span class="comment">// 更新remote索引</span></span><br><span class="line">git push -u origin 分支名 <span class="comment">// 将本地分支推送到origin主机，同时指定origin为默认主机，后面就可以不加任何参数使用git push</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>MarkDown语法</title>
    <url>/Other/Other_id_01.html</url>
    <content><![CDATA[<h1 id="欢迎使用Markdown编辑器"><a href="#欢迎使用Markdown编辑器" class="headerlink" title="欢迎使用Markdown编辑器"></a>欢迎使用Markdown编辑器</h1><p>你好！ 这是你第一次使用 <strong>Markdown编辑器</strong> 所展示的欢迎页。如果你想学习如何使用Markdown编辑器, 可以仔细阅读这篇文章，了解一下Markdown的基本语法知识。</p>
<a id="more"></a>

<h2 id="新的改变"><a href="#新的改变" class="headerlink" title="新的改变"></a>新的改变</h2><p>我们对Markdown编辑器进行了一些功能拓展与语法支持，除了标准的Markdown编辑器功能，我们增加了如下几点新功能，帮助你用它写博客：</p>
<ol>
<li><strong>全新的界面设计</strong> ，将会带来全新的写作体验；</li>
<li>在创作中心设置你喜爱的代码高亮样式，Markdown <strong>将代码片显示选择的高亮样式</strong> 进行展示；</li>
<li>增加了 <strong>图片拖拽</strong> 功能，你可以将本地的图片直接拖拽到编辑区域直接展示；</li>
<li>全新的 <strong>KaTeX数学公式</strong> 语法；</li>
<li>增加了支持<strong>甘特图的mermaid语法<a href="[mermaid语法说明](https://mermaidjs.github.io/)">^1</a></strong> 功能；</li>
<li>增加了 <strong>多屏幕编辑</strong> Markdown文章功能；</li>
<li>增加了 <strong>焦点写作模式、预览模式、简洁写作模式、左右区域同步滚轮设置</strong> 等功能，功能按钮位于编辑区域与预览区域中间；</li>
<li>增加了 <strong>检查列表</strong> 功能。</li>
</ol>
<h2 id="功能快捷键"><a href="#功能快捷键" class="headerlink" title="功能快捷键"></a>功能快捷键</h2><p>撤销：<kbd>Ctrl/Command</kbd> + <kbd>Z</kbd><br>重做：<kbd>Ctrl/Command</kbd> + <kbd>Y</kbd><br>加粗：<kbd>Ctrl/Command</kbd> + <kbd>B</kbd><br>斜体：<kbd>Ctrl/Command</kbd> + <kbd>I</kbd><br>标题：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>H</kbd><br>无序列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>U</kbd><br>有序列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>O</kbd><br>检查列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd><br>插入代码：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>K</kbd><br>插入链接：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>L</kbd><br>插入图片：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>G</kbd><br>查找：<kbd>Ctrl/Command</kbd> + <kbd>F</kbd><br>替换：<kbd>Ctrl/Command</kbd> + <kbd>G</kbd></p>
<h2 id="合理的创建标题，有助于目录的生成"><a href="#合理的创建标题，有助于目录的生成" class="headerlink" title="合理的创建标题，有助于目录的生成"></a>合理的创建标题，有助于目录的生成</h2><p>直接输入1次<kbd>#</kbd>，并按下<kbd>space</kbd>后，将生成1级标题。<br>输入2次<kbd>#</kbd>，并按下<kbd>space</kbd>后，将生成2级标题。<br>以此类推，我们支持6级标题。有助于使用<code>TOC</code>语法后生成一个完美的目录。</p>
<h2 id="如何改变文本的样式"><a href="#如何改变文本的样式" class="headerlink" title="如何改变文本的样式"></a>如何改变文本的样式</h2><p><em>强调文本</em> <em>强调文本</em></p>
<p><strong>加粗文本</strong> <strong>加粗文本</strong></p>
<p>==标记文本==</p>
<p><del>删除文本</del></p>
<blockquote>
<p>引用文本</p>
</blockquote>
<p>H<del>2</del>O is是液体。</p>
<p>2^10^ 运算结果是 1024.</p>
<h2 id="插入链接与图片"><a href="#插入链接与图片" class="headerlink" title="插入链接与图片"></a>插入链接与图片</h2><p>链接: <a href="https://www.csdn.net/" target="_blank" rel="noopener">link</a>.</p>
<p>图片:<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">Alt</span>](<span class="link">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw</span>)</span><br></pre></td></tr></table></figure></div>



<p>带尺寸的图片: </p>
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw" style="zoom:30%">

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">Alt</span>](<span class="link">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw =30x30</span>)</span><br></pre></td></tr></table></figure></div>



<p>居中的图片: <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw" style="align-center:center"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">Alt</span>](<span class="link">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw#pic_center</span>)</span><br></pre></td></tr></table></figure></div>



<p>居中并且带尺寸的图片: <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw" style="align-center:center;zoom:30%"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">Alt</span>](<span class="link">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw#pic_center =30x30</span>)</span><br></pre></td></tr></table></figure></div>



<p>当然，我们为了让用户更加便捷，我们增加了图片拖拽功能。</p>
<h2 id="如何插入一段漂亮的代码片"><a href="#如何插入一段漂亮的代码片" class="headerlink" title="如何插入一段漂亮的代码片"></a>如何插入一段漂亮的代码片</h2><p>去<a href="https://mp.csdn.net/console/configBlog" target="_blank" rel="noopener">博客设置</a>页面，选择一款你喜欢的代码片高亮样式，下面展示同样高亮的 <code>代码片</code>.</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// An highlighted block</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="string">'bar'</span>;</span><br></pre></td></tr></table></figure></div>

<h2 id="生成一个适合你的列表"><a href="#生成一个适合你的列表" class="headerlink" title="生成一个适合你的列表"></a>生成一个适合你的列表</h2><ul>
<li>项目<ul>
<li>项目<ul>
<li>项目</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>项目1</li>
<li>项目2</li>
<li>项目3</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> 计划任务</li>
<li><input checked="" disabled="" type="checkbox"> 完成任务</li>
</ul>
<h2 id="创建一个表格"><a href="#创建一个表格" class="headerlink" title="创建一个表格"></a>创建一个表格</h2><p>一个简单的表格是这么创建的：<br>| 项目 | Value |<br>| —- | —– |<br>| 电脑 | $1600 |<br>| 手机 | $12   |<br>| 导管 | $1    |</p>
<h3 id="设定内容居中、居左、居右"><a href="#设定内容居中、居左、居右" class="headerlink" title="设定内容居中、居左、居右"></a>设定内容居中、居左、居右</h3><p>使用<code>:---------:</code>居中<br>使用<code>:----------</code>居左<br>使用<code>----------:</code>居右<br>|     第一列     |         第二列 | 第三列         |<br>| :————: | ————-: | :————- |<br>| 第一列文本居中 | 第二列文本居右 | 第三列文本居左 |</p>
<h3 id="SmartyPants"><a href="#SmartyPants" class="headerlink" title="SmartyPants"></a>SmartyPants</h3><p>SmartyPants将ASCII标点字符转换为“智能”印刷标点HTML实体。例如：<br>|    TYPE   |ASCII                          |HTML<br>|—————-|——————————-|—————————–|<br>|Single backticks|<code>&#39;Isn&#39;t this fun?&#39;</code>            |’Isn’t this fun?’            |<br>|Quotes          |<code>&quot;Isn&#39;t this fun?&quot;</code>            |”Isn’t this fun?”            |<br>|Dashes          |<code>-- is en-dash, --- is em-dash</code>|– is en-dash, — is em-dash|</p>
<h2 id="创建一个自定义列表"><a href="#创建一个自定义列表" class="headerlink" title="创建一个自定义列表"></a>创建一个自定义列表</h2><dl><dt>Markdown</dt><dd>Text-to-HTML conversion tool</dd></dl><dl><dt>Authors<br>:  John</dt><dd>Luke</dd></dl><h2 id="如何创建一个注脚"><a href="#如何创建一个注脚" class="headerlink" title="如何创建一个注脚"></a>如何创建一个注脚</h2><p>一个具有注脚的文本。<a href="注脚的解释">^2</a></p>
<h2 id="注释也是必不可少的"><a href="#注释也是必不可少的" class="headerlink" title="注释也是必不可少的"></a>注释也是必不可少的</h2><p>Markdown将文本转换为 HTML。</p>
<p>*[HTML]:   超文本标记语言</p>
<h2 id="KaTeX数学公式"><a href="#KaTeX数学公式" class="headerlink" title="KaTeX数学公式"></a>KaTeX数学公式</h2><p>您可以使用渲染LaTeX数学表达式 <a href="https://khan.github.io/KaTeX/" target="_blank" rel="noopener">KaTeX</a>:</p>
<p>Gamma公式展示 $\Gamma(n) = (n-1)!\quad\forall<br>n\in\mathbb N$ 是通过欧拉积分</p>
<p>$$<br>\Gamma(z) = \int_0^\infty t^{z-1}e^{-t}dt,.<br>$$</p>
<blockquote>
<p>你可以找到更多关于的信息 <strong>LaTeX</strong> 数学表达式<a href="http://meta.math.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference" target="_blank" rel="noopener">here</a>.</p>
</blockquote>
<h2 id="新的甘特图功能，丰富你的文章"><a href="#新的甘特图功能，丰富你的文章" class="headerlink" title="新的甘特图功能，丰富你的文章"></a>新的甘特图功能，丰富你的文章</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">gantt</span><br><span class="line">        dateFormat  YYYY-MM-DD</span><br><span class="line">        title Adding GANTT diagram functionality to mermaid</span><br><span class="line">        section 现有任务</span><br><span class="line">        已完成               :done,    des1, 2014-01-06,2014-01-08</span><br><span class="line">        进行中               :active,  des2, 2014-01-09, 3d</span><br><span class="line">        计划一               :         des3, after des2, 5d</span><br><span class="line">        计划二               :         des4, after des3, 5d</span><br></pre></td></tr></table></figure></div>
<ul>
<li>关于 <strong>甘特图</strong> 语法，参考 <a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">这儿</a>,</li>
</ul>
<h2 id="UML-图表"><a href="#UML-图表" class="headerlink" title="UML 图表"></a>UML 图表</h2><p>可以使用UML图表进行渲染。 <a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">Mermaid</a>. 例如下面产生的一个序列图：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">张三 -&gt;&gt; 李四: 你好！李四, 最近怎么样?</span><br><span class="line">李四--&gt;&gt;王五: 你最近怎么样，王五？</span><br><span class="line">李四--x 张三: 我很好，谢谢!</span><br><span class="line">李四-x 王五: 我很好，谢谢!</span><br><span class="line">Note right of 王五: 李四想了很长时间, 文字太长了&lt;br&#x2F;&gt;不适合放在一行.</span><br><span class="line"></span><br><span class="line">李四--&gt;&gt;张三: 打量着王五...</span><br><span class="line">张三-&gt;&gt;王五: 很好... 王五, 你怎么样?</span><br></pre></td></tr></table></figure></div>

<p>这将产生一个流程图。:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[长方形] -- 链接 --&gt; B((圆))</span><br><span class="line">A --&gt; C(圆角长方形)</span><br><span class="line">B --&gt; D&#123;菱形&#125;</span><br><span class="line">C --&gt; D</span><br></pre></td></tr></table></figure></div>

<ul>
<li>关于 <strong>Mermaid</strong> 语法，参考 <a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">这儿</a>,</li>
</ul>
<h2 id="FLowchart流程图"><a href="#FLowchart流程图" class="headerlink" title="FLowchart流程图"></a>FLowchart流程图</h2><p>我们依旧会支持flowchart的流程图：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">flowchat</span><br><span class="line">st&#x3D;&gt;start: 开始</span><br><span class="line">e&#x3D;&gt;end: 结束</span><br><span class="line">op&#x3D;&gt;operation: 我的操作</span><br><span class="line">cond&#x3D;&gt;condition: 确认？</span><br><span class="line"></span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;e</span><br><span class="line">cond(no)-&gt;op</span><br></pre></td></tr></table></figure></div>

<ul>
<li>关于 <strong>Flowchart流程图</strong> 语法，参考 <a href="http://adrai.github.io/flowchart.js/" target="_blank" rel="noopener">这儿</a>.</li>
</ul>
<h2 id="导出与导入"><a href="#导出与导入" class="headerlink" title="导出与导入"></a>导出与导入</h2><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><p>如果你想尝试使用此编辑器, 你可以在此篇文章任意编辑。当你完成了一篇文章的写作, 在上方工具栏找到 <strong>文章导出</strong> ，生成一个.md文件或者.html文件进行本地保存。</p>
<h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><p>如果你想加载一篇你写过的.md文件，在上方工具栏可以选择导入功能进行对应扩展名的文件导入，<br>继续你的创作。</p>
]]></content>
      <categories>
        <category>MarkDown</category>
      </categories>
      <tags>
        <tag>MarkDown</tag>
      </tags>
  </entry>
  <entry>
    <title>国际化语言操作</title>
    <url>/Vue/Vue_id_12.html</url>
    <content><![CDATA[<p>　　　　这是一篇教你如何设置国内源来快速安装Vue脚手架的教程</p>
<a id="more"></a>

<h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><p>　　首先设置国内源，这样你的下载速度会非常快：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">npm set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>　　查看源：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line">npm<span class="built_in"> config </span>list</span><br></pre></td></tr></table></figure></div>

<h2 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h2><p>　　首先要卸载原有的vue版本：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">npm uninstall vue-cli -g</span><br></pre></td></tr></table></figure></div>

<h2 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h2><p>　　安装vue：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">npm install @vue/cli -g</span><br></pre></td></tr></table></figure></div>

<h2 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h2><p>　　创建项目前要先执行命令：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CMD"><figure class="iseeu highlight /cmd"><table><tr><td class="code"><pre><span class="line">npm install -g @vue/cli-init</span><br></pre></td></tr></table></figure></div>

<p>　　执行完后再执行命令：(文件名自己取)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CMD"><figure class="iseeu highlight /cmd"><table><tr><td class="code"><pre><span class="line">vue init webpack 文件名</span><br></pre></td></tr></table></figure></div>


<p>　　安装过程中一次提示如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">project name（项目名称）	  <span class="comment"># 按回车</span></span><br><span class="line">project description（项目描述）	 <span class="comment"># 按回车</span></span><br><span class="line">author（作者）	 <span class="comment"># 按回车</span></span><br><span class="line">vue build（解释器）	 <span class="comment"># 按回车</span></span><br><span class="line">Install vue-router(路由) 		<span class="comment"># 按y按回车</span></span><br><span class="line">use aslantto lint your code(代码检查) 	<span class="comment"># 按n按回车</span></span><br><span class="line"><span class="built_in">set</span> up unit tests(测试模块) 	<span class="comment"># 按n按回车</span></span><br><span class="line">setup e2e tests with night watch(是否安装e2e) 	<span class="comment"># 按n按回车</span></span><br><span class="line">should we run ’npm install’(是否选择npm方式)	<span class="comment"># 选第一个，按回车</span></span><br></pre></td></tr></table></figure></div>

<h2 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a>第五步</h2><p>　　运行完之后：<br>    　　cd 到项目中，可以安装一些常用的包</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">npm install axios --save</span><br><span class="line">npm install style-loader —-save</span><br><span class="line">npm install heyui --save</span><br><span class="line">npm install js-md5 --save</span><br></pre></td></tr></table></figure></div>

<p>　　安装完之后可以直接启动：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CMD"><figure class="iseeu highlight /cmd"><table><tr><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure></div>

<p>　　退出服务：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="LLVM"><figure class="iseeu highlight /llvm"><table><tr><td class="code"><pre><span class="line">ctrl + <span class="keyword">c</span></span><br></pre></td></tr></table></figure></div>

<h2 id="第六步"><a href="#第六步" class="headerlink" title="第六步"></a>第六步</h2><p>　　　　如果出现任何关于node依赖的问题导致服务无法启动，执行npm install无法解决的，则安装rimraf,然后进入项目目录下，<br>　　执行rimraf node_modules 删除后，重新执行 npm install 安装依赖<br>　　安装rimraf：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CMAKE"><figure class="iseeu highlight /cmake"><table><tr><td class="code"><pre><span class="line">npm <span class="keyword">install</span> rimraf -g</span><br></pre></td></tr></table></figure></div>

<p>　　删除node_modules：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="EBNF"><figure class="iseeu highlight /ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rimraf node_modules</span></span><br></pre></td></tr></table></figure></div>

<p>　　重新安装node_modules：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CMAKE"><figure class="iseeu highlight /cmake"><table><tr><td class="code"><pre><span class="line">npm <span class="keyword">install</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>文明上网实现正常访问google网站</title>
    <url>/Google/Google_id_01.html</url>
    <content><![CDATA[<p>　　国内文明上网，实现正常访问Google网站</p>
<a id="more"></a>
<p>　　你们知道在国内为什么无法访问Google网站么？有兴趣的小伙伴可以百度搜索一下，我这里就不多说了<br>我们都知道，Google是搜索引擎界的大哥大，而我们在国内却无法使用，是不是感觉非常遗憾？在这里，我来告诉大家，<br>在国内，同样可以正常访问Google旗下的所有网站的方法：</p>
<h2 id="安装Chrome浏览器以及下载插件"><a href="#安装Chrome浏览器以及下载插件" class="headerlink" title="安装Chrome浏览器以及下载插件"></a>安装Chrome浏览器以及下载插件</h2><p>　　1、Chrome浏览器自行安装，这里不多说<br>　　2、其次，访问网站：<a href="https://chrome.zzzmh.cn/index" target="_blank" rel="noopener">https://chrome.zzzmh.cn/index</a><br>　　　　2.1、在网站首页右侧，点击：谷歌上网助手<span style="color:red">(图一)</span><br>　　　　2.2、点击后进入页面，在右侧有小贴士提示：<br>　　　　　　　请注意：本页面的版本原作者已停止更新，请点击跳转新版本 谷歌上网助手 Ghelper Beta<span style="color:red">(图二)</span><br>　　　　2.3、点击进入最新版本下载页面进行下载<span style="color:red">(图三)</span></p>
<h2 id="如图："><a href="#如图：" class="headerlink" title="如图："></a>如图：</h2><img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Google1.png" style="zoom:43%">

<p align="center" style="color:blue">图一</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Google2.png" style="zoom:50%">

<p align="center" style="color:blue">图二</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Google3.png" style="zoom:50%">

<p align="center" style="color:blue">图三</p>

<h2 id="解压插件并进行安装使用"><a href="#解压插件并进行安装使用" class="headerlink" title="解压插件并进行安装使用"></a>解压插件并进行安装使用</h2><p>　　1、将下载好的插件进行解压<span style="color:red">(图四)</span>，目标文件：<span style="color:red">Ghelper Beta_2.1.2_chrome.zzzmh.cn.crx</span><br>　　2、将目标文件拖到Chrome浏览器的插件管理中，进行安装<span style="color:red">(图五)</span>;注意：需打开Chrome浏览器右上角的开发者模式<span style="color:red">(图六)</span><br>　　3、当插件拖进去安装时，会出现提示框<span style="color:red">(图七)</span>，然后这里选择点击添加扩展程序，到这里，该插件基本上已经OK了<br>　　4、安装好之后，点击浏览器网址输入框右侧新安装的插件图标<span style="color:red">(图八)</span>，这里需要注册登录，不需要购买VIP哦<br>　　5、到这里就结束了，你现在就可以正常的访问Google旗下的网址了，而且你会发现，Chrome浏览器访问网页的速度变快了很多</p>
<h2 id="如图"><a href="#如图" class="headerlink" title="如图:"></a>如图:</h2><img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Google4.png" style="zoom:70%">

<p align="center" style="color:blue">图四</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Google5.png" style="zoom:50%">

<p align="center" style="color:blue">图五</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Google6.png" style="zoom:64%">

<p align="center" style="color:blue">图六</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Google7.png" style="zoom:109%">

<p align="center" style="color:blue">图七</p>
<img src="https://gitee.com/tian_yu_ting/blog_img/raw/master/Google8.png" style="zoom:102%">

<p align="center" style="color:blue">图八</p>
## 总结

<p>　　Chrome是一款非常好用的浏览器，它可以安装多种插件，已满足用户的各种需求，更多功能需要自行慢慢研究探索哦</p>
]]></content>
      <categories>
        <category>Chrome</category>
      </categories>
      <tags>
        <tag>Google</tag>
      </tags>
  </entry>
  <entry>
    <title>自定义购物车系统</title>
    <url>/Vue/Vue_id_13.html</url>
    <content><![CDATA[<h2 id="七牛云文件上传"><a href="#七牛云文件上传" class="headerlink" title="七牛云文件上传"></a>七牛云文件上传</h2><a id="more"></a>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将商品添加到购物车</span></span><br><span class="line">add_cart()&#123;</span><br><span class="line">    <span class="keyword">let</span> find = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 遍历购物车</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>,l=<span class="keyword">this</span>.cartlist.length;i++)&#123;</span><br><span class="line">        <span class="comment">// 如果找到了</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.id == <span class="keyword">this</span>.cartlist[i][<span class="string">'id'</span>])&#123;</span><br><span class="line">            <span class="comment">// 将该商品的数量+1</span></span><br><span class="line">            <span class="keyword">this</span>.cartlist[i][<span class="string">'num'</span>]++;</span><br><span class="line">            find = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果没找到</span></span><br><span class="line">    <span class="keyword">if</span>(find == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">// 将该商品放入购物车列表</span></span><br><span class="line">        <span class="keyword">this</span>.cartlist.push(&#123;</span><br><span class="line">            name:<span class="keyword">this</span>.name,</span><br><span class="line">            id: <span class="keyword">this</span>.id,</span><br><span class="line">            price: <span class="keyword">this</span>.price,</span><br><span class="line">            num: <span class="number">1</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.cartlist)</span><br><span class="line">	<span class="comment">// 将购物车信息存储到LocalStorage</span></span><br><span class="line">	LocalStorage.setItem(<span class="string">'cart'</span>, <span class="built_in">JSON</span>.Stringify(<span class="keyword">this</span>.cartlist))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>


<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化购物车逻辑</span></span><br><span class="line"><span class="comment">// 此条需运行</span></span><br><span class="line">init_cart()&#123;</span><br><span class="line">    <span class="keyword">this</span>.cartlist = LocalStorage.getItem(<span class="string">'cart)</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 计算购物车总数</span></span><br><span class="line"></span><br><span class="line">totalcount()&#123;</span><br><span class="line">    <span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>,l = <span class="keyword">this</span>.cartlist.length;i &lt; l;i++)&#123;</span><br><span class="line">        total += <span class="keyword">this</span>.cartlist[i].num</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 计算商品价格</span></span><br><span class="line">totalprice()&#123;</span><br><span class="line">    <span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>,l=<span class="keyword">this</span>.cartlist.length;i &lt; l;i++)&#123;</span><br><span class="line">        total += (<span class="keyword">this</span>.cartlist[i].num + <span class="keyword">this</span>.cartlist[i].price)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>Cart</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo主题如何将文章置顶</title>
    <url>/Hexo/Hexo_id_02.html</url>
    <content><![CDATA[<p>　　想将写好的一些文章置顶，但是hexo好像默认不提供这个功能，希望以后的版本会有。</p>
<a id="more"></a>
<p>这里简单写一下实现hexo文章置顶功能</p>
<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><p>　　找到node_modules/hexo-generator-index/lib/generator.js这个文件。<br>　　在代码：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> posts = locals.posts.sort(config.index_generator.order_by);</span><br></pre></td></tr></table></figure></div>

<p>　　下面添加以下代码：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line">posts.data = posts.data.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(a.top &amp;&amp; b.top) &#123; <span class="comment">// 如果两篇文章top都有定义</span></span><br><span class="line">		<span class="keyword">if</span>(a.top == b.top) <span class="keyword">return</span> b.date - a.date; <span class="comment">// 如果top值一样则按照文章日期降序排</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> b.top - a.top; 		<span class="comment">// 否则按照top值降序排</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(a.top &amp;&amp; !b.top) &#123; 		<span class="comment">// 如果只有一篇文章top有定义，那么将有top的排在前面</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(!a.top &amp;&amp; b.top) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> b.date - a.date; <span class="comment">// 都没定义按照文章日期降序排</span></span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure></div>

<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pagination = <span class="built_in">require</span>(<span class="string">'hexo-pagination'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">locals</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> config = <span class="keyword">this</span>.config;</span><br><span class="line">            <span class="keyword">const</span> posts = locals.posts.sort(config.index_generator.order_by);</span><br><span class="line"></span><br><span class="line">            posts.data = posts.data.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(a.top &amp;&amp; b.top) &#123; <span class="comment">// 两篇文章top都有定义</span></span><br><span class="line">                                <span class="keyword">if</span>(a.top == b.top) <span class="keyword">return</span> b.date - a.date; <span class="comment">// 若top值一样则按照文章日期降序排</span></span><br><span class="line">                                <span class="keyword">else</span> <span class="keyword">return</span> b.top - a.top; <span class="comment">// 否则按照top值降序排</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(a.top &amp;&amp; !b.top) &#123; <span class="comment">// 以下是只有一篇文章top有定义，那么将有top的排在前面（这里用异或操作居然不行233）</span></span><br><span class="line">                                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(!a.top &amp;&amp; b.top) &#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">return</span> b.date - a.date; <span class="comment">// 都没定义按照文章日期降序排</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">const</span> paginationDir = config.pagination_dir || <span class="string">'page'</span>;</span><br><span class="line">            <span class="keyword">const</span> path = config.index_generator.path || <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> pagination(path, posts, &#123;</span><br><span class="line">                perPage: config.index_generator.per_page,</span><br><span class="line">                layout: [<span class="string">'index'</span>, <span class="string">'archive'</span>],</span><br><span class="line">                format: paginationDir + <span class="string">'/%d/'</span>,</span><br><span class="line">                data: &#123;</span><br><span class="line">                    __index: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章名</span><br><span class="line">date: 文章发布时间</span><br><span class="line">tags: 文章标签</span><br><span class="line">top: 100(文章置顶)</span><br><span class="line">---</span><br></pre></td></tr></table></figure></div>

<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>　　迁移时，切莫忘记备份node_modules/hexo-generator-index/lib/generator.js这个文件</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitee取消输入用户名及密码</title>
    <url>/Git/Git_id_01.html</url>
    <content><![CDATA[<p>　　每次提交项目时，都会被要求输入用户名及密码，那么，我们应该如何跳过这一步骤呢？</p>
<a id="more"></a>
<p>本篇文章为您揭晓…</p>
<h2 id="第一步、查看通信方式"><a href="#第一步、查看通信方式" class="headerlink" title="第一步、查看通信方式"></a>第一步、查看通信方式</h2><p>　　在你的本地仓库中,打开命令窗口,执行以下代码</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure></div>

<p>　　如果是：<br>　　　　origin  <a href="https://gitee.com/fortunamajor/um.git" target="_blank" rel="noopener">https://gitee.com/fortunamajor/um.git</a> (fetch)<br>　　　　origin  <a href="https://gitee.com/fortunamajor/um.git" target="_blank" rel="noopener">https://gitee.com/fortunamajor/um.git</a> (push)<br>　　则证明是https 通信，这样每次都会提示输入用户名和密码，然后我们将其修改为ssh绑定gitee仓库服务端</p>
<h2 id="第二步、通过以下命令删除原有origin的通信方式"><a href="#第二步、通过以下命令删除原有origin的通信方式" class="headerlink" title="第二步、通过以下命令删除原有origin的通信方式"></a>第二步、通过以下命令删除原有origin的通信方式</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">git remote rm origin</span><br></pre></td></tr></table></figure></div>

<h2 id="第三步、重新add-，通过ssh绑定gitee仓库服务端"><a href="#第三步、重新add-，通过ssh绑定gitee仓库服务端" class="headerlink" title="第三步、重新add ，通过ssh绑定gitee仓库服务端"></a>第三步、重新add ，通过ssh绑定gitee仓库服务端</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">git remote add origin git@gitee.com:USERNAME/UM.git</span><br></pre></td></tr></table></figure></div>

<p>　　username填写gitee户名，um.git 填写仓库名.git<br>　　若怕输错，也可以去仓库里【克隆/下载】的地方，直接复制SSH路由</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo常用命令</title>
    <url>/Hexo/Hexo_id_01.html</url>
    <content><![CDATA[<p>　　Hexo是一款非常流行且好用的个人博客模板，下面我们一起来看一下Hexo的常用命令是什么吧……</p>
<a id="more"></a>

<h2 id="常见命令："><a href="#常见命令：" class="headerlink" title="常见命令："></a>常见命令：</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">hexo new <span class="string">"postName"</span> 			<span class="comment">#新建文章</span></span><br><span class="line">hexo new page <span class="string">"pageName"</span> 		<span class="comment">#新建页面</span></span><br><span class="line">hexo generate 				<span class="comment">#生成静态页面至public目录</span></span><br><span class="line">hexo server 					<span class="comment">#开启预览访问端口（默认端口4000，'ctrl + c'关闭server）</span></span><br><span class="line">hexo deploy 					<span class="comment">#部署到GitHub</span></span><br><span class="line">hexo <span class="built_in">help</span>  					<span class="comment"># 查看帮助</span></span><br><span class="line">hexo version  					<span class="comment">#查看Hexo的版本</span></span><br></pre></td></tr></table></figure></div>

<h2 id="缩写："><a href="#缩写：" class="headerlink" title="缩写："></a>缩写：</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">hexo n == hexo new</span><br><span class="line">hexo g == hexo generate</span><br><span class="line">hexo s == hexo server</span><br><span class="line">hexo d == hexo deploy</span><br></pre></td></tr></table></figure></div>

<h2 id="组合命令："><a href="#组合命令：" class="headerlink" title="组合命令："></a>组合命令：</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">hexo s -g <span class="comment">#生成并本地预览</span></span><br><span class="line">hexo d -g <span class="comment">#生成并上传</span></span><br></pre></td></tr></table></figure></div>

<h2 id="写博客："><a href="#写博客：" class="headerlink" title="写博客："></a>写博客：</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">定位到我们的hexo根目录，执行命令：</span><br><span class="line">	hexo new <span class="string">'my-first-blog'</span></span><br><span class="line">hexo会帮我们在`_posts`下生成相关md文件：</span><br><span class="line"><span class="comment"># 命令窗口中：</span></span><br><span class="line">F:\blog\hexo&gt;hexo new <span class="string">"my-first-blog"</span></span><br><span class="line">INFO  Created: F:\blog\hexo\<span class="built_in">source</span>\_posts\hexo常用命令-1.md</span><br></pre></td></tr></table></figure></div>

<p>　　我们只需要打开这个文件就可以开始写博客了</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 默认生成如下内容：</span></span><br><span class="line">---</span><br><span class="line">title: my-first-blog</span><br><span class="line">date: 2013-12-02 15:30:16 </span><br><span class="line">tags:</span><br><span class="line">---</span><br></pre></td></tr></table></figure></div>

<p>　　当然你也可以直接自己新建md文件，用这个命令的好处是帮我们自动生成了时间。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 一般完整格式如下：</span></span><br><span class="line">---</span><br><span class="line">title: postName <span class="comment">#文章页面上的显示名称，一般是中文</span></span><br><span class="line">date: 2013-12-02 15:30:16 <span class="comment">#文章生成时间，一般不改，当然也可以任意修改</span></span><br><span class="line">categories: 默认分类 <span class="comment">#分类</span></span><br><span class="line">tags: [tag1,tag2,tag3] <span class="comment">#文章标签，可空，多标签请用格式，注意:后面有个空格</span></span><br><span class="line">description: 附加一段文章摘要，字数最好在140字以内，会出现在meta的description里面</span><br><span class="line">---</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>GitHub访问及clone缓慢的方法</title>
    <url>/Git/Git_id_02.html</url>
    <content><![CDATA[<p>　　你们在访问GitHub网站时有没有出现加载缓慢，甚至加载失败的情况呢？</p>
<a id="more"></a>
<p>那么，这种情况该如何杜绝呢？请继续往下阅读……</p>
<h2 id="第一步："><a href="#第一步：" class="headerlink" title="第一步："></a>第一步：</h2><p>　　点击访问网址：<a href="https://www.ipaddress.com/" target="_blank" rel="noopener">https://www.ipaddress.com/</a><br>　　在该网址中搜索：<br>　　　　github.global.ssl.fastly.net<br>　　　　github.com<br>　　得到相应的ip地址<span style="color:red">(如图一，图二)</span></p>
<h2 id="如图"><a href="#如图" class="headerlink" title="如图:"></a>如图:</h2><img src="http://q72tcv6j6.bkt.clouddn.com/GitHub%E8%AE%BF%E9%97%AE%E5%8F%8Aclone%E7%BC%93%E6%85%A2%E7%9A%84%E6%96%B9%E6%B3%951.png" style="zoom:67%;" />

<p style="color:blue;text-align:center">图一</p>
<img src="http://q72tcv6j6.bkt.clouddn.com/GitHub%E8%AE%BF%E9%97%AE%E5%8F%8Aclone%E7%BC%93%E6%85%A2%E7%9A%84%E6%96%B9%E6%B3%952.png" style="zoom:67%;" />

<p style="color:blue;text-align:center">图二</p>
第二步：
---

<p>　　找到个人电脑中的hosts文件，此文件在每个电脑上的路径基本上是一致的：C:\Windows\System32\drivers\etc<br>　　打开后将获取到的ip地址及网址添加到posts文件的最下面，保存后退出<br>　　例如：<br>　　　　151.101.185.194 github.global-ssl.fastly.net<br>　　　　192.30.253.112 github.com<br>　　注意：<br>　　　　因此文件在系统目录中，所以无法直接保存，可将posts文件复制到桌面进行修改<br>　　　　修改完成后粘贴到C:\Windows\System32\drivers\etc目录中进行取代之前的posts文件</p>
<h2 id="第三步："><a href="#第三步：" class="headerlink" title="第三步："></a>第三步：</h2><p>　　当第二步完成后，我们需要更新DNS<br>　　Winodws系统的做法：打开CMD，输入ipconfig /flushdns<br>　　Linux的做法：在终端输入sudo /etc/init.d/networking restart</p>
<h2 id="另："><a href="#另：" class="headerlink" title="另："></a>另：</h2><p>　　如果添加上面两条ip后无任何作用，可复制以下内容添加到posts文件中</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">151.101.44.249 github.global.ssl.fastly.net</span><br><span class="line">192.30.253.113 github.com</span><br><span class="line">103.245.222.133 assets-cdn.github.com</span><br><span class="line">23.235.47.133 assets-cdn.github.com</span><br><span class="line">203.208.39.104 assets-cdn.github.com</span><br><span class="line">204.232.175.78 documentcloud.github.com</span><br><span class="line">204.232.175.94 gist.github.com</span><br><span class="line">107.21.116.220 help.github.com</span><br><span class="line">207.97.227.252 nodeload.github.com</span><br><span class="line">199.27.76.130 raw.github.com</span><br><span class="line">107.22.3.110 status.github.com</span><br><span class="line">204.232.175.78 training.github.com</span><br><span class="line">207.97.227.243 www.github.com</span><br><span class="line">185.31.16.184 github.global.ssl.fastly.net</span><br><span class="line">185.31.18.133 avatars0.githubusercontent.com</span><br><span class="line">185.31.19.133 avatars1.githubusercontent.com</span><br></pre></td></tr></table></figure></div>

<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>　　只要脑子不滑坡，办法总比困难多，祝各位机友越学越年轻，都能有自己满意的成果<br>　　如果感觉麻烦，或者不想修改电脑C盘中的文件，则可以参考我的另一篇文章来实现快速访问<a href="https://www.onlyyu.cn/2020/04/02/07/" target="_blank" rel="noopener">点击这里阅读</a></p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>阿里云旗下ecs云服务器配置使用详情</title>
    <url>/CentOS/CentOS_id_08.html</url>
    <content><![CDATA[<h2 id="前段时间-与朋友在阿里云平台上一起购买了一台云服务器"><a href="#前段时间-与朋友在阿里云平台上一起购买了一台云服务器" class="headerlink" title="前段时间,与朋友在阿里云平台上一起购买了一台云服务器"></a>前段时间,与朋友在阿里云平台上一起购买了一台云服务器</h2><h2 id="原定计划是安装ubuntu系统来使用-方便配置-后面因为我们两个侧重点都在python上-于是选择了本身自带python环境的centos系统-在这个过程中-遇到了各种各样的问题"><a href="#原定计划是安装ubuntu系统来使用-方便配置-后面因为我们两个侧重点都在python上-于是选择了本身自带python环境的centos系统-在这个过程中-遇到了各种各样的问题" class="headerlink" title="原定计划是安装ubuntu系统来使用,方便配置,后面因为我们两个侧重点都在python上,于是选择了本身自带python环境的centos系统,在这个过程中,遇到了各种各样的问题"></a>原定计划是安装ubuntu系统来使用,方便配置,后面因为我们两个侧重点都在python上,于是选择了本身自带python环境的centos系统,在这个过程中,遇到了各种各样的问题</h2><a id="more"></a>

<h2 id="我本身是负责服务器搭建这一块儿的-服务器这边的各种问题基本都是我一个人在折腾-到今天-基本已经完成架构-前后端项目也已经在服务器上跑了起来-于是腾出手来-把之前遇到的一些问题进行一下汇总"><a href="#我本身是负责服务器搭建这一块儿的-服务器这边的各种问题基本都是我一个人在折腾-到今天-基本已经完成架构-前后端项目也已经在服务器上跑了起来-于是腾出手来-把之前遇到的一些问题进行一下汇总" class="headerlink" title="我本身是负责服务器搭建这一块儿的,服务器这边的各种问题基本都是我一个人在折腾,到今天,基本已经完成架构,前后端项目也已经在服务器上跑了起来,于是腾出手来,把之前遇到的一些问题进行一下汇总"></a>我本身是负责服务器搭建这一块儿的,服务器这边的各种问题基本都是我一个人在折腾,到今天,基本已经完成架构,前后端项目也已经在服务器上跑了起来,于是腾出手来,把之前遇到的一些问题进行一下汇总</h2><h2 id="看到这篇文章的朋友如果有什么疑问-可以给作者发私信"><a href="#看到这篇文章的朋友如果有什么疑问-可以给作者发私信" class="headerlink" title="看到这篇文章的朋友如果有什么疑问,可以给作者发私信"></a>看到这篇文章的朋友如果有什么疑问,可以给作者发私信</h2><ol>
<li><h3 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h3><p>下载redis安装包</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AWK"><figure class="iseeu highlight /awk"><table><tr><td class="code"><pre><span class="line">wget hhhttp:<span class="regexp">//</span>downloac.redis.io<span class="regexp">/releases/</span>redis-<span class="number">4.0</span>.<span class="number">6</span>.tar.gz</span><br></pre></td></tr></table></figure></div>

<p>解压压缩包</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CSS"><figure class="iseeu highlight /css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-zxvf</span> <span class="selector-tag">redis-4</span><span class="selector-class">.0</span><span class="selector-class">.6</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure></div>

<p>yum 安装gcc依赖</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CMAKE"><figure class="iseeu highlight /cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> gcc</span><br></pre></td></tr></table></figure></div>

<p>跳转到redis解压目录下</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">cd redis<span class="number">-4.0</span><span class="number">.6</span></span><br></pre></td></tr></table></figure></div>

<p>编译安装</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GAUSS"><figure class="iseeu highlight /gauss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">make</span> MAKKOC=libc</span><br><span class="line"><span class="meta"># 将/usr/local/redis-4.0.6/src目录下的文件添加到/usr/local/bin 目录</span></span><br><span class="line">cd src &amp;&amp; <span class="built_in">make</span> install</span><br></pre></td></tr></table></figure></div>

<p>修改配置文件</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line"># 将原本绑定的ip127<span class="number">.0</span><span class="number">.0</span><span class="number">.1</span>修改为<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">bind <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"># 关闭保护模式</span><br><span class="line"><span class="keyword">protected</span>-mode yes 修改为no</span><br></pre></td></tr></table></figure></div>

<p>在服务器安全策略中开放6379端口</p>
</li>
<li><h1 id="阿里云服务器的图形界面"><a href="#阿里云服务器的图形界面" class="headerlink" title="阿里云服务器的图形界面"></a>阿里云服务器的图形界面</h1><p>​    阿里云的centos服务器,在安装图形界面之后,其实依然是无法访问的,我之前纠结于这个问题,直    到最后发现了这个问题.</p>
<p>​    在阿里云的远程连接,其实还有这个另外一个vnc选项,通过这个选项进行连接的话,将会自动帮你配置好图形化界面,而相反的是,如果你在默认的远程连接窗口进行图形化界面的配置的话,将会百分百的失败,失去响应</p>
<p>​    切记,在第一次进行vnc连接的时候,将会有一个远程连接密码生成</p>
<p>​    这个密码将会是固定的,一定要把他记下来,否则的话你将无法连接这个图形界面</p>
<h4 id="切记"><a href="#切记" class="headerlink" title="切记!!!"></a>切记!!!</h4></li>
<li><h1 id="Centos7本身的python环境问题"><a href="#Centos7本身的python环境问题" class="headerlink" title="Centos7本身的python环境问题"></a>Centos7本身的python环境问题</h1><p>centos7本身内置了一个2.7的python环境,在当前的版本下,很多功能都无法使用,所以推荐重新安装一个新版的python环境,否则你将会在使用过程中遇到诸如: python版本过低,无法安装包/pip版本过低,无法安装包/包已废弃…..等等情况,所以新人的话推荐还是稳妥一点,换一个自己顺手的版本</p>
</li>
<li><h1 id="部署Vue"><a href="#部署Vue" class="headerlink" title="部署Vue"></a>部署Vue</h1><p>Vue的部署比较简单,只需要将config/index.js中的关于ip和端口的配置修改即可,host修改为0.0.0.0,</p>
<p>端口的话可以随意设定,当然,设定完记得在服务器安全策略中开放对应的端口,以免出现端口无法访问的情况</p>
</li>
<li><h1 id="部署Django"><a href="#部署Django" class="headerlink" title="部署Django"></a>部署Django</h1><p>Django的部署,需要在settings设置中添加</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="INI"><figure class="iseeu highlight /ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">ALLOWED_HOSTS</span> = [<span class="string">'*'</span>]</span><br></pre></td></tr></table></figure></div>

<p>即允许任何ip访问,部署时使用 python manage.py runserver 0.0.0.0:8000 的形式进行启动</p>
</li>
</ol>
<p>​    </p>
]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(三十六)</title>
    <url>/Python/Python_id_54.html</url>
    <content><![CDATA[<h2 id="pymssql模块"><a href="#pymssql模块" class="headerlink" title="pymssql模块"></a>pymssql模块</h2><p>连接<code>mysql</code>需要用到<code>pymysql</code>模块<br>而连接<code>Microsoft SQL server</code> 需要用到<code>pymssql</code>模块</p>
<a id="more"></a>

<p>前面章节介绍了基本的sql语句和<code>sqlite3</code>模块的用法。<br><code>pymssql</code>模块与<code>sqlite3</code>模块方法基本一致</p>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>直接<code>pip install pymssql</code>安装。<br>可能会报错：<br>可以到<a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/上寻找对应版本下载`.whl`文件" target="_blank" rel="noopener">https://www.lfd.uci.edu/~gohlke/pythonlibs/上寻找对应版本下载`.whl`文件</a><br>然后使用如<code>pip install pymssql-2.1.4-cp38-cp38-win_amd64</code>来安装</p>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><h4 id="指定用户名密码连接"><a href="#指定用户名密码连接" class="headerlink" title="指定用户名密码连接"></a>指定用户名密码连接</h4><p>注意：host:计算机名\实例名，在python代码斜线需要转义，数据库的连接工具里不要转义。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymssql</span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">"host"</span>: <span class="string">'192.168.10.1\\nnr'</span>,</span><br><span class="line">    <span class="string">"user"</span>: <span class="string">"sa"</span>,</span><br><span class="line">    <span class="string">"database"</span>: <span class="string">"demo_project"</span>,</span><br><span class="line">    <span class="string">"password"</span>: <span class="string">"114514"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">conn = pymssql.connect(**DATABASES)</span><br><span class="line">cur = conn.cursor()</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> cur:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">"数据库连接失败"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"数据库连接成功"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询并打印结果</span></span><br><span class="line">cur.execute(<span class="string">'select * from sys.tables'</span>)</span><br><span class="line">query_set = cur.fetchall()</span><br><span class="line">print(query_set, width=<span class="number">60</span>, compact=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#记得关闭以释放资源</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure></div>

<h4 id="Windows账户连接"><a href="#Windows账户连接" class="headerlink" title="Windows账户连接"></a>Windows账户连接</h4><p>登录自己电脑上的数据库时，可以使用Windows身份认证的方式登陆是个很好用的方法。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">"host"</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">    <span class="string">"database"</span>: <span class="string">"demo_project"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>只要不填账号密码，就会自动用Windows身份认证的方式来登录了。</p>
<h4 id="connect的其他常用参数"><a href="#connect的其他常用参数" class="headerlink" title="connect的其他常用参数"></a>connect的其他常用参数</h4><ul>
<li><code>as_dict</code>(bool) ：如果设置为True，则后面的查询结果返回的是字典，关键字为查询结果的列名；否则(默认)返回的为list。</li>
<li><code>autocommit</code>(bool)：默认为False，这样如果对数据表进行更改，则需要手动调用commit来提交操作。</li>
<li><code>port</code>(str)：指定服务器的TCP端口，如果你没有改过的话使用默认的就好。</li>
</ul>
<h3 id="执行SQL语句"><a href="#执行SQL语句" class="headerlink" title="执行SQL语句"></a>执行SQL语句</h3><h4 id="execute"><a href="#execute" class="headerlink" title="execute"></a>execute</h4><p>它类似于一个生成器函数，使用之后游标对象cursor会变成一个结果集迭代器</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">'select top 5 * from t1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取所有查询结果返回列表,见下</span></span><br><span class="line">querylist = list(cur)</span><br><span class="line"></span><br><span class="line"><span class="comment">#标准库中的pprint模块，更美观的打印数据</span></span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line">pprint(querylist, width=<span class="number">60</span>, compact=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#fetchall()返回出列表嵌套元组的结构，每个数据行是一个元组。</span></span><br><span class="line"></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure></div>

<p>第二个参数可以用对SQL语句格式化</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">curs.execute(<span class="string">'SELECT * FROM t1 WHERE username=%s'</span>, <span class="string">'John Doe'</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="executemany"><a href="#executemany" class="headerlink" title="executemany"></a>executemany</h4><p>可以执行多条语句</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 插入三条测试数据</span></span><br><span class="line">cursor.executemany(</span><br><span class="line">    <span class="string">"INSERT INTO t1 VALUES (%d, %s, %s)"</span>,</span><br><span class="line">    [(<span class="number">1</span>, <span class="string">'John Smith'</span>, <span class="string">'John Doe'</span>),</span><br><span class="line">     (<span class="number">2</span>, <span class="string">'Jane Doe'</span>, <span class="string">'Joe Dog'</span>),</span><br><span class="line">     (<span class="number">3</span>, <span class="string">'Mike T.'</span>, <span class="string">'Sarah H.'</span>)])</span><br><span class="line"><span class="comment"># 提交修改，见下</span></span><br><span class="line">conn.commit()</span><br></pre></td></tr></table></figure></div>

<h4 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h4><p>如果对数据进行了修改，且在连接时没有设置<code>autocommit</code>为True，则需要手动调用commit进行提交修改:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">conn.commit() <span class="comment">#修改数据后提交事务</span></span><br></pre></td></tr></table></figure></div>

<h3 id="查询结果获取"><a href="#查询结果获取" class="headerlink" title="查询结果获取"></a>查询结果获取</h3><h4 id="直接遍历Cursor对象"><a href="#直接遍历Cursor对象" class="headerlink" title="直接遍历Cursor对象"></a>直接遍历Cursor对象</h4><p>游标对象cursor在execute之后返回结果集，类似于一个迭代器</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">'select top 5 * from t1'</span>)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur:</span><br><span class="line">    print(<span class="string">'row = %r'</span> % (row,))</span><br></pre></td></tr></table></figure></div>

<p>如果连接时指定了<code>as_dict</code>为True，则返回结果变为字典类型，就能列名来访问</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">'select top 5 * from t1'</span>)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur:</span><br><span class="line">    print(<span class="string">"ID=%d, Name=%s"</span> % (row[<span class="string">'id'</span>], row[<span class="string">'username'</span>]))</span><br></pre></td></tr></table></figure></div>

<h4 id="fetch系列方法"><a href="#fetch系列方法" class="headerlink" title="fetch系列方法"></a>fetch系列方法</h4><p>fetch系列方法，类似<code>cur.next()</code></p>
<p><code>fetchone()</code>会<strong>弹出</strong>第一条（下一条）数据。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">'select top 5 * from nnr_t1'</span>)</span><br><span class="line">row = cur.fetchone()</span><br><span class="line"><span class="keyword">while</span> row:</span><br><span class="line">    print(<span class="string">"ID=%d, Name=%s"</span> % (row[<span class="number">0</span>], row[<span class="number">1</span>]))</span><br><span class="line">    row = cur.fetchone()</span><br></pre></td></tr></table></figure></div>

<p>另外，还可以使用<code>fetchmany</code>和<code>fetchall</code>来一次性获取指定数量或者所有（剩下的）的结果。</p>
<p>关于游标对象Cursor</p>
<p>与pymysql一样，任何时候只会有一个Cursor对象处于查询状态，即使实例化多个Cursor对象。<br>建议将前一个查询<code>fetchall()</code>之后,再来进行另外一个查询,否则永远是最后一个查询的结果。</p>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p>如果要调用存储过程，则使用Cursor对象的<code>callproc</code>方法</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建一个存储过程</span></span><br><span class="line">cur.execute(<span class="string">"""</span></span><br><span class="line"><span class="string">CREATE PROCEDURE FindPerson</span></span><br><span class="line"><span class="string">     @username VARCHAR(100)</span></span><br><span class="line"><span class="string"> AS BEGIN</span></span><br><span class="line"><span class="string">     SELECT * FROM nnr_t1 WHERE username = @username</span></span><br><span class="line"><span class="string">END</span></span><br><span class="line"><span class="string">"""</span>)</span><br><span class="line"><span class="comment"># 调用上面的存储过程</span></span><br><span class="line">cur.callproc(<span class="string">'FindPerson'</span>, (<span class="string">'Jane Doe'</span>,))</span><br></pre></td></tr></table></figure></div>

<p>执行存储过程也可以直接用语句</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"exec SP_NAME 参数1, 参数2"</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="关闭链接"><a href="#关闭链接" class="headerlink" title="关闭链接"></a>关闭链接</h3><p>操作完成后应该调用close方法来关闭链接并释放资源：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">conn.close()</span><br></pre></td></tr></table></figure></div>

<h4 id="上下文管理"><a href="#上下文管理" class="headerlink" title="上下文管理"></a>上下文管理</h4><p>可以使用with语句来处理Connection和cursor对象，这样就不需要手动关闭他们了：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> pymssql.connect(**DATABASES) <span class="keyword">as</span> conn:</span><br><span class="line">    <span class="keyword">with</span> conn.cursor() <span class="keyword">as</span> cur:</span><br><span class="line">        cur.execute(<span class="string">'SELECT * FROM t1'</span>)</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> cur:</span><br><span class="line">            print(row)</span><br></pre></td></tr></table></figure></div>

<h3 id="例：将电子表格写入数据库"><a href="#例：将电子表格写入数据库" class="headerlink" title="例：将电子表格写入数据库"></a>例：将电子表格写入数据库</h3><p>这里使用<code>openpyxl</code>模块只读电子表格（.xlsx）</p>
<h4 id="读取电子表格"><a href="#读取电子表格" class="headerlink" title="读取电子表格"></a>读取电子表格</h4><p>读取电子表格的时候可以通过各种方法处理使其和数据库查询结果的格式一致。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> load_workbook</span><br><span class="line">wb = load_workbook(<span class="string">'./xls.xlsx'</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">table = wb[wb.sheetnames[<span class="number">0</span>]]</span><br><span class="line"><span class="comment">#最大行</span></span><br><span class="line">rows = table.max_row</span><br><span class="line"><span class="comment">#最大列</span></span><br><span class="line">cols = table.max_column </span><br><span class="line"><span class="comment">#单元格读取</span></span><br><span class="line"><span class="comment">#print(table.cell(row = 1, column = 1).value)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#逐行读取，参数min_row开始 min_row=2可以直接跳过表头 max_col和max_row限制最大的行列数</span></span><br><span class="line">data_list = map(<span class="keyword">lambda</span> row: tuple(map(<span class="keyword">lambda</span> col: str(col.value).strip(), row)),table.iter_rows(min_row=<span class="number">1</span>, max_col=cols, max_row=rows))</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果要得到表头（去除表头）</span></span><br><span class="line">header = next(data_list)</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里的data_list也是列表嵌套元组的结构，每一行是一个元组。</span></span><br><span class="line">pprint(list(data_list), width=<span class="number">60</span>, compact=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="写入数据库"><a href="#写入数据库" class="headerlink" title="写入数据库"></a>写入数据库</h4><p>创建表的过程省略，表名t2</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data_list:</span><br><span class="line">    cur.execute(<span class="string">'INSERT INTO t2 VALUES '</span>+ i.__repr__())</span><br><span class="line">conn.commit() <span class="comment">#也可使用executemany</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(三十五)</title>
    <url>/Python/Python_id_53.html</url>
    <content><![CDATA[<h2 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h2><p>这里以mysql数据库为例</p>
<p>MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，目前属于 Oracle 旗下公司。MySQL 最流行的关系型数据库管理系统，在 WEB 应用方面MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件之一。</p>
<p>关于数据库</p>
<a id="more"></a>

<p>本笔记只记录基础命令，详细的数据库用法请左转其官方文档。</p>
<h3 id="安装启动和终端链接"><a href="#安装启动和终端链接" class="headerlink" title="安装启动和终端链接"></a>安装启动和终端链接</h3><h4 id="Linux版本"><a href="#Linux版本" class="headerlink" title="Linux版本"></a>Linux版本</h4><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">yum install mysql-server</span><br></pre></td></tr></table></figure></div>

<p>个人推荐使用 宝塔Linux面板 一键安装 然后重置密码</p>
<h5 id="服务端启动"><a href="#服务端启动" class="headerlink" title="服务端启动"></a>服务端启动</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">[root@akokono.com ~]<span class="comment"># service mysqld start</span></span><br><span class="line">Starting mysqld:                                           [  OK  ]</span><br></pre></td></tr></table></figure></div>

<h5 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">连接：</span><br><span class="line">	<span class="comment">#和win一样</span></span><br><span class="line">    mysql -h host -u user -p</span><br><span class="line"> </span><br><span class="line">常见错误：</span><br><span class="line">    ERROR 2002 (HY000):</span><br><span class="line">    	Can<span class="string">'t connect to local MySQL server through socket '</span>/tmp/mysql.sock<span class="string">' (2), </span></span><br><span class="line"><span class="string">    	it means that the MySQL server daemon (Unix) or service (Windows) is not running.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">退出：</span></span><br><span class="line"><span class="string">    QUIT 或者 Control+D</span></span><br></pre></td></tr></table></figure></div>

<h4 id="Windows版本"><a href="#Windows版本" class="headerlink" title="Windows版本"></a>Windows版本</h4><p>MySQL解压后的 bin 目录下有一大堆的可执行文件，执行如下命令初始化数据：</p>
<p>其默认未给root账户设置密码</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> c:\mysql-5.7.16-winx64\bin</span><br><span class="line">mysqld --initialize-insecure</span><br></pre></td></tr></table></figure></div>

<p>进入可执行文件目录启动,或将MySQL可执行文件添加到环境变量中 :</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入可执行文件目录</span></span><br><span class="line"><span class="built_in">cd</span> c:\mysql-5.7.16-winx64\bin</span><br><span class="line"><span class="comment"># 启动MySQL服务</span></span><br><span class="line">mysqld</span><br></pre></td></tr></table></figure></div>

<p>启动MySQL客户端并连接MySQL服务</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入可执行文件目录</span></span><br><span class="line"><span class="built_in">cd</span> c:\mysql-5.7.16-winx64\bin</span><br><span class="line"><span class="comment"># 连接MySQL服务器</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># 提示请输入密码，直接回车</span></span><br></pre></td></tr></table></figure></div>

<p>如想日后操作简便，可以做如下操作：将MySQL服务制作成windows服务</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 制作MySQL的Windows服务，在终端执行此命令：</span></span><br><span class="line"><span class="string">"c:\mysql-5.7.16-winx64\bin\mysqld"</span> --install</span><br><span class="line"><span class="comment"># 移除MySQL的Windows服务，在终端执行此命令：</span></span><br><span class="line"><span class="string">"c:\mysql-5.7.16-winx64\bin\mysqld"</span> --remove</span><br></pre></td></tr></table></figure></div>

<p>注册成服务之后，以后再启动和关闭MySQL服务时，仅需执行如下命令：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动MySQL服务</span></span><br><span class="line">net start mysql</span><br><span class="line"><span class="comment"># 关闭MySQL服务</span></span><br><span class="line">net stop mysql</span><br></pre></td></tr></table></figure></div>

<h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><h5 id="显示数据库"><a href="#显示数据库" class="headerlink" title="显示数据库"></a>显示数据库</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure></div>

<p>默认已存在的数据库：</p>
<ul>
<li>mysql - 用户权限相关数据</li>
<li>test - 用于用户测试数据</li>
<li>information_schema - MySQL本身架构相关数据</li>
</ul>
<h5 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># utf-8</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> 数据库名称 <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="comment"># gbk</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> 数据库名称 <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> gbk <span class="keyword">COLLATE</span> gbk_chinese_ci;</span><br></pre></td></tr></table></figure></div>

<h5 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> 数据库名称;</span><br><span class="line"><span class="comment">#显示当前使用的数据库中所有表：</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure></div>

<h6 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h6><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建用户</span></span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'用户名'</span>@<span class="string">'IP地址'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'密码'</span>;</span><br><span class="line"><span class="comment">#删除用户</span></span><br><span class="line">    <span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">'用户名'</span>@<span class="string">'IP地址'</span>;</span><br><span class="line"><span class="comment">#修改用户</span></span><br><span class="line">    <span class="keyword">rename</span> <span class="keyword">user</span> <span class="string">'用户名'</span>@<span class="string">'IP地址'</span>; to '新用户名'@'IP地址';;</span><br><span class="line"><span class="comment">#修改密码</span></span><br><span class="line">    <span class="keyword">set</span> <span class="keyword">password</span> <span class="keyword">for</span> <span class="string">'用户名'</span>@<span class="string">'IP地址'</span> = <span class="keyword">Password</span>(<span class="string">'新密码'</span>)</span><br><span class="line"><span class="comment">#用户权限相关数据保存在mysql数据库的user表中，</span></span><br><span class="line"><span class="comment">#所以也可以直接对其进行操作（不建议）</span></span><br></pre></td></tr></table></figure></div>

<h6 id="授权管理"><a href="#授权管理" class="headerlink" title="授权管理"></a>授权管理</h6><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">grants</span> <span class="keyword">for</span> <span class="string">'用户'</span>@<span class="string">'IP地址'</span>               <span class="comment">-- 查看权限</span></span><br><span class="line"><span class="keyword">grant</span>  权限 <span class="keyword">on</span> 数据库.表 <span class="keyword">to</span>   <span class="string">'用户'</span>@<span class="string">'IP地址'</span>   <span class="comment">-- 授权</span></span><br><span class="line"><span class="keyword">revoke</span> 权限 <span class="keyword">on</span> 数据库.表 <span class="keyword">from</span> <span class="string">'用户'</span>@<span class="string">'IP地址'</span>   <span class="comment">-- 取消权限</span></span><br></pre></td></tr></table></figure></div>

<h5 id="数据库表的表示"><a href="#数据库表的表示" class="headerlink" title="数据库表的表示"></a>数据库表的表示</h5><p>内部</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">数据库名.*           -- 数据库中的所有</span><br><span class="line">数据库名.表          <span class="comment">-- 指定数据库中的某张表</span></span><br><span class="line">数据库名.存储过程     <span class="comment">-- 指定数据库中的存储过程</span></span><br><span class="line">*.*                -- 所有数据库</span><br></pre></td></tr></table></figure>

<p>外部</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line">用户名@IP地址         <span class="comment">-- 用户只能在改IP下才能访问</span></span><br><span class="line">用户名@192.168.1.%   <span class="comment">-- 用户只能在改IP段下才能访问(通配符%表示任意)</span></span><br><span class="line">用户名@%             <span class="comment">-- 用户可以再任意IP下访问(默认IP地址为%)</span></span><br></pre></td></tr></table></figure></div>

<p>示例</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> db1.tb1 <span class="keyword">TO</span> <span class="string">'用户名'</span>@<span class="string">'IP'</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">on</span> db1.* <span class="keyword">TO</span> <span class="string">'用户名'</span>@<span class="string">'IP'</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span> <span class="keyword">on</span> *.* <span class="keyword">TO</span> <span class="string">'用户名'</span>@<span class="string">'IP'</span></span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">select</span> <span class="keyword">on</span> db1.tb1 <span class="keyword">from</span> <span class="string">'用户名'</span>@<span class="string">'IP'</span></span><br></pre></td></tr></table></figure></div>

<p>特殊的：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>  <span class="comment">#将数据读取到内存中，从而立即生效。</span></span><br></pre></td></tr></table></figure></div>

<p>忘记密码:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动免授权服务端</span></span><br><span class="line">mysqld --skip-grant-tables</span><br><span class="line"><span class="comment"># 客户端</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># 修改用户名密码</span></span><br><span class="line">update mysql.user <span class="built_in">set</span> authentication_string=password(<span class="string">'666'</span>) <span class="built_in">where</span> user=<span class="string">'root'</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></div>

<h3 id="数据表基本操作"><a href="#数据表基本操作" class="headerlink" title="数据表基本操作"></a>数据表基本操作</h3><h5 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h5><p>not null 不可为空<br>defalut 默认值<br>null 可以为空</p>
<p><code>engine=innodb</code> mysql支持事务性操作 失败回滚 <code>engine=myisam</code> mysql支持全局索引 失败不回滚 默认</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb1(</span><br><span class="line">    nid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> defalut <span class="number">2</span>,</span><br><span class="line">    <span class="keyword">num</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">)<span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8</span><br></pre></td></tr></table></figure></div>

<p><code>auto_increment</code> 自增<br><code>primary key</code> 主键</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb1(</span><br><span class="line">    nid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">num</span> <span class="built_in">int</span> <span class="literal">null</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">--    或</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb1(</span><br><span class="line">    nid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">    <span class="keyword">num</span> <span class="built_in">int</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">index</span>(nid)</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 注意：</span></span><br><span class="line"><span class="comment">-- 对于自增列，必须是索引（含主键）。</span></span><br><span class="line"><span class="comment">-- 对于自增可以设置步长和起始值</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">session</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'auto_inc%'</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> auto_increment_increment=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> auto_increment_offset=<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">shwo global  variables like 'auto_inc%';</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> auto_increment_increment=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> auto_increment_offset=<span class="number">10</span>;</span><br><span class="line"><span class="comment">#主键，</span></span><br><span class="line"><span class="comment">-- 一种特殊的唯一索引，不允许有空值，</span></span><br><span class="line"><span class="comment">-- 如果主键使用单个列，则它的值必须唯一，</span></span><br><span class="line"><span class="comment">-- 如果是多列，则其组合必须唯一。</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb1(</span><br><span class="line">    nid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">num</span> <span class="built_in">int</span> <span class="literal">null</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb1(</span><br><span class="line">    nid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">num</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    primary <span class="keyword">key</span>(nid,<span class="keyword">num</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p><code>foreign key</code> 外键</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line">creat table color(</span><br><span class="line">	nid int not null primary key,</span><br><span class="line">	name char(16) not null</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> fruit(</span><br><span class="line">	nid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span>,</span><br><span class="line">	smt <span class="built_in">char</span>(<span class="number">32</span>) <span class="literal">null</span> ,</span><br><span class="line">	color_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">	<span class="keyword">constraint</span> fk_cc <span class="keyword">foreign</span> <span class="keyword">key</span> (color_id) <span class="keyword">references</span> color(nid)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<h5 id="静态表型数据"><a href="#静态表型数据" class="headerlink" title="静态表型数据"></a>静态表型数据</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">values</span>(<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">4</span>)) <span class="keyword">as</span> 表名(第一行,第二行)</span><br></pre></td></tr></table></figure></div>

<h5 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> 表名</span><br></pre></td></tr></table></figure></div>

<h5 id="清空表"><a href="#清空表" class="headerlink" title="清空表"></a>清空表</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名</span><br></pre></td></tr></table></figure></div>

<h5 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">#添加列：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> 列名 类型</span><br><span class="line"><span class="comment">#删除列：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">column</span> 列名</span><br><span class="line"><span class="comment">#修改列：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">modify</span> <span class="keyword">column</span> 列名 类型;  <span class="comment">-- 类型</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">change</span> 原列名 新列名 类型; <span class="comment">-- 列名，类型</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#添加主键：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> primary <span class="keyword">key</span>(列名);</span><br><span class="line"><span class="comment">#删除主键：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> primary <span class="keyword">key</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名  <span class="keyword">modify</span>  列名 <span class="built_in">int</span>, <span class="keyword">drop</span> primary <span class="keyword">key</span>;</span><br><span class="line">  </span><br><span class="line"><span class="comment">#添加外键：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 从表 <span class="keyword">add</span> <span class="keyword">constraint</span> 外键名称（形如：FK_从表_主表）</span><br><span class="line"><span class="keyword">foreign</span> <span class="keyword">key</span> 从表(外键字段) <span class="keyword">references</span> 主表(主键字段);</span><br><span class="line"><span class="comment">#删除外键：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">foreign</span> <span class="keyword">key</span> 外键名称</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改默认值：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> testalter_tbl <span class="keyword">alter</span> i <span class="keyword">set</span> <span class="keyword">default</span> <span class="number">1000</span>;</span><br><span class="line"><span class="comment">#删除默认值：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> testalter_tbl <span class="keyword">alter</span> i <span class="keyword">drop</span> <span class="keyword">default</span>;</span><br></pre></td></tr></table></figure></div>

<h4 id="表内容基本操作"><a href="#表内容基本操作" class="headerlink" title="表内容基本操作"></a>表内容基本操作</h4><p>mysql存值的基本数据类型</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line">bit[(m)]</span><br><span class="line">  <span class="comment">#二进制位（101001），m表示二进制位的长度（1-64），默认m＝1</span></span><br><span class="line"></span><br><span class="line">tinyint[(m)] [unsigned] [zerofill]</span><br><span class="line">  <span class="comment">#小整数，数据类型用于保存一些范围的整数数值范围：</span></span><br><span class="line">  <span class="comment">#特别的： MySQL中无布尔值，使用tinyint(1)构造。</span></span><br><span class="line"></span><br><span class="line">int[(m)][unsigned][zerofill]</span><br><span class="line">  <span class="comment">#整数，数据类型用于保存一些范围的整数数值范围</span></span><br><span class="line"></span><br><span class="line">bigint[(m)][unsigned][zerofill]</span><br><span class="line">  <span class="comment">#大整数，数据类型用于保存一些范围的整数数值范围</span></span><br><span class="line"></span><br><span class="line">decimal[(m[,d])] [unsigned] [zerofill]</span><br><span class="line">  <span class="comment">#准确的十进制，m是数字总个数（负号不算），d是小数点后个数。 m最大值为65，d最大值为30。</span></span><br><span class="line"></span><br><span class="line">float[(m,d)] [unsigned] [zerofill]</span><br><span class="line">  <span class="comment">#单精度浮点数（非准确小数值），m是数字总个数，d是小数点后个数。数值越大，越不准确</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">double[(m,d)] [unsigned] [zerofill]</span><br><span class="line">  <span class="comment">#双精度浮点数（非准确小数值），m是数字总个数，d是小数点后个数。数值越大，越不准确</span></span><br><span class="line">  </span><br><span class="line">char (m)</span><br><span class="line">  <span class="comment">#char数据类型用于表示固定长度的字符串，可以包含最多达255个字符。</span></span><br><span class="line">  <span class="comment">#其中m代表字符串的长度。即使数据小于m长度，也会占用m长度</span></span><br><span class="line">  </span><br><span class="line">varchar(m)</span><br><span class="line">  <span class="comment">#varchars数据类型用于变长的字符串，可以包含最多达255个字符。</span></span><br><span class="line">  <span class="comment">/**其中m代表该数据类型所允许保存的字符串的最大长度，</span></span><br><span class="line"><span class="comment">    	只要长度小于该最大值的字符串都可以被保存在该数据类型中。</span></span><br><span class="line"><span class="comment">    	注：虽然varchar使用起来较为灵活，但是从整个系统的性能角度来说，</span></span><br><span class="line"><span class="comment">    	char数据类型的处理速度更快，有时甚至可以超出varchar处理速度的50%。</span></span><br><span class="line"><span class="comment">    	因此，用户在设计数据库时应当综合考虑各方面的因素，以求达到最佳的平衡**/</span></span><br><span class="line"></span><br><span class="line">text</span><br><span class="line">  <span class="comment">#text数据类型用于保存变长的大字符串，可以组多到65535 (2**16 − 1)个字符。</span></span><br><span class="line"></span><br><span class="line">mediumtext</span><br><span class="line">  <span class="comment">#A TEXT column with a maximum length of 16,777,215 (2**24 − 1) characters.</span></span><br><span class="line"></span><br><span class="line">longtext</span><br><span class="line">  <span class="comment">#A TEXT column with a maximum length of 4,294,967,295 or 4GB (2**32 − 1) characters.</span></span><br><span class="line"></span><br><span class="line">enum</span><br><span class="line">  <span class="comment">#枚举类型</span></span><br><span class="line">  <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> shirts (</span><br><span class="line">      <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">40</span>),</span><br><span class="line">      <span class="keyword">size</span> ENUM(<span class="string">'x-small'</span>, <span class="string">'small'</span>, <span class="string">'medium'</span>, <span class="string">'large'</span>, <span class="string">'x-large'</span>)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> shirts (<span class="keyword">name</span>, <span class="keyword">size</span>) <span class="keyword">VALUES</span> </span><br><span class="line">      (<span class="string">'dress shirt'</span>,<span class="string">'large'</span>), (<span class="string">'t-shirt'</span>,<span class="string">'medium'</span>),(<span class="string">'polo shirt'</span>,<span class="string">'small'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">  <span class="comment">#集合类型</span></span><br><span class="line">  <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myset (<span class="keyword">col</span> <span class="keyword">SET</span>(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>));</span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> myset (<span class="keyword">col</span>) <span class="keyword">VALUES</span> (<span class="string">'a,d'</span>), (<span class="string">'d,a'</span>), (<span class="string">'a,d,a'</span>), (<span class="string">'a,d,d'</span>), (<span class="string">'d,a,d'</span>);</span><br><span class="line"></span><br><span class="line">DATE</span><br><span class="line">  <span class="comment">#YYYY-MM-DD（1000-01-01/9999-12-31）</span></span><br><span class="line"></span><br><span class="line">TIME</span><br><span class="line">  <span class="comment">#HH:MM:SS（'-838:59:59'/'838:59:59'）</span></span><br><span class="line"></span><br><span class="line">YEAR</span><br><span class="line">  <span class="comment">#YYYY（1901/2155）</span></span><br><span class="line"></span><br><span class="line">DATETIME</span><br><span class="line">  <span class="comment">#YYYY-MM-DD HH:MM:SS（1000-01-01 00:00:00/9999-12-31 23:59:59    Y）</span></span><br><span class="line"></span><br><span class="line">TIMESTAMP</span><br><span class="line">  <span class="comment">#YYYYMMDD HHMMSS（1970-01-01 00:00:00/2037 年某时）</span></span><br></pre></td></tr></table></figure></div>

<p><em>二进制数据：TinyBlob、Blob、MediumBlob、LongBlob</em></p>
<h4 id="增"><a href="#增" class="headerlink" title="#增"></a><a href="http://nanarino.metoyun.com/py/30-SQL语句.html#增" target="_blank" rel="noopener">#</a>增</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表 (列名,列名...) <span class="keyword">values</span> (值,值,值...)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表 (列名,列名...) <span class="keyword">values</span> (值,值,值...),(值,值,值...)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表 (列名,列名...) <span class="keyword">select</span> (列名,列名...) <span class="keyword">from</span> 表</span><br></pre></td></tr></table></figure></div>

<h5 id="删"><a href="#删" class="headerlink" title="删"></a>删</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">id</span>＝<span class="number">1</span> <span class="keyword">and</span> <span class="keyword">name</span>＝<span class="string">'alex'</span><span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<h5 id="改"><a href="#改" class="headerlink" title="改"></a>改</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> 表 <span class="keyword">set</span> <span class="keyword">name</span> ＝ <span class="string">'alex'</span> <span class="keyword">where</span> <span class="keyword">id</span>&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<h5 id="查"><a href="#查" class="headerlink" title="查"></a>查</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">#打印完整表</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> 表</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">id</span> &gt; <span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> nid,<span class="keyword">name</span>,gender <span class="keyword">as</span> gg <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">id</span> &gt; <span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line">a、条件</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">id</span> &gt; <span class="number">1</span> <span class="keyword">and</span> <span class="keyword">name</span> != <span class="string">'alex'</span> <span class="keyword">and</span> <span class="keyword">num</span> = <span class="number">12</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">between</span> <span class="number">5</span> <span class="keyword">and</span> <span class="number">16</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>)</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>)</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">select</span> nid <span class="keyword">from</span> 表)</span><br><span class="line"> </span><br><span class="line">b、通配符</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'ale%'</span>  - ale开头的所有（多个字符串）</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'ale_'</span>  - ale开头的所有（一个字符）</span><br><span class="line"> </span><br><span class="line">c、限制</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">limit</span> <span class="number">5</span>;            - 前5行</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">limit</span> <span class="number">4</span>,<span class="number">5</span>;          - 从第4行开始的5行</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">limit</span> <span class="number">5</span> <span class="keyword">offset</span> <span class="number">4</span>    - 从第<span class="number">4</span>行开始的<span class="number">5</span>行</span><br><span class="line"> </span><br><span class="line">d、排序</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">order</span> <span class="keyword">by</span> 列 <span class="keyword">asc</span>              - 根据 “列” 从小到大排列</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">order</span> <span class="keyword">by</span> 列 <span class="keyword">desc</span>             - 根据 “列” 从大到小排列</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> 表 <span class="keyword">order</span> <span class="keyword">by</span> 列<span class="number">1</span> <span class="keyword">desc</span>, 列<span class="number">2</span> <span class="keyword">asc</span>    - 根据 “列<span class="number">1</span>” 从大到小排列，如果相同则按列<span class="number">2</span>从小到大排序</span><br><span class="line"> </span><br><span class="line">e、分组</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">num</span> <span class="keyword">from</span> 表 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">num</span></span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">num</span>,nid <span class="keyword">from</span> 表 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">num</span>,nid</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">num</span>,nid <span class="keyword">from</span> 表  <span class="keyword">where</span> nid &gt; <span class="number">10</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">num</span>,nid <span class="keyword">order</span> nid <span class="keyword">desc</span></span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">num</span>,nid,<span class="keyword">count</span>(*),<span class="keyword">sum</span>(score),<span class="keyword">max</span>(score),<span class="keyword">min</span>(score) <span class="keyword">from</span> 表 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">num</span>,nid</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">num</span> <span class="keyword">from</span> 表 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">num</span> <span class="keyword">having</span> <span class="keyword">max</span>(<span class="keyword">id</span>) &gt; <span class="number">10</span></span><br><span class="line"> </span><br><span class="line">    特别的：<span class="keyword">group</span> <span class="keyword">by</span> 必须在<span class="keyword">where</span>之后，<span class="keyword">order</span> <span class="keyword">by</span>之前</span><br><span class="line"> </span><br><span class="line">f、连表</span><br><span class="line">    无对应关系则不显示</span><br><span class="line">    <span class="keyword">select</span> A.num, A.name, B.name</span><br><span class="line">    <span class="keyword">from</span> A,B</span><br><span class="line">    <span class="keyword">Where</span> A.nid = B.nid</span><br><span class="line"> </span><br><span class="line">    无对应关系则不显示</span><br><span class="line">    <span class="keyword">select</span> A.num, A.name, B.name</span><br><span class="line">    <span class="keyword">from</span> A <span class="keyword">inner</span> <span class="keyword">join</span> B <span class="keyword">on</span> A.nid = B.nid</span><br><span class="line"> </span><br><span class="line">    A表所有显示，如果B中无对应关系，则值为<span class="literal">null</span></span><br><span class="line">    <span class="keyword">select</span> A.num, A.name, B.name</span><br><span class="line">    <span class="keyword">from</span> A <span class="keyword">left</span> <span class="keyword">join</span> B <span class="keyword">on</span> A.nid = B.nid</span><br><span class="line"> </span><br><span class="line">    B表所有显示，如果B中无对应关系，则值为<span class="literal">null</span></span><br><span class="line">    <span class="keyword">select</span> A.num, A.name, B.name</span><br><span class="line">    <span class="keyword">from</span> A <span class="keyword">right</span> <span class="keyword">join</span> B <span class="keyword">on</span> A.nid = B.nid</span><br><span class="line"> </span><br><span class="line">g、组合</span><br><span class="line">    组合，自动处理重合</span><br><span class="line">    <span class="keyword">select</span> nickname</span><br><span class="line">    <span class="keyword">from</span> A</span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">name</span></span><br><span class="line">    <span class="keyword">from</span> B</span><br><span class="line"> </span><br><span class="line">    组合，不处理重合</span><br><span class="line">    <span class="keyword">select</span> nickname</span><br><span class="line">    <span class="keyword">from</span> A</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">name</span></span><br><span class="line">    <span class="keyword">from</span> B</span><br></pre></td></tr></table></figure></div>

<p>mysql之外的其他关系型数据库的用法大致相同。使用pymysql可用同步执行mysql的事务。</p>
<p>篇幅有限。变量，函数，存储过程，触发器等知识略过。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(三十四)</title>
    <url>/Python/Python_id_52.html</url>
    <content><![CDATA[<h2 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h2><p>协程是单线程下的并发，又称微线程，纤程。英文名Coroutine。<br>Python通过<code>yield</code>，<code>.send()</code>提供了对协程的基本支持，但是不完全。<br>在python中，由于GIL锁的存在，并发编程的最佳实践是<strong>多进程</strong>+<strong>协程</strong>的方式。</p>
<h3 id="greenlet模块"><a href="#greenlet模块" class="headerlink" title="greenlet模块"></a>greenlet模块</h3><a id="more"></a>

<p>第三方模块<code>greenlet</code>已经实现了协程，无需写生成器，<code>.switch()</code>代替了<code>.send()</code>。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">'%s eat 1'</span> %name)</span><br><span class="line">    g2.switch(<span class="string">'egon'</span>)</span><br><span class="line">    print(<span class="string">'%s eat 2'</span> %name)</span><br><span class="line">    g2.switch()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">'%s play 1'</span> %name)</span><br><span class="line">    g1.switch()</span><br><span class="line">    print(<span class="string">'%s play 2'</span> %name)</span><br><span class="line"></span><br><span class="line">g1=greenlet(eat)</span><br><span class="line">g2=greenlet(play)</span><br><span class="line"></span><br><span class="line">g1.switch(<span class="string">'egon'</span>) <span class="comment"># 可以在第一次switch时传入参数，以后都不需要</span></span><br></pre></td></tr></table></figure></div>

<h3 id="gevent模块"><a href="#gevent模块" class="headerlink" title="gevent模块"></a>gevent模块</h3><p>第三方库<code>gevent</code>实现并发同步或异步编程，内部以<code>greenlet</code>方式<strong>自动调度它自己的IO</strong>，它是以C扩展模块形式接入Python的轻量级协程。是python2版本协程的首选方案。它的API与进程，线程相近。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line">g1=gevent.spawn(func,<span class="number">2</span>,<span class="number">3</span>,x=<span class="number">4</span>,y=<span class="number">5</span>)</span><br><span class="line">g2=gevent.spawn(func2)</span><br><span class="line"></span><br><span class="line">g1.join() <span class="comment">#等待g1结束</span></span><br><span class="line">g2.join() <span class="comment">#等待g2结束</span></span><br><span class="line"><span class="comment">#或者上述两步合作一步：gevent.joinall([g1,g2])</span></span><br><span class="line"></span><br><span class="line">print(g1.value) <span class="comment">#拿到func1的返回值</span></span><br></pre></td></tr></table></figure></div>

<p>它自己的IO有：<code>gevent.sleep()</code>，<code>gevent.socket</code>等</p>
<h4 id="猴子补丁"><a href="#猴子补丁" class="headerlink" title="猴子补丁"></a>猴子补丁</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> spawn,joinall,monkey;monkey.patch_all()</span><br></pre></td></tr></table></figure></div>

<p>在它之后导入的模块将被替换为它自己的io，动态替换已有的标准库。</p>
<h3 id="其他第三方异步库"><a href="#其他第三方异步库" class="headerlink" title="其他第三方异步库"></a>其他第三方异步库</h3><p><code>eventlet</code>：同<code>gevent</code>模块，内部以<code>greenlet</code>方式，也有猴子补丁方法，但没<code>gevent</code>好用。<br><code>twisted</code>：基于事件驱动的网络引擎框架。<br><code>tornado</code>：最简单的回调实现异步协程，作为httpserver和httpclient，同时也是Web框架。</p>
<h3 id="asyncio模块"><a href="#asyncio模块" class="headerlink" title="asyncio模块"></a>asyncio模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/asyncio.html" target="_blank" rel="noopener"><code>asyncio</code></a>是Python 3.4版本引入的标准库，直接内置了对异步IO的支持。</p>
<p><strong>运行和休眠</strong></p>
<ul>
<li><code>asyncio.run(可等待对象)</code></li>
<li><code>asyncio.sleep(秒数)</code></li>
</ul>
<p><strong>可等待对象</strong></p>
<ul>
<li>coroutine：协程对象，<code>async def</code>定义的函数返回的对象</li>
<li>task：任务对象，包含协程对象的各种状态</li>
<li>future：将来执行的task，给予高层去等待</li>
</ul>
<h4 id="await语句"><a href="#await语句" class="headerlink" title="await语句"></a><code>await</code>语句</h4><p>await 可等待对象<br>python3.7以上的写法（带装饰器的生成器和<code>yield from</code>写法将在3.10中废弃）</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(delay, what)</span>:</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(delay)</span><br><span class="line">    print(what)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">f"start <span class="subst">&#123;time.strftime(<span class="string">'%X'</span>)&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> say(<span class="number">1</span>, <span class="string">'hello'</span>)</span><br><span class="line">    <span class="keyword">await</span> say(<span class="number">2</span>, <span class="string">'world'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"finish <span class="subst">&#123;time.strftime(<span class="string">'%X'</span>)&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure></div>

<p>它将会打印 “start”，<br>等待 1 秒，再打印 “hello”<br>等待 2 秒，再打印 “world”<br>最后打印 “finish”</p>
<h4 id="create-task"><a href="#create-task" class="headerlink" title=".create_task()"></a><code>.create_task()</code></h4><p>将协程对象及其各种状态打包为 Task 对象，放入任务队列中，并返回。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    task1 = asyncio.create_task(say(<span class="number">1</span>, <span class="string">'hello'</span>))</span><br><span class="line"></span><br><span class="line">    task2 = asyncio.create_task(say(<span class="number">2</span>, <span class="string">'world'</span>))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"start <span class="subst">&#123;time.strftime(<span class="string">'%X'</span>)&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> task1</span><br><span class="line">    <span class="keyword">await</span> task2</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"finish <span class="subst">&#123;time.strftime(<span class="string">'%X'</span>)&#125;</span>"</span>)</span><br></pre></td></tr></table></figure></div>

<p>它将会打印 “start”，<br>等待 1 秒，再打印 “hello”<br>等待 1 秒，再打印 “world”<br>最后打印 “finish”<br>它们并发运行了。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(三十三)</title>
    <url>/Python/Python_id_51.html</url>
    <content><![CDATA[<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><p>进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。</p>
<p>使用多进程来并发可以使python程序有效利用多核CPU。</p>
<p><a href="https://docs.python.org/zh-cn/3/library/multiprocessing.html" target="_blank" rel="noopener"><code>multiprocessing</code></a>模块是最常用的多进程模块。</p>
<a id="more"></a>

<p>在Windows操作系统中由于没有fork，在创建子进程的时候会自动以 import 启动，导致递归。所以必须把创建子进程的部分写在<code>if __name__ ==&#39;__main__&#39;</code>中。</p>
<h3 id="子进程"><a href="#子进程" class="headerlink" title="子进程"></a>子进程</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#_*_coding:utf-8_*_</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">'我单推'</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p = Process(target=f, args=(<span class="string">'ayame'</span>,))</span><br><span class="line">    p.start()</span><br><span class="line">    print(<span class="string">'摸了'</span>)</span><br></pre></td></tr></table></figure></div>

<p>子进程对象方法</p>
<ul>
<li><code>.start()</code> 启动。子进程的执行顺序不是根据启动顺序决定的。</li>
<li><code>.join(timeout = None)</code> 阻塞主进程，直至子进程运行完毕或超时。</li>
<li><code>.daemon=True</code> 设置为<strong>守护进程</strong>，要在start之前设置。主进程代码运行结束，守护进程随即终止。</li>
<li><code>terminate()</code> 关闭进程（不会立即关闭）</li>
</ul>
<p>多个子进程</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(name)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">'我单推'</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    dd_list = [<span class="string">'shishi'</span>,<span class="string">'hima'</span>,<span class="string">'sasaki'</span>]</span><br><span class="line">    dd_list_p = []</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> dd_list:</span><br><span class="line">        p = Process(target=f, args=(name,))</span><br><span class="line">        p.start()</span><br><span class="line">        dd_list_p.append(p)</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> dd_list_p:</span><br><span class="line">        p.join()</span><br><span class="line">    print(<span class="string">'一秒单推一个也是单推(并发)'</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="锁和管道"><a href="#锁和管道" class="headerlink" title="锁和管道"></a>锁和管道</h3><h4 id="锁Lock"><a href="#锁Lock" class="headerlink" title="锁Lock()"></a>锁<code>Lock()</code></h4><p>加锁可以保证多个进程修改同一块数据时，同一时间只能有一个任务可以进行修改</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Lock</span><br><span class="line"><span class="keyword">import</span> os, time, random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">watch</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">'''这里用sleep代替了对锁抢占的内存资源的读写'''</span></span><br><span class="line">    time.sleep(random.random())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">(lock, name)</span>:</span></span><br><span class="line">    lock.acquire()</span><br><span class="line">    print(<span class="string">f'你关注的<span class="subst">&#123;name&#125;</span>开播了，房间号是<span class="subst">&#123;os.getpid()&#125;</span>'</span>)</span><br><span class="line">    watch()</span><br><span class="line">    print(<span class="string">f'你关注的<span class="subst">&#123;name&#125;</span>下播了，房间号是<span class="subst">&#123;os.getpid()&#125;</span>'</span>)</span><br><span class="line">    lock.release()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    lock = Lock()</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> [<span class="string">'shishi'</span>,<span class="string">'hima'</span>,<span class="string">'sasaki'</span>]:</span><br><span class="line">        p = Process(target=work,args=(lock,name))</span><br><span class="line">        p.start()</span><br></pre></td></tr></table></figure></div>

<p>浪费了时间，却保证了数据的安全。</p>
<p>除了最简单的锁<code>Lock()</code> ，还有</p>
<ul>
<li><code>RLock()</code> 递归锁</li>
<li><code>Semaphore(value=1)</code> 计数器锁</li>
<li><code>BoundedSemaphore(value=1)</code> 带上限的计数器锁</li>
</ul>
<h4 id="管道Pipe-duplex-True"><a href="#管道Pipe-duplex-True" class="headerlink" title="管道Pipe(duplex=True)"></a>管道<code>Pipe(duplex=True)</code></h4><p>参数<em>duplex</em> 是否双向</p>
<p>返回包含两个connection对象的元组，connection相当于面向消息的套接字，数据是存在于内存中的。</p>
<h4 id="队列Queue-maxsize"><a href="#队列Queue-maxsize" class="headerlink" title="队列Queue([maxsize])"></a>队列<code>Queue([maxsize])</code></h4><p>队列 <a href="https://docs.python.org/zh-cn/3/library/multiprocessing.html#multiprocessing.Queue" target="_blank" rel="noopener"><code>Queue</code></a> 又是基于（管道+锁）实现的内存中的共享数据，可以让我们从复杂的锁问题中解脱出来， 我们应该尽量避免使用共享数据，尽可能使用消息传递和队列，避免处理复杂的同步和锁问题，而且在进程数目增多时，往往可以获得更好的可获展性。</p>
<p>队列对象方法</p>
<ul>
<li><code>.empty()</code> 是否空</li>
<li><code>.full()</code> 是否满</li>
<li><code>.put(obj, block=True, timeout=None)</code> 压入队列</li>
<li><code>.get(block=True, timeout=None)</code> 弹出队列</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing, os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(queue, name)</span>:</span></span><br><span class="line">    <span class="string">'''向queue中put数据'''</span></span><br><span class="line">    info = <span class="string">f'YouTube频道<span class="subst">&#123;os.getpid():&lt;<span class="number">5</span>d&#125;</span>:<span class="subst">&#123;name:&gt;<span class="number">7</span>s&#125;</span>-Channel播了'</span></span><br><span class="line">    queue.put(info)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shift</span><span class="params">(queue, name)</span>:</span></span><br><span class="line">    <span class="string">'''从queue中get数据'''</span></span><br><span class="line">    info = queue.get()</span><br><span class="line">    print(<span class="string">f'bilibili房间号<span class="subst">&#123;os.getpid():&lt;<span class="number">5</span>d&#125;</span>:<span class="subst">&#123;name:&gt;<span class="number">7</span>s&#125;</span>-Official同传--&gt;<span class="subst">&#123;info&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    youtube = []</span><br><span class="line">    bilibili = []</span><br><span class="line">    queue = multiprocessing.Queue(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 子进程 油管开播</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> [<span class="string">'shishi'</span>,<span class="string">'hima'</span>,<span class="string">'sasaki'</span>]:</span><br><span class="line">        process = multiprocessing.Process(target=push,args=(queue, name))</span><br><span class="line">        process.start()</span><br><span class="line">        youtube.append(process)</span><br><span class="line">    <span class="comment"># 子进程 哔哩哔哩转播</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> [<span class="string">'shishi'</span>,<span class="string">'hima'</span>,<span class="string">'sasaki'</span>]:</span><br><span class="line">        process = multiprocessing.Process(target=shift,args=(queue, name))</span><br><span class="line">        process.start()</span><br><span class="line">        bilibili.append(process)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> youtube:</span><br><span class="line">        p.join()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> bilibili:</span><br><span class="line">        p.join()</span><br></pre></td></tr></table></figure></div>

<h5 id="用于生产者消费者模型的JoinableQueue-maxsize"><a href="#用于生产者消费者模型的JoinableQueue-maxsize" class="headerlink" title="用于生产者消费者模型的JoinableQueue([maxsize])"></a>用于生产者消费者模型的<code>JoinableQueue([maxsize])</code></h5><p><a href="https://docs.python.org/zh-cn/3/library/multiprocessing.html#multiprocessing.JoinableQueue" target="_blank" rel="noopener"><code>JoinableQueue</code></a> 类是 <code>Queue</code> 的子类，额外添加了 <code>task_done()</code>和 <code>join()</code>方法。</p>
<ul>
<li><code>.task_done()</code> 指出之前进入队列的一个任务已经完成</li>
<li><code>.join()</code> 阻塞，直到队列中所有任务均被<code>task_done()</code></li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, JoinableQueue</span><br><span class="line"><span class="keyword">import</span> time, random, os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">(q)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        res = q.get()</span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">        print(<span class="string">f'   DD   - id<span class="subst">&#123;os.getpid():&lt;<span class="number">5</span>d&#125;</span>：<span class="subst">&#123;res&#125;</span>看完了'</span>)</span><br><span class="line">        q.task_done()</span><br><span class="line">    print(<span class="string">'consumer ok'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">(name, q)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">        res = <span class="string">f'<span class="subst">&#123;name&#125;</span>-<span class="subst">&#123;i&#125;</span>回目'</span></span><br><span class="line">        q.put(res)</span><br><span class="line">        print(<span class="string">f'Official- id<span class="subst">&#123;os.getpid():&lt;<span class="number">5</span>d&#125;</span>：<span class="subst">&#123;res&#125;</span>烤好了'</span>)</span><br><span class="line">    q.join()</span><br><span class="line">    print(<span class="string">f'<span class="subst">&#123;name&#125;</span>组收益了'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q = JoinableQueue()</span><br><span class="line">    <span class="comment">#生产者们:烤肉man</span></span><br><span class="line">    nana_offic = Process(target=producer,args=(<span class="string">'nana'</span>,q))</span><br><span class="line">    aqua_offic = Process(target=producer,args=(<span class="string">'aqua'</span>,q))</span><br><span class="line">    peko_offic = Process(target=producer,args=(<span class="string">'peko'</span>,q))</span><br><span class="line">    officials = [nana_offic, aqua_offic, peko_offic]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#消费者们:DD</span></span><br><span class="line">    dd1 = Process(target=consumer,args=(q,))</span><br><span class="line">    dd2 = Process(target=consumer,args=(q,))</span><br><span class="line">    dd1.daemon = <span class="literal">True</span></span><br><span class="line">    dd2.daemon = <span class="literal">True</span></span><br><span class="line">    dd_list = [dd1, dd2]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> officials + dd_list:</span><br><span class="line">        p.start()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> officials:</span><br><span class="line">        p.join()</span><br><span class="line">    print(<span class="string">'熬死DD了'</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="进程池"><a href="#进程池" class="headerlink" title="进程池"></a>进程池</h3><p>进程池<a href="https://docs.python.org/zh-cn/3/library/multiprocessing.html#multiprocessing.pool.Pool" target="_blank" rel="noopener"><code>Pool</code></a>控制同一时间最多有固定数量的进程在运行。</p>
<p>它支持带有超时和回调的异步结果，以及一个并行的 map 实现。</p>
<p>创建进程池</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">multiprocessing.Pool([numprocess  [,initializer [, initargs]]])</span><br></pre></td></tr></table></figure></div>

<p>创建时参数</p>
<ul>
<li><code>numprocess</code> 要创建的进程数，如果省略，将默认使用cpu_count()的值</li>
<li><code>initializer</code> 每个工作进程启动时要执行的可调用对象，默认为None</li>
<li><code>initargs</code> 是要传给initializer的参数组</li>
</ul>
<p>进程池对象方法</p>
<ul>
<li><code>.apply(func [, args [, kwargs]])</code> 排队执行<code>func(*args,**kwargs)</code>返回结果</li>
<li><code>.apply_async(func [, args [, kwargs]])</code> 并行执行，返回AsyncResul的实例</li>
<li><code>.map(func, iterable)</code> 内置函数map的并行版本 (只支持一个 <em>iterable</em> 参数)</li>
<li><code>.map_async(func, iterable)</code> 同map，返回的是AsyncResul的实例</li>
<li><code>.imap(func, iterable)</code> 延迟执行的map，所需的内存小， <em>chunksize</em>参数可调速</li>
</ul>
<p><code>_async</code>的方法支持<em>callback</em> , <em>error_callback</em> 参数，表示将结果<code>.get</code>传入回调和错误回调</p>
<ul>
<li><code>.close()</code> 关闭进程池</li>
<li><code>.jion()</code> 等待退出。要在close之后调用</li>
</ul>
<p>AsyncResul对象方法</p>
<ul>
<li><code>.get([timeout])</code> 获取执行结果。可选timeout抛出异常。</li>
<li><code>.ready()</code> 是否调用完成。</li>
<li><code>.successful()</code> 是否调用完成且没有引发异常。如果就绪之前调用将引发异常。</li>
<li><code>.wait([timeout])</code> 等待结果变为可用。</li>
<li><code>.terminate()</code> 立即终止所有工作进程，不执行任何挂起工作。</li>
</ul>
<p>用例</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request <span class="keyword">as</span> request</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> os, re</span><br><span class="line"></span><br><span class="line">User_Agent = <span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0'</span></span><br><span class="line">headers = dict.fromkeys((<span class="string">'User-Agent'</span>,),User_Agent)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    req = request.Request(url=url, headers=headers)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res = request.urlopen(req).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(os.getpid(), <span class="string">'请求失败'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(os.getpid(), <span class="string">'请求成功'</span>)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_title</span><span class="params">(res)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> title:=re.search(<span class="string">r'(?&lt;=\&lt;title\&gt;).*?(?=&lt;/title&gt;)'</span>, res):</span><br><span class="line">        print(os.getpid(), <span class="string">'解析网页标题为'</span>, title.group())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(os.getpid(), <span class="string">'解析不到网页标题'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    urls=[</span><br><span class="line">        <span class="string">'https://www.baidu.com'</span>,</span><br><span class="line">        <span class="string">'https://www.bilibili.com'</span>,</span><br><span class="line">        <span class="string">'https://cn.bing.com/'</span>,</span><br><span class="line">        <span class="string">'https://mail.163.com/'</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    p = Pool(<span class="number">3</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        res = p.apply_async(get_page, args=(url,), callback=get_title)</span><br><span class="line">        </span><br><span class="line">    p.close()</span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">'完成'</span>)</span><br></pre></td></tr></table></figure></div>

<p>数据共享</p>
<p>进程池callback，队列put等都只能接受<strong>可序列化</strong>的对象作为参数</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(三十二)</title>
    <url>/Python/Python_id_50.html</url>
    <content><![CDATA[<h2 id="套接字socket"><a href="#套接字socket" class="headerlink" title="套接字socket"></a>套接字socket</h2><blockquote>
<p>套接字起源于 20 世纪 70 年代加利福尼亚大学伯克利分校版本的 Unix,即人们所说的 BSD Unix。 因此,有时人们也把套接字称为“伯克利套接字”或“BSD 套接字”。一开始,套接字被设计用在同 一台主机上多个应用程序之间的通讯。这也被称进程间通讯或IPC。</p>
</blockquote>
<h3 id="socket模块"><a href="#socket模块" class="headerlink" title="socket模块"></a>socket模块</h3><a id="more"></a>

<p><a href="https://docs.python.org/zh-cn/3/library/socket.html" target="_blank" rel="noopener"><code>socket</code></a>模块提供了访问 BSD套接字的接口</p>
<h4 id="创建套接字"><a href="#创建套接字" class="headerlink" title="创建套接字"></a>创建套接字</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket()</span><br></pre></td></tr></table></figure></div>

<h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><ul>
<li>AF_INET 面向网络的套接字（默认种族）</li>
<li>AF_UNIX 基于文件的套接字</li>
<li>TCP套接字的名SOCK_STREAM（默认类型）</li>
<li>UDP套接字的名SOCK_DGRAM</li>
</ul>
<table>
<thead>
<tr>
<th>常用方法</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>s.bind()</code></td>
<td>绑定(主机,端口号)到套接字</td>
</tr>
<tr>
<td><code>s.listen()</code></td>
<td>开始TCP监听</td>
</tr>
<tr>
<td><code>s.accept()</code></td>
<td>被动接受TCP客户的连接,(阻塞式)等待连接的到来</td>
</tr>
<tr>
<td><code>s.connect()</code></td>
<td>主动初始化TCP服务器连接</td>
</tr>
<tr>
<td><code>s.connect_ex()</code></td>
<td><code>connect()</code>函数的扩展版本,出错时返回出错码,而不是抛出异常</td>
</tr>
<tr>
<td><code>s.recv()</code></td>
<td>#接收TCP数据</td>
</tr>
<tr>
<td><code>s.send()</code></td>
<td>#发送TCP数据</td>
</tr>
<tr>
<td><code>s.sendall()</code></td>
<td>#发送TCP数据</td>
</tr>
<tr>
<td><code>s.recvfrom()</code></td>
<td>#接收UDP数据</td>
</tr>
<tr>
<td><code>s.sendto()</code></td>
<td>#发送UDP数据</td>
</tr>
<tr>
<td><code>s.getpeername()</code></td>
<td>#连接到当前套接字的远端的地址</td>
</tr>
<tr>
<td><code>s.getsockname()</code></td>
<td>#当前套接字的地址</td>
</tr>
<tr>
<td><code>s.getsockopt()</code></td>
<td>#返回指定套接字的参数</td>
</tr>
<tr>
<td><code>s.setsockopt()</code></td>
<td>#设置指定套接字的参数</td>
</tr>
<tr>
<td><code>s.close()</code></td>
<td>#关闭套接字，也支持with上下文管理<code>socket.socket()</code></td>
</tr>
</tbody></table>
<h4 id="基于TCP协议的socket"><a href="#基于TCP协议的socket" class="headerlink" title="基于TCP协议的socket"></a>基于TCP协议的socket</h4><h5 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">sk = socket.socket() <span class="comment">#即socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span></span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8898</span>))  <span class="comment">#把地址绑定到套接字</span></span><br><span class="line">sk.listen()          <span class="comment">#监听链接</span></span><br><span class="line">conn,addr = sk.accept() <span class="comment">#接受客户端链接 会和input一样一直等待连接</span></span><br><span class="line">ret = conn.recv(<span class="number">1024</span>)  <span class="comment">#接收客户端信息 会和input一样一直等待着信</span></span><br><span class="line">print(ret)       <span class="comment">#打印客户端信息</span></span><br><span class="line">conn.send(<span class="string">b'hi'</span>)        <span class="comment">#向客户端发送信息</span></span><br><span class="line">conn.close()       <span class="comment">#关闭客户端套接字</span></span><br><span class="line">sk.close()        <span class="comment">#关闭服务器套接字(可选)</span></span><br></pre></td></tr></table></figure></div>

<h5 id="client端"><a href="#client端" class="headerlink" title="client端"></a>client端</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">sk = socket.socket() <span class="comment"># 创建客户套接字</span></span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>,<span class="number">8898</span>))    <span class="comment"># 尝试连接服务器</span></span><br><span class="line">sk.send(<span class="string">b'hello!'</span>)</span><br><span class="line">ret = sk.recv(<span class="number">1024</span>)         <span class="comment"># 对话(发送/接收)</span></span><br><span class="line">print(ret)</span><br><span class="line">sk.close()            <span class="comment"># 关闭客户套接字</span></span><br></pre></td></tr></table></figure></div>

<h4 id="常见报错"><a href="#常见报错" class="headerlink" title="常见报错"></a>常见报错</h4><p>Traceback(most recent call last):</p>
<p>OSError: [Error 48] Address already in use</p>
<p>解决方法： 加入一条socket配置，重用ip和端口</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> SOL_SOCKET,SO_REUSEADDR</span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.setsockopt(SOL_SOCKET,SO_REUSEADDR,<span class="number">1</span>) <span class="comment">#就是它，在bind前加</span></span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8898</span>))</span><br><span class="line">sk.listen()</span><br></pre></td></tr></table></figure></div>

<p>Traceback(most recent call last):</p>
<p>ConnectionRefusedError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。</p>
<p>解决方法： 修改防火墙设置或者换一个端口号</p>
<h4 id="基于UDP协议的socket"><a href="#基于UDP协议的socket" class="headerlink" title="基于UDP协议的socket"></a>基于UDP协议的socket</h4><p>udp无需监听和建立连接。</p>
<p>udp收发消息会分别接收和发送对方的地址（addr）。</p>
<h5 id="server端-1"><a href="#server端-1" class="headerlink" title="server端"></a>server端</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">udp_sk = socket.socket(type=socket.SOCK_DGRAM)   <span class="comment">#创建一个服务器的套接字</span></span><br><span class="line">udp_sk.bind((<span class="string">'127.0.0.1'</span>,<span class="number">9000</span>))        <span class="comment">#绑定服务器套接字</span></span><br><span class="line">msg,addr = udp_sk.recvfrom(<span class="number">1024</span>)</span><br><span class="line">print(msg)</span><br><span class="line">udp_sk.sendto(<span class="string">b'hi'</span>,addr)                 <span class="comment"># 对话(接收与发送)</span></span><br><span class="line">udp_sk.close()                         <span class="comment"># 关闭服务器套接字</span></span><br></pre></td></tr></table></figure></div>

<h5 id="client端-1"><a href="#client端-1" class="headerlink" title="client端"></a>client端</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">ip_port=(<span class="string">'127.0.0.1'</span>,<span class="number">9000</span>)</span><br><span class="line">udp_sk=socket.socket(type=socket.SOCK_DGRAM)</span><br><span class="line">udp_sk.sendto(<span class="string">b'hello'</span>,ip_port)</span><br><span class="line">back_msg,addr=udp_sk.recvfrom(<span class="number">1024</span>)</span><br><span class="line">print(back_msg.decode(<span class="string">'utf-8'</span>),addr)</span><br></pre></td></tr></table></figure></div>

<h4 id="更多方法介绍"><a href="#更多方法介绍" class="headerlink" title="更多方法介绍"></a>更多方法介绍</h4><ul>
<li><p>面向锁</p>
<table>
<thead>
<tr>
<th><code>s.setblocking()</code></th>
<th>设置套接字的阻塞与非阻塞模式</th>
</tr>
</thead>
<tbody><tr>
<td><code>s.settimeout()</code></td>
<td>设置阻塞套接字操作的超时时间</td>
</tr>
<tr>
<td><code>s.gettimeout()</code></td>
<td>得到阻塞套接字操作的超时时间</td>
</tr>
</tbody></table>
</li>
<li><p>面向文件</p>
<table>
<thead>
<tr>
<th><code>s.fileno()</code></th>
<th>套接字的文件描述符</th>
</tr>
</thead>
<tbody><tr>
<td><code>s.makefile()</code></td>
<td>创建一个与该套接字相关的文件</td>
</tr>
</tbody></table>
</li>
</ul>
<p>官方文档对socket模块下的<code>socket.send()</code>和<code>socket.sendall()</code>解释如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">socket.send(string[, flags]):</span><br><span class="line"><span class="string">'''Send data to the socket. The socket must be connected to a remote socket.</span></span><br><span class="line"><span class="string">The optional flags argument has the same meaning as for recv() above. </span></span><br><span class="line"><span class="string">Returns the number of bytes sent. </span></span><br><span class="line"><span class="string">Applications are responsible for checking that all data has been sent; </span></span><br><span class="line"><span class="string">if only some of the data was transmitted, </span></span><br><span class="line"><span class="string">the application needs to attempt delivery of the remaining data.</span></span><br><span class="line"><span class="string">send()的返回值是发送的字节数量，这个数量值可能小于要发送的string的字节数，</span></span><br><span class="line"><span class="string">也就是说可能无法发送string中所有的数据。如果有错误则会抛出异常。'''</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">socket.sendall(string[, flags]):</span><br><span class="line"><span class="string">'''Send data to the socket. </span></span><br><span class="line"><span class="string">The socket must be connected to a remote socket. </span></span><br><span class="line"><span class="string">The optional flags argument has the same meaning as for recv() above. </span></span><br><span class="line"><span class="string">Unlike send(), this method continues to send data </span></span><br><span class="line"><span class="string">from string until either all data has been sent or an error occurs. </span></span><br><span class="line"><span class="string">None is returned on success. </span></span><br><span class="line"><span class="string">On error, an exception is raised, </span></span><br><span class="line"><span class="string">and there is no way to determine how much data, </span></span><br><span class="line"><span class="string">if any, was successfully sent.</span></span><br><span class="line"><span class="string">尝试发送string的所有数据，成功则返回None，失败则抛出异常。</span></span><br><span class="line"><span class="string">故，下面两段代码是等价的：'''</span></span><br><span class="line"><span class="comment">#sock.sendall('Hello world\n')</span></span><br><span class="line"><span class="comment">#buffer = 'Hello world\n'</span></span><br><span class="line"><span class="comment">#while buffer:</span></span><br><span class="line"><span class="comment">#    bytes = sock.send(buffer)</span></span><br><span class="line"><span class="comment">#    buffer = buffer[bytes:]</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div>

<h3 id="socketserver模块"><a href="#socketserver模块" class="headerlink" title="socketserver模块"></a>socketserver模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/socketserver.html" target="_blank" rel="noopener"><code>socketserver</code></a>模块使一个server端可以同时和多个client端连接（多线程)</p>
<p>与只使用socket时<code>conn,addr = sk.accept()</code>相同的是<br>继承<code>socketserver.BaseRequestHandler</code>之后<br><code>self.request</code> 就相当于conn<br><code>self.client_address</code> 就相当于addr</p>
<h4 id="server端-2"><a href="#server端-2" class="headerlink" title="server端"></a>server端</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myserver</span><span class="params">(socketserver.BaseRequestHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.data = self.request.recv(<span class="number">1024</span>).strip()</span><br><span class="line">        print(<span class="string">"&#123;&#125; wrote:"</span>.format(self.client_address[<span class="number">0</span>]))</span><br><span class="line">        print(self.data)</span><br><span class="line">        self.request.sendall(self.data.upper())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    HOST, PORT = <span class="string">"127.0.0.1"</span>, <span class="number">9999</span></span><br><span class="line">    <span class="comment"># 设置allow_reuse_address允许服务器重用地址</span></span><br><span class="line">    socketserver.TCPServer.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    <span class="comment"># 创建一个server, 将服务地址绑定到127.0.0.1:9999</span></span><br><span class="line">    server = socketserver.TCPServer((HOST, PORT),Myserver)</span><br><span class="line">    <span class="comment"># 让server永远运行下去，除非强制停止程序</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure></div>

<h4 id="client端-2"><a href="#client端-2" class="headerlink" title="client端"></a>client端</h4><p>就是最前面的基于TCP的套接字的C端，这里使用with上下文管理的写法</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">HOST, PORT = <span class="string">"127.0.0.1"</span>, <span class="number">9999</span></span><br><span class="line">data = <span class="string">"hello"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> sock:</span><br><span class="line">    sock.connect((HOST, PORT))</span><br><span class="line">    sock.sendall(bytes(data + <span class="string">"\n"</span>, <span class="string">"utf-8"</span>))</span><br><span class="line">    received = str(sock.recv(<span class="number">1024</span>), <span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Sent:     &#123;&#125;"</span>.format(data))</span><br><span class="line">print(<span class="string">"Received: &#123;&#125;"</span>.format(received))</span><br></pre></td></tr></table></figure></div>

<h3 id="黏包"><a href="#黏包" class="headerlink" title="黏包"></a>黏包</h3><p>现象 : 同时执行多条命令之后，得到的结果很可能只有一部分，在执行其他命令的时候又接收到之前执行的另外一部分结果，这种显现就是黏包。</p>
<h4 id="黏包成因"><a href="#黏包成因" class="headerlink" title="黏包成因"></a>黏包成因</h4><ul>
<li>TCP协议的拆包机制<br>当发送端缓冲区的长度大于网卡的MTU时TCP会将这次发送的数据拆成几个数据包发送出去。</li>
<li>面向流的通信特点和Nagle算法<br>Nagle算法优化后将多次间隔较小且数据量小的数据，合并成一个大的数据块，然后进行封包。</li>
</ul>
<p><img src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAAAAD/4QMqaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjUtYzAxNCA3OS4xNTE0ODEsIDIwMTMvMDMvMTMtMTI6MDk6MTUgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QUUyMEZGNjM5N0MyMTFFOTlCODhDNjc0NTEzNTdGRjEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QUUyMEZGNjQ5N0MyMTFFOTlCODhDNjc0NTEzNTdGRjEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBRTIwRkY2MTk3QzIxMUU5OUI4OEM2NzQ1MTM1N0ZGMSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBRTIwRkY2Mjk3QzIxMUU5OUI4OEM2NzQ1MTM1N0ZGMSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/uAA5BZG9iZQBkwAAAAAH/2wCEABsaGikdKUEmJkFCLy8vQkc/Pj4/R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0cBHSkpNCY0PygoP0c/NT9HR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR//AABEIARIBtQMBIgACEQEDEQH/xACAAAEBAQEBAQEAAAAAAAAAAAAABQQDAgEGAQEAAAAAAAAAAAAAAAAAAAAAEAACAQIDAggJCgcAAgMAAAAAAQIRAyESBDEUQVFh0SKSE1NxgZHB4TJSMwWhsUJyorJDY3MV8GLCI4OjRCQ08YLiEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA5Tv27bpOUYvlaR43ux3kOtHnA0Az73Y7yHWjzje7HeQ60ecDQDPvdjvIdaPON7sd5DrR5wNAM+92O8h1o843ux3kOtHnA0Az73Y7yHWjzje7HeQ60ecDQDPvdjvIdaPON7sd5DrR5wNAM+92O8h1o853TTVVimB9AAAAAAAAAAAAAAAAAAAAAAAABwlqbMXRzgmuDMuc+b3Y7yHWjzgaAZ97sd5DrR5xvdjvIdaPOBoBn3ux3kOtHnG92O8h1o84GgGfe7HeQ60ecb3Y7yHWjzgaAZ97sd5DrR5xvdjvIdaPOBoBn3ux3kOtHnG92O8h1o84GgHCOpsydFODb4FJc53AAAAAAAAAAAAAAJs7cbmspNKS7HhVfpmrdLHdw6seYz/8Ab/h/rKAGfdLHdw6seYbpY7uHVjzGgAZ90sd3Dqx5hulju4dWPMaABn3Sx3cOrHmG6WO7h1Y8xoAGfdLHdw6seYbpY7uHVjzGgAZ90sd3Dqx5hulju4dWPMaABg1WlsxszahBNQl9FcT5DvpPcW/qR+6hq/cXPqS+6xpPcW/qR+6gNAAAAAAAAAAAAAAAAAAAAAAAAJejsW7juucYyfbT2pPiNm6WO7h1Y8xn0H4v60/MUAM+6WO7h1Y8w3Sx3cOrHmNAAz7pY7uHVjzDdLHdw6seY0ADPulju4dWPMN0sd3Dqx5jQAM+6WO7h1Y8w3Sx3cOrHmNAAz7pY7uHVjzDdLHdw6seY0ACXrLFu27ThGMX20NiS4yoT9f+F+tDzlAAAAAAAAAAAAAAAn/9v+H+soE//t/w/wBZQAAw6yeRxdcMegpOMpbPVpta9nhqeLs1nmrk5Qa9RJtVVNqS9Z5q4Y+ACieIzUm0vouj8NE/OYXNuUVfk7ayRe1xrP6WKpswoqnOEmr0lJuNvtNq4ZZIUUnwL53g+UKp4lcjFOTeEdvJhX5ibGdyV2jklLPsc36tdnZ5aYx2Sry14A1GK1Cq8zzOmZ7HCOOWtNuFacmzADbvVutOlXHDLKuFOCn8y8onqrcIdo60rTY61rR4PHAmTTjOVW4JZs2WTby0sV6UlXZj8h2cJQsxnVUo9tFJqTqlXJKrfDsqwNy1EHJQxUnsrGS+dHclWrM7UoL1HPB5ZZtka7JQdFhsUsKlUDPq/cXPqS+6xpPcW/qR+6hq/cXPqS+6xpPcW/qR+6gNAON3UW7PvJKP8cW06QmpxUo7JKq8YHoAAAAABxnfjCWV1rSuEZS219lPiZ8t6iF1pRrisyrGSqsMVVKu1AdwZnrLKaWeOPDmVPHie3ftpKTnGj2PMsacQHYGaGrsz+nFYtesuB04+Hg5DSAAAAAAAZ46q1KThmWZOlHh8+3xGgCfoPxf1p+YoE/Qfi/rT8xQAAwKdNQ41zV2JSfR6P0o7KPglxuhxt3KqDUpO85LPGr/APtWOyKXA6LgxAqN0PkJqcVKOKkqowwnGUpdpJq5mlSGZrDGnR2NUxrRnDTXJq1w9orS7OPA1l2rjlXbxbNmLCseJXYRSk5JRextqjMGncp1WZSi4YpXJSdePGMcvDgvIebbS00XCryqsmnVxaj0vWfRw4EsOBAbVq7LbWeOHKj1d1Fu168knStKqviqSoxlCikpOFaZa3VXM6JSzRUaY/ym+k5XpODUaRgnVOWPSfBKPGB2t37d31JKTpWiePkOxnjbudopzcWlGSwi1tcf5peyaAJ+v/C/Wh5ygT9f+F+tDzlAAAAAAAAAAAAAAAn/APb/AIf6ygT/APt/w/1lAAAAAB4uKsGuNMDm9RBRzY+rKVOHo+t5Do8tysXjR0fyPmIzpNdBRrJ7KQpF1hD2JcMq7dhv0NMjoqYp8HDGL+jGPA1wAdt2t1Taq1ji29tON4+qtuymB6jYtxo1FYbOSvFxeI6gDmrUIyc1FKT2uir5ToABn1fuLn1JfdZPen1F2xDsrmVZI9HZ9FfSWJQ1fuLn1JfdY0nuLf1I/dQH5W/or9rGcX4dvy85d09jUO1BxvZU4xouzi6YbKlUAT931Pf/AOuI3fU9/wD64lAAT931Pf8A+uI3fU9//riUABOdqcrj+m4wgm88rePS4IJ8fi4DlpE7fZylguxk/XlLu+B4R8C8xUjBRba2ydX83mOK01tcGGXLRttZcMKN04FXj4QOWnhejags0VSMfoPi+uc7jlYhlcu8nLKsaVcsKvo7afSxa8JRPjSeDAnJbvRRbi+FUzJxTSzNJrgaq1Rva4uh63fU9/8A64myFmFv1Ixj4EkdAJ+76nv/APXEbvqe/wD9cSgAJ+76nv8A/XEbvqe//wBcSgAPx13TXbl6cUnckpOskqehFXR6HVW9tzIvZ9b5NhcAE/4fsu176fmKBP0H4v60/MUAAAAHic1BOT2I9mXWNKGaSTUXWkqecDs7sU1Hhcsvjy5vmHRvQ44zXlTRGcatKOWSwVf7eOEFh/aeFZx4XgmV9O07UGtmVfN4gPm7WsHkimmngktjrwHWMVGtFtdWegAAAE/X/hfrQ85QJ+v/AAv1oecoAAAAAAAAAAAAAAE//t/w/wBZQJ//AG/4f6ygAAAA+NJqj2H0AeHbi2nTZs8qfzpCFuNuqiqVx83zYU4D2AAAAAADPq/cXPqS+6xpPcW/qR+6hq/cXPqS+6xpPcW/qR+6gNAAAAAAAAAAAAAAAAAAAAAAAAJ+g/F/Wn5igT9B+L+tPzFAAAAB8cU9qqfQBzdqDrVett+TyeqtnCk9p6jFRSisEsEegAAAAAAT9f8AhfrQ85QJ+v8Awv1oecoAAAAAAAAAAAAAAEy/OVnVdpknOPZZehGuOap73/8AKvdT0lAAT9//ACr3U9I3/wDKvdT0lAAT9/8Ayr3U9I3/APKvdT0lAATpfEoxpmt3VV0VYbXxbdp93/8AKvdT0jX/AIX60POUAJ+//lXup6Rv/wCVe6npKAAn7/8AlXup6Rv/AOVe6npKAAl39Y7luUFavVlFr1ONeE26aLjZgng1CNfIjuAAAAAAAAAAAAAAAAAAAAAAAAAJFi/LTSuRlbuyzXZSTjGqozvv/wCVe6npKAAn7/8AlXup6Rv/AOVe6npKAAn7/wDlXup6Rv8A+Ve6npKAAnfuUc2Xs7ualaZMacdK7D7v/wCVe6npPv8A2/4f6zeBP3/8q91PSN//ACr3U9JQAE/f/wAq91PSN/8Ayr3U9JQAEi/flqJW4xt3Y5bsZNyjRURXAAAAAAAAAAAAAAAAAAAAAAAJ+v8Awv1oecoE/X/hfrQ85QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnv/3V+j/WUCe//cX6T+8UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACXr79tu2lKNY3oVxWFK1rxUKMLkbirBqS5HU/LfFbPZ321sn0uf5S/8Os9jYiuF9J+P0AbQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+NpKr2IDBL/3I/pP7xQJMtTa3qM88cvZtVqqbSpGSms0XVPhA9AAAAAAAAAAAAAAAAAAAAAABmv6mNmkaOc5erFbXzLlA0gwqGquYuUbS4orM/G3h5Bu19bLzrywiwNx5lOMFWTSXKT53dXb6LhG43hGcdi+sv4R7hoIPpX32s+OWzxR2UAyfEHY1LhScejLHFeq9pXhOM1WDTXIeN2tbMkafVRnn8Pt1zWv7U+OPnWygG4GTS35TzW7mFy26SpsfFJeE1gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADxOcYKsmorldAPZ8argzPvljZ2kOsjvGSkqxdVyAfjbuncL7srbmovHsP2MIKEVFbIqnkI19xerjctp3XFdKMV9LFKr2f/Bt7fVPFWkvDNAbwT9+lb9/blbXtLpR8bRuhNTSlF1T4UB6AAAAAAAAAAAAAAAAAAHmUlFOT2JVMWghmi78/Xu4+CPAlyH3W36RdmKzXLiaUVy4VfEjTYtu3bjB7YxS8iA6gAAAAAAAx3tBZvTzzVXSm1r5jn+22Y+7zW3xxk/PUoADBbu3LE1avPMpepPZV+zLl4uM3mXW289mXGlmXhjijrZn2kIz9qKflQHUAAAAAAAAAAAAAAAAAAAAAAAAAAAABhvX5zn2Fj1tspcEV55M9Q0NqPSmu0l7U+l6Dn8N6Vt3XtuSlJ+WhQA5OxbeDjGn1UZLnw6DxtN2W9uXY14CgAOVmzCzFQgqJHUAD5tJbluV5qMZStXFXLFVpLk8JVAGD9xivXhdguOUMPOarV6F5ZrbUlyHUn6mz2X/kWVSUcZJbJx4a8vEwKAPEJqcVKOySqj2AAAAAAAAAAAA8TmoRcnsim/Iezndh2kJQ9pNeVAZNBbbj28/eXcfAuBLkobzHoLmeyovCVvoSXE44GwAAAMz1KTaScnWmFMeN4tYJ9Hwny3qlOryySST2ZtuzCNfRwk7UW6Zlgs0s2MEl0frbeLYszlto2IJq3ccZJSUXRZIwlRLGqWK4l5aVoBRhq4TVUp0+pPHlwiaIyU1VV8aa+R0ZO1GlzSjH+3Scqe7xooyaxzfy0wy+Y32oOEVF0w4lReSr+cDoAAM+rlkszf8AK/mPuljlswT4Ix+Yy/En0Iwfq3JxjJ8hzvfF7NrCNZteJfLzAVQfm/3i5O5GtIQzLNwulcfk4kVP3TTe39mXMBQBP/dNN7f2Zcw/dNN7f2ZcwFAE/wDdNN7f2Zcw/dNN7f2ZcwFAE/8AdNN7f2Zcx9WtjeajYkm3KjbjLDoyls6Ps8YG8EtX7iV2SnCWSsqZZY5YpYdPBVTXDjXwHueqlC5cTcYqEY0xcuF/R6OLVK44YbQKIJ9i9OVc04USq3lwT9nNnxy7Xhs4Uc+3uynWLTil7Esa0xUc/Sy0Wz2sEwKgMD+IWbeFyabePRjL/wDWPj8R8/dNN7f2ZcwFAE/9003t/ZlzD9003t/ZlzAUAT/3TTe39mXMP3TTe39mXMBQBP8A3TTe39mXMSl8YuQm9k4VdOB0rh/DQH6Un6i7O9Pd7Lo/pz9lcS/mf8cnOx8Ws3cJVg/L8x0+GKtrtH61yUpPy0A12bMbEFbhsidQAABO1GonCU9sVFLGsdnJX6UtlHwLDFgUQS7N+TnRz4JbXbfgqoyTwjt5eJI+q9fUe0dHCWKeVUpwbbsXjtpjt8QFMHGxKc4Zp4N8GXL5Vml8/iOwA+NVwZ9OV652UJTf0U2Bm+Gv/wAeK4sy8kmbjJoIdnYgntpXy4+c1gAAAAAAAAAAAAAGC/Znan29hVf04e0uT+Zfxy6LGohqI5oeNcKfEzuT7P8Ab1VyPeRjNeLB/KBQAAHwOKkqNVTPoA8ZI5s9Fm46Y+U9gAAABj+IQzaefIs3kxPbs29TBSuRUsyT5fLtOfxCeWxLjl0V4XgarcckFH2Ul5AJv7RbjcjcttxyyUqbVg6+H5yqAAAAAAADhfs9rlT2RlV4tYZZLg8J3AGPU6ftIKEIx2NJ1ay1VMKJ18GB5uWJKUpQT6SjsarXNPNi9mEljxbDcAMFvTTg69HGLS/k8HtV+k3Rt8mz67F2LeRrHZJydV0Yx2ZWpbM2L2m4Ac7cMiaq2q4V4OQ6AAAAAAAAkr4Rbc3O43LM26bFi/KVgBxtae3ZwtxUf44zJZlut12ZYQuPNbfh2x5iicb9iF+OSaw+blQHYGDTXLkLj09x58sc0ZcLjWmPKbwBivaVzbksvS2qlG1xZsX5OA2gDBY0rtvpKEk1Sqw+SlJY7XVeA8PSp27cXbTn/bzSpHDLlrV7XgmsK+QpADxC3G2qQSiuRUPYAAxfEYOenmlwKvkxNp4mk4tPZRgfLU1cgpLZJJnQxfDnXTwrxedm0AAAAAAAAAAAAAAGPVWJTy3bXvLezlXDF+E2ADLY1cL3R9Wa2wlg1zmo43dPbve8ipfxx7TP+22OFOnFmlT5wPt34hZtSUHKrbphjTw8RtOC01qMHbUUovauMyqxqNPhZkpw9me1eCS84FE8TmoRcpOiWLMXa6t4dnFcucLSXLzT1Mk0voRwj4+FgIfE7EvWbhX2lTnXynuXxGwtksz4o1bNbimqNYCMIx2JLwAYIW56q4rt1ZIQxhB7W/al5l/DogAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE/VPsb0L79X3cuSuz5SgeLkI3IuElVPaYoq/peil21tbPbjyfzfOBQBh3+PsXa8WRnOd3VXl/Zh2S457XyUxp4wKQMun1cLyo+jcXrQe1M1AAZtRqoWF0nWXBFes/EZoLW0zNwebHLLDLyVXnApGPXXuztNL159GK5XzHjPq5YKNuPK238x7s6TLPtbsu0ucfBH6qA72LfZW4w9lJHUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADPe0tq/7yKb4+Hyoz/tsPauU4s5QAGazo7Vh1hHHjeL8rNIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH//Z" alt="img"></p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>思路：制作报头，提前让接收端知晓自己将要发送的字节流总大小</p>
<p>让发送端在发送数据前，发送<strong>固定长度</strong>的报头，然后接收端循环接收完所有数据。</p>
<h3 id="struct模块"><a href="#struct模块" class="headerlink" title="struct模块"></a>struct模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/struct.html" target="_blank" rel="noopener"><code>struct</code></a>可以把以下类型转成固定长度的bytes</p>
<table>
<thead>
<tr>
<th>Format</th>
<th>C Type</th>
<th>Python type</th>
<th>Standard size</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td>x</td>
<td>pad byte</td>
<td>no value</td>
<td></td>
<td></td>
</tr>
<tr>
<td>c</td>
<td>char</td>
<td>string of length 1</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>b</td>
<td>signed char</td>
<td>integer</td>
<td>1</td>
<td>(3)</td>
</tr>
<tr>
<td>B</td>
<td>unsigned char</td>
<td>integer</td>
<td>1</td>
<td>(3)</td>
</tr>
<tr>
<td>?</td>
<td>_Bool</td>
<td>bool</td>
<td>1</td>
<td>(1)</td>
</tr>
<tr>
<td>h</td>
<td>short</td>
<td>integer</td>
<td>2</td>
<td>(3)</td>
</tr>
<tr>
<td>H</td>
<td>unsigned short</td>
<td>integer</td>
<td>2</td>
<td>(3)</td>
</tr>
<tr>
<td>i</td>
<td>int</td>
<td>integer</td>
<td>4</td>
<td>(3)</td>
</tr>
<tr>
<td>I</td>
<td>unsigned int</td>
<td>integer</td>
<td>4</td>
<td>(3)</td>
</tr>
<tr>
<td>l</td>
<td>long</td>
<td>integer</td>
<td>4</td>
<td>(3)</td>
</tr>
<tr>
<td>L</td>
<td>unsigned long</td>
<td>integer</td>
<td>4</td>
<td>(3)</td>
</tr>
<tr>
<td>q</td>
<td>long long</td>
<td>integer</td>
<td>8</td>
<td>(2)(3)</td>
</tr>
<tr>
<td>Q</td>
<td>unsigned long long</td>
<td>integer</td>
<td>8</td>
<td>(2)(3)</td>
</tr>
<tr>
<td>f</td>
<td>float</td>
<td>float</td>
<td>4</td>
<td>(4)</td>
</tr>
<tr>
<td>d</td>
<td>double</td>
<td>float</td>
<td>8</td>
<td>(4)</td>
</tr>
<tr>
<td>s</td>
<td>char[]</td>
<td>string</td>
<td></td>
<td></td>
</tr>
<tr>
<td>P</td>
<td>char[]</td>
<td>string</td>
<td></td>
<td></td>
</tr>
<tr>
<td>p</td>
<td>void *</td>
<td>integer</td>
<td></td>
<td>(5)(3)</td>
</tr>
</tbody></table>
<ul>
<li><code>struct.pack()</code></li>
<li><code>struct.unpack()</code></li>
</ul>
<p><code>.pack()</code>和<code>.unpack()</code>的参数一样：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">'i'</span>,<span class="number">1111111111111</span>)</span><br><span class="line"></span><br><span class="line">struct.error: <span class="string">'i'</span> format requires <span class="number">-2147483648</span> &lt;= number &lt;= <span class="number">2147483647</span> <span class="comment">#这个是范围</span></span><br></pre></td></tr></table></figure></div>

<p><code>.unpack()</code>将返回一个元组。</p>
<h5 id="使用struct自制报头"><a href="#使用struct自制报头" class="headerlink" title="使用struct自制报头"></a>使用struct自制报头</h5><p>以远程终端功能（雾）为例：</p>
<p>服务端（自定制报头）</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket, struct, os, subprocess</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>, <span class="number">8080</span>))</span><br><span class="line">s.listen()</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    cmd = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    cd = cmd.split(<span class="string">b'cd '</span>)</span><br><span class="line">    <span class="keyword">if</span> len(cd) == <span class="number">2</span>:</span><br><span class="line">        os.chdir(str(cd[<span class="number">-1</span>].strip(), <span class="string">'utf-8'</span>))</span><br><span class="line">    print(<span class="string">'cmd: %s'</span> % cmd)</span><br><span class="line">    res = subprocess.Popen(cmd.decode(<span class="string">'utf-8'</span>),</span><br><span class="line">                           shell=<span class="literal">True</span>,</span><br><span class="line">                           stdout=subprocess.PIPE,</span><br><span class="line">                           stderr=subprocess.PIPE)</span><br><span class="line">    back_msg = res.stderr.read() <span class="keyword">or</span> res.stdout.read()</span><br><span class="line">    conn.send(struct.pack(<span class="string">'i'</span>, len(back_msg)))  <span class="comment">#先发报头：back_msg的长度</span></span><br><span class="line">    conn.sendall(back_msg)  <span class="comment">#再发真实的内容</span></span><br><span class="line">conn.close()</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure></div>

<p>客户端（自定制报头）</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket, struct</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">res = s.connect_ex((<span class="string">'127.0.0.1'</span>, <span class="number">8080</span>))</span><br><span class="line">res <span class="keyword">and</span> print(res)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    msg = input(<span class="string">'&gt;&gt;&gt; '</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> len(msg) == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> msg == <span class="string">':q'</span>: <span class="keyword">break</span></span><br><span class="line">    s.send(msg.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    data_len = struct.unpack(<span class="string">'i'</span>, s.recv(<span class="number">4</span>))[<span class="number">0</span>]  <span class="comment">#接收报头</span></span><br><span class="line">    now_len = <span class="number">0</span></span><br><span class="line">    all_data = <span class="string">b''</span></span><br><span class="line">    <span class="keyword">while</span> now_len &lt; data_len:</span><br><span class="line">        now_data = s.recv(<span class="number">1024</span>)</span><br><span class="line">        all_data += now_data</span><br><span class="line">        now_len += len(now_data)</span><br><span class="line">    print(all_data.decode(<span class="string">'gbk'</span>))  <span class="comment">#windows默认gbk编码</span></span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure></div>

<p>自此，黏包问题被完美解决。事实上，应用层的协议（FTP等）本质上就是定制的稍微复杂一点的报头。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(三十一)</title>
    <url>/Python/Python_id_49.html</url>
    <content><![CDATA[<h2 id="系统有关模块"><a href="#系统有关模块" class="headerlink" title="系统有关模块"></a>系统有关模块</h2><h3 id="sys模块"><a href="#sys模块" class="headerlink" title="sys模块"></a>sys模块</h3><blockquote>
<p><a href="https://docs.python.org/zh-cn/3/library/sys.html" target="_blank" rel="noopener"><code>sys</code></a>模块是与python解释器交互的一个接口</p>
</blockquote>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">sys.argv           <span class="comment">#命令行参数List，第一个元素是程序本身路径</span></span><br><span class="line">sys.exit(n)        <span class="comment">#退出程序，正常退出时exit(0),错误退出sys.exit(1)</span></span><br><span class="line">sys.version        <span class="comment">#获取Python解释程序的版本信息</span></span><br><span class="line">sys.path           <span class="comment">#返回模块的搜索路径，初始化时使用PYTHONPATH环境变量的值</span></span><br><span class="line">sys.platform       <span class="comment">#返回操作系统平台名称</span></span><br></pre></td></tr></table></figure></div>

<p>试图错误退出</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> SystemExit <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure></div>

<h4 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="LUA"><figure class="iseeu highlight /lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">'hello'</span>)`的本质是`sys.<span class="built_in">stdout</span>.<span class="built_in">write</span>(<span class="string">'hello'</span>+<span class="string">'\n'</span>)`</span><br><span class="line">`sys.<span class="built_in">stdout</span>.<span class="built_in">flush</span>()`将缓冲区的内容强制打印</span><br><span class="line">在控制台打印字符进度条使用`sys.<span class="built_in">stdout</span>.<span class="built_in">flush</span>()`会更加平滑</span><br><span class="line">Windows系统的回车符`<span class="string">'\r'</span>`可以重写本行的内容，完成进度条的效果。</span><br><span class="line">打印异常则是`sys.<span class="built_in">stderr</span></span><br></pre></td></tr></table></figure></div>

<p>进度条例子：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment">#Compatible module of terminal color for Win7 and more</span></span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> init, Fore</span><br><span class="line">init(autoreset=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Colormsg</span><span class="params">(str)</span>:</span></span><br><span class="line">    <span class="string">'''带颜色的消息类 默认是白色'''</span></span><br><span class="line">    color = <span class="string">'WHITE'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, msg:str)</span>:</span></span><br><span class="line">        self._msg = msg</span><br><span class="line">        super().__init__()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_color</span><span class="params">(self, color: str)</span>:</span></span><br><span class="line">        <span class="string">'''设置colorama支持的字体前景色名 全部大写'''</span></span><br><span class="line">        self.color = color</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;getattr(Fore, self.color)&#125;</span><span class="subst">&#123;super().__str__()&#125;</span><span class="subst">&#123;Fore.RESET&#125;</span>'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proportion_bar</span><span class="params">(proportion: float, color: str)</span>:</span></span><br><span class="line">    <span class="string">'''直接在CMD中打印的进度条</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            proportion: 进度比 0-1</span></span><br><span class="line"><span class="string">            color: colorama支持的字体前景色名 全部大写</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    num = int(proportion * <span class="number">25</span>)</span><br><span class="line">    sys.stdout.write(<span class="string">'\r%s%s'</span> % (Colormsg(<span class="string">"█"</span> * num).set_color(color), <span class="string">"█"</span> *</span><br><span class="line">                                 (<span class="number">25</span> - num)))</span><br><span class="line">    sys.stdout.write(<span class="string">'\t%d%%'</span> % (<span class="number">100</span> * proportion))</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">'开始启动...'</span>)</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">101</span>):</span><br><span class="line">        time.sleep(<span class="number">0.02</span>)</span><br><span class="line">        proportion_bar(i / <span class="number">100</span>, <span class="string">'MAGENTA'</span>)</span><br><span class="line">    print(<span class="string">'\n启动完成。'</span>)</span><br><span class="line">    shell()</span><br></pre></td></tr></table></figure></div>

<h3 id="os模块"><a href="#os模块" class="headerlink" title="os模块"></a>os模块</h3><blockquote>
<p><a href="https://docs.python.org/zh-cn/3/library/os.html" target="_blank" rel="noopener"><code>os</code></a>模块是与操作系统交互的一个接口</p>
</blockquote>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">os.sep        <span class="comment">#输出操作系统特定的路径分隔符，win下为"\\",Linux下为"/"</span></span><br><span class="line">os.linesep    <span class="comment">#输出当前平台使用的行终止符，win下为"\r\n",Linux下为"\n"</span></span><br><span class="line">os.pathsep    <span class="comment">#输出用于分割文件路径的字符串 win下为;,Linux下为:</span></span><br><span class="line">os.name       <span class="comment">#输出字符串指示当前使用平台。win-&gt;'nt'; Linux-&gt;'posix'</span></span><br><span class="line">os.curdir     <span class="comment">#返回当前目录:"."</span></span><br><span class="line">os.pardir     <span class="comment">#获取当前目录的父目录字符串名:".."</span></span><br><span class="line">os.path       <span class="comment">#获取环境变量</span></span><br></pre></td></tr></table></figure></div>

<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">os.getcwd() <span class="comment">#获取工作目录 即当前python脚本工作的目录路径</span></span><br><span class="line">os.chdir(<span class="string">"dirname"</span>) <span class="comment">#改版当前脚本工作目录 相当于cd</span></span><br><span class="line">os.makedirs(<span class="string">'dirname1/dirname2'</span>)    <span class="comment">#可生成多层递归目录</span></span><br><span class="line">os.removedirs(<span class="string">'dirname1'</span>)    <span class="comment">#若目录为空，则删除，并递归到上一级目录，如若也为空，则删除，依此类推</span></span><br><span class="line">os.mkdir(<span class="string">'dirname'</span>)    <span class="comment">#生成单级目录；相当于shell中mkdir dirname</span></span><br><span class="line">os.rmdir(<span class="string">'dirname'</span>)    <span class="comment">#删除单级空目录，若目录不为空则无法删除，报错；相当于shell中rmdir dirname</span></span><br><span class="line">os.listdir(<span class="string">'dirname'</span>)    <span class="comment">#列出指定目录下的所有文件和子目录，包括隐藏文件，并以列表方式打印</span></span><br><span class="line">os.remove()  <span class="comment">#删除一个文件</span></span><br><span class="line">os.rename(<span class="string">"oldname"</span>,<span class="string">"newname"</span>)  <span class="comment">#重命名文件/目录</span></span><br><span class="line">os.stat(<span class="string">'path/filename'</span>)  <span class="comment">#获取文件/目录信息</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">	st_mode: inode 保护模式</span></span><br><span class="line"><span class="string">	st_ino: inode 节点号。</span></span><br><span class="line"><span class="string">	st_dev: inode 驻留的设备。</span></span><br><span class="line"><span class="string">	st_nlink: inode 的链接数。</span></span><br><span class="line"><span class="string">	st_uid: 所有者的用户ID。</span></span><br><span class="line"><span class="string">	st_gid: 所有者的组ID。</span></span><br><span class="line"><span class="string">	st_size: 普通文件以字节为单位的大小；包含等待某些特殊文件的数据。</span></span><br><span class="line"><span class="string">	st_atime: 上次访问的时间。</span></span><br><span class="line"><span class="string">	st_mtime: 最后一次修改的时间。</span></span><br><span class="line"><span class="string">	st_ctime: 由操作系统报告的"ctime"。在某些系统上（如Unix）是最新的元数据更改的时间，</span></span><br><span class="line"><span class="string">			在其它系统上（如Windows）是创建时间（详细信息参见平台的文档）。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">os.system(<span class="string">"bash command"</span>)  <span class="comment">#运行shell命令，直接显示</span></span><br><span class="line">os.popen(<span class="string">"bash command"</span>).read()  <span class="comment">#运行shell命令，获取执行结果</span></span><br><span class="line">os.getpid() <span class="comment">#获取当前进程PID</span></span><br><span class="line">os.getppid() <span class="comment">#获取父进程PID</span></span><br><span class="line">os.chdir(<span class="string">"dirname"</span>)  <span class="comment">#改变当前脚本工作目录；相当于shell下cd</span></span><br><span class="line">os.path.abspath(path) <span class="comment">#返回path规范化的绝对路径</span></span><br><span class="line">os.path.split(path) <span class="comment">#将path分割成目录和文件名二元组返回 </span></span><br><span class="line">os.path.dirname(path) <span class="comment">#返回path的目录。其实就是os.path.split(path)[0]</span></span><br><span class="line">os.path.basename(path) <span class="comment">#返回path最后的文件名。即os.path.split(path)[1]</span></span><br><span class="line">os.path.exists(path)  <span class="comment">#如果path存在，返回True；如果path不存在，返回False</span></span><br><span class="line">os.path.isabs(path)  <span class="comment">#如果path是绝对路径，返回True</span></span><br><span class="line">os.path.isfile(path)  <span class="comment">#如果path是一个存在的文件，返回True。否则返回False</span></span><br><span class="line">os.path.isdir(path)  <span class="comment">#如果path是一个存在的目录，则返回True。否则返回False</span></span><br><span class="line">os.path.join(path1[, path2[, ...]])  <span class="comment">#将多个路径组合后返回，第一个绝对路径之前的参数将被忽略</span></span><br><span class="line">os.path.getatime(path)  <span class="comment">#返回path所指向的文件或者目录的最后访问时间</span></span><br><span class="line">os.path.getmtime(path)  <span class="comment">#返回path所指向的文件或者目录的最后修改时间</span></span><br><span class="line">os.path.getsize(path) <span class="comment">#返回path的大小 文件夹固定4096不准确</span></span><br></pre></td></tr></table></figure></div>

<p>关于<strong>file</strong>的使用</p>
<p>不要直接使用<code>__file__</code>，因为它在shell、IDLE、Pycharm中的表示形式各不相同。</p>
<p>可以以<code>os.path.abspath(__file__)</code>的方式来使用</p>
<p>很多时候，特别是GUI程序，<code>os.popen</code>函数不推荐使用，而推荐使用subprocess模块的<code>popen</code></p>
<h3 id="subprocess模块"><a href="#subprocess模块" class="headerlink" title="subprocess模块"></a>subprocess模块</h3><p>subprocess模块是在python2.4版本中新增的，官方文档中描述为可以用来替换以下函数：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AUTOHOTKEY"><figure class="iseeu highlight /autohotkey"><table><tr><td class="code"><pre><span class="line">os.system`、`os.spawn`、`os.popen`、`popen2</span><br></pre></td></tr></table></figure></div>

<table>
<thead>
<tr>
<th>函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>subprocess.run()</td>
<td>Python 3.5中新增的函数。执行指定的命令，等待命令执行完成后返回一个包含执行结果的CompletedProcess类的实例。</td>
</tr>
<tr>
<td>subprocess.call()</td>
<td>执行指定的命令，返回命令执行状态，其功能类似于os.system(cmd)。</td>
</tr>
<tr>
<td>subprocess.check_call()</td>
<td>Python 2.5中新增的函数。 执行指定的命令，如果执行成功则返回状态码，否则抛出异常。其功能等价于subprocess.run(…, check=True)。</td>
</tr>
<tr>
<td>subprocess.check_output()</td>
<td>Python 2.7中新增的的函数。执行指定的命令，如果执行状态码为0则返回命令执行结果，否则抛出异常。</td>
</tr>
<tr>
<td>subprocess.getoutput(cmd)</td>
<td>接收字符串格式的命令，执行命令并返回执行结果，其功能类似于os.popen(cmd).read()和commands.getoutput(cmd)。</td>
</tr>
<tr>
<td>subprocess.getstatusoutput(cmd)</td>
<td>执行cmd命令，返回一个元组(命令执行状态, 命令执行结果输出)，其功能类似于commands.getstatusoutput()。</td>
</tr>
</tbody></table>
<h4 id="模块方法说明"><a href="#模块方法说明" class="headerlink" title="模块方法说明"></a>模块方法说明</h4><ol>
<li>在Python 3.5之后的版本中，官方文档中提倡通过<code>subprocess.run()</code>函数替代其他函数来使用subproccess模块的功能；</li>
<li>在Python 3.5之前的版本中，我们可以通过<code>subprocess.call()</code>，<code>subprocess.getoutput()</code>等上面列出的其他函数来使用subprocess模块的功能；</li>
<li><code>subprocess.run()</code>、<code>subprocess.call()</code>、<code>subprocess.check_call()</code>和<code>subprocess.check_output()</code>都是通过对<code>subprocess.Popen</code>的封装来实现的高级函数，因此如果我们需要更复杂功能时，可以通过<code>subprocess.Popen</code>来完成。</li>
<li><code>subprocess.getoutput()</code>和<code>subprocess.getstatusoutput()</code>函数是来自Python 2.x的commands模块的两个遗留函数。它们隐式的调用系统shell，并且不保证其他函数所具有的安全性和异常处理的一致性。另外，它们从Python 3.3.4开始才支持Windows平台。</li>
</ol>
<p>subprocess模块目的是<strong>启动一个新的进程并与之通信</strong>，最常用是定义类<code>Popen</code>，<br>使用<code>Popen</code>可以创建进程，并与进程进行复杂的交互。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = subprocess.Popen(<span class="string">'dir'</span>, stdout=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(p.stdout.read())</span><br></pre></td></tr></table></figure></div>

<h4 id="Popen类参数说明"><a href="#Popen类参数说明" class="headerlink" title="Popen类参数说明"></a><code>Popen</code>类参数说明</h4><ul>
<li>args 要执行的shell命令，可以是字符串，也可以是命令各个参数组成的序列。</li>
<li>bufsize 指定缓存策略，0不缓冲，1行缓冲，大于1表示缓冲区大小，负数表示系统默认。</li>
<li>stdin, stdout, stderr 程序标准输入、输出、错误句柄。</li>
<li>preexec_fn 指定一个将在子进程运行之前被调用的可执行对象，只在Unix平台下有效。</li>
<li>close_fds 除了0,1和2之外的所有文件描述符 是否在子进程执行之前关闭。</li>
<li>shell 是否使用shell作为要执行的程序，True时建议args参数是一个字符串</li>
<li>cwd 如果该参数值不是None，则该函数将会在执行这个子进程之前改变当前工作目录。</li>
<li>env 用于指定子进程的环境变量，默认从父进程中继承。</li>
<li>universal_newlines 是否将stdin，stdout和stderr作为文本流打开</li>
<li>startupinfo和creationflags 这两个参数只在Windows下有效，它们将被传递给底层的CreateProcess()函数，用于设置子进程的一些属性，如主窗口的外观，进程优先级等。</li>
</ul>
<p>使用python调用cmd中的python打印helloworld：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj = subprocess.Popen([<span class="string">"python"</span>], </span><br><span class="line">                           stdin=subprocess.PIPE, </span><br><span class="line">                           stdout=subprocess.PIPE, </span><br><span class="line">                           stderr=subprocess.PIPE)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>out,err = obj.communicate(input=<span class="string">'print("helloworld！") \n'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(out)</span><br><span class="line">helloworld！</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(err)</span><br></pre></td></tr></table></figure></div>

<h4 id="Popen类方法说明"><a href="#Popen类方法说明" class="headerlink" title="Popen类方法说明"></a><code>Popen</code>类方法说明</h4><table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Popen.poll()</td>
<td>用于检查子进程（命令）是否已经执行结束，没结束返回None，结束后返回状态码。</td>
</tr>
<tr>
<td>Popen.wait(timeout=None)</td>
<td>等待子进程结束，并返回状态码；如果在timeout指定的秒数之后进程还没有结束，将会抛出一个TimeoutExpired异常。</td>
</tr>
<tr>
<td>Popen.communicate(input=None, timeout=None)</td>
<td>该方法可用来与进程进行交互，比如发送数据到stdin，从stdout和stderr读取数据，直到到达文件末尾。</td>
</tr>
<tr>
<td>Popen.send_signal(signal)</td>
<td>发送指定的信号给这个子进程。</td>
</tr>
<tr>
<td>Popen.terminate()</td>
<td>停止该子进程。</td>
</tr>
<tr>
<td>Popen.kill()</td>
<td>杀死该子进程。</td>
</tr>
</tbody></table>
<p>其实例化对象可以用<code>.wait()</code>方法来等返回结果，否则不会阻塞。</p>
<p>设定一小时后关机</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = subprocess.Popen(<span class="string">"shutdown -s -t 3600"</span>, shell=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.wait()<span class="comment">#阻塞进程等待shell命令执行完毕</span></span><br></pre></td></tr></table></figure></div>

<p>子进程：【拒绝访问。(5)】的推荐解决办法</p>
<p>运行gpedit.msc：计算机配置—–&gt;windows设置—–&gt;安全设置—–&gt;本地策略—–&gt;安全选项—–&gt;用户帐户控制：用于内置管理员帐户的管理员批准模式—–&gt;禁用</p>
<p>家庭版：【找不到gpedit.msc】的推荐解决办法</p>
<p>使用DISM命令：部署映像服务和管理工具，win10家庭版批处理如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">pushd</span> <span class="string">"%~dp0"</span></span><br><span class="line">dir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientExtensions-Package~3*.mum &gt;List.txt</span><br><span class="line">dir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientTools-Package~3*.mum &gt;&gt;List.txt</span><br><span class="line"><span class="keyword">for</span> /f %%i <span class="keyword">in</span> (<span class="string">'findstr /i . List.txt 2^&gt;nul'</span>) <span class="keyword">do</span> dism /online /norestart /add-package:<span class="string">"C:\Windows\servicing\Packages\%%i"</span></span><br><span class="line">pause</span><br></pre></td></tr></table></figure></div>

<p>账户获取管理员权限</p>
<p>家庭版等Administrator账户是默认隐藏和关闭的，<br>不要使用命令<code>net user administrator /active:yes</code>去开启<br>应该运行netplwiz去修改组（重启）</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(三十)</title>
    <url>/Python/Python_id_48.html</url>
    <content><![CDATA[<h2 id="数学有关模块"><a href="#数学有关模块" class="headerlink" title="数学有关模块"></a>数学有关模块</h2><h3 id="random模块"><a href="#random模块" class="headerlink" title="random模块"></a>random模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/random.html" target="_blank" rel="noopener"><code>random</code></a>模块实现了各种分布的伪随机数生成器</p>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> random</span><br><span class="line"><span class="comment">#随机小数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.random()      <span class="comment"># 大于0且小于1之间的小数</span></span><br><span class="line"><span class="number">0.7664338663654585</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.uniform(<span class="number">1</span>,<span class="number">3</span>) <span class="comment">#大于1小于3的小数</span></span><br><span class="line"><span class="number">1.6270147180533838</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#随机整数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.randint(<span class="number">1</span>,<span class="number">5</span>)  <span class="comment"># 大于等于1且小于等于5之间的整数 左闭右闭</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.randrange(<span class="number">1</span>,<span class="number">10</span>,<span class="number">2</span>) <span class="comment"># 大于等于1且小于10之间的奇数 左闭右开</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#随机选择一个返回</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.choice([<span class="number">1</span>,<span class="string">'23'</span>,[<span class="number">4</span>,<span class="number">5</span>]])  <span class="comment"># #1或者23或者[4,5]</span></span><br><span class="line"><span class="comment">#随机选择多个返回，返回的个数为函数的第二个参数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.sample([<span class="number">1</span>,<span class="string">'23'</span>,[<span class="number">4</span>,<span class="number">5</span>]],<span class="number">2</span>) <span class="comment"># #列表元素任意2个组合</span></span><br><span class="line">[[<span class="number">4</span>, <span class="number">5</span>], <span class="string">'23'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#打乱列表顺序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>item=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.shuffle(item) <span class="comment"># 打乱次序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>item</span><br><span class="line">[<span class="number">5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random.shuffle(item)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>item</span><br><span class="line">[<span class="number">5</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure></div>

<h3 id="decimal模块"><a href="#decimal模块" class="headerlink" title="decimal模块"></a>decimal模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/decimal.html" target="_blank" rel="noopener"><code>decimal</code></a>模块提供十进制数据类型，并能界定精度，由数字的字面量精准生成。</p>
<h4 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0.1</span> + <span class="number">0.2</span></span><br><span class="line"><span class="number">0.30000000000000004</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="string">'0.1'</span>) + Decimal(<span class="string">'0.2'</span>)</span><br><span class="line">Decimal(<span class="string">'0.3'</span>)</span><br></pre></td></tr></table></figure></div>

<p>运算符%</p>
<p>和普通浮点运算略有区别，Decimal对象是取余运算而不是取模运算</p>
<p>使用数字字面量可以精准生成，也可以从数字生成，并来回转换</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="number">0.3</span>)</span><br><span class="line">Decimal(<span class="string">'0.299999999999999988897769753748434595763683319091796875'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal.from_float(<span class="number">0.3</span>) <span class="comment">#低版本python用</span></span><br><span class="line">Decimal(<span class="string">'0.299999999999999988897769753748434595763683319091796875'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(Decimal(<span class="number">0.3</span>))</span><br><span class="line"><span class="string">'0.299999999999999988897769753748434595763683319091796875'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>float(Decimal(<span class="number">0.3</span>))</span><br><span class="line"><span class="number">0.3</span></span><br></pre></td></tr></table></figure></div>

<p>其他运算方法：</p>
<ul>
<li><code>.sqrt()</code> 平方根</li>
<li><code>.exp()</code> 指数</li>
<li><code>.ln()</code> 自然对数</li>
<li><code>.log10()</code> 10 为底的对数</li>
</ul>
<h4 id="精度界定"><a href="#精度界定" class="headerlink" title="精度界定"></a>精度界定</h4><p><code>getcontext().prec</code>设置有效数字，默认有效数字为28位</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>getcontext().prec = <span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="number">1</span>) / Decimal(<span class="number">7</span>)</span><br><span class="line">Decimal(<span class="string">'0.142857'</span>)</span><br></pre></td></tr></table></figure></div>

<p><code>getcontext().rounding</code>设置取舍方式，包括：</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3/library/decimal.html#decimal.ROUND_CEILING" target="_blank" rel="noopener"><code>ROUND_CEILING</code></a> 向Infinity取舍</li>
<li><a href="https://docs.python.org/zh-cn/3/library/decimal.html#decimal.ROUND_DOWN" target="_blank" rel="noopener"><code>ROUND_DOWN</code></a> 向0取舍</li>
<li><a href="https://docs.python.org/zh-cn/3/library/decimal.html#decimal.ROUND_FLOOR" target="_blank" rel="noopener"><code>ROUND_FLOOR</code></a> 向-Infinity取舍</li>
<li><a href="https://docs.python.org/zh-cn/3/library/decimal.html#decimal.ROUND_HALF_DOWN" target="_blank" rel="noopener"><code>ROUND_HALF_DOWN</code></a> 半时向0取舍</li>
<li><a href="https://docs.python.org/zh-cn/3/library/decimal.html#decimal.ROUND_HALF_EVEN" target="_blank" rel="noopener"><code>ROUND_HALF_EVEN</code></a> 五舍六入 相当于内置函数<code>round()</code></li>
<li><a href="https://docs.python.org/zh-cn/3/library/decimal.html#decimal.ROUND_HALF_UP" target="_blank" rel="noopener"><code>ROUND_HALF_UP</code></a> 半时向0反方向取舍</li>
<li><a href="https://docs.python.org/zh-cn/3/library/decimal.html#decimal.ROUND_UP" target="_blank" rel="noopener"><code>ROUND_UP</code></a> 向0反方向取舍</li>
<li><a href="https://docs.python.org/zh-cn/3/library/decimal.html#decimal.ROUND_05UP" target="_blank" rel="noopener"><code>ROUND_05UP</code></a> 界定后是05则是10 否则是00</li>
</ul>
<p><code>.quantize()</code>舍入为固定指数</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="string">'7.325'</span>).quantize(Decimal(<span class="string">'.01'</span>), rounding=ROUND_DOWN)</span><br><span class="line">Decimal(<span class="string">'7.32'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="string">'7.325'</span>).quantize(Decimal(<span class="string">'1.'</span>), rounding=ROUND_UP)</span><br><span class="line">Decimal(<span class="string">'8'</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="math模块和cmath模块"><a href="#math模块和cmath模块" class="headerlink" title="math模块和cmath模块"></a>math模块和cmath模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/math.html" target="_blank" rel="noopener"><code>math</code></a>模块提供了对C标准定义的数学函数的访问，不适用于复数。</p>
<p>如果想得到复数结果请使用<a href="https://docs.python.org/zh-cn/3/library/cmath.html" target="_blank" rel="noopener">cmath</a>模块的同名方法</p>
<h4 id="常用数学常数"><a href="#常用数学常数" class="headerlink" title="常用数学常数"></a>常用数学常数</h4><ul>
<li><em>pi</em> 圆周率</li>
<li><em>e</em> 自然对数底数</li>
</ul>
<h4 id="常用数学函数"><a href="#常用数学函数" class="headerlink" title="常用数学函数"></a>常用数学函数</h4><ul>
<li><code>gcd</code>(<em>a</em>, <em>b</em>) 最大公约数</li>
<li><code>factorial</code>(<em>x</em>) 阶乘</li>
<li><code>sqrt</code>(<em>x</em>) 开平方</li>
<li><code>log</code>(<em>x</em>[, <em>base</em>]) 对数</li>
<li><code>pow</code>(<em>x</em>, <em>y</em>) 指数</li>
<li><code>cos</code>(<em>x</em>) 三角</li>
<li><code>asin</code>(<em>x</em>) 反三角</li>
<li><code>degrees</code>(<em>x</em>) <code>radians</code>(<em>x</em>) 角度弧度转化</li>
<li><code>ceil</code>(<em>x</em>) <code>floor</code>(<em>x</em>) 上下取整</li>
</ul>
<p><code>canonical</code>(<em>x</em>) 返回相同的 Decimal 对象 <em>x</em></p>
<h3 id="statistics模块"><a href="#statistics模块" class="headerlink" title="statistics模块"></a>statistics模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/statistics.html" target="_blank" rel="noopener"><code>statistics</code></a>模块用于数理统计，它主要提供了一个正态分布类 <a href="https://docs.python.org/zh-cn/3/library/statistics.html#statistics.NormalDist" target="_blank" rel="noopener"><code>NormalDist</code></a></p>
<h4 id="常用统计函数"><a href="#常用统计函数" class="headerlink" title="常用统计函数"></a>常用统计函数</h4><ul>
<li><code>mean()</code> <code>fmean()</code> 算术平均数 浮点数的算数平均数</li>
<li><code>median()</code> <code>median_low()</code> <code>median_high()</code> 中位数 低中位 高中位数</li>
<li><code>geometric_mean()</code> <code>harmonic_mean()</code> 几何平均数 调和平均数</li>
<li><code>stdev()</code> <code>variance()</code> 标准差 方差</li>
</ul>
<h3 id="NumPy模块"><a href="#NumPy模块" class="headerlink" title="NumPy模块"></a>NumPy模块</h3><p>第三方模块<a href="https://www.numpy.org.cn/alopecia/#预防脱发食物" target="_blank" rel="noopener"><code>NumPy</code></a>是使用Python进行科学计算的基础包。除了数学函数，随机数它包含如下的内容：</p>
<ul>
<li>一个强大的N维数组对象<code>.ndarray</code></li>
<li>复杂的（广播）功能<code>.ufunc</code></li>
<li>用于集成C / C ++和Fortran代码的工具</li>
<li>有用的线性代数<code>.linalg</code>，傅里叶变换<code>.fft</code></li>
</ul>
<p>除了明显的科学用途外，NumPy还可以用作通用数据的高效多维容器。可以定义任意数据类型。这使NumPy能够无缝快速地与各种数据库集成。</p>
<h4 id="绘制上帝指纹"><a href="#绘制上帝指纹" class="headerlink" title="绘制上帝指纹"></a>绘制上帝指纹</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mandelbrot</span><span class="params">(w, h=None, maxit=<span class="number">20</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Returns an image of the Mandelbrot fractal of size (h,w)."""</span></span><br><span class="line">    <span class="keyword">if</span> h <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        h = w</span><br><span class="line">    y, x = np.ogrid[<span class="number">-3</span>/<span class="number">2</span>:<span class="number">3</span>/<span class="number">2</span>:h * <span class="number">1j</span>, <span class="number">-15</span>/<span class="number">8</span>:<span class="number">9</span>/<span class="number">8</span>:w * <span class="number">1j</span>]  <span class="comment">#界定的复平面坐标系的横纵轴</span></span><br><span class="line">    c = x + y * <span class="number">1j</span>  <span class="comment">#界定的复平面坐标系矩阵</span></span><br><span class="line">    divtime = maxit + np.zeros(c.shape, dtype=int)  <span class="comment">#初始化的权重矩阵 = 轮数+零矩阵</span></span><br><span class="line">    z = c  <span class="comment">#初始化的用于迭代的复平面坐标系矩阵z</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(maxit):</span><br><span class="line">        z = z**<span class="number">2</span> + c  <span class="comment">#mandelbrot集合迭代公式</span></span><br><span class="line">        diverge = z * np.conj(z) &gt; <span class="number">2</span>**<span class="number">2</span>  <span class="comment">#计算本轮发散的布尔索引</span></span><br><span class="line">        div_now = diverge &amp; (divtime == maxit)  <span class="comment">#计算比上轮新增的布尔索引</span></span><br><span class="line">        divtime[div_now] = i  <span class="comment">#为新增的发散设置权重</span></span><br><span class="line">        z[diverge] = <span class="number">2</span>  <span class="comment">#为发散点的值赋值 简化后续运算</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">            这个值要大于根号2 如果不赋值 后续循环中将会溢出</span></span><br><span class="line"><span class="string">            RuntimeWarning: overflow encountered in multiply</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">    <span class="keyword">return</span> divtime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">w = int(input(<span class="string">"输入像素值"</span>))</span><br><span class="line">plt.imshow(mandelbrot(w))</span><br><span class="line"></span><br><span class="line">ax = plt.gca()</span><br><span class="line">ax.grid(<span class="literal">True</span>, linestyle=<span class="string">'-.'</span>)</span><br><span class="line">plt.yticks(np.mgrid[<span class="number">0</span>:w:<span class="number">9j</span>], np.mgrid[<span class="number">3</span>/<span class="number">2</span>:<span class="number">-3</span>/<span class="number">2</span>:<span class="number">9j</span>])</span><br><span class="line">plt.xticks(np.mgrid[<span class="number">0</span>:w:<span class="number">9j</span>], np.mgrid[<span class="number">-9</span>/<span class="number">4</span>:<span class="number">3</span>/<span class="number">4</span>:<span class="number">9j</span>])</span><br><span class="line">ax.spines[<span class="string">'bottom'</span>].set_position((<span class="string">'data'</span>, <span class="number">1</span> / <span class="number">2</span> * w))</span><br><span class="line">ax.spines[<span class="string">'left'</span>].set_position((<span class="string">'data'</span>, <span class="number">3</span> / <span class="number">4</span> * w))</span><br><span class="line">ax.spines[<span class="string">'bottom'</span>].set_color(<span class="string">'white'</span>)</span><br><span class="line">ax.spines[<span class="string">'left'</span>].set_color(<span class="string">'white'</span>)</span><br><span class="line">plt.tick_params(axis=<span class="string">'x'</span>, colors=<span class="string">'white'</span>)</span><br><span class="line">plt.tick_params(axis=<span class="string">'y'</span>, colors=<span class="string">'white'</span>)</span><br><span class="line">plt.savefig(<span class="string">'./mandelbrot.png'</span>, format=<span class="string">'png'</span>, transparent=<span class="literal">True</span>,</span><br><span class="line">            dpi=<span class="number">300</span>, pad_inches = <span class="number">0</span> ,bbox_inches = <span class="string">'tight'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></div>

<p>效果图</p>
<p><img src="/fcg22450.github.io/img/python_img/%E4%B8%8A%E5%B8%9D%E6%8C%87%E7%BA%B9.jpg" alt="上帝指纹"></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十八)</title>
    <url>/Python/Python_id_46.html</url>
    <content><![CDATA[<h2 id="正则有关模块"><a href="#正则有关模块" class="headerlink" title="正则有关模块"></a>正则有关模块</h2><p>本篇不会过多介绍正则表达式内容，可参考js篇的正则对象章节。</p>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><a id="more"></a>

<p>python不支持不定长的后行断言（逆序环视）</p>
<p>error: look-behind requires fixed-width pattern</p>
<blockquote>
<p>正则就是用一些具有特殊含义的符号组合到一起（称为正则表达式）来描述字符或者字符串的方法。或者说：正则就是用来描述一类事物的规则。（在Python中）它内嵌在Python中，并通过 re 模块实现。正则表达式模式被编译成一系列的字节码，然后由用 C 编写的匹配引擎执行。</p>
</blockquote>
<table>
<thead>
<tr>
<th>正则表达式</th>
<th>类型</th>
<th>匹配内容</th>
</tr>
</thead>
<tbody><tr>
<td><code>.</code></td>
<td>元字符</td>
<td>匹配除换行符以外的任意字符</td>
</tr>
<tr>
<td><code>\w</code></td>
<td>元字符</td>
<td>匹配字母或数字或下划线，大写即非数字字母下划线</td>
</tr>
<tr>
<td><code>\s</code></td>
<td>元字符</td>
<td>匹配任意的空白符，大写即非空字符</td>
</tr>
<tr>
<td><code>\d</code></td>
<td>元字符</td>
<td>匹配数字，大写即非数字</td>
</tr>
<tr>
<td><code>\n</code></td>
<td>元字符</td>
<td>匹配一个换行符，也属于<code>\s</code></td>
</tr>
<tr>
<td><code>\t</code></td>
<td>元字符</td>
<td>匹配一个制表符，也属于<code>\s</code></td>
</tr>
<tr>
<td><code>\b</code></td>
<td>元字符</td>
<td>匹配一个单词的边界</td>
</tr>
<tr>
<td><code>^</code></td>
<td>元字符</td>
<td>匹配字符串的开始</td>
</tr>
<tr>
<td><code>$</code></td>
<td>元字符</td>
<td>匹配字符串的结尾</td>
</tr>
<tr>
<td>`a</td>
<td>b`</td>
<td>逻辑</td>
</tr>
<tr>
<td><code>(...)</code></td>
<td>分组</td>
<td>匹配括号内的组，捕获</td>
</tr>
<tr>
<td><code>(?:...)</code></td>
<td>分组</td>
<td>匹配括号内的组，不捕获</td>
</tr>
<tr>
<td><code>(?...)</code></td>
<td>命名分组</td>
<td>匹配括号内的组，捕获并命名（python支持）</td>
</tr>
<tr>
<td><code>(?&gt;...)</code></td>
<td>固化分组</td>
<td>匹配过程中不交还括号内的组（python不支持）</td>
</tr>
<tr>
<td><code>[...]</code></td>
<td>字符集</td>
<td>匹配字符组中的字符</td>
</tr>
<tr>
<td><code>[^...]</code></td>
<td>字符集</td>
<td>匹配除了字符组中字符的所有字符</td>
</tr>
<tr>
<td><code>*</code></td>
<td>量词</td>
<td>贪婪匹配，重复零次或更多次</td>
</tr>
<tr>
<td><code>+</code></td>
<td>量词</td>
<td>贪婪匹配，重复一次或更多次</td>
</tr>
<tr>
<td><code>?</code></td>
<td>量词</td>
<td>贪婪匹配，重复零次或一次</td>
</tr>
<tr>
<td><code>{n}</code></td>
<td>量词</td>
<td>重复n次</td>
</tr>
<tr>
<td><code>{n,}</code></td>
<td>量词</td>
<td>重复n次或更多次</td>
</tr>
<tr>
<td><code>{n,m}</code></td>
<td>量词</td>
<td>重复n到m次</td>
</tr>
<tr>
<td><code>(?=pattern)</code></td>
<td>断言</td>
<td>后面有，断言也叫环视look-behind</td>
</tr>
<tr>
<td><code>(?!pattern)</code></td>
<td>断言</td>
<td>后面没有</td>
</tr>
<tr>
<td><code>(?&lt;=pattern)</code></td>
<td>断言</td>
<td>前面有（python不支持不定长逆序环视）</td>
</tr>
<tr>
<td>`(?</td>
<td>断言</td>
<td>前面没有（python不支持不定长逆序环视）</td>
</tr>
</tbody></table>
<p>注意</p>
<ul>
<li>python中正则表达式是不是真实字符串，需要二重转义，推荐使用真实字符串(<code>r&quot;&quot;</code>)</li>
<li>贪婪匹配会尽可能匹配，后面加?号使其变成惰性匹配，匹配尽可能少的。</li>
<li>断言（环视）的括号中的匹配到的内容只会用来判断不会被正则表达式捕获。</li>
</ul>
<h3 id="常用范围"><a href="#常用范围" class="headerlink" title="常用范围"></a>常用范围</h3><table>
<thead>
<tr>
<th>正则</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>[0-9]</code></td>
<td>和<code>[0123456789]</code>和<code>\d</code>是一个意思</td>
</tr>
<tr>
<td><code>[a-z]+</code></td>
<td>不定长的小写字母，尽可能多，一个以上</td>
</tr>
<tr>
<td><code>[A-Z]*?</code></td>
<td>不定长的大写字母，尽可能少，可以一个都没有</td>
</tr>
<tr>
<td><code>[0-9a-fA-F]</code></td>
<td>十六进制字符</td>
</tr>
<tr>
<td>`^.*(?=.jpg$</td>
<td>.png)`</td>
</tr>
<tr>
<td><code>^(?!-).*</code></td>
<td>不以<code>-</code>开头的行（<code>re.M</code>模式）</td>
</tr>
<tr>
<td><code>[a-z0-9_\.-]{3,15}@[a-z]{2,5}\.[a-z]{2,6}</code></td>
<td>Email</td>
</tr>
</tbody></table>
<h3 id="re模块"><a href="#re模块" class="headerlink" title="re模块"></a>re模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/re.html" target="_blank" rel="noopener"><code>re</code></a>模块提供了与 Perl 语言类似的正则表达式匹配操作</p>
<p>最常用方法</p>
<ul>
<li><code>re.findall(r,txt)</code> 查找所有满足匹配条件的结果,放在列表里</li>
<li><code>re.match(r,txt)</code> 匹配第一个然后返回一个包含匹配信息的对象</li>
<li><code>re.sub(r,s,txt)</code> 将所有满足匹配条件的替换成字符串s</li>
</ul>
<h4 id="模式flags"><a href="#模式flags" class="headerlink" title="模式flags"></a>模式<code>flags</code></h4><p>不同模式主要会改变<code>^</code>和<code>$</code>的匹配行为</p>
<ul>
<li><code>None</code> 首行模式，默认的</li>
<li><code>re.S</code> / <code>re.DOTALL</code>单行模式，整个文本看成以换行符连接在一起的一行</li>
<li><code>re.M</code> / <code>re.MULTILINE</code> 多行模式，每一行都有开头和结尾</li>
<li><code>re.I</code> 忽略大小写模式</li>
</ul>
<p>多模式可以直接相加</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">'''few.JPG</span></span><br><span class="line"><span class="string">oij.png</span></span><br><span class="line"><span class="string">ade.jpg</span></span><br><span class="line"><span class="string">ade.jpg.rename</span></span><br><span class="line"><span class="string">ytr.GIF</span></span><br><span class="line"><span class="string">pow.PNG'''</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">r'^.*(?=\.jpg$|\.png)'</span>, s, re.M+re.I)</span><br><span class="line">[<span class="string">'few'</span>, <span class="string">'oij'</span>, <span class="string">'ade'</span>, <span class="string">'pow'</span>]</span><br></pre></td></tr></table></figure></div>

<h4 id="分组"><a href="#分组" class="headerlink" title="分组(...)"></a>分组<code>(...)</code></h4><p>分组在某种程度上完全可以代替断言的功能。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">'(.*?)_sb'</span>, <span class="string">'alex_sb wusir_sb 日天_sb'</span>)</span><br><span class="line">[<span class="string">'alex'</span>, <span class="string">'wusir'</span>, <span class="string">'日天'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>HTML = <span class="string">'&lt;a href="http://www.baidu.com"&gt;点击&lt;/a&gt;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(re.findall(<span class="string">'href="(.*?)"'</span>, HTML))</span><br><span class="line">[<span class="string">'http://www.baidu.com'</span>]</span><br></pre></td></tr></table></figure></div>

<p>分组<code>()</code>中加入<code>?:</code> 表示整体，而不是只针对性捕获<code>()</code>里面的内容。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ret = re.findall(<span class="string">'www.(baidu|oldboy).com'</span>, <span class="string">'www.oldboy.com'</span>)</span><br><span class="line">print(ret)  <span class="comment"># ['oldboy']这是因为findall会优先把匹配结果组里内容返回,如果想要匹配结果,取消权限即可</span></span><br><span class="line"></span><br><span class="line">ret = re.findall(<span class="string">'www.(?:baidu|oldboy).com'</span>, <span class="string">'www.oldboy.com'</span>)</span><br><span class="line">print(ret)  <span class="comment"># ['www.oldboy.com']</span></span><br></pre></td></tr></table></figure></div>

<h4 id="常用方法用例"><a href="#常用方法用例" class="headerlink" title="常用方法用例"></a>常用方法用例</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ret = re.findall(<span class="string">'a'</span>, <span class="string">'eva egon yuan'</span>)  <span class="comment"># 返回所有满足匹配条件的结果,放在列表里</span></span><br><span class="line">print(ret) <span class="comment">#结果 : ['a', 'a']</span></span><br><span class="line"></span><br><span class="line">ret = re.search(<span class="string">'a'</span>, <span class="string">'eva egon yuan'</span>).group()</span><br><span class="line">print(ret) <span class="comment">#结果 : 'a'</span></span><br><span class="line"><span class="comment"># 函数会在字符串内查找模式匹配,只到找到第一个匹配然后返回一个包含匹配信息的对象,该对象可以</span></span><br><span class="line"><span class="comment"># 通过调用group()方法得到匹配的字符串,如果字符串没有匹配，则返回None。</span></span><br><span class="line"></span><br><span class="line">ret = re.match(<span class="string">'a'</span>, <span class="string">'abc'</span>).group()  <span class="comment"># 同search,不过尽在字符串开始处进行匹配</span></span><br><span class="line">print(ret) <span class="comment">#结果 : 'a'</span></span><br><span class="line"></span><br><span class="line">ret = re.split(<span class="string">'[ab]'</span>, <span class="string">'abcd'</span>)  <span class="comment"># 先按'a'分割得到''和'bcd',在对''和'bcd'分别按'b'分割</span></span><br><span class="line">print(ret)  <span class="comment"># ['', '', 'cd']</span></span><br><span class="line"></span><br><span class="line">ret = re.sub(<span class="string">'\d'</span>, <span class="string">'H'</span>, <span class="string">'eva3egon4yuan4'</span>, <span class="number">1</span>)<span class="comment">#将数字替换成'H'，参数1表示只替换1个</span></span><br><span class="line">print(ret) <span class="comment">#evaHegon4yuan4</span></span><br><span class="line"></span><br><span class="line">ret = re.subn(<span class="string">'\d'</span>, <span class="string">'H'</span>, <span class="string">'eva3egon4yuan4'</span>)<span class="comment">#将数字替换成'H'，返回元组(替换的结果,替换了多少次)</span></span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">obj = re.compile(<span class="string">'\d&#123;3&#125;'</span>)  <span class="comment">#将正则表达式编译成为一个 正则表达式对象，规则要匹配的是3个数字</span></span><br><span class="line">ret = obj.search(<span class="string">'abc123eeee'</span>) <span class="comment">#正则表达式对象调用search，参数为待匹配的字符串</span></span><br><span class="line">print(ret.group())  <span class="comment">#结果 ： 123</span></span><br><span class="line"></span><br><span class="line">ret = re.finditer(<span class="string">'\d'</span>, <span class="string">'ds3sy4784a'</span>)   <span class="comment">#finditer返回一个存放匹配结果的迭代器</span></span><br><span class="line">print(next(ret).group())  <span class="comment">#查看第一个结果</span></span><br><span class="line">print(next(ret).group())  <span class="comment">#查看第二个结果</span></span><br><span class="line">print([i.group() <span class="keyword">for</span> i <span class="keyword">in</span> ret])  <span class="comment">#查看剩余的左右结果</span></span><br></pre></td></tr></table></figure></div>

<h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><ul>
<li>多行模式(<code>MULTILINE</code>)中<code>match()</code>只匹配字符串的开始，但<code>search()</code>和以 <code>&#39;^&#39;</code> 开头的正则会每行匹配</li>
<li><code>split()</code>的优先级查询</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">ret=re.split(<span class="string">"\d+"</span>,<span class="string">"eva3egon4yuan"</span>)</span><br><span class="line">print(ret) <span class="comment">#结果 ： ['eva', 'egon', 'yuan']</span></span><br><span class="line"></span><br><span class="line">ret=re.split(<span class="string">"(\d+)"</span>,<span class="string">"eva3egon4yuan"</span>)</span><br><span class="line">print(ret) <span class="comment">#结果 ： ['eva', '3', 'egon', '4', 'yuan']</span></span><br></pre></td></tr></table></figure></div>

<p>在匹配部分加上<code>()</code>之后所切出的结果是不同的， 没有<code>()</code>的没有保留所匹配的项，但是有<code>()</code>的却能够保留了匹配的项， 这个在某些需要保留匹配部分的使用过程是非常重要的。</p>
<ul>
<li><code>.sub()</code>替换时可以接受函数（这同时是一个命名分组的例子）</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>size = <span class="string">'height165weight21deep213'</span> <span class="comment">#要求所有数字内容都加5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.sub(<span class="string">r'(?P&lt;num&gt;\d+)'</span>, <span class="keyword">lambda</span> x:str(int(x.group(<span class="string">"num"</span>))+<span class="number">5</span>), size)</span><br><span class="line"><span class="string">'height170weight26deep218'</span></span><br></pre></td></tr></table></figure></div>

<h3 id="regex模块"><a href="#regex模块" class="headerlink" title="regex模块"></a>regex模块</h3><p>Python自带了正则表达式引擎（内置的re模块），但是不支持一些高级特性，比如下面这几个：</p>
<ul>
<li>固化分组 Atomic grouping</li>
<li>占有优先量词 Possessive quantifiers</li>
<li>可变长度的逆序环视 Variable-length lookbehind</li>
<li>递归匹配 Recursive patterns</li>
<li>（起始/继续）位置锚\G Search anchor</li>
</ul>
<p>第三方模块regex实现了如上高级特效，且API与re模块一致。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十九)</title>
    <url>/Python/Python_id_47.html</url>
    <content><![CDATA[<h2 id="时间有关模块"><a href="#时间有关模块" class="headerlink" title="时间有关模块"></a>时间有关模块</h2><h3 id="timeit模块"><a href="#timeit模块" class="headerlink" title="timeit模块"></a>timeit模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/timeit.html" target="_blank" rel="noopener"><code>timeit</code></a>模块提供简单的方法来计算一小段 Python 代码的耗时。简单使用如下</p>
<p><code>timeit.timeit(eval/lambda, number=10000)</code> 运行10000次中的最快用时</p>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line">print(timeit.timeit(<span class="string">'test()'</span>, globals=globals()))</span><br></pre></td></tr></table></figure></div>

<h3 id="time模块"><a href="#time模块" class="headerlink" title="time模块"></a>time模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/time.html" target="_blank" rel="noopener"><code>time</code></a>模块提供了各种时间相关的底层函数。最常用方法有：</p>
<ul>
<li><code>time.sleep()</code> 线程睡眠，接收浮点秒数。</li>
<li><code>time.time()</code> 戳一个时间。</li>
</ul>
<h4 id="格式转换"><a href="#格式转换" class="headerlink" title="格式转换"></a>格式转换</h4><p>在Python中，通常有这三种方式来表示时间</p>
<ul>
<li>时间元组(struct_time)</li>
<li>时间戳(timestamp)</li>
<li>格式化时间(Format String)</li>
</ul>
<h5 id="时间戳-timestamp"><a href="#时间戳-timestamp" class="headerlink" title="时间戳(timestamp)"></a>时间戳(timestamp)</h5><p>形如：<code>1588218207.4545252</code></p>
<p>通常来说，时间戳表示的是从1970年1月1日00:00:00开始按秒计算的偏移量。</p>
<p>我们运行<code>time.time()</code>，返回的是当前时间戳，是float类型。</p>
<h5 id="格式化时间-Format-String"><a href="#格式化时间-Format-String" class="headerlink" title="格式化时间(Format String)"></a>格式化时间(Format String)</h5><p>形如：<code>&#39;2017-07-24 13:54:37&#39;</code></p>
<p>运行<code>time.strftime(&quot;%Y-%m-%d %H-%M-%S&quot;)</code>，返回当前格式化时间，参数中它支持以下指令</p>
<table>
<thead>
<tr>
<th align="left">指令</th>
<th align="left">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>%a</code></td>
<td align="left">本地化的缩写星期中每日的名称。</td>
</tr>
<tr>
<td align="left"><code>%A</code></td>
<td align="left">本地化的星期中每日的完整名称。</td>
</tr>
<tr>
<td align="left"><code>%b</code></td>
<td align="left">本地化的月缩写名称。</td>
</tr>
<tr>
<td align="left"><code>%B</code></td>
<td align="left">本地化的月完整名称。</td>
</tr>
<tr>
<td align="left"><code>%c</code></td>
<td align="left">本地化的适当日期和时间表示。</td>
</tr>
<tr>
<td align="left"><code>%d</code></td>
<td align="left">十进制数 [01,31] 表示的月中日。</td>
</tr>
<tr>
<td align="left"><code>%H</code></td>
<td align="left">十进制数 [00,23] 表示的小时（24小时制）。</td>
</tr>
<tr>
<td align="left"><code>%I</code></td>
<td align="left">十进制数 [01,12] 表示的小时（12小时制）。</td>
</tr>
<tr>
<td align="left"><code>%j</code></td>
<td align="left">十进制数 [001,366] 表示的年中日。</td>
</tr>
<tr>
<td align="left"><code>%m</code></td>
<td align="left">十进制数 [01,12] 表示的月。</td>
</tr>
<tr>
<td align="left"><code>%M</code></td>
<td align="left">十进制数 [00,59] 表示的分钟。</td>
</tr>
<tr>
<td align="left"><code>%p</code></td>
<td align="left">本地化的 AM 或 PM 。</td>
</tr>
<tr>
<td align="left"><code>%S</code></td>
<td align="left">十进制数 [00,61] 表示的秒。</td>
</tr>
<tr>
<td align="left"><code>%U</code></td>
<td align="left">十进制数 [00,53] 表示的一年中的周数（星期日作为一周的第一天）。在第一个星期日之前的新年中的所有日子都被认为是在第0周。</td>
</tr>
<tr>
<td align="left"><code>%w</code></td>
<td align="left">十进制数 [0(<strong>星期日</strong>),6] 表示的周中日。</td>
</tr>
<tr>
<td align="left"><code>%W</code></td>
<td align="left">十进制数 [00,53] 表示的一年中的周数（星期一作为一周的第一天）。在第一个星期一之前的新年中的所有日子被认为是在第0周。</td>
</tr>
<tr>
<td align="left"><code>%x</code></td>
<td align="left">本地化的适当日期表示。</td>
</tr>
<tr>
<td align="left"><code>%X</code></td>
<td align="left">本地化的适当时间表示。</td>
</tr>
<tr>
<td align="left"><code>%y</code></td>
<td align="left">十进制数 [00,99] 表示的没有世纪的年份。</td>
</tr>
<tr>
<td align="left"><code>%Y</code></td>
<td align="left">十进制数表示的带世纪的年份。</td>
</tr>
<tr>
<td align="left"><code>%z</code></td>
<td align="left">时区偏移以格式 +HHMM 或 -HHMM 形式的 UTC/GMT 的正或负时差指示，其中H表示十进制小时数字，M表示小数分钟数字 [-23:59, +23:59] 。</td>
</tr>
<tr>
<td align="left"><code>%Z</code></td>
<td align="left">时区名称（如果不存在时区，则不包含字符）。</td>
</tr>
<tr>
<td align="left"><code>%%</code></td>
<td align="left">字面的 <code>&#39;%&#39;</code> 字符。</td>
</tr>
</tbody></table>
<h5 id="struct-time"><a href="#struct-time" class="headerlink" title="struct_time"></a>struct_time</h5><p>struct_time元组共有9个元素共九个元素:(年，月，日，时，分，秒，一年中第几周，一年中第几天等）</p>
<table>
<thead>
<tr>
<th>索引（Index）</th>
<th>属性（Attribute）</th>
<th>值（Values）</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>tm_zone</td>
<td>时区名称的缩写</td>
</tr>
<tr>
<td>.</td>
<td>tm_gmtoff</td>
<td>以秒为单位的UTC以东偏离</td>
</tr>
<tr>
<td>0</td>
<td>tm_year（年）</td>
<td>比如2011</td>
</tr>
<tr>
<td>1</td>
<td>tm_mon（月）</td>
<td>1 - 12</td>
</tr>
<tr>
<td>2</td>
<td>tm_mday（日）</td>
<td>1 - 31</td>
</tr>
<tr>
<td>3</td>
<td>tm_hour（时）</td>
<td>0 - 23</td>
</tr>
<tr>
<td>4</td>
<td>tm_min（分）</td>
<td>0 - 59</td>
</tr>
<tr>
<td>5</td>
<td>tm_sec（秒）</td>
<td>0 - 61</td>
</tr>
<tr>
<td>6</td>
<td>tm_wday（星期几）</td>
<td>0 - 6 (星期一是0依次)</td>
</tr>
<tr>
<td>7</td>
<td>tm_yday（一年中的第几天）</td>
<td>1 - 366</td>
</tr>
<tr>
<td>8</td>
<td>tm_isdst（是否是夏令时）</td>
<td>默认为0</td>
</tr>
</tbody></table>
<h5 id="当前时间的三种格式"><a href="#当前时间的三种格式" class="headerlink" title="当前时间的三种格式"></a>当前时间的三种格式</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#导入时间模块</span></span><br><span class="line">&gt;&gt;&gt;<span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">#时间戳</span></span><br><span class="line">&gt;&gt;&gt;time.time()</span><br><span class="line"><span class="number">1500875844.800804</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#时间字符串</span></span><br><span class="line">&gt;&gt;&gt;time.strftime(<span class="string">"%Y-%m-%d %X"</span>)</span><br><span class="line"><span class="string">'2017-07-24 13:54:37'</span></span><br><span class="line">&gt;&gt;&gt;time.strftime(<span class="string">"%Y-%m-%d %H-%M-%S"</span>)</span><br><span class="line"><span class="string">'2017-07-24 13-55-04'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#时间元组</span></span><br><span class="line"><span class="comment">#localtime将一个时间戳转换为当前时区的struct_time</span></span><br><span class="line">&gt;&gt;&gt;time.localtime()</span><br><span class="line">time.struct_time(tm_year=<span class="number">2017</span>, tm_mon=<span class="number">7</span>, tm_mday=<span class="number">24</span>,</span><br><span class="line">　　　　　　　　　　tm_hour=<span class="number">13</span>, tm_min=<span class="number">59</span>, tm_sec=<span class="number">37</span>, </span><br><span class="line">                 tm_wday=<span class="number">0</span>, tm_yday=<span class="number">205</span>, tm_isdst=<span class="number">0</span>)</span><br></pre></td></tr></table></figure></div>

<h5 id="三种格式的转换"><a href="#三种格式的转换" class="headerlink" title="三种格式的转换"></a>三种格式的转换</h5><p><img src="/fcg22450.github.io/img/python_img/%E6%97%B6%E9%97%B4%E6%A8%A1%E5%9D%97.jpg" alt=""></p>
<h6 id="timestamp-⇄-struct-time"><a href="#timestamp-⇄-struct-time" class="headerlink" title="timestamp ⇄ struct_time"></a>timestamp ⇄ struct_time</h6><ul>
<li><code>time.gmtime(timestamp) -&gt; struct_time</code></li>
<li><code>time.localtime(timestamp) -&gt; struct_time</code></li>
<li><code>time.mktime(struct_time) -&gt; timestamp</code></li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#UTC时间。与英国伦敦当地时间一致</span></span><br><span class="line">&gt;&gt;&gt;time.gmtime(<span class="number">1500000000</span>)</span><br><span class="line">time.struct_time(tm_year=<span class="number">2017</span>, tm_mon=<span class="number">7</span>, tm_mday=<span class="number">14</span>, tm_hour=<span class="number">2</span>,</span><br><span class="line">                 tm_min=<span class="number">40</span>, tm_sec=<span class="number">0</span>, tm_wday=<span class="number">4</span>, tm_yday=<span class="number">195</span>, tm_isdst=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#当地时间。北京与UTC时间相差+8小时</span></span><br><span class="line">&gt;&gt;&gt;time.localtime(<span class="number">1500000000</span>)</span><br><span class="line">time.struct_time(tm_year=<span class="number">2017</span>, tm_mon=<span class="number">7</span>, tm_mday=<span class="number">14</span>, tm_hour=<span class="number">10</span>,</span><br><span class="line">                 tm_min=<span class="number">40</span>, tm_sec=<span class="number">0</span>, tm_wday=<span class="number">4</span>, tm_yday=<span class="number">195</span>, tm_isdst=<span class="number">0</span>)</span><br><span class="line"><span class="comment">#与time.localtime相反效果</span></span><br><span class="line">&gt;&gt;&gt;time_tuple = time.localtime(<span class="number">1500000000</span>)</span><br><span class="line">&gt;&gt;&gt;time.mktime(time_tuple)</span><br><span class="line"><span class="number">1500000000.0</span></span><br></pre></td></tr></table></figure></div>

<h6 id="struct-time-⇄-Format-String"><a href="#struct-time-⇄-Format-String" class="headerlink" title="struct_time ⇄ Format String"></a>struct_time ⇄ Format String</h6><ul>
<li><code>time.strftime(模板字符串, struct_time=当前) -&gt; FormatString</code></li>
<li><code>time.strptime(FormatString, 模板字符串) -&gt; struct_time</code></li>
</ul>
<p>值得注意的是，在Python3.8之前，时间的模板字符串里不支持非Ascii字符。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#结构化时间参数若不传，则显示当前时间</span></span><br><span class="line">&gt;&gt;&gt;time.strftime(<span class="string">"%Y-%m-%d %X"</span>)</span><br><span class="line"><span class="string">'2017-07-24 14:55:36'</span></span><br><span class="line">&gt;&gt;&gt;time.strftime(<span class="string">"%Y-%m-%d"</span>,time.localtime(<span class="number">1500000000</span>))</span><br><span class="line"><span class="string">'2017-07-14'</span></span><br><span class="line">&gt;&gt;&gt;time.strptime(<span class="string">"2017-03-16"</span>,<span class="string">"%Y-%m-%d"</span>)</span><br><span class="line">time.struct_time(tm_year=<span class="number">2017</span>, tm_mon=<span class="number">3</span>, tm_mday=<span class="number">16</span>, tm_hour=<span class="number">0</span>,</span><br><span class="line">                 tm_min=<span class="number">0</span>, tm_sec=<span class="number">0</span>, tm_wday=<span class="number">3</span>, tm_yday=<span class="number">75</span>, tm_isdst=<span class="number">-1</span>)</span><br><span class="line">&gt;&gt;&gt;time.strptime(<span class="string">"07/24/2017"</span>,<span class="string">"%m/%d/%Y"</span>)</span><br><span class="line">time.struct_time(tm_year=<span class="number">2017</span>, tm_mon=<span class="number">7</span>, tm_mday=<span class="number">24</span>, tm_hour=<span class="number">0</span>,</span><br><span class="line">                 tm_min=<span class="number">0</span>, tm_sec=<span class="number">0</span>, tm_wday=<span class="number">0</span>, tm_yday=<span class="number">205</span>, tm_isdst=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure></div>

<h6 id="与标准-a-b-d-H-M-S-Y格式的Format-String之间的转换"><a href="#与标准-a-b-d-H-M-S-Y格式的Format-String之间的转换" class="headerlink" title="与标准%a %b %d %H:%M:%S %Y格式的Format String之间的转换"></a>与标准<code>%a %b %d %H:%M:%S %Y</code>格式的Format String之间的转换</h6><ul>
<li><code>time.asctime(struct_time) → Format %a %b %d %H:%M:%S %Y String</code></li>
<li><code>time.ctime(timestamp) → Format %a %b %d %H:%M:%S %Y String</code></li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#如果不传参数，直接返回当前时间的格式化串</span></span><br><span class="line">&gt;&gt;&gt;time.asctime(time.localtime(<span class="number">1500000000</span>))</span><br><span class="line"><span class="string">'Fri Jul 14 10:40:00 2017'</span></span><br><span class="line">&gt;&gt;&gt;time.asctime()</span><br><span class="line"><span class="string">'Mon Jul 24 15:18:33 2017'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果不传参数，直接返回当前时间的格式化串</span></span><br><span class="line">&gt;&gt;&gt;time.ctime()</span><br><span class="line"><span class="string">'Mon Jul 24 15:19:07 2017'</span></span><br><span class="line">&gt;&gt;&gt;time.ctime(<span class="number">1500000000</span>)</span><br><span class="line"><span class="string">'Fri Jul 14 10:40:00 2017'</span></span><br></pre></td></tr></table></figure></div>

<h3 id="calendar模块"><a href="#calendar模块" class="headerlink" title="calendar模块"></a>calendar模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/calendar.html" target="_blank" rel="noopener"><code>calendar</code></a>模块提供了日历相关的函数，和格式化输出日历。</p>
<p>常量</p>
<ul>
<li><code>.MONDAY</code> = 0</li>
<li><code>.TUESDAY</code> = 1</li>
<li><code>.WEDNESDAY</code> = 2</li>
<li><code>.THURSDAY</code> = 3</li>
<li><code>.FRIDAY</code> = 4</li>
<li><code>SATURDAY</code> = 5</li>
<li><code>.SUNDAY</code> = 6</li>
</ul>
<p>常用函数</p>
<ul>
<li><code>.isleap</code>(<em>year</em>) 是否是闰年</li>
<li><code>.weekday</code>(<em>year</em>, <em>month</em>, <em>day</em>) 是星期几（星期一是0依次）</li>
<li><code>.weekheader</code>(<em>n</em>) 得到星期几的缩写头，n是字符宽度</li>
<li><code>.monthrange</code>(<em>year</em>, <em>month</em>) 得到一个月第一天是星期几和这个月的天数</li>
<li><code>.timegm</code>(struct_time) 与<code>time.gmtime()</code>相反效果</li>
</ul>
<p>常用类</p>
<ul>
<li><code>.TextCalendar</code>(<em>firstweekday=0</em>) 简单文本日历</li>
<li><code>.HTMLCalendar</code>(<em>firstweekday=0</em>) 超文本日历</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> calendar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果需要星期日在第一位 需要设置firstweekday=6或者SUNDAY</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(calendar.TextCalendar(<span class="number">6</span>).formatmonth(<span class="number">2020</span>, <span class="number">4</span>))</span><br><span class="line">     April <span class="number">2020</span></span><br><span class="line">Su Mo Tu We Th Fr Sa</span><br><span class="line">          <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span></span><br><span class="line"><span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span></span><br><span class="line"><span class="number">19</span> <span class="number">20</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">25</span></span><br><span class="line"><span class="number">26</span> <span class="number">27</span> <span class="number">28</span> <span class="number">29</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#本地化  前缀Locale-</span></span><br><span class="line"><span class="comment">#“ja-JP” 日语</span></span><br><span class="line"><span class="comment">#"fr-FR" 法语</span></span><br><span class="line"><span class="comment">#“zh-CN” 国语</span></span><br><span class="line"><span class="comment">#'en-US' 嘤语</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>frc = calendar.LocaleTextCalendar(locale=<span class="string">"fr-FR"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> print(frc.formatmonth(<span class="number">2020</span>, <span class="number">4</span>))</span><br><span class="line">     avril <span class="number">2020</span></span><br><span class="line">lu ma me je ve sa di</span><br><span class="line">       <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span></span><br><span class="line"><span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span></span><br><span class="line"><span class="number">20</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">25</span> <span class="number">26</span></span><br><span class="line"><span class="number">27</span> <span class="number">28</span> <span class="number">29</span> <span class="number">30</span></span><br></pre></td></tr></table></figure></div>

<p>注意：</p>
<ul>
<li>本质调用<code>locale.setlocale()</code>，使用后会一直生效，且非线程安全。</li>
<li>由于等宽字体的限制，不推荐使用非字母的本地语言。</li>
<li>非字母的本地语言如果要使用，还需要调整<code>formatmonth</code>的<code>w</code>参数大于2</li>
<li>如果出现乱码，可以尝试以下：<ul>
<li>重编码（推荐）</li>
<li>改连接符为下划线再加字符集，如<code>ja_JP.UTF-8</code><br>（可能需要捕获第一次setlocale的异常，且python3.8以下可能依然乱码）</li>
</ul>
</li>
</ul>
<h3 id="datetime模块"><a href="#datetime模块" class="headerlink" title="datetime模块"></a>datetime模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/datetime.html" target="_blank" rel="noopener"><code>datetime</code></a>模块提供用于处理日期和时间的类。</p>
<p>时间对象分为感知型和简单型，感知型相比简单型多了时区，夏令时等信息。</p>
<h4 id="常用类"><a href="#常用类" class="headerlink" title="常用类"></a>常用类</h4><table>
<thead>
<tr>
<th align="center">类名</th>
<th align="center">功能说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">timedelta</td>
<td align="center">时间间隔类</td>
</tr>
<tr>
<td align="center">tzinfo</td>
<td align="center">感知型信息抽象类</td>
</tr>
<tr>
<td align="center">timezone</td>
<td align="center">tzinfo类的子类，时区信息类</td>
</tr>
<tr>
<td align="center">date</td>
<td align="center">简单型日期类</td>
</tr>
<tr>
<td align="center">time</td>
<td align="center">时间类</td>
</tr>
<tr>
<td align="center">datetime</td>
<td align="center">date类的子类，日期时间类</td>
</tr>
</tbody></table>
<p>实例化timedelta 时间间隔类</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jp_offset = datetime.timedelta(hours=<span class="number">9</span>)</span><br></pre></td></tr></table></figure></div>

<p>实例化timezone 时区信息类</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>JST = datetime.timezone(jp_offset, name = <span class="string">'Tokyo'</span>)</span><br></pre></td></tr></table></figure></div>

<p>夏时制不深入讨论，需要实现抽象基类tzinfo上的<code>.dst()</code>方法，timezone类并未将其实现。</p>
<h4 id="date类"><a href="#date类" class="headerlink" title="date类"></a>date类</h4><p>代表一个理想化历法中的日期（年、月和日），即当今的格列高利历向前后两个方向无限延伸</p>
<p>它是一个不可变类型（hashable）</p>
<h5 id="实例化生成"><a href="#实例化生成" class="headerlink" title="实例化生成"></a>实例化生成</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">a = datetime.date(<span class="number">2017</span>, <span class="number">3</span>, <span class="number">15</span>)</span><br></pre></td></tr></table></figure></div>

<h5 id="静态方法生成"><a href="#静态方法生成" class="headerlink" title="静态方法生成"></a>静态方法生成</h5><ul>
<li><code>datetime.date.today</code>() 返回本地日期date对象</li>
<li><code>date.fromisoformat</code>(<em>date_string</em>) 格式化字符串→本地日期date对象，只支持<code>YYYY-MM-DD</code></li>
<li><code>date.fromtimestamp</code>(<em>timestamp</em>) 时间戳→本地日期date对象</li>
</ul>
<h5 id="对象属性和方法"><a href="#对象属性和方法" class="headerlink" title="对象属性和方法"></a>对象属性和方法</h5><ul>
<li><code>.year</code>, <code>.month</code>, <code>.day</code> 数据描述符（只读）</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = datetime.date.today()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">datetime.date(<span class="number">2017</span>, <span class="number">3</span>, <span class="number">22</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.year</span><br><span class="line"><span class="number">2017</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.month</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.day</span><br><span class="line"><span class="number">22</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>.replace()</code> 替换数据描述符的属性值</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.replace(day=<span class="number">26</span>)</span><br><span class="line">datetime.date(<span class="number">2017</span>, <span class="number">3</span>, <span class="number">26</span>)</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>.timetuple()</code> 转struct_time元组，补0</li>
<li><code>.weekday()</code> 星期几 星期一为0依次</li>
<li><code>.isoweekday()</code> 星期几 没有0，星期一为1依次</li>
<li><code>.isocalendar()</code> 返回元组<code>(年, 周，星期)</code> 星期规则同<code>.isoweekday()</code></li>
</ul>
<h6 id="比较和做差"><a href="#比较和做差" class="headerlink" title="比较和做差"></a>比较和做差</h6><p>由于实现了诸多魔术方法，两个date对象之间可以比较和做差</p>
<p>做差将返回datetime.timedelta对象</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b &lt; a</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b - a</span><br><span class="line">datetime.timedelta(days=<span class="number">7</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(b - a).days</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure></div>

<h6 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h6><ul>
<li><code>.strftime(模板字符串)</code> 格式化方法</li>
<li><code>.isoformat()</code> 返回符合ISO 8601标准 (<code>YYYY-MM-DD</code>) 的日期字符串</li>
<li>魔术方法<code>__str__()</code>和<code>.__format__()</code> 可以使用格式化的一切方法。</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.__format__(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line"><span class="string">'2017-03-22'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.isoformat()</span><br><span class="line"><span class="string">'2017-03-22'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.strftime(<span class="string">'%y'</span>)</span><br><span class="line"><span class="string">'17'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(b,<span class="string">'%D'</span>)</span><br><span class="line"><span class="string">'03/22/17'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(b)</span><br><span class="line"><span class="string">'2017-03-22'</span></span><br></pre></td></tr></table></figure></div>

<h4 id="time类"><a href="#time类" class="headerlink" title="time类"></a>time类</h4><p>一个 time对象代表某日的（本地）时间，它独立于任何特定日期，并可通过 tzinfo对象来调整。</p>
<h5 id="实例化生成-1"><a href="#实例化生成-1" class="headerlink" title="实例化生成"></a>实例化生成</h5><p><code>datetime.time</code>(<em>hour=0</em>, <em>minute=0</em>, <em>second=0</em>, <em>microsecond=0</em>, <em>tzinfo=None</em>)</p>
<h5 id="静态方法生成-1"><a href="#静态方法生成-1" class="headerlink" title="静态方法生成"></a>静态方法生成</h5><p><code>.fromisoformat</code>(<em>time_string</em>) .isoformat的逆操作</p>
<h5 id="对象属性和方法-1"><a href="#对象属性和方法-1" class="headerlink" title="对象属性和方法"></a>对象属性和方法</h5><p>和date对象一样，实例化时的参数将成为实例对象的数据描述符（只读）</p>
<p><code>.replace()</code> 替换数据描述符的属性值</p>
<h5 id="比较和做差运算"><a href="#比较和做差运算" class="headerlink" title="比较和做差运算"></a>比较和做差运算</h5><p>time对象不能做差，比较的时候要求tzinfo属性一致。</p>
<h5 id="格式化输出-1"><a href="#格式化输出-1" class="headerlink" title="格式化输出"></a>格式化输出</h5><ul>
<li><p><code>.strftime(模板字符串)</code> 格式化方法</p>
</li>
<li><p><code>.isoformat</code>(<em>timespec=’auto’</em>) 返回符合ISO 8601标准 (<code>HH:MM:SS.ffffff</code>) 的时间字符串</p>
<p>默认的<code>auto</code>会在<code>.ffffff</code>为<code>.000000</code>的时候不显示，即整秒时为<code>HH:MM:SS</code></p>
<p>可设置的其他值：</p>
<ul>
<li><code>&#39;hours&#39;</code>: 以两个数码的 <code>HH</code> 格式</li>
<li><code>&#39;minutes&#39;</code>: 以 <code>HH:MM</code> 格式</li>
<li><code>&#39;seconds&#39;</code>: 以 <code>HH:MM:SS</code> 格式</li>
<li><code>&#39;milliseconds&#39;</code>: 包含完整时间，但将秒值截断至微秒。 格式为 <code>HH:MM:SS.sss</code></li>
<li><code>&#39;microseconds&#39;</code>: 以 <code>HH:MM:SS.ffffff</code> 格式包含完整时间。</li>
</ul>
</li>
<li><p>魔术方法<code>__str__()</code>, <code>__format__()</code></p>
</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>offset = datetime.timedelta(hours=<span class="number">8</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>shanghai_timez = datetime.timezone(offset, name = <span class="string">'Shanghai'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bonjour = datetime.time(<span class="number">7</span>,<span class="number">30</span>,tzinfo=shanghai_timez)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bonjour.isoformat()</span><br><span class="line"><span class="string">'07:30:00+08:00'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bonjour.strftime(<span class="string">"%H:%M:%S %Z"</span>)</span><br><span class="line"><span class="string">'07:30:00 Shanghai'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(bonjour,<span class="string">'%z'</span>)</span><br><span class="line"><span class="string">'+0800'</span></span><br></pre></td></tr></table></figure></div>

<h4 id="datetime类"><a href="#datetime类" class="headerlink" title="datetime类"></a>datetime类</h4><p>datetime类可以看做是date类和time类的合体</p>
<p>由于是继承的date类，这里<strong>只介绍派生的方法</strong>。</p>
<h5 id="实例化生成-2"><a href="#实例化生成-2" class="headerlink" title="实例化生成"></a>实例化生成</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="EXCEL"><figure class="iseeu highlight /excel"><table><tr><td class="code"><pre><span class="line">datetime.datetime(<span class="built_in">year</span>, <span class="built_in">month</span>, <span class="built_in">day</span>, <span class="built_in">hour</span>, <span class="built_in">minute</span>, <span class="built_in">second</span>, microsecond,tzinfo)</span><br></pre></td></tr></table></figure></div>

<h5 id="静态方法生成-2"><a href="#静态方法生成-2" class="headerlink" title="静态方法生成"></a>静态方法生成</h5><ul>
<li><code>datetime.now</code>(<em>tz=None</em>) 当前的datetime对象，可传入时区，默认系统时区</li>
<li><code>datetime.utcnow</code>() 生成简单型datetime对象，消除时区信息</li>
<li><code>datetime.utcfromtimestamp</code>(<em>timestamp</em>) 由<em>timestamp</em>生成datetime对象，消除时区信息</li>
<li><code>datetime.combine</code>(<em>date</em>, <em>time</em>[, <em>tzinfo</em>]) 由date对象和time对象生成</li>
<li><code>datetime.strptime</code>(<em>date_string</em>, <em>format</em>) 由date_string生成datetime对象</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.strptime(<span class="string">'2017-3-22 15:25'</span>,<span class="string">'%Y-%m-%d %H:%M'</span>)</span><br><span class="line">datetime.datetime(<span class="number">2017</span>, <span class="number">3</span>, <span class="number">22</span>, <span class="number">15</span>, <span class="number">25</span>)</span><br></pre></td></tr></table></figure></div>

<h5 id="对象属性和方法-2"><a href="#对象属性和方法-2" class="headerlink" title="对象属性和方法"></a>对象属性和方法</h5><ul>
<li><code>.date()</code> 拆解出date对象</li>
<li><code>.time()</code> 拆解出time对象</li>
<li><code>.timestamp()</code> 6位浮点的时间戳</li>
<li><code>.utctimetuple()</code> 返回消除时区信息的struct_time</li>
</ul>
<h6 id="格式化输出-2"><a href="#格式化输出-2" class="headerlink" title="格式化输出"></a>格式化输出</h6><p><code>.isoformat</code>(<em>sep=’T’, timespec=’auto’</em>) 同date类的同名方法，sep是日期和时间之间的分隔符。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十七)</title>
    <url>/Python/Python_id_45.html</url>
    <content><![CDATA[<h2 id="序列化有关模块"><a href="#序列化有关模块" class="headerlink" title="序列化有关模块"></a>序列化有关模块</h2><a id="more"></a>

<blockquote>
<p>将原本的字典、列表等内容转换成一个字符串的过程就叫做<strong>序列化</strong>。</p>
<p><strong>序列化的目的</strong></p>
<p>1、以某种存储形式使自定义<a href="https://baike.baidu.com/item/对象持久化" target="_blank" rel="noopener">对象持久化</a>； 2、将对象从一个地方传递到另一个地方。 3、使程序更具维护性。 <img src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAAAAD/4QMqaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjUtYzAxNCA3OS4xNTE0ODEsIDIwMTMvMDMvMTMtMTI6MDk6MTUgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Q0I2OTlBOTE5N0MxMTFFOUJENThFRjEyNDgxREI0NEYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Q0I2OTlBOTI5N0MxMTFFOUJENThFRjEyNDgxREI0NEYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDQjY5OUE4Rjk3QzExMUU5QkQ1OEVGMTI0ODFEQjQ0RiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDQjY5OUE5MDk3QzExMUU5QkQ1OEVGMTI0ODFEQjQ0RiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/uAA5BZG9iZQBkwAAAAAH/2wCEABsaGikdKUEmJkFCLy8vQkc/Pj4/R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0cBHSkpNCY0PygoP0c/NT9HR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR//AABEIAQ4EDAMBIgACEQEDEQH/xACYAAEAAwEBAQAAAAAAAAAAAAAAAQQFAwIGAQEBAQEBAQAAAAAAAAAAAAAAAQMCBAUQAQABAgIHAwYMBQQCAQUAAAABAgMRBDFRodESUhQhQQXwYYGCEyRxkbHBIjJCorIzNBXhYnLC4tIjU7OSQ/Fjc4M1RREBAAIDAAICAgMBAQEAAAAAAAESUZECETFhYiFBcYEDsfAy/9oADAMBAAIRAxEAPwD6YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEGKBnaVTiYoEtInExQFpE4mKAtInExQFpE4mKAtInExQFpE4mKAtInExQFpE4mKAtInExQFpE4mKAtInFLymHUSJAdoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgxRIzmVTiYoEtInExQFpE4mKAtInExQFpE4mKAtInExQFpE4mKAtInExQFpE4mKAtInExQFpE4mKAtInExQFpE4mKAtInExQFpE4mKAtI9CIS0j8oAKAAPIDBQAAAAAAAAAAAAAAAAAAAAABMITDrn2JAaoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8yEjGfagCAAAAAAAAAAAAAAAAAAAAAAAAAAAACYSiEtefSADoAAeQGCgAAAAAAAAAAAAAAAAAAAAACYQmHXPsSA1QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5kJGM+1AEAAAAAAAAAAAAAAAAAAAAAAAAAAAAEwlEJa8+kAHQAA8gMFAAAAAAAAAABj+I565Yqimjs8/Z5tcNhfAAIAAAAAAAACYQmHXPsSA1QAAAAAAAAAAAAAAAAAAAAByvXabNE119lMf/AADqM392sc2yr/S8/utru7fj/wBINQZX7py04+t/B3y2bqvVYVUcEf1Y/MC8PNVUU6Xj21GsHUZmbztVmqmae2ntx2Ydy97ajWDqOcXaZnCJU7/iVuxXNurTHw6sdQNAZP7xa8sf9J+72vLH/SDWBn05mqc1VZ+zTh+HEGgChazk3L1VqI+jTh9LHXTjowBfFDPZ3pIpnh4uLHvw0Yeada+AAAAAAAAAAAAAAAAAAAAAAAADzISMZ9qAIOVN6iqqaIn6VOn0q053DMRl+H1sf5eLRh87jfydcX4vWu/HHRy4Rplwn/8AYx5f+t14GpdzNuzMRXOHFo093wIzOYixbm5pww+WIZ0ZKu/fmu99WO7s7fo4d0vPjN3Cmm3Hfjj92TwNTLXvb24uYcOOPZjj3zDuzLPiGWt0RTx6P5atzvb8QsXKoppqxmfNVuTwO9+7Fmia57t+CMvei/bi5HZFWOycGdn87ZqtVW4q+l2dmE64nU8ZDP2LNimiurCqMcYwq5pnuhfH4GnXmbdE8NU4THml56y1zbJ3MmuzRez1VNcYx2a+TzND9ry3J96refgdustc2ydz1Rmbdc8NM4zPmlX/AGvLcn3qt7Ot2aLOfiiiMKYx/wCvzniB9Aq3s5RZriirTPw7liuuKI4p0MXI0Tmbs5ivzYfFNM6tWpIG4KGbz8ZaKZw4uPHvw0Yeadan+9Ryfe/xXxI0Orp9t7D7X+PFq+dbfKddHU9Rh2asf5eHTh8zQ/eo5Pvf4rMDbU83nIy00xMY8WOzDzTrecvnqbtE11RwxHp82pm+K36Lk2+GccOLX/KkR+R9Aq5rNRlqOKYx83xeadb3RmbdyeGmcZnzTuYPid/2t2KI7Yo+eIIj8j6G1c9pTFWt0YceMTH/AK/v/wCKf3mf+P7/APieJG2M/JZ/qpmOHh4cO/HTj5o1NBAAQTCUQlrz6QAdAADyAwUAAAAAAYl/xKuqv2diO3X2asftR8LbfLWa5yF76ceWHmx1uoFqbuft9tej/wDG1b1V2qzM2fzO7Rr7dPZoerOat3/qTj6J+eFgmR8fnPb8XvH1vV83L6G1let9pHtvy+3H6mqcNHbpUfGPzI8u6l9Isz+Bk+K5q5l+D2c8PFxY9kTo4dcONWczF76OX7ZjTP0fkqj4Xnxz/wBfrf2tPI24t2aYjz/LJ+h7yk3JtUzd+v246Nc4aOzQsA5ABAAAAATCFe/7Xs9l6dHzu+I8z4SZ8QtDN978uA978uB6KfbnbO/x1ppDN978uA978uAp9udl/jrTSGb735cB735cBT7c7L/HWmkM33vy4D3vy4Cn252X+OtNIZvvflwHvflwFPtzsv8AHWmkM33vy4D3vy4Cn252X+OtNIZvvflwHvflwFPtzsv8daaQzfe/LgPe/LgKfbnZf4600hm+9+XAe9+XAU+3Oy/x1ppDN978uA978uAp9udl/jrTSGb735cB735cBT7c7L/HWmkz/FP01fq/ih5978uB68U/TV+r+KHM81/cT/DqJ8/qY/lOVv26bcRM9vbr1ysdTb17JYOZyVFFiLtEdsY8XbPNhHe0rXh+Vu0xXTR2T/NVvculzqbevZLpRcpr+rOLLzOSyti3Nc0aP5qtcRrevCLE27XHP2/mmoHPxr6lPp+WlzzGWyeXmIrjDHz1/M6eM/Up9Py0tWZpnSD5/HIav+wxyGr/ALFi5XdylXFP+7b9FO+dMudFNfiH0qp4LersndOmAWMlZytyqa7MdtH9Xfjra1VUURjOhxsWbdmOG3GHx/Oo+J3pqwsUfWr0+jCrv3gpZLOWqK6rl2cKqsO6e7GO6GtZz9m9VFFE4zPmn4dRlqLNVGFvtiPh8+tSylMXs1Vcp+rTw4emmYB7t/rq/V/Ai3+ur9X8Cbf66v1fwIt/rq/V/AC/m8xGXtzX3/xhT8JtYWvad9f9s1Qo52qrN1zh9S3h96I+CdMNPwv9NR634pBT8b0Uet/a0s1mqctTxVae6Pi8062T41dpq4aYntpxx+67ZfJV36vbZjTq2aaZ+AHXw6i7VM3rk/Xw7Ozuxjuaozfe/LgdRzb9xH8uZnx+pn+GkM33vy4D3vy4HVPtztzf4600hm+9+XAe9+XAU+3Oy/x1ppDN978uA978uAp9udl/jrTSGb735cB735cBT7c7L/HWmkM33vy4D3vy4Cn252X+OtNIZvvflwHvflwFPtzsv8daaQzfe/LgPe/LgKfbnZf4600hm+9+XAe9+XAU+3Oy/wAdaaQzfe/LgPe/LgKfbnZf460nM5iu1XhE9n8E0Z+J+tGHl8Clf9pxf7mn0fM4vRHHMxHncMJ7mJb1F6i59WcXV84vWfb/AGdHqs+v8vH7205/08/rTTkeaccO3S9PDPt6BExilzu01VUzFM8M69KDCzORsZeMaqu3ujCrfOtmU24iuIrjCP4eZuWMhFr/AHb841fJ3d0/AZW3GavdVE4fy+iadPZqx0NPIrWcll71PFTV2Rp7Kt6r7WM1mYqrj6M93q+jU2p8Nt+0i5HZHfHbqw04qXiOXpy9NFVuMOHi24ayJF67kbFFMzw7at6n4Tl6KqfaVR2933oXM/eiMvMx34Yf+UPXh1vgsUxOnt/FLn9Dhn8paptVVxT9Ls7cZ1xGt4yGTs3bFNddONU49880+c8Qz1qq3VbpnGqcO6dcTqVvD8zdwptUR9GnHHR34yv58BfszeztVMVcM9nbhj9hZ/a7n/L9yN6pf9rOcqmx9bs1cnn9Kxh4jr/61HHLZWczjNF3R/J/GNSzl/Dq7N+Lk1cURj24RH2cNbNyMZnCrp51Y/V8+H1vSv4eI6/+skR4vfmIi1oidP3Zca/EqabXsrUYapx8+PfDZir2dvjvaY0/H5mXlLc5y7N+v6vdHomnuw1akgXfDsr09vt+tVp9Ez52g4Zmx1FubeOHFh2/BOLL/ZY5/u/5J79jz/8A0vL/AI26xP2WOf7v+R+yxz/d/wAlnwNa9ZovU8NcYx6fmfOeIWLVq5FFuOHTj2zqjDS+hsWoy9uKMcYp7/hl8tmKpvVxdnRX/bGByNy7lrWVp9tZo+nTo+lPf2TpxjRKPDcv7Giblemr5pmO5wte0yNyLf1qKtGiNEYzrnTLv4pf4aPZU/Wr+aYk+B3yWd6rH6OHDh368fNGpeY81z4dbppwxxxxnHz9nZ262vTVFUYxocyMTwjtruT/AE/3Nxh+C9s3J/p/ubiz7AByJhKIS159IAOgAB5AYKAAAAAAOdy1TdjCqMYdHz9OVzljstTjHqfPKwOfiGSpy2Fy32Rq+KO+Z1trJ3ZvWaa6tM4/LMMroczmZj284Yean+2Y1Q3LduLdMU06IdSPnvGPzI8u6l9HpZviOSnMxE0fWp244eeNTlk7eborpi72W4x5NU6u3Se4HHxz/wBfrf2tfLflx6flUPFcrczHB7OOLh4se2I08OuWjZpmmiInT/FP0OoDkAAAAAAEwhMOufYkBqgAAAAAAAAAAAAAAAAAAAAyvF68LPDzfNNLVYl+rqszFH2LeOM/1U4+adMA1abUcHBVo/iyLNyfD6/ZXPy50T6MZ7IxnTLvd8Xt09lv6c+mPlpcacpezk8V+eGnuj6M7aZjVAPP0vErn/0qfnj0TphuxGHZDE6fMZL8qeOjV9GPlxnTLrZ8Wprnhqp4Z+HH+0Hnxb6U0Ua+L+12nwmzM44fi/1OFHvWb4vsW/7qPROmGxXVwxiDHzHhlm3bmqI7Yw16/hc8j4davWablUds46+aY1veZ8TtXLc00z2zhr1/Au+G0zRl6aZ0/S/FIM7KZeiM1ja+rb+H7VM62hZyfBdqu1TjM4YfFhrXKbdNMzMR2zpUs7nenwppjGqf4ebDQDPz1vpa4rszw1Vd2GOiI75x1tTJZbp7cUz9bv8Ajn4davk8lVFXtr3bcnZpjunDRg1AZFv9dX6v4EW/11fq/gd8z4jTl6+CqNvweadapkapzGYqvxGETh+GafNq1A0M5TFNqqY78Plhn5e3euZW3TanCPpcWjm7NLSzv5NXo+WHHwv9NR634pBj+IZKnK004dtU44z8XnnW+oY/jFqquimqn7OOPpmkp8Zt4dsYT6f9IL13N02rkW501Y7Ix1LTAs1TnMzFyIwop+enDzTphvgAAAAAAAAAAAAAAAAAAzszl67teMR2fwTRkIj604+XwtAaX68eIZ0jz5cqLNFv6sYOoOPPlp6eZCRhPtRzvW5uUTTE8OPfpdBB8xmsvXbri1FfHNWmOHDRESu0+E10xhF3s/o/yWc7lbNccdf0Z5u2dXdEsPqr3DNumrio7O6I8+rHS09i7kKapzHZVx0UaZww00z6dLXzdn29qaNeHyxKl4Xds8PBR9fv0+efg0Iz/iHs/wDbt/X+TRPfGE4wk+xk0VV5ngy/Lxau/wCl5tWt9ZEREYQ+Zqyl7KUxfjTGOOjs7tc4446m3lM5RmY7Oyrvj4/NGokU83kbVqzVXEfS7O3t1x51nwv9NR634pT4jVHT1ej8UKNrMdPkqZ+1OOH/AJ9p7j+xwtZjgruZjDi4eDs0aY4fLsWqfFq6oxi12f1/4q8WPZZGuqdNXDsrWcnn7FqzTRXVhVGPdVrnzKKOSzFeUiY4OLiw+1EaMfh1tLLeJTeuxamjhn+rHux1Ov7pluf7tW5n2btN7PcdE40z/ow709/oXPE8vdvxTFvtjtx0ebDSqUeH35jhmrhj4KZ+dfzefpy04TGM/D8HmnWpR4hfv/lUYetT88EeR7u5Tpctc+lxTPD3Yfa+GdarlfDZzFuLnHw8WPZw46JmNbvepzHT3JzH8uH1eb+X0PWQz9izYporqwqjHGMKuaZ7oX8+BH7NP/J9z/JRz2UnKcP0uLix7sNGHnnW2v3TLc/3atzK8UzVrMRT7OeLDix7JjVrgjz5Gt4jTXVZmKPNq1xrZfiFmLFNqiO7j+aX0TE8Z02/X/tcwNe7XFumap7nzdnOU1XpvXdPd8WHdHzPp5jFypy9unRG2SJGPmfEbV+iaMNPw64nU6eFZnGn2VX2dHp4pnua9M09yreotWMb0xhVOHb2/Aef0KHgkdlfq/3Nxj+DU4UTOvD5amwT7AByJhKIS159IAOgAB5AYKAAAAAAAAAAAAAAAAAAAAAAJhCYdc+xIDVAAAAAAAAAAAAAAAAAAAAB5imImZjTOl6AcqLNFucaYw+N1AB4mimZ4u+HsB5imImZjTKUgOfsqdToACMO9IAAAADzVTFUYToRRRFuOGnsiHsAAAAAAAAAAAAAAAAAAAAAAAAAAB5kJGM+1HO7RNdM0xOE63QQYtvwniniu1cXmww+SprW7VNqOGiMIdBfPkVLmTpmKuD6NVWHbp0eaZV8l4dTY+lV21/Jp8+Ghph5ETGPZLNp8Moouxcp+ry9urDTi0w8jHueERcrmri092H+Tvc8Nt1zTy049nb24+loh5kV8zY9vam1jw8WHbp0TEuVnIW7dEU1fSmO/tj510PIrdHa5ds73Cjw+Ld/21M9nLh/Lhpx9LQDyPFVumqcZjth7BBXzVn29ubcThjh8sSq2PDLVFERXHFV3zjMd+qJaQvkUv27L8u2rerZnwqi5h7P6GGOOmflqaweZBRzmS6qaZ4uHgx7sdOHnjUvAACDHveERdrmqK8Mf5f8ninwWIntrx9X/JtjrzI52rVNqmKKeyIdAcgACYSiEtefSADoAAeQGCgAAAAAAAAAAAAAAAAAAAAACYQmHXPsSA1QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB5kJGM+1AEAAAAAAAAAAAAAAAAAAAAAAAAAAAAEwlEJa8+kAHQAA8gMFAAAAAAAAAAAAAAAAAAAAAAEwhMOufYkBqgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADzISMZ9qAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAJhKIS1j0gA6AAEGCRPECMDBIlYEYGCQrAjAwSFYEYGCQrAjAwSFYFe9di1hj3u+DF8RucVfDy/PENWxc9pRFWve16/ziOees/+hnHXnqYdcDBIyrDRGBgkKwIwMEhWBGBgkKwIwMEhWBGCQXx4ABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBgkTxEiMDBIlYEYGCQrAjAwSFYEYGCQrAjAwSFYEYGCQrAjAwSFYFO1mfaVzRhhh34+bHUt4MrK/nT6Pwy1mnfHPM/jEOOJmY/OUYGCRnWHaMDBIVgRgYJCsCMDBIVgRgYJCsCMDBIVgRgYJDxAAOgAAAAAAAAAAAAAARM4RjKVPPXOC3Md874dcxaYhJnxHlh3K+Oqap72p4bcxiaZ7sPnZC1k7ns7kT3fwl7++fPMw8XE+OvL6EB857gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGTlfzp9H4ZazJyv50+j8MtZt/p7/AKhl/n6/uQBi1AAAAAAAAAAAAAAAAAAAAAAAAAAAAFbMZaL+GM6FkWJmJ8wkxE/iWDnMtFjhw+1jswXf26nX5fG5eKfY9b5ms9HXfVeZ8+/LGOObdR4whIPM3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAc6rtNMxTM9s6AdAAAAAABzi7TNXBj9KO7a6ACMYxwJnAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAycr+dPo/DLWZOV/On0fhlrNv9Pf8AUMv8/X9yAMWoAAAAAAAAAAAAAAAAAAAAAAAAAAAAADJ8U+x63zNZk+KfY9b5lvrrPNsq3N5iZ448Rn/rGJiOuvPx/wAWxU66zzbKtx11nm2VbmdOsTppbnMbWxU66zzbKtx11nm2VbinWJ0W5zG1sVOus82yrcddZ5tlW4p1idFucxtbFTrrPNsq3HXWebZVuKdYnRbnMbWxU66zzbKtx11nm2VbinWJ0W5zG1sVOus82yrcddZ5tlW4p1idFucxtbFTrrPNsq3HXWebZVuKdYnRbnMbWxU66zzbKtx11nm2VbinWJ0W5zG1sVOus82yrcddZ5tlW4p1idFucxtbFTrrPNsq3HXWebZVuKdYnRbnMbWxU66zzbKtx11nm2VbinWJ0W5zG1sVOus82yrcddZ5tlW4p1idFucxtbFTrrPNsq3HXWebZVuKdYnRbnMbWxU66zzbKtx11nm2VbinWJ0W5zG1sVOus82yrcddZ5tlW4p1idFucxtbFTrrPNsq3HXWebZVuKdYnRbnMbWxU66zzbKtx11nm2VbinWJ0W5zG1sVOus82yrcddZ5tlW4p1idFucxtbFTrrPNsq3HXWebZVuKdYnRbnMbW1DP5ucrTExGOP8ADzTrdOus82yrco+NfUp9Py0uZiY9wsTE+nvqc3/xffoVMzRmMxhM28Jp/np78Pg1NTM2LtyYm3XwR/TE/KzbPtL1XDTe7f8A7cIqz1Ob/wCP79DpZv5iquIrt8NOviplm5i5dszwxd4qtXBEbdGhqZCi/TEzfntnDCPo+fl9AF/J3Ltc103OCJ7uCJ7teLNy9q7frqoi52UYfS4Y741NfO5j2Fuau/u+OGZlclmKKMaK+DHu4aZ1+cFj9vu/833I3rVOb4r9Vjh+rh2466eLRh86jl7l+nM+yrq4ojT9GmPs4xoe7f66v1fwAi3+ur9X8DXmYpjGWRb/AF1fq/gR4tmuCn2VOmrT6OGdQI8Pib92rMVebD4ppnywefG9FHrf2rnhf6aj1vxSp+N6KPW/tBtqdjO0X65op+zh268Y+BQzOaqzdXsLGjvn4p+1Eap72nlctTlqOGn0z8fnnWCyKnXWebZVuOus82yrc7p1idObc5ja2KnXWebZVuOus82yrcU6xOi3OY2tip11nm2VbjrrPNsq3FOsTotzmNrYqddZ5tlW466zzbKtxTrE6Lc5ja2KnXWebZVuOus82yrcU6xOi3OY2tip11nm2VbjrrPNsq3FOsTotzmNrYqddZ5tlW466zzbKtxTrE6Lc5ja2KnXWebZVuOus82yrcU6xOi3OY2tip11nm2VbjrrPNsq3FOsTotzmNrYqddZ5tlW466zzbKtxTrE6Lc5ja2KnXWebZVuOus82yrcU6xOi3OY2tip11nm2VbjrrPNsq3FOsTotzmNrYqddZ5tlW466zzbKtxTrE6Lc5ja2KnXWebZVuOus82yrcU6xOi3OY2tip11nm2VbjrrPNsq3FOsTotzmNrYqddZ5tlW466zzbKtxTrE6Lc5ja2KnXWebZVuOus82yrcU6xOi3OY2tip11nm2VbjrrPNsq3FOsTotzmNrYqddZ5tlW466zzbKtxTrE6Lc5ja2KnXWebZVuOus82yrcU6xOi3OY2qZX86fR+GWsyMnVFV6ZjR/CWu7/1/+v6hx/n6/uQBi1AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcrtmi79eMcPhcehs8u2retjqOpj1MuZ5ifcKnQ2eXbVvOhs8u2reti36zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW9R8Z7aaY+H+1ssbPf72Yt2o7uL8MS5mZn3KxER6dJzmYiey19+ncoZybl6OKq1wzH2uOJ1dz6RVzn5NXo+WEViZCu5ao4qLfFj9rjiNfdLRsZ+5Xei1XRw44/aie7Huh08L/TUet+KU2MrVTeru19szw4fFhOiQU64nO5jhn8u3/dT6J0w90Z+uxXNvM+iduimPgas8NGNU+liXap8SuRRR+XTpq+GMdE4TpgFjwyia+K/Vprww9GNPl2It/rq/V/A1aaYojCNCrTlOG/Vfx+th2YaqcNOPzAp2/11fq/gReyfBFy7XOMzw4fJPem3+ur9X8C9nfyavR8sAo5PNUZbK0TXOniw080+adbLz2YuZiKa6o4aO3h7YnVj59LY8Os0XMtbmqMcOLD/wApV/G9FHrf2g1bGXoy9PDRDuhkZm5VOaoopnm/DiC70Nnl21bzobPLtq3rY7v1mdua84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0qdDZ5dtW86Gzy7at62F+szsrziNKnQ2eXbVvOhs8u2rethfrM7K84jSp0Nnl21bzobPLtq3rYX6zOyvOI0428vbtdtEYemXYHMzM+1iPHoARQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQsZObd2q7VPFM4Yd3dhrXwHiuOKMIZFWQzFccNVzsn+Wne2gHGxZixRFuNEb8XYAUM3k5zMxjVhTGPZh8HnjUt2rVNqnhojCHQAZ2ZyFV+vjpr4PVx1edogM/J5CMtM1TPHVPfhhr8861nM25uW5pjTOHyu4CrkrM2LNNurTGPyzJmsrTmaeGrsnun4vPGpaAY8eF3KYwi72f0Rvd8r4dFiv2lVXHVrww1xraIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//Z" alt="img"></p>
</blockquote>
<h3 id="json模块"><a href="#json模块" class="headerlink" title="json模块"></a>json模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/json.html" target="_blank" rel="noopener"><code>json</code></a>模块主要提供了2个功能：</p>
<ul>
<li><code>dumps()</code> 反序列化</li>
<li><code>loads()</code> 序列化</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic = &#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>,<span class="string">'k3'</span>:<span class="string">'v3'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str_dic = json.dumps(dic)  <span class="comment">#序列化：将一个字典转换成一个字符串</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(str_dic)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">str_dic</span></span></span><br><span class="line">'&#123;"k3": "v3", "k1": "v1", "k2": "v2"&#125;'</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic2 = json.loads(str_dic)  <span class="comment">#反序列化：将一个字符串格式的字典转换成一个字典</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic2</span><br><span class="line">&#123;<span class="string">'k1'</span>: <span class="string">'v1'</span>, <span class="string">'k2'</span>: <span class="string">'v2'</span>, <span class="string">'k3'</span>: <span class="string">'v3'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list_dic = [<span class="number">1</span>,[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>],<span class="number">3</span>,&#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>&#125;]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str_dic = json.dumps(list_dic) <span class="comment">#也可以处理嵌套的数据类型 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str_dic</span><br><span class="line"><span class="string">'[1, ["a", "b", "c"], 3, &#123;"k1": "v1", "k2": "v2"&#125;]'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list_dic2 = json.loads(str_dic)</span><br><span class="line">[<span class="number">1</span>, [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>], <span class="number">3</span>, &#123;<span class="string">'k1'</span>: <span class="string">'v1'</span>, <span class="string">'k2'</span>: <span class="string">'v2'</span>&#125;]</span><br></pre></td></tr></table></figure></div>

<p>json字符串中的引号只能用双引号（<code>&quot;</code>）</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PGSQL"><figure class="iseeu highlight /pgsql"><table><tr><td class="code"><pre><span class="line">dump()`和`<span class="keyword">load</span>()</span><br><span class="line"><span class="keyword">import</span> <span class="type">json</span></span><br><span class="line">f = <span class="keyword">open</span>(<span class="string">'json_file'</span>,<span class="string">'w'</span>)</span><br><span class="line">dic = &#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>,<span class="string">'k3'</span>:<span class="string">'v3'</span>&#125;</span><br><span class="line"><span class="type">json</span>.dump(dic,f)  #dump方法接收一个文件句柄，直接将字典转换成<span class="type">json</span>字符串写入文件</span><br><span class="line">f.<span class="keyword">close</span>()</span><br><span class="line"></span><br><span class="line">f = <span class="keyword">open</span>(<span class="string">'json_file'</span>)</span><br><span class="line">dic2 = <span class="type">json</span>.<span class="keyword">load</span>(f)  #<span class="keyword">load</span>方法接收一个文件句柄，直接将文件中的<span class="type">json</span>字符串转换成数据结构返回</span><br><span class="line">f.<span class="keyword">close</span>()</span><br><span class="line">print(<span class="keyword">type</span>(dic2),dic2)</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p><code>ensure_ascii</code>参数</p>
<p>当它为True的时候，所有非ASCII码字符显示为\uXXXX序列，只需在dump时将ensure_ascii设置为False即可，此时存入json的中文即可正常显示</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">f = open(<span class="string">'file'</span>,<span class="string">'w'</span>)</span><br><span class="line">json.dump(&#123;<span class="string">'国籍'</span>:<span class="string">'中国'</span>&#125;,f)</span><br><span class="line">ret = json.dumps(&#123;<span class="string">'国籍'</span>:<span class="string">'中国'</span>&#125;)</span><br><span class="line">f.write(ret+<span class="string">'\n'</span>)</span><br><span class="line">json.dump(&#123;<span class="string">'国籍'</span>:<span class="string">'美国'</span>&#125;,f,ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">ret = json.dumps(&#123;<span class="string">'国籍'</span>:<span class="string">'美国'</span>&#125;,ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">f.write(ret+<span class="string">'\n'</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><code>separators</code>参数</p>
<p>实际上是<code>(item_separator, dict_separator)</code>的一个元组，<br>默认的就是<code>(&#39;, &#39;, &#39;: &#39;)</code>，注意，它含有空格。<br>这表示字典内keys之间用<code>,</code>隔开，而key和value之间用<code>:</code>隔开。</p>
</li>
<li><p><code>Skipkeys</code>参数</p>
<p>默认值是False，<br>当含有非基本类型<code>(str,unicode,int,long,float,bool,None)</code>，就会报<code>TypeError</code>的错误。<br>此时设置成True，则会跳过这些类</p>
</li>
<li><p><code>sort_keys</code>参数</p>
<p>是否对字典排序（按ASCII）</p>
</li>
<li><p><code>indent</code>参数</p>
<p>缩进显示的缩进数，如果不为0，会生成pretty-printed json。</p>
</li>
</ul>
<h3 id="pickle-模块"><a href="#pickle-模块" class="headerlink" title="pickle 模块"></a>pickle 模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/pickle.html" target="_blank" rel="noopener"><code>pickle</code></a>模块提供了四个功能：</p>
<ul>
<li>dumps、dump(序列化，存）</li>
<li>loads（反序列化，读）</li>
<li>load  （不仅可以序列化字典，列表…<strong>可以把python中任意的数据类型序列化</strong>）</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">dic = &#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>,<span class="string">'k3'</span>:<span class="string">'v3'</span>&#125;</span><br><span class="line">str_dic = pickle.dumps(dic)</span><br><span class="line">print(str_dic)  <span class="comment">#一串二进制内容</span></span><br><span class="line"></span><br><span class="line">dic2 = pickle.loads(str_dic)</span><br><span class="line">print(dic2)    <span class="comment">#字典</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">struct_time  = time.localtime(<span class="number">1000000000</span>)</span><br><span class="line">print(struct_time)</span><br><span class="line">f = open(<span class="string">'pickle_file'</span>,<span class="string">'wb'</span>)</span><br><span class="line">pickle.dump(struct_time,f)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'pickle_file'</span>,<span class="string">'rb'</span>)</span><br><span class="line">struct_time2 = pickle.load(f)</span><br><span class="line">print(struct_time2.tm_year)</span><br></pre></td></tr></table></figure></div>

<h3 id="shelve模块"><a href="#shelve模块" class="headerlink" title="shelve模块"></a>shelve模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/shelve.html" target="_blank" rel="noopener"><code>shelve</code></a>模块是种简单的数据存储方案，它只有一个函数就是open()，这个函数接收一个参数就是文件名，并且文件名必须是.bat类型的。然后返回一个shelf对象，你可以用它来存储东西，它就像一个普通的字典，key必须为字符串，而值可以是python所支持的数据类型 ，当你存储完毕的时候，就调用close函数来关闭。<br>把open方法的<strong>writeback</strong>参数的值赋为True，这样的话，你open后所有的内容都将在cache中，当你close的时候，将全部一次性写到硬盘里面。如果数据量不是很大的时候，建议这么做。</p>
<h4 id="写入"><a href="#写入" class="headerlink" title="写入"></a>写入</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shelve</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"> </span><br><span class="line">info = &#123;<span class="string">'name'</span>: <span class="string">'bigberg'</span>, <span class="string">'age'</span>: <span class="number">22</span>&#125;</span><br><span class="line">name = [<span class="string">'Apoll'</span>, <span class="string">'Zous'</span>, <span class="string">'Luna'</span>]</span><br><span class="line">t = datetime.datetime.now()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> shelve.open(<span class="string">'shelve.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">  f[<span class="string">'name'</span>] = name  <span class="comment"># 持久化列表</span></span><br><span class="line">  f[<span class="string">'info'</span>] = info     <span class="comment"># 持久化字典</span></span><br><span class="line">  f[<span class="string">'time'</span>] = t      <span class="comment"># 持久化时间类型</span></span><br></pre></td></tr></table></figure></div>

<p>执行代码后会生成3个文件：<code>shelve.txt.bak</code>、<code>shelve.txt.dat</code>、<code>shelve.txt.dir</code>。</p>
<h4 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shelve</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> shelve.open(<span class="string">'shelve.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">  n = f.get(<span class="string">'name'</span>)</span><br><span class="line">  i = f.get(<span class="string">'info'</span>)</span><br><span class="line">  now = f.get(<span class="string">'time'</span>)</span><br><span class="line"> </span><br><span class="line">print(n)</span><br><span class="line">print(i)</span><br><span class="line">print(now)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line"> </span><br><span class="line">[<span class="string">'Apoll'</span>, <span class="string">'Zous'</span>, <span class="string">'Luna'</span>]</span><br><span class="line">&#123;<span class="string">'age'</span>: <span class="number">22</span>, <span class="string">'name'</span>: <span class="string">'bigberg'</span>&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-07</span><span class="number">-08</span> <span class="number">11</span>:<span class="number">07</span>:<span class="number">34.865022</span></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十六)</title>
    <url>/Python/Python_id_44.html</url>
    <content><![CDATA[<h2 id="加密有关模块"><a href="#加密有关模块" class="headerlink" title="加密有关模块"></a>加密有关模块</h2><h3 id="hashlib模块"><a href="#hashlib模块" class="headerlink" title="hashlib模块"></a>hashlib模块</h3><p>内置模块<a href="https://docs.python.org/zh-cn/3/library/hashlib.html" target="_blank" rel="noopener"><code>hashlib</code></a>提供了常见的摘要算法，如MD5，SHA1等等。</p>
<a id="more"></a>

<blockquote>
<p>什么是摘要算法呢？摘要算法又称哈希算法、散列算法。它通过一个函数，把任意长度的数据转换为一个长度固定的数据串（通常用16进制的字符串表示）。 摘要算法就是通过摘要函数f()对任意长度的数据data计算出固定长度的摘要digest，目的是为了发现原始数据是否被人篡改过。 摘要算法之所以能指出数据是否被篡改过，就是因为摘要函数是一个单向函数，计算f(data)很容易，但通过digest反推data却非常困难。而且，对原始数据做一个bit的修改，都会导致计算出的摘要完全不同。</p>
</blockquote>
<p>我们以常见的摘要算法MD5为例，计算出一个字符串的MD5值：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line">md5.update(<span class="string">'how to use md5 in python hashlib?'</span>.encode())</span><br><span class="line"></span><br><span class="line"><span class="comment">#计算结果如下：</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>md5.hexdigest()</span><br><span class="line"><span class="string">'d26a53750bc40b38b65a520292f69306'</span></span><br></pre></td></tr></table></figure></div>

<p>如果数据量很大，可以分块多次调用update()，最后计算的结果是一样的</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">md5 = hashlib.md5()</span><br><span class="line">md5.update(<span class="string">'how to use md5 in '</span>.encode())</span><br><span class="line">md5.update(<span class="string">'python hashlib?'</span>.encode())</span><br><span class="line">print(md5.hexdigest())</span><br></pre></td></tr></table></figure></div>

<p>MD5是最常见的摘要算法，速度很快，生成结果是固定的128 bit字节，通常用一个32位的16进制字符串表示。另一种常见的摘要算法是SHA1，调用SHA1和调用MD5完全类似</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"> </span><br><span class="line">sha1 = hashlib.sha1()</span><br><span class="line">sha1.update(<span class="string">'how to use sha1 in '</span>.encode())</span><br><span class="line">sha1.update(<span class="string">'python hashlib?'</span>.encode())</span><br><span class="line">print(md5.hexdigest())</span><br></pre></td></tr></table></figure></div>

<p>SHA1的结果是160 bit字节，通常用一个40位的16进制字符串表示。比SHA1更安全的算法是SHA256和SHA512，不过越安全的算法越慢，而且摘要长度更长。</p>
<h3 id="hmac模块"><a href="#hmac模块" class="headerlink" title="hmac模块"></a>hmac模块</h3><p>Keyed-Hashing for Message Authentication。它通过一个标准算法，在计算哈希的过程中，把key混入计算过程中。Hmac算法针对所有哈希算法都通用，无论是MD5还是SHA-1。采用Hmac替代我们自己的salt算法，可以使程序算法更标准化，也更安全。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> hmac</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>message = <span class="string">b'Hello, world!'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>key = <span class="string">b'secret'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>h = hmac.new(key, message, digestmod=<span class="string">'MD5'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 如果消息很长，可以多次调用h.update(msg)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>h.hexdigest()</span><br><span class="line"><span class="string">'fa4ee7d173f2d97ee79022d1a7355bcf'</span></span><br></pre></td></tr></table></figure></div>

<h3 id="base64模块"><a href="#base64模块" class="headerlink" title="base64模块"></a>base64模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/base64.html" target="_blank" rel="noopener"><code>base64</code></a>模块它也不算加密，只是二进制显示的区别。<br>解码需要注意的是，位数不够 等号来凑。<br>具体用法请参考文档。最常用的编码和解码的API为：</p>
<ul>
<li><code>base64.b64encode(s, altchars=None)</code></li>
<li><code>base64.b64decode(s, altchars=None, validate=False)</code></li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="string">b'nanarino'</span>, altchars=<span class="literal">None</span>)</span><br><span class="line"><span class="string">b'bmFuYXJpbm8='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64decode(<span class="string">b'bmFuYXJpbm8='</span>,altchars=<span class="literal">None</span>, validate=<span class="literal">False</span>)</span><br><span class="line"><span class="string">b'nanarino'</span></span><br></pre></td></tr></table></figure></div>

<h3 id="pycrypt模块"><a href="#pycrypt模块" class="headerlink" title="pycrypt模块"></a>pycrypt模块</h3><p>加密不同于摘要，加密是一个可逆的过程。<br>Python中常用的加密模块是第三方模块<code>pycrypt</code><br>在Windows系统中可用的模块名字叫<code>pycryptodomex</code></p>
<p>提供了常用的几种对称加密算法（AES等）<br>具体用法请参考文档。使用ASE加密和解密的例子：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密钥长度必须为16、24或32位，分别对应AES-128、AES-192和AES-256,这里使用16位</span></span><br><span class="line">aes = AES.new(str.encode(<span class="string">'1234567890123456'</span>), AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">msg = <span class="string">'待加密文本'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#待加密文本长度需要是为16的倍数 不够需要补'\0'，反之 解密后也需要去除多余的'\0'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_to_16</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> len(s) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">        s += <span class="string">'\0'</span></span><br><span class="line">    <span class="keyword">return</span> str.encode(s)</span><br><span class="line"></span><br><span class="line">encrypted_text = str(base64.encodebytes(aes.encrypt(add_to_16(msg))),</span><br><span class="line">                     encoding=<span class="string">'utf8'</span>).replace(<span class="string">'\n'</span>, <span class="string">''</span>)  <span class="comment"># 加密</span></span><br><span class="line">decrypted_text = str(</span><br><span class="line">    aes.decrypt(base64.decodebytes(bytes(</span><br><span class="line">        encrypted_text, encoding=<span class="string">'utf8'</span>))).rstrip(<span class="string">b'\0'</span>).decode(<span class="string">"utf8"</span>))  <span class="comment"># 解密</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'加密值：'</span>, encrypted_text)</span><br><span class="line">print(<span class="string">'解密值：'</span>, decrypted_text)</span><br></pre></td></tr></table></figure></div>

<h3 id="zlib模块"><a href="#zlib模块" class="headerlink" title="zlib模块"></a>zlib模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/zlib.html" target="_blank" rel="noopener"><code>zlib</code></a>模块通过哈夫曼编码对二进制数据的压缩，具体用法请参考文档。常用API：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#压缩二进制字符串</span></span><br><span class="line">msg = zlib.compress(msg)</span><br><span class="line"></span><br><span class="line"><span class="comment">#解压二进制字符串</span></span><br><span class="line">msg = zlib.decompress(msg)</span><br></pre></td></tr></table></figure></div>

<h3 id="uuid模块"><a href="#uuid模块" class="headerlink" title="uuid模块"></a>uuid模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/uuid.html" target="_blank" rel="noopener"><code>uuid</code></a>模式是用来生成唯一标识的工具<br>具体用法请参考文档。例子：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line">print(uuid.uuid3(uuid.NAMESPACE_DNS,<span class="string">"alice"</span>))</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十五)</title>
    <url>/Python/Python_id_43.html</url>
    <content><![CDATA[<h2 id="模块和包"><a href="#模块和包" class="headerlink" title="模块和包"></a>模块和包</h2><blockquote>
<p>python的模块都是天然的单例</p>
</blockquote>
<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><a id="more"></a>

<p>import加载的模块分为四个通用类别：</p>
<ul>
<li>使用python编写的代码（.py文件）</li>
<li>已被编译为共享库或DLL的C或C++扩展</li>
<li>包好一组模块的包</li>
<li>使用C编写并链接到python解释器的内置模块</li>
</ul>
<p>我们可以从<code>sys.modules</code>中找到当前已经加载的模块，<br><code>sys.modules</code>是一个字典，内部包含模块名与模块对象的映射，<br>该字典决定了导入模块时是否需要重新导入。</p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>自定义模块文件名<code>my_module.py</code>,模块名<code>my_module</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#my_module.py</span></span><br><span class="line">print(<span class="string">'from the my_module.py'</span>)</span><br><span class="line"></span><br><span class="line">money = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'my_module-&gt;read1-&gt;money'</span>,money)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'my_module-&gt;read2 calling read1'</span>)</span><br><span class="line">    read1()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> money</span><br><span class="line">    money=<span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<p>每个模块都是一个独立的名称空间，定义在这个模块中的函数，把这个模块的名称空间当做全局名称空间，<br>这样我们在编写自己的模块时，就不用担心我们定义在自己模块中全局变量会在被导入时，与使用者的全局变量冲突<br>同时模块也是单例类，多次导入，’from the my_module.py’也只被print一次。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#测试：执行my_module.change()操作的全局变量money仍然是my_module中的</span></span><br><span class="line"><span class="comment">#demo.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> my_module</span><br><span class="line"></span><br><span class="line">money = <span class="number">1</span></span><br><span class="line">my_module.change() <span class="comment"># 改变的是my_module.money</span></span><br><span class="line"></span><br><span class="line">print(money)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">执行结果：</span></span><br><span class="line"><span class="string">from the my_module.py</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></div>

<h4 id="在一行导入多个模块"><a href="#在一行导入多个模块" class="headerlink" title="在一行导入多个模块"></a>在一行导入多个模块</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, os, re</span><br></pre></td></tr></table></figure></div>

<h4 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> my_module <span class="keyword">as</span> sm</span><br></pre></td></tr></table></figure></div>

<h4 id="from-…-import…"><a href="#from-…-import…" class="headerlink" title="from … import…"></a>from … import…</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> my_module <span class="keyword">import</span> read1, read2</span><br><span class="line"></span><br><span class="line">my_module.read1() <span class="comment">#可用</span></span><br><span class="line">read1() <span class="comment">#可用</span></span><br></pre></td></tr></table></figure></div>

<p>如果当前命名空间有重名read1或者read2，那么会有覆盖效果。</p>
<h5 id="导入多行"><a href="#导入多行" class="headerlink" title="导入多行"></a>导入多行</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> my_module <span class="keyword">import</span> (read1,</span><br><span class="line">                  read2,</span><br><span class="line">                  money)</span><br></pre></td></tr></table></figure></div>

<h5 id="别名-1"><a href="#别名-1" class="headerlink" title="别名"></a>别名</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> my_module <span class="keyword">import</span> read1 <span class="keyword">as</span> read</span><br></pre></td></tr></table></figure></div>

<h5 id="全部导入"><a href="#全部导入" class="headerlink" title="全部导入"></a>全部导入</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> my_module <span class="keyword">import</span> * <span class="comment">#将模块my_module中所有的名字都导入到当前名称空间</span></span><br></pre></td></tr></table></figure></div>

<p>此时需要在在<code>my_module.py</code>中新增一行</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">__all__ = [<span class="string">'money'</span>,<span class="string">'read1'</span>]</span><br></pre></td></tr></table></figure></div>

<p>这样在另外一个文件中用<code>from my_module import *</code>就这能导入列表中规定的两个名字</p>
<h4 id="模块的加载与修改"><a href="#模块的加载与修改" class="headerlink" title="模块的加载与修改"></a>模块的加载与修改</h4><p>每个模块相当于单例类，导入一次立被实例化，放入字典<code>sys.modules</code>中了。<br>python不支持重新加载或卸载之前导入的模块<br>如果只是你想交互测试的一个模块，使用<code>importlib.reload(modulename)</code>，<br>而且这只能用于测试环境。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#aa.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'func1'</span>)</span><br><span class="line"><span class="keyword">import</span> time, importlib</span><br><span class="line"><span class="keyword">import</span> aa</span><br><span class="line"> </span><br><span class="line">time.sleep(<span class="number">20</span>)</span><br><span class="line"><span class="comment"># importlib.reload(aa)</span></span><br><span class="line">aa.func1()</span><br></pre></td></tr></table></figure></div>

<p>在20秒的等待时间里，修改aa.py中func1的内容，等待test.py的结果。<br>打开importlib注释，重新测试</p>
<h4 id="把模块当做脚本执行"><a href="#把模块当做脚本执行" class="headerlink" title="把模块当做脚本执行"></a>把模块当做脚本执行</h4><p>我们可以通过模块的全局变量<code>__name__</code>来查看模块名：<br>当做脚本运行：<br><code>__name__</code>等于<code>&#39;__main__&#39;</code><br>当做模块导入：<br><code>__name__</code>= 模块名<br>作用：用来控制.py文件在不同的应用场景下执行不同的逻辑</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">if <span class="strong">__name__</span> == '<span class="strong">__main__</span>':</span><br></pre></td></tr></table></figure></div>

<h4 id="模块搜索路径"><a href="#模块搜索路径" class="headerlink" title="模块搜索路径"></a>模块搜索路径</h4><p>python解释器在启动时会自动加载一些模块，可以使用<code>sys.modules</code>查看<br>模块的查找顺序是：内存中已经加载的模块-&gt;内置模块-&gt;sys.path路径中包含的模块<br>在初始化后，python程序可以修改<code>sys.path</code>,路径放到前面的优先于标准库被加载</p>
<h4 id="编译python文件"><a href="#编译python文件" class="headerlink" title="编译python文件"></a>编译python文件</h4><p>为了提高加载模块的速度，强调强调强调：提高的是加载速度而绝非运行速度。<br>python解释器会在<code>__pycache__</code>目录中下缓存每个模块编译后的版本，<br>格式为：module.version.pyc。<br>通常会包含python的版本号。</p>
<p>例如，在CPython3.3版本下，<br><code>my_module.py</code>模块会被缓存成<code>__pycache__/my_module.cpython-33.pyc</code>。<br>这种命名规范保证了编译后的结果多版本共存。</p>
<h4 id="dir-函数"><a href="#dir-函数" class="headerlink" title="dir()函数"></a><code>dir()</code>函数</h4><p>内置函数<code>dir()</code>可以用来查找模块中定义的名字，返回一个有序字符串列表</p>
<h3 id="包"><a href="#包" class="headerlink" title="包"></a>包</h3><p>包是一种通过使用<code>.模块名</code>来组织python模块名称空间的方式。</p>
<ul>
<li>无论是import形式还是from…import形式，凡是在导入语句中（而不是在使用时）遇到带点的，都是关于包独有的导入语法，如<code>from moviepy.editor import *</code></li>
<li>包是目录级的（文件夹级），包的本质就是一个包含<code>__init__.py</code>文件的目录</li>
<li><ul>
<li>import导入文件时，产生名称空间中的名字来源于文件，</li>
<li>import 包时，产生的名称空间的名字同样来源于文件，即包下的<code>__init__.py</code>，导入包本质就是在导入该文件</li>
</ul>
</li>
</ul>
<p><strong>强调：</strong></p>
<p>\1. 而在python2中，包下没有<code>__init__.py</code>文件，import包会报错 　　2. 创建包的目的不是为了运行，而是被导入使用，记住，包只是模块的一种形式而已，包即模块</p>
<h4 id="绝对导入和相对导入"><a href="#绝对导入和相对导入" class="headerlink" title="绝对导入和相对导入"></a>绝对导入和相对导入</h4><h5 id="内部互调"><a href="#内部互调" class="headerlink" title="内部互调"></a>内部互调</h5><p>我们的最顶级包glance是写给别人用的，(结构图见最下)<br>然后在glance包内部也会有彼此之间互相导入的需求，这时候就有绝对导入和相对导入两种方式：</p>
<ul>
<li>绝对导入：以glance作为起始</li>
<li>相对导入：用<code>.</code>或者<code>..</code>的方式为起始（只能在一个包中使用，不能用于不同目录内）</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#绝对导入</span></span><br><span class="line"><span class="keyword">from</span> glance.cmd <span class="keyword">import</span> manage</span><br><span class="line">manage.main()</span><br><span class="line"></span><br><span class="line"><span class="comment">#相对导入</span></span><br><span class="line"><span class="keyword">from</span> ..cmd <span class="keyword">import</span> manage</span><br><span class="line">manage.main()</span><br></pre></td></tr></table></figure></div>

<p>外部测试结果：注意一定要在于glance同级的文件中测试</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> glance.api <span class="keyword">import</span> versions</span><br></pre></td></tr></table></figure></div>

<p>注意：</p>
<p>在使用pycharm时，有的情况会为你多做一些事情<br>因而在测试时，一定要回到命令行去执行</p>
<p><strong><code>__init__.py</code>决定的外部用例</strong></p>
<p>单独导入包名称时，不会导入包中所有包含的所有子模块，<br>即不会自动导入同级所有目录和python文件(子模块)。<br>模块内方法的调用方式取决于各级的<code>__init__.py</code>文件。</p>
<h5 id="默认的"><a href="#默认的" class="headerlink" title="默认的"></a>默认的</h5><p>很多第三方模块的各级<code>__init__.py</code>文件是如下书写的</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#glance/__init__.py</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="comment">#glance/cmd/__init__.py</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> manage</span><br></pre></td></tr></table></figure></div>

<p>此时外部可以这样调用：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> glance</span><br><span class="line">glance.cmd.manage.main()</span><br></pre></td></tr></table></figure></div>

<h5 id="惯例的"><a href="#惯例的" class="headerlink" title="惯例的"></a>惯例的</h5><p>也可以这样书写使无论什么方式都可以调用：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">glance/                   </span><br><span class="line">├── __init__.py     <span class="keyword">from</span> .api <span class="keyword">import</span> *</span><br><span class="line">│                   __version__ = <span class="string">"1.0.0"</span></span><br><span class="line">│                   __all__ = [<span class="string">'api'</span>,<span class="string">'cmd'</span>,<span class="string">'db'</span>]   </span><br><span class="line">├── api                  </span><br><span class="line">│   │</span><br><span class="line">│   ├── __init__.py   __all__ = [<span class="string">'policy'</span>,<span class="string">'versions'</span>]</span><br><span class="line">│   │                <span class="keyword">from</span> .versions <span class="keyword">import</span> * </span><br><span class="line">│   │</span><br><span class="line">│   ├── policy.py</span><br><span class="line">│   │</span><br><span class="line">│   └── versions.py  <span class="function"><span class="keyword">def</span> <span class="title">get_now_version</span><span class="params">()</span>:</span></span><br><span class="line">│                        print(<span class="string">"1.0.0"</span>)</span><br><span class="line">│    </span><br><span class="line">├── cmd  </span><br><span class="line">│   │</span><br><span class="line">│   ├── __init__.py	  __all__ = [<span class="string">'manage'</span>]</span><br><span class="line">│   │</span><br><span class="line">│   └── manage.py    </span><br><span class="line">│   </span><br><span class="line">└── db           </span><br><span class="line">    │</span><br><span class="line">    ├── __init__.py   __all__ = [<span class="string">'models'</span>]</span><br><span class="line">    │</span><br><span class="line">    └── models.py</span><br></pre></td></tr></table></figure></div>

<p>此时外部怎样调用都行：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> glance</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>glance.api.versions.get_now_version()</span><br><span class="line"><span class="string">"1.0.0"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>glance.versions.get_now_version()</span><br><span class="line"><span class="string">"1.0.0"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>glance.get_now_version()</span><br><span class="line"><span class="string">"1.0.0"</span></span><br></pre></td></tr></table></figure></div>

<p>也就是说，这里的<code>__init__.py</code>里写了<br><code>from .api import *</code> 它的效果是含有 <code>from . import api</code> 的<br>当多重调用方式有重名的时候，<strong>深度优先</strong>：<br>如果<code>get_now_version</code>函数就叫<code>versions</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> glance</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>glance.api.versions.versions()</span><br><span class="line">AttributeError: <span class="string">'function'</span> object has no attribute <span class="string">'versions'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>glance.versions.versions()</span><br><span class="line">AttributeError: <span class="string">'function'</span> object has no attribute <span class="string">'versions'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>glance.api.versions()</span><br><span class="line"><span class="string">"1.0.0"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>glance.versions()</span><br><span class="line"><span class="string">"1.0.0"</span></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十四)</title>
    <url>/Python/Python_id_42.html</url>
    <content><![CDATA[<h2 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h2><blockquote>
<p>在Python中,所有以“__”双下划线包起来的方法,都统称为“Magic Method”,中文称:”魔术方法”</p>
</blockquote>
<p>这里只补充内置(类)方法中的魔术方法</p>
<a id="more"></a>

<h3 id="字符串相关"><a href="#字符串相关" class="headerlink" title="字符串相关"></a>字符串相关</h3><p>改变对象的字符串显示的魔术方法</p>
<ul>
<li>用于控制台输出显示的<code>__str__</code></li>
<li>用于程序调试显示的<code>__repr__</code></li>
<li>自定制格式化字符串<code>__format__</code></li>
</ul>
<p>内置函数<code>str</code>或者<code>print</code> 会调用 <code>obj.__str__()</code><br>内置函数<code>repr</code>会调用 <code>obj.__repr__()</code><br>如果<code>__str__</code>没有被定义,那么就会使用<code>__repr__</code>来代替输出</p>
<p>注意：这俩方法的返回值必须是字符串,否则抛出异常</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#_*_coding:utf-8_*_</span></span><br><span class="line">format_dict=&#123;</span><br><span class="line">    <span class="string">'nat'</span>:<span class="string">'&#123;obj.name&#125;-&#123;obj.addr&#125;-&#123;obj.type&#125;'</span>,<span class="comment">#学校名-学校地址-学校类型</span></span><br><span class="line">    <span class="string">'tna'</span>:<span class="string">'&#123;obj.type&#125;:&#123;obj.name&#125;:&#123;obj.addr&#125;'</span>,<span class="comment">#学校类型:学校名:学校地址</span></span><br><span class="line">    <span class="string">'tan'</span>:<span class="string">'&#123;obj.type&#125;/&#123;obj.addr&#125;/&#123;obj.name&#125;'</span>,<span class="comment">#学校类型/学校地址/学校名</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">School</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,addr,type)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.addr=addr</span><br><span class="line">        self.type=type</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'School(%s,%s)'</span> %(self.name,self.addr)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'(%s,%s)'</span> %(self.name,self.addr)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__format__</span><span class="params">(self, format_spec)</span>:</span></span><br><span class="line">        <span class="comment"># if format_spec</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> format_spec <span class="keyword">or</span> format_spec <span class="keyword">not</span> <span class="keyword">in</span> format_dict:</span><br><span class="line">            format_spec=<span class="string">'nat'</span></span><br><span class="line">        fmt = format_dict[format_spec]</span><br><span class="line">        <span class="keyword">return</span> fmt.format(obj=self)</span><br><span class="line"></span><br><span class="line">s1 = School(<span class="string">'oldboy1'</span>,<span class="string">'北京'</span>,<span class="string">'私立'</span>)</span><br><span class="line">print(<span class="string">'from repr: '</span>,repr(s1))</span><br><span class="line">print(<span class="string">'from str: '</span>,str(s1))</span><br><span class="line">print(s1)</span><br><span class="line">print(format(s1,<span class="string">'nat'</span>))</span><br><span class="line">print(format(s1,<span class="string">'tna'</span>))</span><br><span class="line">print(format(s1,<span class="string">'tan'</span>))</span><br><span class="line">print(format(s1,<span class="string">'asfdasdffd'</span>))</span><br><span class="line">%s`和`%r</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'str : class B'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'repr : class B'</span></span><br><span class="line"></span><br><span class="line">b=B()</span><br><span class="line">print(<span class="string">'%s'</span>%b)</span><br><span class="line">print(<span class="string">'%r'</span>%b)</span><br></pre></td></tr></table></figure></div>

<p>在之前章节中提到的：</p>
<p>在基础字符串类型中，魔术方法<code>__repr__</code>返回的是原始字符串类型。<br>而基础的容器类型中<code>__str__</code>对容器内部成员一般是用的<code>__repr__</code>方法。</p>
<p>例如：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'\\'</span>.__str__()</span><br><span class="line"><span class="string">'\\'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'\\'</span>.__repr__()</span><br><span class="line"><span class="string">"'\\\\'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="string">'\\'</span>].__str__()</span><br><span class="line"><span class="string">"['\\\\']"</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></div>

<p>重写<code>__repr__()</code>方法使容器外访问和容器内偏差</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> init, Fore</span><br><span class="line">init(autoreset = <span class="literal">False</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Color_str</span><span class="params">(str)</span>:</span></span><br><span class="line">    color = <span class="string">'WHITE'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_color</span><span class="params">(self,color)</span>:</span></span><br><span class="line">        self.color = color</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line">    </span><br><span class="line">    <span class="string">'''前章继承的基本类，现在重写它的repr方法'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''注意不要在这里触发self.__repr__()，如f'&#123;self=&#125;',否则递归'''</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;getattr(Fore, self.color)&#125;</span><span class="subst">&#123;self&#125;</span><span class="subst">&#123;Fore.RESET&#125;</span>'</span></span><br><span class="line">        </span><br><span class="line">arr = [Color_str(<span class="string">'Y'</span>).set_color(<span class="string">'GREEN'</span>),Color_str(<span class="string">'N'</span>).set_color(<span class="string">"RED"</span>)]</span><br><span class="line"></span><br><span class="line">print(arr[<span class="number">0</span>], arr[<span class="number">1</span>])</span><br><span class="line">print(arr)</span><br></pre></td></tr></table></figure></div>

<p><code>print(arr[0], arr[1])</code>是msg本体正常颜色的Y和N<br><code>print(arr)</code>打印出来的是绿色的Y和红色的N：[Y, N]</p>
<h3 id="索引相关"><a href="#索引相关" class="headerlink" title="索引相关"></a>索引相关</h3><ul>
<li><code>__getitem__</code></li>
<li><code>__setitem__</code></li>
<li><code>__delitem__</code></li>
</ul>
<p>在读取、修改、删除对象成员按索引<code>[0]</code>的时候可以分别定义以上方法。<br>事实上内置模块<a href="https://docs.python.org/zh-cn/3/library/operator.html" target="_blank" rel="noopener"><code>operator</code></a>里就包括这些同名的方法映射了索引的操作。<br>而在需要切片<code>[0:1]</code>时则可以用这些方法结合内置函数<code>slice(start, stop, step)</code>来自定义。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(self.__dict__[item])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self.__dict__[key]=value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(<span class="string">'del obj[key]时,我执行'</span>)</span><br><span class="line">        self.__dict__.pop(key)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'del obj.key时,我执行'</span>)</span><br><span class="line">        self.__dict__.pop(item)</span><br><span class="line"></span><br><span class="line">f1=Foo(<span class="string">'sb'</span>)</span><br><span class="line">f1[<span class="string">'age'</span>]=<span class="number">18</span></span><br><span class="line">f1[<span class="string">'age1'</span>]=<span class="number">19</span></span><br><span class="line"><span class="keyword">del</span> f1.age1</span><br><span class="line"><span class="keyword">del</span> f1[<span class="string">'age'</span>]</span><br><span class="line">f1[<span class="string">'name'</span>]=<span class="string">'alex'</span></span><br><span class="line">print(f1.__dict__)</span><br></pre></td></tr></table></figure></div>

<p>举例:纸牌游戏</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FranchDeck</span>:</span></span><br><span class="line">    ranks = [str(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>,<span class="number">11</span>)] + list(<span class="string">'JQKA'</span>)</span><br><span class="line">    suits = [<span class="string">'红心'</span>,<span class="string">'方板'</span>,<span class="string">'梅花'</span>,<span class="string">'黑桃'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._cards = [Card(rank,suit) <span class="keyword">for</span> rank <span class="keyword">in</span> FranchDeck.ranks</span><br><span class="line">                                        <span class="keyword">for</span> suit <span class="keyword">in</span> FranchDeck.suits]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self._cards)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._cards[item]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self._cards[key] = value</span><br><span class="line"></span><br><span class="line">deck = FranchDeck()</span><br><span class="line">print(deck[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line">print(choice(deck))</span><br><span class="line">print(choice(deck))</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle</span><br><span class="line">shuffle(deck)</span><br><span class="line">print(deck[:<span class="number">5</span>])</span><br></pre></td></tr></table></figure></div>

<p>除此之外还有<code>__missing__</code>，<br>通过 <code>dict[key]</code>或者 <code>dict.__getitem__(key)</code> 访问不存在的key时就会返回<code>__missing__()</code><br>当然，<code>dict</code>类并没有实现它，但是<code>collections.defaultdict</code>类实现了它</p>
<h3 id="实例化相关"><a href="#实例化相关" class="headerlink" title="实例化相关"></a>实例化相关</h3><p>除了<code>__init__</code>还有一个<code>__new__</code>（构造函数）。<br>实例化时触发，重写时必须返回<code>super().__new__(cls)</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#python单例模式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kw)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">'_instance'</span>):</span><br><span class="line">            cls._instance = object.__new__(cls, *args, **kw)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line">one = Singleton()</span><br><span class="line">two = Singleton()</span><br><span class="line"></span><br><span class="line">two.a = <span class="number">3</span></span><br><span class="line">print(one.a)</span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># one和two完全相同,可以用id(), ==, is检测</span></span><br><span class="line">print(id(one))</span><br><span class="line"><span class="comment"># 29097904</span></span><br><span class="line">print(id(two))</span><br><span class="line"><span class="comment"># 29097904</span></span><br><span class="line">print(one == two)</span><br><span class="line"><span class="comment"># True</span></span><br><span class="line">print(one <span class="keyword">is</span> two)</span><br></pre></td></tr></table></figure></div>

<h3 id="调用相关"><a href="#调用相关" class="headerlink" title="调用相关"></a>调用相关</h3><p><code>__call__</code><br>对象后面加括号，触发执行<code>__call__</code>。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'__call__'</span>)</span><br><span class="line"></span><br><span class="line">obj = Foo() <span class="comment"># 执行 __init__和__new__</span></span><br><span class="line">obj()       <span class="comment"># 执行 __call__</span></span><br></pre></td></tr></table></figure></div>

<p>内置函数<code>callable</code>也会辨别它。</p>
<h3 id="对象属性相关"><a href="#对象属性相关" class="headerlink" title="对象属性相关"></a>对象属性相关</h3><p>在访问对象的属性的时候 依照这样一个优先级 经过③轮遍历：</p>
<ol>
<li>①继承树中各个类的<code>__getattribute__</code>方法</li>
<li>本类的数据描述符属性</li>
<li>本实例属性（<code>obj.__dict__</code>）</li>
<li>本类的非数据描述符属性</li>
<li>②继承树各个类的属性和描述符属性（<code>super().__dict__</code>）</li>
<li>③继承树各个类的<code>__getattr__</code>方法</li>
<li>抛出<code>AttributeError</code>异常</li>
</ol>
<h4 id="getattr"><a href="#getattr" class="headerlink" title="__getattr__"></a><code>__getattr__</code></h4><p>如果找不到对象的属性时会调用这个方法<br>这个方法应该返回属性值或者抛出<code>AttributeError</code>异常<br>注意，如果通过以上优先级机制能找到对象属性的话，不会调用<code>__getattr__</code>方法<br>另外两个</p>
<ul>
<li><code>__setattr__</code>设置对象的属性</li>
<li><code>__delattr__</code>删除对象的属性</li>
</ul>
<h4 id="getattribute"><a href="#getattribute" class="headerlink" title="__getattribute__"></a><code>__getattribute__</code></h4><p>当访问某个对象的属性时，会无条件的调用这个方法。这个方法只适用于新式类。<br>该方法应该返回属性值或者抛出<code>AttributeError</code>异常。<br>当同时定义<code>__getattribute__</code>和<code>__getattr__</code>时，<br><code>__getattr__</code>方法不会再被调用，除非引发<code>AttributeError</code>异常</p>
<p>注意：</p>
<p>当在<code>__getattribute__</code>代码块中，再次执行属性的获取操作时，<br>会再次触发<code>__getattribute__</code>方法的调用，代码将会陷入无限递归</p>
<h3 id="运算符相关"><a href="#运算符相关" class="headerlink" title="运算符相关"></a>运算符相关</h3><p>内置模块<a href="https://docs.python.org/zh-cn/3/library/operator.html" target="_blank" rel="noopener"><code>operator</code></a>里的函数与运算符映射。重写以下方法其实是影响的operator中函数的调用。</p>
<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><p>布尔类型转换（如直接<code>if</code>）调用<code>__bool__</code>，需要返回布尔值</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.a = <span class="number">1</span></span><br><span class="line">        self.b = <span class="number">2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(self.a)</span><br><span class="line">a = A()</span><br><span class="line"><span class="keyword">if</span> a:</span><br><span class="line">    print(!bool(a))</span><br></pre></td></tr></table></figure></div>

<h4 id="比较运算"><a href="#比较运算" class="headerlink" title="比较运算"></a>比较运算</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"><span class="strong">__eq__</span></span><br></pre></td></tr></table></figure></div>

<p>遇到比较运算符时触发，需要返回布尔值</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.a = <span class="number">1</span></span><br><span class="line">        self.b = <span class="number">2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self,obj)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.a == obj.a <span class="keyword">and</span> self.b == obj.b)</span><br><span class="line">a = A()</span><br><span class="line">b = A()</span><br><span class="line">print(a == b)</span><br></pre></td></tr></table></figure></div>

<p>其他运算操作符与之相似：<code>__lt__()</code>、<code>__le__()</code>、<code>__ne__()</code>、<code>__gt__()</code>和<code>__ge__()</code>等</p>
<h3 id="其他内置函数有关"><a href="#其他内置函数有关" class="headerlink" title="其他内置函数有关"></a>其他内置函数有关</h3><p>内置函数<code>len()</code>调用<code>__len__</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.a = <span class="number">1</span></span><br><span class="line">        self.b = <span class="number">2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.__dict__)</span><br><span class="line">a = A()</span><br><span class="line">print(len(a))</span><br></pre></td></tr></table></figure></div>

<p>内置函数<code>hash()</code>调用<code>__hash__</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.a = <span class="number">1</span></span><br><span class="line">        self.b = <span class="number">2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hash(str(self.a)+str(self.b))</span><br><span class="line">a = A()</span><br><span class="line">print(hash(a))</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十三)</title>
    <url>/Python/Python_id_41.html</url>
    <content><![CDATA[<h2 id="面向对象特性"><a href="#面向对象特性" class="headerlink" title="面向对象特性"></a>面向对象特性</h2><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentClass1</span>:</span> <span class="comment">#定义父类</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentClass2</span>:</span> <span class="comment">#定义父类</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubClass1</span><span class="params">(ParentClass1)</span>:</span> <span class="comment">#单继承，基类是ParentClass1，派生类是SubClass</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubClass2</span><span class="params">(ParentClass1,ParentClass2)</span>:</span> <span class="comment">#多继承，用逗号分隔开多个继承的类</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div>

<h4 id="查看继承"><a href="#查看继承" class="headerlink" title="查看继承"></a>查看继承</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>SubClass1.__bases__ <span class="comment">#__base__只查看从左到右继承的第一个子类，__bases__则是查看所有继承的父类</span></span><br><span class="line">(&lt;class '__main__.ParentClass1'&gt;,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>SubClass2.__bases__</span><br><span class="line">(&lt;class '__main__.ParentClass1'&gt;, &lt;class '__main__.ParentClass2'&gt;)</span><br></pre></td></tr></table></figure>

<p>如果没有指定基类，python的类会默认继承object类，object是所有python类的基类，它提供了一些常见方法</p>
<h4 id="super类"><a href="#super类" class="headerlink" title="super类"></a>super类</h4><p>在类内部实例化<code>super()</code>会顺着继承链返回后一个类的引用。<br>由于多继承的关系，后一个类不一定是父类。<br>在python2中类内部使用<code>super()</code>时，参数不可以不写<br>不省略参数的写法是：<code>super(cls, self)</code></p>
<h4 id="派生"><a href="#派生" class="headerlink" title="派生"></a>派生</h4><p>子类也可以添加自己新的属性或者在自己这里重新定义这些属性（不会影响父类的属性）</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> init, Fore</span><br><span class="line">init(autoreset = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">'''信息类'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, msg)</span>:</span></span><br><span class="line">        self.msg = msg</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.msg)</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Color_info</span><span class="params">(Info)</span>:</span></span><br><span class="line">    <span class="string">'''带颜色的信息类'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, msg, color)</span>:</span></span><br><span class="line">        super().__init__(msg)</span><br><span class="line">        self.color = color</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">f'<span class="subst">&#123;getattr(Fore, self.color)&#125;</span><span class="subst">&#123;self.msg&#125;</span><span class="subst">&#123;Fore.RESET&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">red_info = Color_info(<span class="string">'我爱你'</span>,<span class="string">'RED'</span>)</span><br><span class="line">red_info.out()</span><br></pre></td></tr></table></figure></div>

<p>重写了父类的out方法，这里的getattr方法将在后文介绍。<br>调用<code>Color_info(&#39;我爱你&#39;,&#39;RED&#39;).out()</code>即可在控制台打印出红色的我爱你。</p>
<p>派生基本类</p>
<p>无法在<code>__init__</code>时对基本类（如str）派生属性<br>且派生时<code>super().__init__</code>不需要传入参数。</p>
<p>派生基本类时，退而求其次的使用方法来添加属性：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> init, Fore</span><br><span class="line">init(autoreset = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Color_str</span><span class="params">(str)</span>:</span></span><br><span class="line">    color = <span class="string">'WHITE'</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, msg)</span>:</span></span><br><span class="line">        <span class="string">"""事实上，这个__init__不需要写，msg就是字符串的本体了"""</span></span><br><span class="line">        self.msg = msg</span><br><span class="line">        super().__init__()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_color</span><span class="params">(self,color)</span>:</span></span><br><span class="line">        self.color = color</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">out</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">f'<span class="subst">&#123;getattr(Fore, self.color)&#125;</span><span class="subst">&#123;self&#125;</span><span class="subst">&#123;Fore.RESET&#125;</span>'</span>)</span><br><span class="line">        <span class="string">"""f字符串的&#123;self&#125;其实是调用了self.__str__()没实现，向父类查找"""</span></span><br><span class="line"></span><br><span class="line">red_str = Color_str(<span class="string">'我爱你'</span>).set_color(<span class="string">'RED'</span>)</span><br><span class="line">print(red_str)</span><br><span class="line">red_str.out()</span><br></pre></td></tr></table></figure></div>

<p><code>print()</code>会调用str类的<code>__str__()</code>魔术方法打印出msg本体，除非重写它</p>
<p>而<code>red_str.out()</code>正确打出了预期的带颜色的msg</p>
<h4 id="抽象类与接口类"><a href="#抽象类与接口类" class="headerlink" title="抽象类与接口类"></a>抽象类与接口类</h4><blockquote>
<p>继承有两种用途：<br>一：继承基类的方法，并且做出自己的改变或者扩展（代码重用）<br>二：声明某个子类兼容于某基类，定义一个接口类Interface，接口类中定义了一些接口名（就是函数名）且并未实现接口的功能，子类继承接口类，并且实现接口中的功能</p>
</blockquote>
<p>每个类需要实现一个pay方法，但是由于缺少沟通，最后一个类的pay方法写成了fuqian方法（大雾</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alipay</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    支付宝支付</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span><span class="params">(self,money)</span>:</span></span><br><span class="line">        print(<span class="string">'支付宝支付了%s元'</span>%money)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Applepay</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    apple pay支付</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span><span class="params">(self,money)</span>:</span></span><br><span class="line">        print(<span class="string">'apple pay支付了%s元'</span>%money)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wechatpay</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fuqian</span><span class="params">(self,money)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        实现了pay的功能，但是名字不一样</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        print(<span class="string">'微信支付了%s元'</span>%money)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pay</span><span class="params">(payment,money)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    支付函数，总体负责支付</span></span><br><span class="line"><span class="string">    对应支付的对象和要支付的金额</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    payment.pay(money)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Wechatpay()</span><br><span class="line">pay(p,<span class="number">200</span>)   <span class="comment">#执行会报错</span></span><br></pre></td></tr></table></figure></div>

<p>写一个含有需要实现的方法的基类，手动报异常：<code>NotImplementedError</code>来解决开发中遇到的问题</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Payment</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wechatpay</span><span class="params">(Payment)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fuqian</span><span class="params">(self,money)</span>:</span></span><br><span class="line">        print(<span class="string">'微信支付了%s元'</span>%money)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Wechatpay()  <span class="comment">#这里不报错</span></span><br><span class="line">pay(p,<span class="number">200</span>)      <span class="comment">#这里报错了</span></span><br></pre></td></tr></table></figure></div>

<p>借用abc模块来实现：存在抽象方法时（即需要实现而未实现的方法），实例化的时候就会报错。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABCMeta,abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Payment</span><span class="params">(metaclass=ABCMeta)</span>:</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span><span class="params">(self,money)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wechatpay</span><span class="params">(Payment)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fuqian</span><span class="params">(self,money)</span>:</span></span><br><span class="line">        print(<span class="string">'微信支付了%s元'</span>%money)</span><br><span class="line"></span><br><span class="line">p = Wechatpay() <span class="comment"># 直接报错</span></span><br></pre></td></tr></table></figure></div>

<h5 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a><strong>依赖倒置原则</strong></h5><blockquote>
<p>高层模块不应该依赖低层模块，二者都应该依赖其抽象；<br>抽象不应该应该依赖细节；细节应该依赖抽象。<br>换言之，要针对接口编程，而不是针对实现编程</p>
</blockquote>
<p>接口继承实质上是要求“做出一个良好的抽象，这个抽象规定了一个兼容接口，使得外部调用者无需关心具体细节，可一视同仁的处理实现了特定接口的所有对象”——这在程序设计上，叫做归一化。</p>
<h4 id="钻石继承问题"><a href="#钻石继承问题" class="headerlink" title="钻石继承问题"></a>钻石继承问题</h4><h3 id=""><a href="#" class="headerlink" title="#"></a><a href="http://nanarino.metoyun.com/py/17-面向对象特性.html#" target="_blank" rel="noopener">#</a><img src="http://nanarino.metoyun.com/assets/img/oop1.ad806d8c.jpg" alt="img"></h3><p>它决定了属性查找的顺序即<code>super()</code>的指向</p>
<ul>
<li>新式类：广度优先</li>
<li>经典类：深度优先</li>
</ul>
<h4 id="Mixin方式"><a href="#Mixin方式" class="headerlink" title="Mixin方式"></a>Mixin方式</h4><h5 id="接口隔离原则"><a href="#接口隔离原则" class="headerlink" title="接口隔离原则"></a><strong>接口隔离原则</strong></h5><blockquote>
<p>使用多个专门的接口，而不使用单一的总接口。<br>即客户端不应该依赖那些不需要的接口。<br>在继承抽象类的过程中，我们应该尽量避免多继承；<br>而在继承接口的时候，我们反而鼓励你来多继承接口</p>
</blockquote>
<p>另一种派生方法的方式</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo_Mixin</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div>

<p>定义一个Mixin类里面写好需要派生的方法<br>需要派生这个方法的类，只需要多继承一个Mixin类</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(foo_Mixin, A)</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line">B().foo()</span><br></pre></td></tr></table></figure></div>

<p>由于继承链的广度优先<code>foo_Mixin</code>里使用<code>super()</code>会往<code>A</code>指</p>
<h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h3><p>多态性是指在不考虑实例类型的情况下使用实例</p>
<h4 id="鸭子类型"><a href="#鸭子类型" class="headerlink" title="鸭子类型"></a>鸭子类型</h4><p>Python崇尚鸭子类型，即‘如果看起来像、叫声像而且走起路来像鸭子，那么它就是鸭子’。python程序员通常根据这种行为来编写程序。例如，如果想编写现有对象的自定义版本，可以继承该对象。也可以创建一个外观和行为像，但与它无任何关系的全新对象，后者通常用于保存程序组件的松耦合度。</p>
<h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><p>隐藏对象的属性和实现细节，仅对外提供公共访问方式。<br>在python中用双下划线开头的方式将属性隐藏起来（设置成私有的）</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#其实这仅仅这是一种变形操作</span></span><br><span class="line"><span class="comment">#类中所有双下划线开头的名称如__x都会自动变形成：_类名__x的形式：</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    __N=<span class="number">0</span> <span class="comment">#类的数据属性就应该是共享的,但是语法上是可以把类的数据属性设置成私有的如__N,会变形为_A__N</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__X=<span class="number">10</span> <span class="comment">#变形为self._A__X</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__foo</span><span class="params">(self)</span>:</span> <span class="comment">#变形为_A__foo</span></span><br><span class="line">        print(<span class="string">'from A'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__foo() <span class="comment">#只有在类内部才可以通过__foo的形式访问到.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#A._A__N是可以访问到的，即这种操作并不是严格意义上的限制外部访问，仅仅只是一种语法意义上的变形</span></span><br></pre></td></tr></table></figure></div>

<p>在继承中，父类如果不想让子类覆盖自己的方法，可以将方法定义为私有的</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#把fa定义成私有的，即__fa</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__fa</span><span class="params">(self)</span>:</span> <span class="comment">#在定义时就变形为_A__fa</span></span><br><span class="line"><span class="meta">... </span>        print(<span class="string">'from A'</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.__fa() <span class="comment">#只会与自己所在的类为准,即调用_A__fa</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__fa</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        print(<span class="string">'from B'</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b=B()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.test()</span><br><span class="line"><span class="keyword">from</span> A</span><br></pre></td></tr></table></figure></div>

<h3 id="类中使用的装饰器"><a href="#类中使用的装饰器" class="headerlink" title="类中使用的装饰器"></a>类中使用的装饰器</h3><h4 id="property"><a href="#property" class="headerlink" title="property"></a>property</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">例一：BMI指数（bmi是计算而来的，但很明显它听起来像是一个属性而非方法，如果我们将其做成一个属性，更便于理解）</span><br><span class="line"></span><br><span class="line">成人的BMI数值：</span><br><span class="line">过轻：低于18.5</span><br><span class="line">正常：18.5-23.9</span><br><span class="line">过重：24-27</span><br><span class="line">肥胖：28-32</span><br><span class="line">非常肥胖, 高于32</span><br><span class="line">　　体质指数（BMI）&#x3D;体重（kg）÷身高^2（m）</span><br><span class="line">　　EX：70kg÷（1.75×1.75）&#x3D;22.86</span><br><span class="line">class People:</span><br><span class="line">    def __init__(self,name,weight,height):</span><br><span class="line">        self.name&#x3D;name</span><br><span class="line">        self.weight&#x3D;weight</span><br><span class="line">        self.height&#x3D;height</span><br><span class="line">    @property</span><br><span class="line">    def bmi(self):</span><br><span class="line">        return self.weight &#x2F; (self.height**2)</span><br><span class="line"></span><br><span class="line">p1&#x3D;People(&#39;egon&#39;,75,1.85)</span><br><span class="line">print(p1.bmi)</span><br></pre></td></tr></table></figure></div>

<p>属性property，由其他已有属性值动态计算得到。<br>本质就是实现了get，set，delete三种方法的数据描述符</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Goods</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 原价</span></span><br><span class="line">        self.original_price = <span class="number">100</span></span><br><span class="line">        <span class="comment"># 折扣</span></span><br><span class="line">        self.discount = <span class="number">0.8</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">price</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 实际价格 = 原价 * 折扣</span></span><br><span class="line">        new_price = self.original_price * self.discount</span><br><span class="line">        <span class="keyword">return</span> new_price</span><br><span class="line"></span><br><span class="line"><span class="meta">    @price.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">price</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.original_price = value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @price.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">price</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self.original_price</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Goods()</span><br><span class="line">obj.price         <span class="comment"># 获取商品价格</span></span><br><span class="line">obj.price = <span class="number">200</span>   <span class="comment"># 修改商品原价</span></span><br><span class="line">print(obj.price)</span><br><span class="line"><span class="keyword">del</span> obj.price     <span class="comment"># 删除商品原价</span></span><br></pre></td></tr></table></figure></div>

<h4 id="classmethod"><a href="#classmethod" class="headerlink" title="classmethod"></a>classmethod</h4><p>（狭义上的）类方法，class命名空间里定义的只和类有关，不和实例有关的函数</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Classmethod_Demo</span><span class="params">()</span>:</span></span><br><span class="line">    role = <span class="string">'dog'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(cls.role)</span><br><span class="line">Classmethod_Demo.func()</span><br></pre></td></tr></table></figure></div>

<h4 id="staticmethod"><a href="#staticmethod" class="headerlink" title="staticmethod"></a>staticmethod</h4><p>静态方法，class命名空间里定义的普通函数，常用来定义工具函数。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Staticmethod_Demo</span><span class="params">()</span>:</span></span><br><span class="line">    role = <span class="string">'dog'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"当普通方法用"</span>)</span><br><span class="line"></span><br><span class="line">Staticmethod_Demo.func()</span><br></pre></td></tr></table></figure></div>

<h3 id="与类有关的内置方法"><a href="#与类有关的内置方法" class="headerlink" title="与类有关的内置方法"></a>与类有关的内置方法</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">isinstance(obj,cls)<span class="comment">#检查是否obj是否是类 cls 的对象</span></span><br><span class="line">issubclass(sub, super)<span class="comment">#检查sub类是否是 super 类的派生类</span></span><br></pre></td></tr></table></figure></div>

<h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><p>python面向对象中的反射：通过字符串的形式操作对象相关的属性。python中的一切事物都是对象（都可以使用反射）</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    f = <span class="string">'类的静态变量'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.age=age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say_hi</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'hi,%s'</span>%self.name)</span><br><span class="line"></span><br><span class="line">obj=Foo(<span class="string">'egon'</span>,<span class="number">73</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测是否含有某属性</span></span><br><span class="line">print(hasattr(obj,<span class="string">'name'</span>))</span><br><span class="line">print(hasattr(obj,<span class="string">'say_hi'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取属性</span></span><br><span class="line">n=getattr(obj,<span class="string">'name'</span>)</span><br><span class="line">print(n)</span><br><span class="line">func=getattr(obj,<span class="string">'say_hi'</span>)</span><br><span class="line">func()</span><br><span class="line"></span><br><span class="line">print(getattr(obj,<span class="string">'aaaaaaaa'</span>,<span class="string">'不存在啊'</span>)) <span class="comment">#报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置属性</span></span><br><span class="line">setattr(obj,<span class="string">'sb'</span>,<span class="literal">True</span>)</span><br><span class="line">setattr(obj,<span class="string">'show_name'</span>,<span class="keyword">lambda</span> self:self.name+<span class="string">'sb'</span>)</span><br><span class="line">print(obj.__dict__)</span><br><span class="line">print(obj.show_name(obj))</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除属性</span></span><br><span class="line">delattr(obj,<span class="string">'age'</span>)</span><br><span class="line">delattr(obj,<span class="string">'show_name'</span>)</span><br><span class="line">delattr(obj,<span class="string">'show_name111'</span>)<span class="comment">#不存在,则报错</span></span><br><span class="line"></span><br><span class="line">print(obj.__dict__)</span><br></pre></td></tr></table></figure></div>

<p>反射当前模块成员</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'s1'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'s2'</span></span><br><span class="line"></span><br><span class="line">this_module = sys.modules[__name__]</span><br><span class="line"></span><br><span class="line">hasattr(this_module, <span class="string">'s1'</span>)</span><br><span class="line">getattr(this_module, <span class="string">'s2'</span>)</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十二)</title>
    <url>/Python/Python_id_40.html</url>
    <content><![CDATA[<h2 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h2><blockquote>
<p>在python中，用变量表示特征，用函数表示技能，<br>因而具有相同特征和技能的一类事物就是‘类’，<br>对象是则是这一类事物中具体的一个。<br>上一节中提到的异常类就是如此。</p>
</blockquote>
<h3 id="属性引用"><a href="#属性引用" class="headerlink" title="属性引用"></a>属性引用</h3><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span>   <span class="comment">#定义一个人类</span></span><br><span class="line">    role = <span class="string">'person'</span>  <span class="comment">#人的角色属性都是人</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name = name  <span class="comment"># 每一个角色都有自己的昵称;</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span><span class="params">(self)</span>:</span>  <span class="comment">#人都可以走路，也就是有一个走路方法</span></span><br><span class="line">        print(<span class="string">"person is walking..."</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h3><p>类名()就等于在执行<code>Person.__init__</code>。事实上它还执行了<code>Person.__new__</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">egg = Person(<span class="string">'狗蛋'</span>)</span><br></pre></td></tr></table></figure></div>

<p>执行完<code>__init__()</code>就会返回一个对象（这里的egg）。<br>这个对象类似一个字典，存着属于这个人本身的一些属性和方法。</p>
<h4 id="访问对象属性"><a href="#访问对象属性" class="headerlink" title="访问对象属性"></a>访问对象属性</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">print(egg.name)</span><br></pre></td></tr></table></figure></div>

<p>访问类属性，找不到对象属性的时候会根据访问链向 类属性，描述符，父类属性 查找（顺序远比这个复杂）</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">print(egg.role)</span><br><span class="line">print(Person.role)</span><br></pre></td></tr></table></figure></div>

<p>设置同名的对象属性不会影响到父类属性</p>
<h4 id="调用类方法"><a href="#调用类方法" class="headerlink" title="调用类方法"></a>调用类方法</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">egg.walk()</span><br></pre></td></tr></table></figure></div>

<p>也可以用<strong>静态方法的方式</strong>调用类方法，直接实例占用形参<code>self</code>的位置</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">Person.walk(egg)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>创建一个类就会创建一个类的名称空间，<br>用来存储类中定义的所有名字，这些名字称为类的属性。<br>静态方法就是直接定义在这个命名空间的函数。<br>它们的形参不含self和cls，几乎与类和实例无关。</p>
</blockquote>
<h3 id="特殊属性"><a href="#特殊属性" class="headerlink" title="特殊属性"></a>特殊属性</h3><p>我们定义的类的属性到底存到哪里了？有两种方式查看</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">dir(类名)<span class="comment">#：查出的是一个名字列表</span></span><br><span class="line">类名.__dict__<span class="comment">#:查出的是一个字典，key为属性名，value为属性值</span></span><br></pre></td></tr></table></figure></div>

<p>特殊的类属性如下</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">类名.__name__<span class="comment"># 类的名字(字符串)</span></span><br><span class="line">类名.__doc__<span class="comment"># 类的文档字符串</span></span><br><span class="line">类名.__base__<span class="comment"># 类的第一个父类(在讲继承时会讲)</span></span><br><span class="line">类名.__bases__<span class="comment"># 类所有父类构成的元组(在讲继承时会讲)</span></span><br><span class="line">类名.__dict__<span class="comment"># 类的字典属性</span></span><br><span class="line">类名.__module__<span class="comment"># 类定义所在的模块</span></span><br><span class="line"></span><br><span class="line">实例化对象.__class__<span class="comment"># 实例对应的类(仅新式类中)</span></span><br></pre></td></tr></table></figure></div>

<h3 id="组合用法"><a href="#组合用法" class="headerlink" title="组合用法"></a>组合用法</h3><p>组合指的是，在一个类中以另外一个类的对象作为数据属性，称为类的组合</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> pi</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    定义了一个圆形类；</span></span><br><span class="line"><span class="string">    提供计算面积(area)和周长(perimeter)的方法</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,radius)</span>:</span></span><br><span class="line">        self.radius = radius</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self)</span>:</span></span><br><span class="line">         <span class="keyword">return</span> pi * self.radius * self.radius</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perimeter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * pi *self.radius</span><br><span class="line"></span><br><span class="line">circle = Circle(<span class="number">10</span>) <span class="comment">#实例化一个圆</span></span><br><span class="line">area1 = circle.area() <span class="comment">#计算圆面积</span></span><br><span class="line">per1 = circle.perimeter() <span class="comment">#计算圆周长</span></span><br><span class="line">print(area1,per1) <span class="comment">#打印圆面积和周长</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ring</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    定义了一个圆环类</span></span><br><span class="line"><span class="string">    提供圆环的面积和周长的方法</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,radius_outside,radius_inside)</span>:</span></span><br><span class="line">        self.outsid_circle = Circle(radius_outside)</span><br><span class="line">        self.inside_circle = Circle(radius_inside)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.outsid_circle.area() - self.inside_circle.area()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perimeter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span>  self.outsid_circle.perimeter() + self.inside_circle.perimeter()</span><br><span class="line"></span><br><span class="line">ring = Ring(<span class="number">10</span>,<span class="number">5</span>) <span class="comment">#实例化一个环形</span></span><br><span class="line">print(ring.perimeter()) <span class="comment">#计算环形的周长</span></span><br><span class="line">print(ring.area()) <span class="comment">#计算环形的面积</span></span><br></pre></td></tr></table></figure></div>

<h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><blockquote>
<p>观察者模式（Observer）</p>
<p>指多个对象间存在一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。这种模式有时又称作发布-订阅模式、模型-视图模式，它是对象行为型模式。</p>
</blockquote>
<h3 id="描述符"><a href="#描述符" class="headerlink" title="描述符"></a>描述符</h3><p><a href="https://docs.python.org/zh-cn/3/howto/descriptor.html" target="_blank" rel="noopener">描述符(descriptor)</a> 是一种类</p>
<p>我们把实现了<code>__get__()</code>、<code>__set__()</code>和<code>__delete__()</code>中的其中任意一种方法的类称之为描述符</p>
<h4 id="创建一个描述符"><a href="#创建一个描述符" class="headerlink" title="创建一个描述符"></a>创建一个描述符</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stu_descriptor</span>:</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, obj, objtype)</span>:</span></span><br><span class="line">        print(<span class="string">"获取了val的值"</span>)</span><br><span class="line">        <span class="keyword">return</span> self.val</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, obj, val)</span>:</span></span><br><span class="line">        print(<span class="string">"修改了val的值"</span>)</span><br><span class="line">        self.val = val</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        print(<span class="string">"删除了val属性"</span>)</span><br><span class="line">        <span class="keyword">del</span> self.val</span><br></pre></td></tr></table></figure></div>

<h4 id="使用描述符来代理属性"><a href="#使用描述符来代理属性" class="headerlink" title="使用描述符来代理属性"></a>使用描述符来代理属性</h4><p>描述符是一种具有“捆绑行为”的对象属性，也是一种Observer。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stu</span>:</span></span><br><span class="line">    age = Stu_descriptor()</span><br><span class="line"></span><br><span class="line">stu = Stu()</span><br><span class="line"></span><br><span class="line">stu = Stu()</span><br><span class="line">stu.age = <span class="number">12</span></span><br><span class="line">print(stu.age)</span><br><span class="line"><span class="keyword">del</span> stu.age</span><br><span class="line">stu = <span class="number">10</span> <span class="comment">#自动回收内存</span></span><br></pre></td></tr></table></figure></div>

<h5 id="触发描述符的魔术方法"><a href="#触发描述符的魔术方法" class="headerlink" title="触发描述符的魔术方法"></a>触发描述符的魔术方法</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu.age = <span class="number">12</span></span><br><span class="line">修改了val的值</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu.age</span><br><span class="line">获取了val的值</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> stu.age</span><br><span class="line">删除了val属性</span><br></pre></td></tr></table></figure></div>

<ul>
<li><h5 id="数据描述符（data-descriptor）"><a href="#数据描述符（data-descriptor）" class="headerlink" title="数据描述符（data descriptor）"></a>数据描述符（data descriptor）</h5></li>
<li><h5 id="非数据描述符（non-data-descriptors）"><a href="#非数据描述符（non-data-descriptors）" class="headerlink" title="非数据描述符（non-data descriptors）"></a>非数据描述符（non-data descriptors）</h5></li>
</ul>
<p>数据描述符：定义了<code>__set__</code> 和<code>__get__</code> 方法的对象(property是数据描述符)</p>
<p>非数据描述符：只定义了<code>__get__</code> 方法的对象(staticmethod，classmethod是非数据描述符)</p>
<h5 id="与魔术方法-del-方法的不同"><a href="#与魔术方法-del-方法的不同" class="headerlink" title="与魔术方法__del__方法的不同"></a>与魔术方法<code>__del__</code>方法的不同</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stu</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"对象内存已被回收"</span>)</span><br><span class="line">stu1 = Stu()</span><br><span class="line">stu2 = Stu()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> stu1</span><br><span class="line">对象内存已被回收</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stu2 = <span class="number">10</span></span><br><span class="line">对象内存已被回收</span><br></pre></td></tr></table></figure></div>

<p><code>__del__</code>方法是对象内存被回收（包括自动回收）时触发，此方法一般无须定义。<br>因为Python是一门高级语言，程序员在使用时无需关心内存的分配和释放，<br>因为此工作都是交给Python解释器来执行，<br>所以，析构函数的调用是由解释器在进行垃圾回收时自动触发执行的<br>更多的魔术方法将在后面介绍</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十一)</title>
    <url>/Python/Python_id_39.html</url>
    <content><![CDATA[<h2 id="迭代器和生成器"><a href="#迭代器和生成器" class="headerlink" title="迭代器和生成器"></a>迭代器和生成器</h2><h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><p>迭代器（<code>iterator</code>）必须提供<code>.__next__()</code>方法<br><code>.__next__()</code>执行要么返回下一个迭代器<br>要么抛出<code>StopIteration</code>异常以标识迭代完成</p>
<a id="more"></a>

<h4 id="可迭代对象"><a href="#可迭代对象" class="headerlink" title="可迭代对象"></a>可迭代对象</h4><p>实现了迭代器协议的对象，是<code>Iterable</code>但不是<code>Iterator</code>。<br><code>list</code>、<code>dict</code>、<code>str</code>等都是可迭代对象<br>提供了<code>.__iter__()</code>方法，每次执行都会创建一个<strong>初始的</strong>迭代器。<br>python的内部工具（<code>for</code>语句，<code>sum()</code>函数，<code>list()</code>函数等）使用迭代器协议访问对象<br>同一个可迭代对象生成的可迭器<strong>互不影响</strong>，但是具有<strong>惰性</strong>（见下）。</p>
<h4 id="for循环机制"><a href="#for循环机制" class="headerlink" title="for循环机制"></a>for循环机制</h4><p><code>for</code>循环/<code>list()</code>的等内部做的事情:</p>
<ul>
<li>对需要遍历的对象执行<code>.__iter__()</code>初始化为迭代器</li>
<li>迭代器<code>.__next__()</code>访问下一个可迭代对象</li>
<li>捕获<code>StopIteration</code>异常</li>
</ul>
<p>它既可以遍历有序列类型 也可遍历无序列类型</p>
<h4 id="内置函数next-iter"><a href="#内置函数next-iter" class="headerlink" title="内置函数next() iter()"></a>内置函数<code>next()</code> <code>iter()</code></h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="RUBY"><figure class="iseeu highlight /ruby"><table><tr><td class="code"><pre><span class="line"><span class="keyword">next</span>(Obj)<span class="string">` 相当于 `</span>Obj.__next_<span class="number">_</span>()</span><br><span class="line">iter(Obj)<span class="string">` 相当于 `</span>Obj.__iter_<span class="number">_</span>()</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; a = <span class="string">"1234"</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; a = iter(a)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; next(a)</span><br><span class="line"><span class="string">'1'</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; next(a)</span><br><span class="line"><span class="string">'2'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; a</span><br><span class="line">&lt;str_iterator object at <span class="number">0x0000000002AD6438</span>&gt;</span><br></pre></td></tr></table></figure></div>

<p>类似于之前闭包章节的累加函数，同一个迭代器对象生成的迭代器<strong>互不影响</strong>：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">"1234"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = iter(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = iter(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(b)</span><br><span class="line"><span class="string">'1'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(b)</span><br><span class="line"><span class="string">'2'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(c)</span><br><span class="line"><span class="string">'1'</span></span><br></pre></td></tr></table></figure></div>

<p>但是生成的迭代器会受到迭代器对象本身的影响（<strong>惰性</strong>）：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = iter(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(b)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">-1</span>] = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(b)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(b)</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<p>所以<code>for in</code>语句中改变被迭代对象本体会对循环产生影响。</p>
<h4 id="自实现迭代器"><a href="#自实现迭代器" class="headerlink" title="自实现迭代器"></a>自实现迭代器</h4><p>创建一个返回数字的迭代器对象，初始值为 1，逐步递增 1</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyNumbers</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> self</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">    x = self.a</span><br><span class="line">    self.a += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"> </span><br><span class="line">myclass = MyNumbers()</span><br><span class="line">myiter = iter(myclass)</span><br><span class="line"></span><br><span class="line">print(next(myiter))</span><br><span class="line">print(next(myiter))</span><br><span class="line">print(next(myiter))</span><br><span class="line">print(next(myiter))</span><br><span class="line">print(next(myiter))</span><br></pre></td></tr></table></figure></div>

<p>迭代器的基类是<code>from collections.abc import Iterable</code>， 可以这样判别。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(myiter, Iterable)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></div>

<h3 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h3><p>在python中生成器（generator）也是属于迭代器<br>自己实现了迭代器协议，非迭代器对象<code>.__iter__()</code>方法生成的迭代器。<br>在python3中，大部分内置函数如<code>range</code>、<code>map</code>、<code>filter</code>等的返回值都可视为生成器<br>因为<code>range(10**10)</code>比<code>list(range(10**10))</code>占用的内存要小得多</p>
<h4 id="生成器函数"><a href="#生成器函数" class="headerlink" title="生成器函数"></a>生成器函数</h4><p>也叫作<strong>惰性函数</strong><br>使用<code>yield</code>而不是return<br>生成器函数执行返回一个生成器<br>生成器每次next返回一个生成器函数的<code>yield</code>，函数的状态被保存了</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(b)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(b)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(b)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">&lt;generator object a at <span class="number">0x0000000002B002A0</span>&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="生成器表达式"><a href="#生成器表达式" class="headerlink" title="生成器表达式"></a>生成器表达式</h4><p>类似以前讲过的列表解析 但是不是使用中括号,而是使用圆括号</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#前文的使用yield的惰性函数a等效于这个：</span></span><br><span class="line">a = (i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>, <span class="number">6</span>))</span><br></pre></td></tr></table></figure></div>

<p>生成器表达式占用的内存比列表解析小得多。避免超长的列表产生。</p>
<p>注意</p>
<p>在with语句中（如文件句柄管理）定义的迭代器/迭代器对象/生成器<br>由于惰性使用，在with语句关闭之后会导致其生成的可迭代对象next方法报错</p>
<h4 id="其他生成器方法"><a href="#其他生成器方法" class="headerlink" title="其他生成器方法"></a>其他生成器方法</h4><ul>
<li><strong><code>.send()</code>方法</strong></li>
<li><code>.close()</code>方法</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="LIVECODESERVER"><figure class="iseeu highlight /livecodeserver"><table><tr><td class="code"><pre><span class="line">.<span class="built_in">send</span>()`的其参数将作为上一个yield语句的返回值来进行下一个`__next__()</span><br><span class="line">def <span class="keyword">a</span>():</span><br><span class="line">    n = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>: </span><br><span class="line">        print(n := (n + (yield n)))</span><br><span class="line">        </span><br><span class="line">b = <span class="keyword">a</span>()</span><br><span class="line">print(next(b)) <span class="comment"># 1</span></span><br><span class="line">b.<span class="built_in">send</span>(<span class="number">5</span>) <span class="comment"># 6</span></span><br><span class="line">b.<span class="built_in">send</span>(<span class="number">5</span>) <span class="comment"># 11</span></span><br><span class="line">b.<span class="built_in">send</span>(<span class="number">5</span>) <span class="comment"># 16</span></span><br><span class="line">b.<span class="built_in">send</span>(<span class="number">5</span>) <span class="comment"># 21</span></span><br><span class="line">b.<span class="built_in">send</span>(<span class="number">5</span>) <span class="comment"># 16</span></span><br><span class="line">b.<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure></div>

<h3 id="zip-iter-list-int"><a href="#zip-iter-list-int" class="headerlink" title="zip(*[iter(list)]*int)"></a><code>zip(*[iter(list)]*int)</code></h3><p>这是一个比较巧妙的用法</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(zip(*[iter([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>])]*<span class="number">3</span>))</span><br><span class="line">[(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>),(<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>)]</span><br></pre></td></tr></table></figure></div>

<h3 id="itertools模块"><a href="#itertools模块" class="headerlink" title="itertools模块"></a>itertools模块</h3><p>内置模块<code>itertools</code>提供了非常有用的用于操作迭代对象的函数</p>
<ul>
<li><code>itertools.count(1)</code>无限计数器</li>
<li><code>itertools.cycle(&#39;吼啦迷迭吼啦哟&#39;)</code>无限迭代器</li>
<li><code>itertools.repeat(&#39;呐&#39;, 3)</code>复读机 次数可选 默认无限</li>
<li><code>itertools.chain(&#39;吼啦迷迭&#39;, &#39;吼啦哟&#39;)</code>接头迭代器</li>
<li><code>itertools.groupby(&#39;neeeee,mooooo&#39;)</code>分组迭代器 相邻的相等的一组</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二十)</title>
    <url>/Python/Python_id_38.html</url>
    <content><![CDATA[<h2 id="递归和深拷贝"><a href="#递归和深拷贝" class="headerlink" title="递归和深拷贝"></a>递归和深拷贝</h2><h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><blockquote>
<p>在计算机中，函数调用是通过栈（stack）这种数据结构实现的，每当进入一个函数调用，栈就会加一层栈帧，每当函数返回，栈就会减一层栈帧。由于栈的大小不是无限的，所以，递归调用的次数过多，会导致栈溢出。</p>
</blockquote>
<p>递归实例:汉诺塔</p>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(n,home = <span class="string">"A柱"</span>,destination = <span class="string">"C柱"</span>,assistance = <span class="string">"B柱"</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">1</span> :</span><br><span class="line">        print(<span class="string">"\t将"</span>+ home + <span class="string">"的最上面的环移动到"</span> + destination + <span class="string">"的最上面"</span>)</span><br><span class="line">    <span class="keyword">if</span> n&gt;<span class="number">1</span> :</span><br><span class="line">        move(n<span class="number">-1</span>,home,assistance,destination)</span><br><span class="line">        move(<span class="number">1</span>,home,destination,assistance)</span><br><span class="line">        move(n<span class="number">-1</span>,assistance,destination,home)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>move(<span class="number">1</span>)</span><br><span class="line">	将A柱的最上面的环移动到C柱的最上面</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>move(<span class="number">2</span>)</span><br><span class="line">	将A柱的最上面的环移动到B柱的最上面</span><br><span class="line">	将A柱的最上面的环移动到C柱的最上面</span><br><span class="line">	将B柱的最上面的环移动到C柱的最上面</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>move(<span class="number">3</span>)</span><br><span class="line">	将A柱的最上面的环移动到C柱的最上面</span><br><span class="line">	将A柱的最上面的环移动到B柱的最上面</span><br><span class="line">	将C柱的最上面的环移动到B柱的最上面</span><br><span class="line">	将A柱的最上面的环移动到C柱的最上面</span><br><span class="line">	将B柱的最上面的环移动到A柱的最上面</span><br><span class="line">	将B柱的最上面的环移动到C柱的最上面</span><br><span class="line">	将A柱的最上面的环移动到C柱的最上面</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></div>

<p>写一个装饰器来探究这个函数开辟了多少个作用域吧</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(func)</span>:</span></span><br><span class="line">    step=<span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> step</span><br><span class="line">        step+=<span class="number">1</span></span><br><span class="line">        print(<span class="string">"第%s个函数作用域被开辟"</span>%step)</span><br><span class="line">        res=func(*args,**kwargs)</span><br><span class="line">        print(<span class="string">"第%s个函数作用域被销毁"</span>%step)</span><br><span class="line">        step-=<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@foo</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(n,home = <span class="string">"A柱"</span>,destination = <span class="string">"C柱"</span>,assistance = <span class="string">"B柱"</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">1</span> :</span><br><span class="line">        print(<span class="string">"\t将"</span>+ home + <span class="string">"的最上面的环移动到"</span> + destination + <span class="string">"的最上面"</span>)</span><br><span class="line">    <span class="keyword">if</span> n&gt;<span class="number">1</span> :</span><br><span class="line">        move(n<span class="number">-1</span>,home,assistance,destination)</span><br><span class="line">        move(<span class="number">1</span>,home,destination,assistance)</span><br><span class="line">        move(n<span class="number">-1</span>,assistance,destination,home)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>move(<span class="number">1</span>)</span><br><span class="line">第<span class="number">1</span>个函数作用域被开辟</span><br><span class="line">	将A柱的最上面的环移动到C柱的最上面</span><br><span class="line">第<span class="number">1</span>个函数作用域被销毁</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>move(<span class="number">2</span>)</span><br><span class="line">第<span class="number">1</span>个函数作用域被开辟</span><br><span class="line">第<span class="number">2</span>个函数作用域被开辟</span><br><span class="line">	将A柱的最上面的环移动到B柱的最上面</span><br><span class="line">第<span class="number">2</span>个函数作用域被销毁</span><br><span class="line">第<span class="number">2</span>个函数作用域被开辟</span><br><span class="line">	将A柱的最上面的环移动到C柱的最上面</span><br><span class="line">第<span class="number">2</span>个函数作用域被销毁</span><br><span class="line">第<span class="number">2</span>个函数作用域被开辟</span><br><span class="line">	将B柱的最上面的环移动到C柱的最上面</span><br><span class="line">第<span class="number">2</span>个函数作用域被销毁</span><br><span class="line">第<span class="number">1</span>个函数作用域被销毁</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="comment">#由此可见 递归的性能消耗有多大</span></span><br></pre></td></tr></table></figure></div>

<h3 id="尾递归"><a href="#尾递归" class="headerlink" title="尾递归"></a>尾递归</h3><blockquote>
<p>尾递归是指，在函数返回的时候，调用自身本身，并且，return语句不能包含表达式。这样，编译器或者解释器就可以把尾递归做优化，使递归本身无论调用多少次，都只占用一个栈帧，不会出现栈溢出的情况。</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#一般递归</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">normal_recursion</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> n + normal_recursion(n<span class="number">-1</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#尾递归</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tail_recursion</span><span class="params">(n, total=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> total</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> tail_recursion(n<span class="number">-1</span>, total+n)</span><br></pre></td></tr></table></figure></div>

<p>最后一步调用,形成”调用栈”<br>复杂度 O(n) =&gt; O(1)<br>遗憾的是，大多数编程语言没有针对尾递归做优化，Python解释器也没有做优化，所以，即使把上面的函数改成尾递归方式，也会导致栈溢出。</p>
<p> 但是一个牛人想出的解决办法：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">实现一个 tail_call_optimized 装饰器</span><br><span class="line"><span class="comment">#!/usr/bin/env python2.4</span></span><br><span class="line"><span class="comment"># This program shows off a python decorator(</span></span><br><span class="line"><span class="comment"># which implements tail call optimization. It</span></span><br><span class="line"><span class="comment"># does this by throwing an exception if it is</span></span><br><span class="line"><span class="comment"># it's own grandparent, and catching such</span></span><br><span class="line"><span class="comment"># exceptions to recall the stack.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TailRecurseException</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, args, kwargs)</span>:</span></span><br><span class="line">        self.args = args</span><br><span class="line">        self.kwargs = kwargs</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tail_call_optimized</span><span class="params">(g)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    This function decorates a function with tail call</span></span><br><span class="line"><span class="string">    optimization. It does this by throwing an exception</span></span><br><span class="line"><span class="string">    if it is it's own grandparent, and catching such</span></span><br><span class="line"><span class="string">    exceptions to fake the tail call optimization.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This function fails if the decorated</span></span><br><span class="line"><span class="string">    function recurses in a non-tail context.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        f = sys._getframe()</span><br><span class="line">        <span class="keyword">if</span> f.f_back <span class="keyword">and</span> f.f_back.f_back \</span><br><span class="line">            <span class="keyword">and</span> f.f_back.f_back.f_code == f.f_code:</span><br><span class="line">            <span class="comment"># 抛出异常</span></span><br><span class="line">            <span class="keyword">raise</span> TailRecurseException(args, kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">return</span> g(*args, **kwargs)</span><br><span class="line">                <span class="keyword">except</span> TailRecurseException, e:</span><br><span class="line">                    args = e.args</span><br><span class="line">                    kwargs = e.kwargs</span><br><span class="line">    func.__doc__ = g.__doc__</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line"><span class="meta">@tail_call_optimized</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n, acc=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="string">"calculate a factorial"</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> acc</span><br><span class="line">    <span class="keyword">return</span> factorial(n<span class="number">-1</span>, n*acc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> factorial(<span class="number">10000</span>)</span><br></pre></td></tr></table></figure></div>

<p>原文<a href="http://code.activestate.com/recipes/474088-tail-call-optimization-decorator/" target="_blank" rel="noopener">http://code.activestate.com/recipes/474088-tail-call-optimization-decorator/</a></p>
<h3 id="深浅拷贝"><a href="#深浅拷贝" class="headerlink" title="深浅拷贝"></a>深浅拷贝</h3><p>浅拷贝</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">l2 = l1</span><br></pre></td></tr></table></figure></div>

<p>对于赋值运算来说,2个列表名,指向的是同一个内存地址，所以他们是完全一样的。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">l2 = l1.copy()</span><br></pre></td></tr></table></figure></div>

<p>对于浅copy来说，只是在内存中重新创建了开辟了一个空间存放一个新列表，但是新列表中的元素与原列表中的元素是公用的。</p>
<h4 id="借助copy模块"><a href="#借助copy模块" class="headerlink" title="借助copy模块"></a>借助copy模块</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">l2 = copy.deepcopy(l1)</span><br></pre></td></tr></table></figure></div>

<p>对于深copy来说，列表是在内存中重新创建的，列表中可变的数据类型是重新创建的，列表中的不可变的数据类型是公用的。</p>
<blockquote>
<h5 id="如果需要自己写一个函数来实现深拷贝，那么可以通过递归实现。"><a href="#如果需要自己写一个函数来实现深拷贝，那么可以通过递归实现。" class="headerlink" title="#如果需要自己写一个函数来实现深拷贝，那么可以通过递归实现。"></a><a href="http://nanarino.metoyun.com/py/14-递归和深拷贝.html#如果需要自己写一个函数来实现深拷贝，那么可以通过递归实现。" target="_blank" rel="noopener">#</a>如果需要自己写一个函数来实现深拷贝，那么可以通过递归实现。</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">dt = &#123;<span class="string">"a"</span>: <span class="string">"aaa"</span>, <span class="string">"b"</span>: <span class="string">"bbb"</span>, <span class="string">"c"</span>: &#123;<span class="string">"c1"</span>: <span class="number">11</span>, <span class="string">"c2"</span>: &#123;<span class="string">"c21"</span>: <span class="string">"211"</span>, <span class="string">"c22"</span>: <span class="string">"212"</span>, <span class="string">"c23"</span>: <span class="string">"213"</span>&#125;, <span class="string">"c3"</span>: <span class="number">33</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copy_dict</span><span class="params">(d)</span>:</span></span><br><span class="line">    res = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> d.items():</span><br><span class="line">        <span class="comment"># 如果不是dict字典，则直接赋值</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, dict):</span><br><span class="line">            res[key] = value</span><br><span class="line">        <span class="comment"># 如果还是字典，递归调用copy_dict(d)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res[key] = copy_dict(value)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">print(<span class="string">"复制前："</span> + str(dt))</span><br><span class="line">copy_dt = copy_dict(dt)</span><br><span class="line">print(<span class="string">"复制后："</span> + str(copy_dict(dt)))</span><br></pre></td></tr></table></figure></div></blockquote>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十九)</title>
    <url>/Python/Python_id_37.html</url>
    <content><![CDATA[<h2 id="闭包和装饰器"><a href="#闭包和装饰器" class="headerlink" title="闭包和装饰器"></a>闭包和装饰器</h2><p>闭包是函数作用域的体现<br>装饰器本质就是函数,功能是为其他函数添加附加功能</p>
<a id="more"></a>

<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><blockquote>
<p>闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。所以，闭包是由函数和与其相关的引用环境组合而成的实体。</p>
<p>闭包的原理，当内嵌函数引用了包含它的函数（enclosing function）中的non-local 变量后，这些变量会被保存在enclosing function的<code>__closure__</code>属性中，成为enclosing function本身的一部分；也就是说，这些变量的生命周期会和enclosing function一样。</p>
<p>在Python中创建一个闭包可以归结为以下三点：</p>
<ul>
<li>闭包函数必须有内嵌函数</li>
<li>内嵌函数需要引用该嵌套函数上一级namespace中的变量</li>
<li>闭包函数必须返回内嵌函数</li>
</ul>
</blockquote>
<h4 id="闭包示例"><a href="#闭包示例" class="headerlink" title="闭包示例"></a>闭包示例</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    step = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add1</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> step</span><br><span class="line">        step += <span class="number">1</span></span><br><span class="line">        print(step)</span><br><span class="line">    <span class="keyword">return</span> add1</span><br><span class="line"><span class="comment">#foo函数执行会返回一个累加作用的函数add1 </span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo()()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo()()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo()()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="comment">#函数执行结束作用域立即销毁 得利于python解释器的自动回收垃圾的机制</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=foo()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b=foo()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[str(c.cell_contents) <span class="keyword">for</span> c <span class="keyword">in</span> a.__closure__][<span class="number">0</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[str(c.cell_contents) <span class="keyword">for</span> c <span class="keyword">in</span> a.__closure__][<span class="number">0</span>]</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[str(c.cell_contents) <span class="keyword">for</span> c <span class="keyword">in</span> a.__closure__][<span class="number">0</span>]</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="comment">#闭包让作用域不会被销毁 </span></span><br><span class="line"><span class="comment">#__closure__属性拿到所引用的内部变量的内存地址（只做了解）</span></span><br></pre></td></tr></table></figure></div>

<p>由于内存得不到自动释放，这里的foo执行会生成<strong>互不影响</strong>的累加器。<br>这与之后章节的生成器具有相同的功能。</p>
<h3 id="开放封闭原则"><a href="#开放封闭原则" class="headerlink" title="开放封闭原则"></a>开放封闭原则</h3><blockquote>
<p>不修改被修饰函数的源代码 不修改被修改函数的调用方式</p>
</blockquote>
<h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><p>在python中，装饰器（<code>Decorator</code>）就是一个返回函数的高阶函数，修改了目标函数的功能且符合开放封闭原则</p>
<h4 id="装饰器的实现"><a href="#装饰器的实现" class="headerlink" title="装饰器的实现"></a>装饰器的实现</h4><p>利用: 高阶函数 和 闭包</p>
<ul>
<li>装饰器名foo</li>
<li>被修饰的函数名bar</li>
</ul>
<p>bar声明的前一行<code>@foo</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        code</span><br><span class="line">        ret = func(*args,**kwargs)</span><br><span class="line">        code</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line">    </span><br><span class="line"><span class="meta">@foo</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br></pre></td></tr></table></figure></div>

<p>相当于<code>bar = foo(bar)</code>，这样，在不改变<code>bar</code>调用方式的情况下增加了<code>bar</code>的功能<br>但是 ,<code>bar</code>的函数名却被修改为了<code>&#39;wrapper&#39;</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>bar.__name__</span><br><span class="line"><span class="string">'wrapper'</span></span><br></pre></td></tr></table></figure></div>

<p>使用装饰器<code>functools.wraps</code>修改马甲，完整版如下</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        code</span><br><span class="line">        ret = func(*args,**kwargs)</span><br><span class="line">        code</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line">    </span><br><span class="line"><span class="meta">@foo</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br></pre></td></tr></table></figure></div>

<p>更复杂的装饰器也只是在这个基础上套娃。</p>
<h3 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h3><p>不同于数学意义，偏函数（Partial function），可以把函数分两次调用，每次传一部分参数的函数。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">def foo(x, y):</span><br><span class="line">    return x + y</span><br></pre></td></tr></table></figure></div>

<p>高阶函数<code>functools.partial</code>可以帮助我们创建一个偏函数</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> functools</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bar = functools.partial(foo, y=<span class="number">-100</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bar(<span class="number">50</span>)</span><br><span class="line"><span class="number">-50</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bar(x=<span class="number">100</span>)</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十八)</title>
    <url>/Python/Python_id_36.html</url>
    <content><![CDATA[<h2 id="函数和作用域"><a href="#函数和作用域" class="headerlink" title="函数和作用域"></a>函数和作用域</h2><p>前面已经学习了很多内置函数和各种数据类型的对象的方法。</p>
<h3 id="函数声明格式"><a href="#函数声明格式" class="headerlink" title="函数声明格式"></a>函数声明格式</h3><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> 函数名<span class="params">(形参)</span>:</span></span><br><span class="line">	code</span><br><span class="line">	<span class="keyword">return</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>return语句不写默认返回<code>None</code></li>
<li>return语句接多个表达式会返回为元组</li>
<li>可以使用pass语句占位</li>
</ul>
<h4 id="传递实参"><a href="#传递实参" class="headerlink" title="传递实参"></a>传递实参</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#位置参数，一一对应</span></span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">#关键字参数</span></span><br><span class="line">foo(a=<span class="number">1</span>, b=<span class="number">2</span>, c=<span class="number">3</span>)</span><br><span class="line"><span class="comment">#混合使用时，位置参数要先占坑</span></span><br></pre></td></tr></table></figure></div>

<p><strong>注意</strong></p>
<p>给形参传递实参相当于是直接赋值，对于引用类型来讲相当于起别名。<br>这会导致定义的函数可能不是纯函数（所传递进去的原列表字典等参数可以被影响）<br>可以使用（深）拷贝等方法在操作引用类型时达到纯函数的效果</p>
<h4 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 必传的参数 要在 有默认值的参数 之前</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(a, b, c=None)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div>

<p><strong>注意</strong></p>
<p>在python中，默认参数不能是其他形参构成的表达式。（不要：<code>def f(a, b=len(a)):</code>）</p>
<p>在python中，参数所在的小括号并不属于函数命名空间也不是独立的块作用域，<br>所以不要使用默认参数来初始化空列表和空字典。（不要：<code>def f(a, b=[]):</code>）<br>可以用<code>def f(a, b=None):</code>和<code>if b is None: b = []</code>来赋值</p>
<h4 id="剩余参数"><a href="#剩余参数" class="headerlink" title="剩余参数"></a>剩余参数</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AUTOHOTKEY"><figure class="iseeu highlight /autohotkey"><table><tr><td class="code"><pre><span class="line">*元组`（不限于元组）， `**字典</span><br></pre></td></tr></table></figure></div>

<h5 id="接收"><a href="#接收" class="headerlink" title="接收"></a>接收</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">    print(args)</span><br><span class="line">    print(kwargs)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bar(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, x=<span class="number">5</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">&#123;<span class="string">'x'</span>: <span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure></div>

<h5 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(a,b,c)</span>:</span></span><br><span class="line">    print(a)</span><br><span class="line">    print(b)</span><br><span class="line">    print(c)</span><br><span class="line"></span><br><span class="line"><span class="comment">#剩余的参数由列表填充（位置参数）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(<span class="number">1</span>,*[<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#剩余的参数由字典填充（关键字参数）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(<span class="number">1</span>,**&#123;<span class="string">"b"</span>:<span class="number">2</span>, <span class="string">"c"</span>:<span class="number">3</span>&#125;)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#混合使用时，要先由*列表填充再用**字典填充</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo(*(<span class="number">1</span>, <span class="number">2</span>,), **&#123;<span class="string">"c"</span>:<span class="number">3</span>&#125;)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></div>

<p>在python3.8中新增使用<code>/</code> 和<code>*</code>分割的用法：<br>强制限制函数的参数只允许以位置参数或者关键字参数的方式传入。<br><code>/</code>之前的参数必须是位置参数，<code>*</code>之后的参数必须是关键字参数</p>
<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><p>变量在声明时所在的作用域，也叫作<code>local namespace</code>（当前函数命名空间）<br>函数在声明时所在的作用域是可以层层向外层搜索的<br>不同的函数作用域中区分声明和赋值:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">global</span> name    <span class="comment">#全局作用域</span></span><br><span class="line"><span class="keyword">nonlocal</span> name    <span class="comment">#非全局的相比更外层的作用域</span></span><br></pre></td></tr></table></figure></div>

<p>Python中通过提供 namespace 来实现重名函数/方法、变量等信息的识别，其一共有三种 namespace，分别为：</p>
<ul>
<li>local namespace: 作用范围为当前函数或者类方法</li>
<li>global namespace: 作用范围为当前模块</li>
<li>build-in namespace: 作用范围为所有模块</li>
</ul>
<p>当函数/方法、变量等信息发生重名时，Python会按照<br><code>local namespace</code> -&gt; <code>global namespace</code> -&gt; <code>build-in namespace</code><br>的顺序搜索用户所需元素，并且以第一个找到此元素的 namespace 为准。</p>
<p>同时，Python中的内建函数<code>locals()</code>和<code>globals()</code>可以用来查看不同namespace中定义的元素。</p>
<h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><p>return冒号右边的语句的返回值</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">lambda</span> x:x+<span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<p>匿名函数作为参数：以list.sort的key为例</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#list.sort(cmp=None, key=None, reverse=False)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst = [<span class="string">'3'</span>,<span class="string">'14'</span>,<span class="string">'72'</span>,<span class="string">'108'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst.sort()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst</span><br><span class="line">[<span class="string">'108'</span>, <span class="string">'14'</span>, <span class="string">'3'</span>, <span class="string">'72'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst.sort(key = <span class="keyword">lambda</span> x:int(x))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lst</span><br><span class="line">[<span class="string">'3'</span>, <span class="string">'14'</span>, <span class="string">'72'</span>, <span class="string">'108'</span>]</span><br></pre></td></tr></table></figure></div>

<h4 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h4><ul>
<li>不可变：不用变量保存状态,不修改变量</li>
<li>第一类对象：函数即变量</li>
</ul>
<h3 id="高阶函数-map-filter-reduce"><a href="#高阶函数-map-filter-reduce" class="headerlink" title="高阶函数 map() filter() reduce()"></a>高阶函数 <code>map()</code> <code>filter()</code> <code>reduce()</code></h3><p>Py3里 <code>reduce()</code>被收入了<code>functools</code>模块中<br>Py2中 <code>filter()</code> <code>reduce()</code>返回的是列表, 而 Py3 中返回到是一个迭代器。</p>
<p>其上实现了 <code>__iter__</code> 和 <code>__next__</code> 方法故而可直接用于<code>for in</code>语句。<br>也可以用<code>list()</code>函数将迭代器转为列表（不限于列表）。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 计算列表各个元素的平方</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(<span class="keyword">lambda</span> x: x ** <span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]))</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br><span class="line"><span class="comment"># 提供了两个列表，对相同位置的列表数据进行相加</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(<span class="keyword">lambda</span> x, y: x + y, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>], [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>]))</span><br><span class="line">[<span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">19</span>]</span><br><span class="line"><span class="comment">#过滤出列表中的所有奇数：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_odd</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> n % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">&gt;&gt;&gt;list(filter(is_odd, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]))</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br><span class="line"><span class="comment">#使用reduce记录词频：</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">statistics</span><span class="params">(dic,k)</span>:</span> </span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> k <span class="keyword">in</span> dic: </span><br><span class="line">    dic[k] = <span class="number">1</span> </span><br><span class="line">  <span class="keyword">else</span>: </span><br><span class="line">    dic[k] +=<span class="number">1</span> </span><br><span class="line">  <span class="keyword">return</span> dic </span><br><span class="line">lst = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>] </span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;reduce(statistics,lst,&#123;&#125;)</span><br><span class="line">&#123;<span class="number">1</span>: <span class="number">2</span>, <span class="number">2</span>: <span class="number">2</span>, <span class="number">3</span>: <span class="number">3</span>, <span class="number">5</span>: <span class="number">4</span>, <span class="number">6</span>: <span class="number">2</span>, <span class="number">7</span>: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><p>罗列了（包含前面已经学过的）内置函数，每一个函数请自己敲一遍。</p>
<h4 id="文件处理"><a href="#文件处理" class="headerlink" title="文件处理"></a>文件处理</h4><p><code>open()</code> 打开一个文件，返回一个文件操作符(文件句柄)<br>操作文件的模式有<code>r,w,a,r+,w+,a+</code>共6种<br>每一种方式都可以用二进制的形式操作(<code>rb,wb,ab,rb+,wb+,ab+</code>)<br>可以用<code>encoding=指定编码</code>。</p>
<h4 id="作用域相关"><a href="#作用域相关" class="headerlink" title="作用域相关"></a>作用域相关</h4><p><code>globals()</code>——获取全局变量的字典<br><code>locals()</code>——获取执行本方法所在命名空间内的局部变量的字典</p>
<h4 id="控制台相关"><a href="#控制台相关" class="headerlink" title="控制台相关"></a>控制台相关</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line">input()` 输入</span><br><span class="line">`<span class="builtin-name">print</span>()` 输出</span><br><span class="line">`<span class="builtin-name">print</span>(value, <span class="built_in">..</span>., <span class="attribute">sep</span>=<span class="string">' '</span>, <span class="attribute">end</span>=<span class="string">'\n'</span>, <span class="attribute">file</span>=sys.stdout, <span class="attribute">flush</span>=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>file: 默认是输出到屏幕，如果设置为文件句柄，输出到文件</li>
<li>sep: 打印多个值之间的分隔符，默认为空格</li>
<li>end: 每一次打印的结尾，默认为换行符</li>
<li>flush: 立即把内容输出到流文件，不作缓存</li>
</ul>
<h4 id="数据类型相关"><a href="#数据类型相关" class="headerlink" title="数据类型相关"></a>数据类型相关</h4><p><code>type(o)</code> 返回变量o的数据类型</p>
<h4 id="内存相关"><a href="#内存相关" class="headerlink" title="内存相关"></a>内存相关</h4><p><code>id(o)</code> o是参数，返回一个变量的内存地址<br><code>hash(o)</code> o是参数，返回一个可hash变量的哈希值，不可hash的变量被hash之后会报错。</p>
<h4 id="帮助方法"><a href="#帮助方法" class="headerlink" title="帮助方法"></a>帮助方法</h4><p>在控制台执行<code>help()</code>进入帮助模式。可以随意输入变量或者变量的类型。输入q退出<br>或者直接执行<code>help(o)</code>，o是参数，查看和变量o有关的操作。。。</p>
<h4 id="和调用相关"><a href="#和调用相关" class="headerlink" title="和调用相关"></a>和调用相关</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STYLUS"><figure class="iseeu highlight /stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">callable</span><span class="params">(o)</span></span>`，o是参数，看这个变量是不是可调用。如果o是一个函数名，就会返回`True</span><br></pre></td></tr></table></figure></div>

<h4 id="和数字相关"><a href="#和数字相关" class="headerlink" title="和数字相关"></a>和数字相关</h4><p>数据类型相关：bool，int，float，complex<br>进制转换相关：bin，oct，hex<br>数学运算：abs，divmod，min，max，sum，round，pow</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">abs()<span class="comment">#绝对值 复数的模</span></span><br><span class="line">bin()<span class="comment">#十进制转二进制</span></span><br><span class="line">hex()<span class="comment">#十进制转十六进制</span></span><br><span class="line">oct()<span class="comment">#十进制转八进制</span></span><br><span class="line">bool()<span class="comment">#转布尔类型</span></span><br><span class="line">max(list)<span class="comment">#可迭代对象内部逐位比较 最大</span></span><br><span class="line">min(list)<span class="comment">#可迭代对象内部逐位比较 最小</span></span><br><span class="line">max(list,key=lamdba dic:dic[<span class="string">'keyname'</span>])<span class="comment">#元素之间比较</span></span><br><span class="line">pow(a,b)<span class="comment">#相当于a**b</span></span><br><span class="line">pow(a,b,c)<span class="comment">#相当于a**b%c</span></span><br><span class="line">round(num)<span class="comment">#四舍五入</span></span><br><span class="line">divmod(被除数,除数)<span class="comment">#返回元组:(商,余数)</span></span><br></pre></td></tr></table></figure></div>

<h4 id="和数据结构相关"><a href="#和数据结构相关" class="headerlink" title="和数据结构相关"></a>和数据结构相关</h4><p>列表和元组相关的：list和tuple<br>字符串相关的：str，format，bytes，bytearry，memoryview，ord，chr，ascii，repr<br>序列：reversed，slice<br>字典和集合：dict，set，frozenset<br>数据集合：len，sorted，enumerate，all，any，zip，filter，map</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">bytes(s,encoding=<span class="string">'utf-8'</span>)<span class="comment">#编码</span></span><br><span class="line">s.decode(<span class="string">'utf-8'</span>)<span class="comment">#解码（已废弃,直接用str(s,'utf-8')）</span></span><br><span class="line"></span><br><span class="line">chr(int)<span class="comment">#数字转asc字符</span></span><br><span class="line">ord(char)<span class="comment">#字符转asc码</span></span><br><span class="line"></span><br><span class="line">slice(start,stop,step)<span class="comment">#切片对象</span></span><br><span class="line"></span><br><span class="line">reversed(list)<span class="comment">#临时翻转</span></span><br><span class="line">sorted()<span class="comment">#临时排序  本质是比较大小</span></span><br><span class="line"></span><br><span class="line">zip(list1,list2)<span class="comment">#拉链 返回若干小元组(list1[0],list2[0])        </span></span><br><span class="line">enumerate()<span class="comment">#函数用于将一个可遍历的数据对象(如列表、元组或字符串)</span></span><br><span class="line"><span class="comment">#组合为一个索引序列，同时列出数据和数据下标，一般用在 for 循环当中。</span></span><br><span class="line"></span><br><span class="line">all()<span class="comment">#是否所有元素都为真 空容器也为真</span></span><br><span class="line">any()<span class="comment">#是否存在元素为真</span></span><br></pre></td></tr></table></figure></div>

<h4 id="模块操作相关"><a href="#模块操作相关" class="headerlink" title="模块操作相关"></a>模块操作相关</h4><p> <code>__import__(str)</code>导入模块</p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AUTOHOTKEY"><figure class="iseeu highlight /autohotkey"><table><tr><td class="code"><pre><span class="line">dir()`属性展开</span><br><span class="line">`eval()`将字符串当做python代码执行 魔鬼方法 不推荐使用</span><br><span class="line">`vars(obj)`查看对象下所有方法返回为字典 若无参数相当于`locals()</span><br></pre></td></tr></table></figure></div>

<p>……</p>
<p>在学完面向对象之后补充与面向对象有关的内置方法</p>
<h3 id="类型注解"><a href="#类型注解" class="headerlink" title="类型注解"></a>类型注解</h3><p>python3.6版本以上才可以使用<br>注解参数的类型 <code>-&gt;</code>后面是返回值的类型</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(step:int)</span> -&gt; int:</span></span><br></pre></td></tr></table></figure></div>

<p>结合默认参数一起使用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(step:int=<span class="number">1</span>)</span> -&gt; int:</span></span><br></pre></td></tr></table></figure></div>

<p>类型注解不做静态检查，只在IDE只提供提示</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十七)</title>
    <url>/Python/Python_id_35.html</url>
    <content><![CDATA[<h2 id="日志处理"><a href="#日志处理" class="headerlink" title="日志处理"></a>日志处理</h2><p>日志可以使用内置的<a href="https://docs.python.org/zh-cn/3/library/logging.html" target="_blank" rel="noopener"><code>logging</code></a>模块来生成<br>服务端的日志可以使用内置的<a href="https://docs.python.org/zh-cn/3/library/sqlite3.html" target="_blank" rel="noopener"><code>sqlite3</code></a>模块来持久化。</p>
<h3 id="logging模块"><a href="#logging模块" class="headerlink" title="logging模块"></a>logging模块</h3><a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="comment">##级别依次提高</span></span><br><span class="line">logging.debug(<span class="string">'排错信息'</span>)</span><br><span class="line">logging.info(<span class="string">'正常信息'</span>)</span><br><span class="line">logging.warning(<span class="string">'警告信息'</span>)</span><br><span class="line">logging.error(<span class="string">'错误信息'</span>)</span><br><span class="line">logging.critical(<span class="string">'严重错误信息'</span>)</span><br></pre></td></tr></table></figure></div>

<p>默认情况下Python的logging模块将日志打印到了标准输出（<code>sys.stdout</code>）中，<br>且只显示了大于等于WARNING级别的日志</p>
<p>默认的日志格式为 <code>日志级别：Logger名称：用户输出消息</code>。</p>
<p>它有两种配置方法</p>
<ul>
<li>配置logging全局参数</li>
<li>显式地创建logger实例并配置</li>
</ul>
<p>也可以同时在两处配置，logger实例上的配置优先级更高。</p>
<h4 id="配置logging全局参数"><a href="#配置logging全局参数" class="headerlink" title="配置logging全局参数"></a>配置logging全局参数</h4><p><code>basicConfig()</code>函数更改logging模块默认行为</p>
<ul>
<li>缺点：低版本python里中文会乱码,不能同时控制台打印和写入文件</li>
<li>优点：灵活配置日志级别，日志格式，和输出位置</li>
</ul>
<p>简单的配置：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging  </span><br><span class="line">logging.basicConfig(level=logging.DEBUG,</span><br><span class="line">        format=<span class="string">'%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s'</span>,  </span><br><span class="line">        datefmt=<span class="string">'%a, %d %b %Y %H:%M:%S'</span>,  </span><br><span class="line">        filename=<span class="string">'/tmp/test.log'</span>,  </span><br><span class="line">        filemode=<span class="string">'w'</span>)  </span><br><span class="line">  </span><br><span class="line">logging.debug(<span class="string">'debug message'</span>)  </span><br><span class="line">logging.info(<span class="string">'info message'</span>)  </span><br><span class="line">logging.warning(<span class="string">'warning message'</span>)  </span><br><span class="line">logging.error(<span class="string">'error message'</span>)  </span><br><span class="line">logging.critical(<span class="string">'critical message'</span>)</span><br></pre></td></tr></table></figure></div>

<h5 id="更多的配置选项"><a href="#更多的配置选项" class="headerlink" title="更多的配置选项"></a>更多的配置选项</h5><ul>
<li><code>filename</code>：用指定的文件名创建FiledHandler，这样日志会被存储在指定的文件中。</li>
<li><code>filemode</code>：文件打开方式，在指定了filename时使用这个参数，默认值为“a”还可指定为“w”。</li>
<li><code>format</code>：指定handler使用的日志显示格式。</li>
<li><code>datefmt</code>：指定日期时间格式。</li>
<li><code>level</code>：设置rootlogger的日志级别</li>
<li><code>stream</code>：创建指定的StreamHandler。默认sys.stderr可选sys.stdout或者文件句柄</li>
</ul>
<p>若指定了<code>filename</code>，则<code>stream</code>参数会被忽略。</p>
<h6 id="format参数中可能用到的格式化串"><a href="#format参数中可能用到的格式化串" class="headerlink" title="format参数中可能用到的格式化串"></a>format参数中可能用到的格式化串</h6><table>
<thead>
<tr>
<th>格式化串</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>%(name)s</code></td>
<td>Logger的名字</td>
</tr>
<tr>
<td><code>%(levelno)s</code></td>
<td>数字形式的日志级别</td>
</tr>
<tr>
<td><code>%(levelname)s</code></td>
<td>文本形式的日志级别</td>
</tr>
<tr>
<td><code>%(pathname)s</code></td>
<td>调用日志输出函数的模块的完整路径名</td>
</tr>
<tr>
<td><code>%(filename)s</code></td>
<td>调用日志输出函数的模块的文件名</td>
</tr>
<tr>
<td><code>%(module)s</code></td>
<td>调用日志输出函数的模块名</td>
</tr>
<tr>
<td><code>%(funcName)s</code></td>
<td>调用日志输出函数的函数名</td>
</tr>
<tr>
<td><code>%(lineno)d</code></td>
<td>调用日志输出函数的语句所在的代码行</td>
</tr>
<tr>
<td><code>%(created)f</code></td>
<td>当前时间，用UNIX标准的表示时间的浮点数表示</td>
</tr>
<tr>
<td><code>%(relativeCreated)d</code></td>
<td>输出日志信息时的，自Logger创建以来的毫秒数</td>
</tr>
<tr>
<td><code>%(asctime)s</code></td>
<td>字符串形式的当前时间。默认格式是“2003-07-08 16:49:45,896”</td>
</tr>
<tr>
<td><code>%(thread)d</code></td>
<td>线程ID</td>
</tr>
<tr>
<td><code>%(threadName)s</code></td>
<td>线程名</td>
</tr>
<tr>
<td><code>%(process)d</code></td>
<td>进程ID</td>
</tr>
<tr>
<td><code>%(message)s</code></td>
<td>用户输出的消息</td>
</tr>
</tbody></table>
<h4 id="配置logger实例参数"><a href="#配置logger实例参数" class="headerlink" title="配置logger实例参数"></a>配置logger实例参数</h4><p><code>logging.getLogger()</code>实例化一个记录器对象</p>
<p>即使不实例化，也会默认创建<code>root logger</code>，缺省值读取<code>basicConfig()</code>的配置<br>记录器对象可以设置：</p>
<ul>
<li><code>logger.setLevel(logging.ERROR)</code> 设置日志级别为ERROR</li>
<li><code>logger.addHandler(handler_name)</code> 为Logger实例增加一个处理器</li>
<li><code>logger.removeHandler(handler_name)</code> 为Logger实例删除一个处理器</li>
</ul>
<p>创建和添加处理器Handler</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logger = logging.getLogger()</span><br><span class="line"><span class="comment"># 用于写入日志文件的handler</span></span><br><span class="line">fh = logging.FileHandler(<span class="string">'test.log'</span>,encoding=<span class="string">'utf-8'</span>) </span><br><span class="line"><span class="comment"># 用于输出到控制台的handler</span></span><br><span class="line">ch = logging.StreamHandler()</span><br><span class="line"><span class="comment">#logger对象可以添加多个handler</span></span><br><span class="line">logger.addHandler(fh)</span><br><span class="line">logger.addHandler(ch)</span><br></pre></td></tr></table></figure></div>

<p>处理器对象也可以设置：</p>
<ul>
<li><code>ch.setLevel(logging.WARN)</code> # 单对这个流设置日志级别</li>
<li><code>ch.setFormatter(formatter_name)</code> # 设置一个格式化器formatter</li>
<li><code>ch.addFilter(filter_name)</code> # 增加一个过滤器，可以增加多个</li>
<li><code>ch.removeFilter(filter_name)</code> # 删除一个过滤器</li>
</ul>
<p>创建格式化器：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">fh = logging.FileHandler(<span class="string">'test.log'</span>,encoding=<span class="string">'utf-8'</span>) </span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">fh.setFormatter(formatter) </span><br><span class="line">logger.addHandler(fh)</span><br></pre></td></tr></table></figure></div>

<h3 id="sqlite3模块"><a href="#sqlite3模块" class="headerlink" title="sqlite3模块"></a>sqlite3模块</h3><p>SQLite是一种嵌入式数据库，它的数据库就是一个文件。Python内置了SQLite3。</p>
<h4 id="基本用法示例"><a href="#基本用法示例" class="headerlink" title="基本用法示例"></a>基本用法示例</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建连接，如果文件不存在，会自动在当前目录创建:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn = sqlite3.connect(<span class="string">'test.db'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建游标</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行SQL语句，创建user表:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.execute(<span class="string">r"""CREATE TABLE "user" (</span></span><br><span class="line"><span class="string">						"id" integer NOT NULL PRIMARY KEY AUTOINCREMENT,</span></span><br><span class="line"><span class="string">                    	"name" varchar(20)</span></span><br><span class="line"><span class="string">                    );"""</span>)</span><br><span class="line">&lt;sqlite3.Cursor object at <span class="number">0x10f8aa260</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续执行一条SQL语句，插入一条记录:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.execute(<span class="string">r"""INSERT INTO "main"."user"(name) VALUES ('Michael');"""</span>)</span><br><span class="line">&lt;sqlite3.Cursor object at <span class="number">0x10f8aa260</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭游标</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交事务</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.close()</span><br></pre></td></tr></table></figure></div>

<h4 id="游标对象常用属性和方法"><a href="#游标对象常用属性和方法" class="headerlink" title="游标对象常用属性和方法"></a>游标对象常用属性和方法</h4><ul>
<li><code>cursor.execute()</code>执行SQL语句并返回<code>cursor</code>对象本身</li>
<li><code>cursor.rowcount</code>刚刚执行语句影响的行数</li>
<li><code>cursor.fetchone()</code>弹出刚刚执行查询语句的结果集的第一条，元组</li>
<li><code>cursor.fetchall()</code>刚刚执行查询语句的全部（剩余）结果集，列表嵌套元组</li>
</ul>
<p>直接遍历<code>cursor</code>对象本身也可以拿到（剩余）结果集</p>
<p>基本的sql语句和更多的数据库连接模块的用法在之后章节有介绍。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十六)</title>
    <url>/Python/Python_id_34.html</url>
    <content><![CDATA[<h2 id="文件处理"><a href="#文件处理" class="headerlink" title="文件处理"></a>文件处理</h2><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作:"></a>基本操作:</h3><ol>
<li>打开文件,得到文件句柄并赋值给变量</li>
<li>通过句柄对文件进行操作</li>
<li>关闭文件</li>
</ol>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f=open(<span class="string">"文件名"</span>,encoding=<span class="string">'utf-8'</span>)<span class="comment">#默认系统编码win下GBK</span></span><br><span class="line">data=f.read()</span><br><span class="line">print(data)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure></div>

<h3 id="内置函数open"><a href="#内置函数open" class="headerlink" title="内置函数open()"></a>内置函数<code>open()</code></h3><h4 id="可选模式"><a href="#可选模式" class="headerlink" title="可选模式:"></a>可选模式:</h4><ul>
<li>只读”r”(默认)</li>
<li>只写”w” 如果文件存在则清空 不存在则新建</li>
<li>可读可写”r+”</li>
<li>追加写入”a”/“a+” 如<code>f=open(&quot;x.txt&quot;,&quot;a&quot;)</code></li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f.read() <span class="comment">#连续读字符 默认全部读完</span></span><br><span class="line">f.readable() <span class="comment">#是否可读</span></span><br><span class="line">f.readline() <span class="comment">#连续读行</span></span><br><span class="line">f.readlines()<span class="comment">#用列表返回每一行，成员的换行符不会被忽略</span></span><br><span class="line"></span><br><span class="line">f.write(str) <span class="comment">#连续写 "a"模式在末尾追加</span></span><br><span class="line">f.writeable() <span class="comment">#是否可写</span></span><br><span class="line">f.writelines(list) <span class="comment">#将列表连续写行，成员的换行符需要带上，如["aaa\n","bbb\n","ccc\n"]</span></span><br></pre></td></tr></table></figure></div>

<h4 id="上下文管理"><a href="#上下文管理" class="headerlink" title="上下文管理"></a>上下文管理</h4><p>file对象实现了魔术方法<code>__enter__()</code> 和<code>__exit__()</code><br>所以可以使用 <code>with open() as f</code>的写法</p>
<h4 id="b模式"><a href="#b模式" class="headerlink" title="b模式:"></a>b模式:</h4><p>不能设置encoding “rb” 读二进制</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">data=f.read()</span><br><span class="line">print(data.decode(<span class="string">"utf-8"</span>))</span><br></pre></td></tr></table></figure></div>

<p> “wb” 写二进制</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f.write(bytes(<span class="string">"内容"</span>,encoding=<span class="string">"utf-8"</span>))</span><br></pre></td></tr></table></figure></div>

<p> “ab”追加</p>
<h4 id="其他参数"><a href="#其他参数" class="headerlink" title="其他参数"></a>其他参数</h4><h5 id="encoding"><a href="#encoding" class="headerlink" title="encoding"></a>encoding</h5><p>规定字符集</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">file = open(filename, <span class="string">"w"</span>, encoding=<span class="string">'Latin-1'</span>)</span><br></pre></td></tr></table></figure></div>

<h5 id="newline"><a href="#newline" class="headerlink" title="newline"></a>newline</h5><p>规定换行效果，默认适应操作系统<br>对于用<code>\r\n</code>换行的系统，默认的<code>newline=&quot;\r&quot;</code>，故而只需要写入<code>&quot;\n&quot;</code>就相当于写入<code>&quot;\r\n&quot;</code><br>另一方面，设置<code>newline=&quot;&quot;</code>才能使用<code>&quot;\r\n&quot;</code>换行，下面是官方参考手册里的解释：</p>
<blockquote>
<p>In Python 2.X, it was required to open the csvfile with ‘b’ because the csv module does its own line termination handling.</p>
<p>In Python 3.X, the csv module still does its own line termination handling, but still needs to know an encoding for Unicode strings. The correct way to open a csv file for writing is:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">outputfile=open(<span class="string">"out.csv"</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf8'</span>,newline=<span class="string">''</span>)</span><br></pre></td></tr></table></figure></div>

<p>encoding can be whatever you require, but newline=’’ suppresses text mode newline handling. On Windows, failing to do this will write \r\r\n file line endings instead of the correct \r\n. This is mentioned in the 3.X csv.reader documentation only, but csv.writer requires it as well.</p>
</blockquote>
<p>对于下文即将介绍的csv模块也是如此。</p>
<h4 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">f.flush() <span class="comment">#刷新</span></span><br><span class="line">f.tell()  <span class="comment">#当前光标所在位置</span></span><br><span class="line">f.seek(int,int默认<span class="number">0</span>)  <span class="comment">#相对位置读字节</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    负数倒着读,只能b模式下使用</span></span><br><span class="line"><span class="string">    第二个参数:</span></span><br><span class="line"><span class="string">        0代表从文件开头开始算起</span></span><br><span class="line"><span class="string">        1代表从当前位置开始算起</span></span><br><span class="line"><span class="string">        2代表从文件末尾算起。</span></span><br><span class="line"><span class="string">    utf的3字节一个汉字 seek(3)相当于从头开始read(1)</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">f.truncate(int)<span class="comment">#截取字节</span></span><br></pre></td></tr></table></figure></div>

<h4 id="循环文件的推荐方式"><a href="#循环文件的推荐方式" class="headerlink" title="循环文件的推荐方式"></a>循环文件的推荐方式</h4><p>如:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    offs=<span class="number">-10</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        f.seek(offs,<span class="number">2</span>)</span><br><span class="line">        data=f.readlines()</span><br><span class="line">        <span class="keyword">if</span> len(data)&gt;<span class="number">1</span>:</span><br><span class="line">            print(<span class="string">"最后一行是"</span>+data[<span class="number">-1</span>].decode(<span class="string">"utf-8"</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        offs*=<span class="number">2</span></span><br></pre></td></tr></table></figure></div>

<p>不推荐:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f.readlines(): ...</span><br></pre></td></tr></table></figure></div>

<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p>现在有一个<code>recensement.txt</code>文件</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">1 	Paris 	2229621</span><br><span class="line">2 	Marseille 	855393</span><br><span class="line">3 	Lyon 	500715</span><br><span class="line">4 	Toulouse 	458298</span><br><span class="line">5 	Nice 	342295</span><br><span class="line">6 	Nantes 	292718</span><br><span class="line">.......</span><br><span class="line">70 	Drancy 	68241</span><br><span class="line">71 	Colmar 	67956</span><br><span class="line">72 	Ajaccio 	67507</span><br><span class="line">73 	Bourges 	67189</span><br><span class="line">74 	Issy-les-Moulineaux 	65662</span><br><span class="line">75 	Levallois-Perret 	65264</span><br></pre></td></tr></table></figure></div>

<p>将它转化为一个字典再求出所有数的和</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json    <span class="comment">#引入json模块只是为了好看,后面会讲</span></span><br><span class="line"><span class="keyword">import</span> functools    <span class="comment">#高阶函数functools.reduce以后会讲</span></span><br><span class="line"><span class="keyword">with</span> open (<span class="string">'recensement.txt'</span>,<span class="string">'r'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    dic = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        k=line.strip().split(<span class="string">"\t"</span>)[<span class="number">1</span>]</span><br><span class="line">        val=line.strip().split(<span class="string">"\t"</span>)[<span class="number">-1</span>]</span><br><span class="line">        dic[k]=val</span><br><span class="line">    print(json.dumps(dic,sort_keys=<span class="literal">True</span>,indent=<span class="number">2</span>,separators=(<span class="string">','</span>,<span class="string">':'</span>),ensure_ascii=<span class="literal">False</span>))</span><br><span class="line">    co=functools.reduce(<span class="keyword">lambda</span> r,x:int(r)+int(x),list(dic.values()))</span><br><span class="line">    print(<span class="string">"总和是%s"</span>%co)</span><br></pre></td></tr></table></figure></div>

<p>执行结果</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"Aix-en-Provence "</span>:<span class="string">"141545"</span>,</span><br><span class="line">  <span class="string">"Ajaccio "</span>:<span class="string">"67507"</span>,</span><br><span class="line">  <span class="string">"Amiens "</span>:<span class="string">"132699"</span>,</span><br><span class="line">  <span class="string">"Angers "</span>:<span class="string">"150125"</span>,</span><br><span class="line">  <span class="string">"Antibes "</span>:<span class="string">"75456"</span>,</span><br><span class="line">  <span class="string">"Argenteuil "</span>:<span class="string">"106817"</span>,</span><br><span class="line"><span class="comment">#......</span></span><br><span class="line">  <span class="string">"Toulouse "</span>:<span class="string">"458298"</span>,</span><br><span class="line">  <span class="string">"Tourcoing "</span>:<span class="string">"93974"</span>,</span><br><span class="line">  <span class="string">"Tours "</span>:<span class="string">"134803"</span>,</span><br><span class="line">  <span class="string">"Versailles "</span>:<span class="string">"85272"</span>,</span><br><span class="line">  <span class="string">"Villeurbanne "</span>:<span class="string">"147192"</span>,</span><br><span class="line">  <span class="string">"Vitry-sur-Seine "</span>:<span class="string">"90075"</span></span><br><span class="line">&#125;</span><br><span class="line">总和是12470089</span><br></pre></td></tr></table></figure></div>

<h3 id="csv模块"><a href="#csv模块" class="headerlink" title="csv模块"></a>csv模块</h3><p>内置模块 读写csv表格<br>读取例子：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">filename = <span class="string">'名单.csv'</span></span><br><span class="line"><span class="keyword">with</span> open(filename) <span class="keyword">as</span> f:</span><br><span class="line">    reader = csv.reader(f)</span><br><span class="line">    print(list(reader))</span><br></pre></td></tr></table></figure></div>

<p>写入例子：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">filename = <span class="string">'单推名单.csv'</span></span><br><span class="line">csvFile = open(filename, <span class="string">"w"</span>, encoding=<span class="string">'utf-8'</span>, newline=<span class="string">''</span>)</span><br><span class="line">writer = csv.writer(csvFile)</span><br><span class="line"></span><br><span class="line">fileHeader = (<span class="string">"姓名"</span>, <span class="string">"年龄"</span>)</span><br><span class="line">writer.writerow(fileHeader)</span><br><span class="line"></span><br><span class="line">data = (<span class="string">"夏色祭"</span>,<span class="number">17</span>)</span><br><span class="line">writer.writerow(data)</span><br><span class="line"></span><br><span class="line">csvFile.close()</span><br></pre></td></tr></table></figure></div>

<p>正如前文中的描述，如果不设置<code>newline=&#39;&#39;</code>，将会导致csv写入空行。</p>
<h3 id="configparser模块"><a href="#configparser模块" class="headerlink" title="configparser模块"></a>configparser模块</h3><p>内置模块 适用于操作配置文件<br>常见文档格式如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="INI"><figure class="iseeu highlight /ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">ServerAliveInterval</span> = <span class="number">45</span></span><br><span class="line"><span class="attr">Compression</span> = <span class="literal">yes</span></span><br><span class="line"><span class="attr">CompressionLevel</span> = <span class="number">9</span></span><br><span class="line"><span class="attr">ForwardX11</span> = <span class="literal">yes</span></span><br><span class="line">  </span><br><span class="line"><span class="section">[bitbucket.org]</span></span><br><span class="line"><span class="attr">User</span> = hg</span><br><span class="line">  </span><br><span class="line"><span class="section">[topsecret.server.com]</span></span><br><span class="line"><span class="attr">Port</span> = <span class="number">50022</span></span><br><span class="line"><span class="attr">ForwardX11</span> = <span class="literal">no</span></span><br></pre></td></tr></table></figure></div>

<h4 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config[<span class="string">"DEFAULT"</span>] = &#123;<span class="string">'ServerAliveInterval'</span>: <span class="string">'45'</span>,</span><br><span class="line">                      <span class="string">'Compression'</span>: <span class="string">'yes'</span>,</span><br><span class="line">                     <span class="string">'CompressionLevel'</span>: <span class="string">'9'</span>,</span><br><span class="line">                     <span class="string">'ForwardX11'</span>:<span class="string">'yes'</span></span><br><span class="line">                     &#125;</span><br><span class="line">config[<span class="string">'bitbucket.org'</span>] = &#123;<span class="string">'User'</span>:<span class="string">'hg'</span>&#125;</span><br><span class="line">config[<span class="string">'topsecret.server.com'</span>] = &#123;<span class="string">'Host Port'</span>:<span class="string">'50022'</span>,<span class="string">'ForwardX11'</span>:<span class="string">'no'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'example.ini'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> configfile:</span><br><span class="line">   config.write(configfile)</span><br></pre></td></tr></table></figure></div>

<h4 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">'example.ini'</span>)</span><br><span class="line"></span><br><span class="line">print(config.sections())        <span class="comment"># ['bitbucket.org', 'topsecret.server.com']</span></span><br><span class="line">print(<span class="string">'bytebong.com'</span> <span class="keyword">in</span> config) <span class="comment"># False</span></span><br><span class="line">print(<span class="string">'bitbucket.org'</span> <span class="keyword">in</span> config) <span class="comment"># True</span></span><br><span class="line">print(config[<span class="string">'bitbucket.org'</span>][<span class="string">"user"</span>])  <span class="comment"># hg</span></span><br><span class="line">print(config[<span class="string">'DEFAULT'</span>][<span class="string">'Compression'</span>]) <span class="comment"># yes</span></span><br><span class="line">print(config[<span class="string">'topsecret.server.com'</span>][<span class="string">'ForwardX11'</span>])  <span class="comment">#no</span></span><br><span class="line">print(config[<span class="string">'bitbucket.org'</span>])          <span class="comment">#&lt;Section: bitbucket.org&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> config[<span class="string">'bitbucket.org'</span>]:     <span class="comment"># 注意,有default会默认default的键</span></span><br><span class="line">    print(key)</span><br><span class="line"></span><br><span class="line">config.options(<span class="string">'bitbucket.org'</span>)  <span class="comment"># 同for循环,找到'bitbucket.org'下所有键</span></span><br><span class="line">config.items(<span class="string">'bitbucket.org'</span>)    <span class="comment">#找到'bitbucket.org'下所有键值对</span></span><br><span class="line">config.get(<span class="string">'bitbucket.org'</span>,<span class="string">'compression'</span>) <span class="comment">#获取'bitbucket.org'下key对应的value</span></span><br></pre></td></tr></table></figure></div>

<h4 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">'example.ini'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#增加</span></span><br><span class="line">config.add_section(<span class="string">'yuan'</span>)</span><br><span class="line"><span class="comment">#删除</span></span><br><span class="line">config.remove_section(<span class="string">'bitbucket.org'</span>)  </span><br><span class="line">config.remove_option(<span class="string">'topsecret.server.com'</span>,<span class="string">"forwardx11"</span>)</span><br><span class="line"><span class="comment">#修改</span></span><br><span class="line">config.set(<span class="string">'topsecret.server.com'</span>,<span class="string">'k1'</span>,<span class="string">'11111'</span>)</span><br><span class="line">config.set(<span class="string">'yuan'</span>,<span class="string">'k2'</span>,<span class="string">'22222'</span>)</span><br><span class="line"><span class="comment">#保存修改</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'new2.ini'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> configfile:</span><br><span class="line">    config.write(configfile)</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十五)</title>
    <url>/Python/Python_id_33.html</url>
    <content><![CDATA[<h2 id="数据类型拓展"><a href="#数据类型拓展" class="headerlink" title="数据类型拓展"></a>数据类型拓展</h2><p>在内置数据类型（dict、list、set、tuple）的基础上，collections模块还提供了几个额外的数据类型：<br>Counter、deque、defaultdict、namedtuple和OrderedDict等。</p>
<a id="more"></a>

<blockquote>
<p>1.namedtuple: 生成可以使用名字来访问元素内容的tuple</p>
<p>2.deque: 双端队列，可以快速的从另外一侧追加和推出对象</p>
<p>3.Counter: 计数器，主要用来计数</p>
<p>4.OrderedDict: 有序字典</p>
<p>5.defaultdict: 带有默认值的字典</p>
<p>ex：Iterable: 迭代器基类</p>
</blockquote>
<h3 id="Iterable"><a href="#Iterable" class="headerlink" title="Iterable"></a>Iterable</h3><p>所有可以被<code>for in</code>循环的类型都是继承于<code>Iterable</code></p>
<p>Python3.8版本以上的问题</p>
<p>DeprecationWarning:</p>
<p>Using or importing the ABCs from ‘collections’ instead of from ‘collections.abc’ is deprecated, and in 3.8 it willstop working</p>
<p>解决办法：<br><code>from collections import Iterable</code>修改为<code>from collections.abc import Iterable</code></p>
<p>判断对象能被for循环</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(<span class="number">123</span>, Iterable)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance([<span class="number">1</span>,<span class="number">23</span>], Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,&#125;, Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(<span class="string">'123'</span>, Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance((<span class="number">123</span>,), Iterable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance((i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">'123'</span>), Iterable)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></div>

<h3 id="namedtuple"><a href="#namedtuple" class="headerlink" title="namedtuple"></a>namedtuple</h3><p>我们知道<code>tuple</code>可以表示不变集合，例如，一个点的二维坐标就可以表示成：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = (<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure></div>

<p>但是，看到(1, 2)，很难看出这个tuple是用来表示一个坐标的。<br>这时，<code>namedtuple</code>就派上了用场：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Point = namedtuple(<span class="string">'Point'</span>, [<span class="string">'x'</span>, <span class="string">'y'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Point(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.x</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.y</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p._asdict()</span><br><span class="line">&#123;<span class="string">'x'</span>: <span class="number">1</span>, <span class="string">'y'</span>: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure></div>

<p>类似的，如果要用坐标和半径表示一个圆，也可以用<code>namedtuple</code>定义：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#namedtuple('名称', [属性list]):</span></span><br><span class="line">Circle = namedtuple(<span class="string">'Circle'</span>, [<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'r'</span>])</span><br></pre></td></tr></table></figure></div>

<h3 id="deque"><a href="#deque" class="headerlink" title="deque"></a>deque</h3><p>使用list存储数据时，按索引访问元素很快，但是插入和删除元素就很慢了，因为list是线性存储，数据量大的时候，插入和删除效率很低。<br>deque是为了高效实现插入和删除操作的双向列表，适合用于队列和栈：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q = deque([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.append(<span class="string">'x'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q.appendleft(<span class="string">'y'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q</span><br><span class="line">deque([<span class="string">'y'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'x'</span>])</span><br></pre></td></tr></table></figure></div>

<p>deque除了实现list的<code>append()</code>和<code>pop()</code>外，还支持<code>appendleft()</code>和<code>popleft()</code>，这样就可以非常高效地往头部添加或删除元素。</p>
<h3 id="OrderedDict"><a href="#OrderedDict" class="headerlink" title="OrderedDict"></a>OrderedDict</h3><p>使用dict时，Key是无序的。在对dict做迭代时，我们无法确定Key的顺序。<br>如果要保持Key的顺序，可以用<code>OrderedDict</code>：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = dict([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">2</span>), (<span class="string">'c'</span>, <span class="number">3</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d <span class="comment"># dict的Key是无序的</span></span><br><span class="line">&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'c'</span>: <span class="number">3</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od = OrderedDict([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">2</span>), (<span class="string">'c'</span>, <span class="number">3</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od <span class="comment"># OrderedDict的Key是有序的</span></span><br><span class="line">OrderedDict([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">2</span>), (<span class="string">'c'</span>, <span class="number">3</span>)])</span><br></pre></td></tr></table></figure></div>

<p>注意，<code>OrderedDict</code>的Key会按照插入的顺序排列，不是Key本身排序：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>od = OrderedDict()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od[<span class="string">'z'</span>] = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od[<span class="string">'y'</span>] = <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od[<span class="string">'x'</span>] = <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od.keys() <span class="comment"># 按照插入的Key的顺序返回</span></span><br><span class="line">[<span class="string">'z'</span>, <span class="string">'y'</span>, <span class="string">'x'</span>]</span><br></pre></td></tr></table></figure></div>

<h3 id="defaultdict"><a href="#defaultdict" class="headerlink" title="defaultdict"></a>defaultdict</h3><p>有如下值集合<code>[11,22,33,44,55,66,77,88,99,90...]</code>，将所有大于66的值保存至字典的第一个key中，将小于66的值保存至第二个key的值中。</p>
<p>即： <code>{&#39;k1&#39;: 大于66, &#39;k2&#39;: 小于66}</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">values = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">77</span>,<span class="number">88</span>,<span class="number">99</span>,<span class="number">90</span>]</span><br><span class="line"></span><br><span class="line">my_dict = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span>  values:</span><br><span class="line">    <span class="keyword">if</span> value&gt;<span class="number">66</span>:</span><br><span class="line">        <span class="keyword">if</span> my_dict.has_key(<span class="string">'k1'</span>):</span><br><span class="line">            my_dict[<span class="string">'k1'</span>].append(value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            my_dict[<span class="string">'k1'</span>] = [value]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> my_dict.has_key(<span class="string">'k2'</span>):</span><br><span class="line">            my_dict[<span class="string">'k2'</span>].append(value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            my_dict[<span class="string">'k2'</span>] = [value]</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">values = [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">77</span>,<span class="number">88</span>,<span class="number">99</span>,<span class="number">90</span>]</span><br><span class="line"></span><br><span class="line">my_dict = defaultdict(list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span>  values:</span><br><span class="line">    <span class="keyword">if</span> value&gt;<span class="number">66</span>:</span><br><span class="line">        my_dict[<span class="string">'k1'</span>].append(value)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        my_dict[<span class="string">'k2'</span>].append(value)</span><br></pre></td></tr></table></figure></div>

<p>使用<code>dict</code>时，如果引用的Key不存在，就会抛出<code>KeyError</code>。如果希望key不存在时，返回一个默认值，就可以用<code>defaultdict</code>：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd = defaultdict(<span class="keyword">lambda</span>: <span class="string">'N/A'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd[<span class="string">'key1'</span>] = <span class="string">'abc'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd[<span class="string">'key1'</span>] <span class="comment"># key1存在</span></span><br><span class="line"><span class="string">'abc'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd[<span class="string">'key2'</span>] <span class="comment"># key2不存在，返回默认值</span></span><br><span class="line"><span class="string">'N/A'</span></span><br></pre></td></tr></table></figure></div>

<h3 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h3><p>Counter类的目的是用来跟踪值出现的次数。它是一个无序的容器类型，以字典的键值对形式存储，其中元素作为key，其计数作为value。计数值可以是任意的Interger（包括0和负数）。Counter类和其他语言的bags或multisets很相似。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Counter(<span class="string">'abcdeabcdabcaba'</span>)</span><br><span class="line">Counter(&#123;<span class="string">'a'</span>: <span class="number">5</span>, <span class="string">'b'</span>: <span class="number">4</span>, <span class="string">'c'</span>: <span class="number">3</span>, <span class="string">'d'</span>: <span class="number">2</span>, <span class="string">'e'</span>: <span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><p>队列类型由Queue模块提供，创建一个“队列”对象如下。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Queue</span><br><span class="line">myqueue = Queue.Queue(maxsize = <span class="number">10</span>)</span><br></pre></td></tr></table></figure></div>

<p>Queue.Queue类即是一个队列的同步实现。</p>
<p>将一个值放入队列中（线程暂停）。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">myqueue.put(<span class="number">10</span>)</span><br></pre></td></tr></table></figure></div>

<p>将一个值从队列中取出（线程暂停）。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">myqueue.get()</span><br></pre></td></tr></table></figure></div>

<p>python queue模块有三种队列:</p>
<blockquote>
<p>1、python queue模块的FIFO队列先进先出。<br>2、LIFO类似于堆。即先进后出。<br>3、还有一种是优先级队列级别越低越先出来。</p>
</blockquote>
<p>针对这三种队列分别有三个构造函数:</p>
<blockquote>
<p>1、class Queue.Queue(maxsize) FIFO<br>2、class Queue.LifoQueue(maxsize) LIFO<br>3、class Queue.PriorityQueue(maxsize) 优先级队列</p>
</blockquote>
<p>它的存在主要是为了数据安全，而不只是一种数据结构。故而这里不多介绍了</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十四)</title>
    <url>/Python/Python_id_32.html</url>
    <content><![CDATA[<h2 id="三目和推导式"><a href="#三目和推导式" class="headerlink" title="三目和推导式"></a>三目和推导式</h2><blockquote>
<p>流程控制章节的进阶。</p>
</blockquote>
<h3 id="三目运算符"><a href="#三目运算符" class="headerlink" title="三目运算符"></a>三目运算符</h3><p>也叫三元表达式</p>
<a id="more"></a>

<p>普通的if else语句</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> b：</span><br><span class="line">    print(a)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(c)</span><br></pre></td></tr></table></figure></div>

<p>三元表达式写法，相当于java中输出<code>b?a:c</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">print(a <span class="keyword">if</span> b <span class="keyword">else</span> c)</span><br></pre></td></tr></table></figure></div>

<h3 id="赋值表达式"><a href="#赋值表达式" class="headerlink" title="赋值表达式"></a>赋值表达式</h3><p>在python3.8中，将赋值语句的 <code>=</code> 前加上一个冒号 <code>:</code> 。<br>它就变成了一个赋值表达式（Assignment expressions）。</p>
<blockquote>
<p>It is affectionately known as “the walrus operator” due to its resemblance to the eyes and tusks of a walrus<br>由于它和海象的眼睛和长牙相似，它被亲切地称为<strong>海象运算符</strong></p>
</blockquote>
<p>赋值表达式会在赋值的同时返回左值的引用。</p>
<ul>
<li><p>if，while中使用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">'select t1.id, t1.name from t1'</span>)</span><br><span class="line">row = cur.fetchone()</span><br><span class="line"><span class="keyword">while</span> row:</span><br><span class="line">    print(<span class="string">"id=%d, name=%s"</span> % (row[<span class="number">0</span>], row[<span class="number">1</span>]))</span><br><span class="line">    row = cur.fetchone()</span><br></pre></td></tr></table></figure></div>

<p>在这个示例中，赋值表达式可以减少部分代码：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">'select t1.id, t1.name from t1'</span>)</span><br><span class="line"><span class="keyword">while</span> row:=cur.fetchone():</span><br><span class="line">    print(<span class="string">"id=%d, name=%s"</span> % (row[<span class="number">0</span>], row[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>短路用法使用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> txt:</span><br><span class="line">	<span class="keyword">if</span> char == <span class="string">'p'</span>:</span><br><span class="line">		n += <span class="number">1</span></span><br><span class="line">print(n)</span><br></pre></td></tr></table></figure></div>

<p>使用短路和赋值表达式可以修改为：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> txt:</span><br><span class="line">	(char == <span class="string">'p'</span>) <span class="keyword">and</span> (n := n + <span class="number">1</span>)</span><br><span class="line">print(n)</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<h3 id="列表解析式"><a href="#列表解析式" class="headerlink" title="列表解析式"></a>列表解析式</h3><p>也叫列表推导式。代码可读性较差，使用可能降低协同开发的效率，按需使用。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">[<span class="string">"%s"</span>%i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line"><span class="comment">#得到["0","1","2","3","4"]</span></span><br><span class="line"></span><br><span class="line">[<span class="string">"%s"</span>%i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>) <span class="keyword">if</span> i%<span class="number">2</span>==<span class="number">0</span>]</span><br><span class="line"><span class="comment">#得到["0","2","4"]</span></span><br></pre></td></tr></table></figure></div>

<p>换用圆括号是生成式。它惰性使用，相比于列表解析占用的内存小得多<br>生成器(generator)会在之后章节详细介绍。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">(<span class="string">"%s"</span>%i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>))</span><br></pre></td></tr></table></figure></div>

<p>它可以直接在for in语句中使用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> (<span class="string">"%s"</span>%i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)):</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure></div>

<p>它的结果和使用内置函数map一样</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">map(<span class="keyword">lambda</span> i: <span class="string">"%s"</span>%i, range(<span class="number">5</span>))</span><br></pre></td></tr></table></figure></div>

<p>换用花括号得到的则是集合推导式。</p>
<h3 id="字典推导式"><a href="#字典推导式" class="headerlink" title="字典推导式"></a>字典推导式</h3><p>字典推导式语法和列表解析式类似<br>python3.8后，字典推导式已与字典字面值实现同步，会先计算键再计算值。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Dict comprehension</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cast = &#123;input(<span class="string">'role? '</span>): input(<span class="string">'actor? '</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>)&#125;</span><br><span class="line">role? King Arthur</span><br><span class="line">actor? Chapman</span><br><span class="line">role? Black Knight</span><br><span class="line">actor? Cleese</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十三)</title>
    <url>/Python/Python_id_28.html</url>
    <content><![CDATA[<h2 id="字符串格式化"><a href="#字符串格式化" class="headerlink" title="字符串格式化"></a>字符串格式化</h2><p>Python的字符串格式化有两种方式</p>
<ul>
<li>%格式符方式</li>
<li>format方式</li>
</ul>
<a id="more"></a>

<p>事实上，格式化借助的是对象的魔术方法。<br>实现了<code>__format__</code>的对象才适用于format方式格式化输出，<br>实现了<code>__str__</code>，<code>__repr__</code>的对象才分别适用于格式符<code>%s</code>和<code>%r</code>输出。<br>在面向对象章节有给对象定义魔术方法的示例。</p>
<h3 id="格式符"><a href="#格式符" class="headerlink" title="%格式符"></a><code>%</code>格式符</h3><p>一般格式为 <code>%(name)</code> + <a href="https://docs.python.org/zh-cn/3/library/string.html#formatspec" target="_blank" rel="noopener">format_spec</a></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">[[fill]align][sign][#][0][width][grouping_option][.precision][type]</span><br></pre></td></tr></table></figure></div>

<h4 id="name"><a href="#name" class="headerlink" title="name"></a>name</h4><p>可选，用于选择指定的key</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"%(name)s——%(age)d"</span>%&#123;<span class="string">'name'</span>:<span class="string">'宝钟玛琳'</span>,<span class="string">'age'</span>:<span class="number">17</span>&#125;</span><br><span class="line"><span class="string">'宝钟玛琳——17'</span></span><br></pre></td></tr></table></figure></div>

<p>s 和 d 属于 [<code>type</code>]</p>
<p>format_spec规则的常用组分：</p>
<h4 id="sign"><a href="#sign" class="headerlink" title="sign"></a>sign</h4><p>可选，数字和字符串可供选择的值有：</p>
<ul>
<li><code>+</code> 右对齐；正数负数前加正负号</li>
<li><code>-</code> 左对齐；负数前加负号</li>
<li>空格 右对齐；负数前加负号</li>
<li><code>0</code> 右对齐；正数前无符号，负数前加负号；用0填充空白处</li>
</ul>
<h4 id="width"><a href="#width" class="headerlink" title="width"></a>width</h4><p>可选，占有宽度</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"%(name)+7s——%(age)-5d"</span>%&#123;<span class="string">'name'</span>:<span class="string">'宝钟玛琳'</span>,<span class="string">'age'</span>:<span class="number">17</span>&#125;</span><br><span class="line"><span class="string">'   宝钟玛琳——17   '</span></span><br></pre></td></tr></table></figure></div>

<h4 id="precision"><a href="#precision" class="headerlink" title=".precision"></a>.precision</h4><p>可选，小数点后保留的位数 默认6位</p>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p>类型，必选</p>
<p>任意对象：</p>
<ul>
<li><code>%s</code> 字符串 (采用<code>str()</code>的显示)</li>
<li><code>%r</code> 字符串 (采用<code>repr()</code>的显示)</li>
<li><code>%c</code> 单个字符</li>
</ul>
<p>字符串和整数：</p>
<ul>
<li><code>%b</code> 二进制整数</li>
<li><code>%%</code> 字符”%”转义</li>
</ul>
<p>数字：</p>
<ul>
<li><code>%d</code> 十进制整数</li>
<li><code>%i</code> 十进制整数</li>
<li><code>%o</code> 八进制整数</li>
<li><code>%x</code> 十六进制整数</li>
<li><code>%e</code> 指数 (基底写为e)</li>
<li><code>%E</code> 指数 (基底写为E)</li>
<li><code>%f</code> 浮点数</li>
<li><code>%F</code> 浮点数，与上相同</li>
<li><code>%g</code> 科学计数法(e)或浮点数 (根据显示长度)</li>
<li><code>%G</code> 科学计数法(E)或浮点数 (根据显示长度)</li>
<li><code>%%</code> 字符”%”</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'——%(p).2f'</span>%&#123;<span class="string">'p'</span>:<span class="number">0.1</span>+<span class="number">0.2</span>&#125;</span><br><span class="line"><span class="string">'——0.30'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'——%(p).2g'</span>%&#123;<span class="string">'p'</span>:<span class="number">0.1</span>+<span class="number">0.2</span>&#125;</span><br><span class="line"><span class="string">'——0.3'</span></span><br></pre></td></tr></table></figure></div>

<h3 id="终端字体颜色"><a href="#终端字体颜色" class="headerlink" title="终端字体颜色"></a>终端字体颜色</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">#格式：</span></span><br><span class="line"><span class="string">　　设置颜色开始 ：\033[显示方式;前景色;背景色m</span></span><br><span class="line"><span class="string">　　</span></span><br><span class="line"><span class="string">#说明：</span></span><br><span class="line"><span class="string">前景色            背景色           颜色</span></span><br><span class="line"><span class="string">---------------------------------------</span></span><br><span class="line"><span class="string">30                40              黑色</span></span><br><span class="line"><span class="string">31                41              红色</span></span><br><span class="line"><span class="string">32                42              绿色</span></span><br><span class="line"><span class="string">33                43              黃色</span></span><br><span class="line"><span class="string">34                44              蓝色</span></span><br><span class="line"><span class="string">35                45              紫红色</span></span><br><span class="line"><span class="string">36                46              青蓝色</span></span><br><span class="line"><span class="string">37                47              白色</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">显示方式           意义</span></span><br><span class="line"><span class="string">-------------------------</span></span><br><span class="line"><span class="string">0                终端默认设置</span></span><br><span class="line"><span class="string">1                高亮显示</span></span><br><span class="line"><span class="string">4                使用下划线</span></span><br><span class="line"><span class="string">5                闪烁</span></span><br><span class="line"><span class="string">7                反白显示</span></span><br><span class="line"><span class="string">8                不可见</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#例子：</span></span><br><span class="line">\<span class="number">033</span>[<span class="number">1</span>;<span class="number">31</span>;<span class="number">40</span>m    <span class="comment">#1-高亮显示 31-前景色红色  40-背景色黑色</span></span><br><span class="line">\<span class="number">033</span>[<span class="number">0</span>m          <span class="comment">#采用终端默认设置，即取消颜色设置</span></span><br></pre></td></tr></table></figure></div>

<p>可以使用第三方模块termcolor来简化语句：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> termcolor <span class="keyword">import</span> colored</span><br><span class="line"></span><br><span class="line">print(colored(<span class="string">"helloworld"</span>, <span class="string">"red"</span>))</span><br></pre></td></tr></table></figure></div>

<p>第三方模块在使用前需要用pip安装</p>
<p>系统支持</p>
<p>Windows7及以下无法解析颜色代码<br>使用termcolor模块也无效<br>可以使用第三方模块colorama来显示颜色</p>
<p>colorama模块兼容更好：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span>  init, Fore</span><br><span class="line"></span><br><span class="line">init(autoreset=<span class="literal">False</span>) <span class="comment">#给True的时候print时无需+Fore.RESET</span></span><br><span class="line">print(Fore.RED + <span class="string">"helloworld"</span> + Fore.RESET)</span><br></pre></td></tr></table></figure></div>

<h3 id="内置函数format"><a href="#内置函数format" class="headerlink" title="内置函数format()"></a>内置函数<code>format()</code></h3><p>内置函数<code>format</code>(<em>value</em>[, <em>format_spec</em>])<br>第二个参数即format_spec格式规格迷你语言<br>实现了魔术方法<code>__format__</code>的对象都可以使用</p>
<p>以数字对象的格式化为例：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(<span class="number">12</span>,<span class="string">'+.3f'</span>) <span class="comment">#保留3位小数</span></span><br><span class="line"><span class="string">'+12.000'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(<span class="number">3</span>,<span class="string">'b'</span>) <span class="comment">#二进制转化</span></span><br><span class="line"><span class="string">'11'</span></span><br></pre></td></tr></table></figure></div>

<p>其他实现了魔术方法<code>__format__</code>的对象，这里以<code>datetime.time</code>对象为例：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>night = datetime.time(<span class="number">22</span>,<span class="number">30</span>,tzinfo=datetime.timezone(</span><br><span class="line"><span class="meta">... </span>    datetime.timedelta(hours=<span class="number">8</span>), name = <span class="string">'北京'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(night,<span class="string">'现在是%Z时间%H点%M分'</span>)</span><br><span class="line"><span class="string">'现在是北京时间22点30分'</span></span><br></pre></td></tr></table></figure></div>

<p><code>datetime</code>模块后续会介绍。</p>
<h3 id="str-format"><a href="#str-format" class="headerlink" title="str.format()"></a><code>str.format()</code></h3><p>涉及到函数的传参方式，将在后面章节介绍。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="string">' &#123;&#125;  &#123;&#125;  &#123;&#125; '</span>.format(a,b,c)     </span><br><span class="line"><span class="string">' &#123;0&#125;  &#123;1&#125;  &#123;2&#125; '</span>.format(a,b,c)</span><br><span class="line"><span class="string">' &#123;0&#125;  &#123;1&#125;  &#123;2&#125; '</span>.format(*[a,b,c])</span><br><span class="line"><span class="string">' &#123;a&#125;  &#123;b&#125;  &#123;c&#125; '</span>.format(a=a,b=b,c=c)</span><br><span class="line"><span class="string">' &#123;a&#125;  &#123;b&#125;  &#123;c&#125; '</span>.format(**&#123;<span class="string">"a"</span>:a,<span class="string">"b"</span>:b,<span class="string">"c"</span>:c&#125;)</span><br></pre></td></tr></table></figure></div>

<p><code>{!s}</code>是默认的</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="string">'&#123;!s&#125;、&#123;!a&#125;、&#123;!r&#125;'</span> <span class="comment">#分别表示str、ascii和repr方法。</span></span><br></pre></td></tr></table></figure></div>

<p>实现了魔术方法<code>__format__</code>的对象可以使用冒号 <code>: format_spec</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'0x&#123;:x&#125;'</span>.format(<span class="number">255</span>)</span><br><span class="line"><span class="string">'0xff'</span></span><br></pre></td></tr></table></figure></div>

<p>以<code>datetime.time</code>对象为例的其他实现了魔术方法<code>__format__</code>的对象：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'现在是&#123;:%Z&#125;时间&#123;:%H&#125;点&#123;:%M&#125;分'</span>.format(night,night,night)</span><br><span class="line"><span class="string">'现在是北京时间22点30分'</span></span><br></pre></td></tr></table></figure></div>

<h3 id="f字符串"><a href="#f字符串" class="headerlink" title="f字符串"></a>f字符串</h3><p>在python3.6以上，<code>str.format()</code>可以直接使用<strong>f字符串</strong>的写法<br>用<code>f&#39;{a}{b}{c}&#39;</code>即可代替<code>&#39;{a}{b}{c}&#39;.format(a=a,b=b,c=c)</code>。<br>f字符串中不允许使用<code>\</code>转义字符。</p>
<p>与<code>%</code>格式符的不同：<br>Sign对齐使用<code>&lt;</code>，<code>&gt;</code> 和 <code>^</code> 而不是 <code>+</code> 和 <code>-</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'%-6d000'</span>%<span class="number">233</span></span><br><span class="line"><span class="number">233</span>   <span class="number">000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f'<span class="subst">&#123;<span class="number">233</span>:&lt;<span class="number">6</span>d&#125;</span>000'</span></span><br><span class="line"><span class="number">233</span>   <span class="number">000</span></span><br></pre></td></tr></table></figure></div>

<p>以<code>datetime.time</code>对象为例的其他实现了魔术方法<code>__format__</code>的对象：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f'现在是<span class="subst">&#123;night:%Z&#125;</span>时间<span class="subst">&#123;night:%H&#125;</span>点<span class="subst">&#123;night:%M&#125;</span>分'</span></span><br><span class="line"><span class="string">'现在是北京时间22点30分'</span></span><br></pre></td></tr></table></figure></div>

<p>在python3.8以上</p>
<p>f字符串中可以直接使用说明符<code>=</code>调试，</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>python = <span class="number">3.8</span>	</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f"<span class="subst">&#123;python=&#125;</span>"</span>	</span><br><span class="line"><span class="string">'python=3.8'</span></span><br></pre></td></tr></table></figure></div>

<h3 id="内置函数str-和repr"><a href="#内置函数str-和repr" class="headerlink" title="内置函数str()和repr()"></a>内置函数<code>str()</code>和<code>repr()</code></h3><p><code>str()</code>不止是构造函数（<code>class</code>）实例化一个<code>str</code>对象，<br><code>str(o)</code>它也是对参数对象进行魔术方法的调用：<code>o.__str__()</code>，将参数转换为了<code>str</code>对象<br>无论是<code>print(o)</code>，<code>f&#39;{o}&#39;</code>, <code>&quot;%s&quot;%o</code>，它们都是对魔术方法 <code>o.__str__()</code>的调用</p>
<hr>
<p>而<code>repr(o)</code>，<code>f&#39;{o!r}&#39;</code>, <code>&quot;%r&quot;%o</code>则是对魔术方法 <code>o.__repr__()</code>的调用，<br>它会以字面量的形式呈现对象，即字符串带有引号，列表变成<code>&#39;[&#39;+ repr(成员) + &#39;,]&#39;</code><br><strong>f字符串</strong>中<code>f&#39;{o=}&#39;</code>就相当于<code>f&#39;o={repr(o)}&#39;</code></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十二)</title>
    <url>/Python/Python_id_27.html</url>
    <content><![CDATA[<h2 id="字典和集合"><a href="#字典和集合" class="headerlink" title="字典和集合"></a>字典和集合</h2><blockquote>
<p>几种数据类型在内存中的访问方式</p>
<ul>
<li>直接访问：数字</li>
<li>顺序访问：字符串 列表 元组</li>
<li>映射访问：字典</li>
</ul>
</blockquote>
<a id="more"></a>

<h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><blockquote>
<h4 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h4><p>可迭代类型 可变类型 无序类型 一系列键值对key-value用冒号分割，格式如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">d = &#123;<span class="string">'key1'</span> : <span class="string">'value1'</span>, <span class="string">'key2'</span> : <span class="string">'value2'</span> &#125;</span><br></pre></td></tr></table></figure></div>

<p>key必须是<strong>不可变类型</strong>的数据（否则报错unhashable）<br>value可以是任意数据类型<br>如果key使用布尔值会被转换为1和0</p>
</blockquote>
<p>在python3.6以上版本中，字典默认按插入的顺序排列了键值对。<br>在python3.8以上版本中，字典可以使用 <code>reversed()</code>按插入顺序反向迭代</p>
<h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><h5 id="in成员运算符"><a href="#in成员运算符" class="headerlink" title="in成员运算符"></a>in成员运算符</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="string">'key1'</span> <span class="keyword">in</span> d <span class="comment">#判断键是否存在 返回布尔值</span></span><br></pre></td></tr></table></figure></div>

<h5 id="getitem操作"><a href="#getitem操作" class="headerlink" title="getitem操作"></a>getitem操作</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'key1'</span>]</span><br><span class="line"><span class="string">'value1'</span></span><br></pre></td></tr></table></figure></div>

<h5 id="setitem操作"><a href="#setitem操作" class="headerlink" title="setitem操作"></a>setitem操作</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">d[<span class="string">'key1'</span>] = <span class="string">'debu'</span></span><br></pre></td></tr></table></figure></div>

<h4 id="有关的内置函数"><a href="#有关的内置函数" class="headerlink" title="有关的内置函数"></a>有关的内置函数</h4><p><code>len(dict)</code>返回键的数目</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PROLOG"><figure class="iseeu highlight /prolog"><table><tr><td class="code"><pre><span class="line">zip()<span class="string">`以拉链法**惰性**生成键值对：`</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>),(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)<span class="string">` -&gt;`</span>[(<span class="string">'a'</span>,<span class="number">1</span>),(<span class="string">'b'</span>,<span class="number">2</span>)(<span class="string">'c'</span>,<span class="number">3</span>)]</span><br><span class="line">dict()<span class="string">` 以键值对生成字典：`</span>[(<span class="string">'a'</span>,<span class="number">1</span>),(<span class="string">'b'</span>,<span class="number">2</span>),(<span class="string">'c'</span>,<span class="number">3</span>)]<span class="string">` -&gt; `</span>&#123;<span class="string">'a'</span>:<span class="number">1</span>,<span class="string">'b'</span>:<span class="number">2</span>,<span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><p><code>dict.fromkeys(可迭代对象,value)</code>静态方法生成字典，所有键的值都为value</p>
<p><code>.copy()</code> 浅拷贝</p>
<h5 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h5><p><code>.setdefault(key, value)</code>已存在则返回已存在的value，不存在则设置。</p>
<p><code>.update(key=value)</code> <code>.update(dict)</code>设置或覆盖，这里可对比之后章节函数的剩余参数。</p>
<p><code>.pop(key, None)</code>删除并返回其value，不存在则返回第二个参数，第二个参数默认为None。</p>
<p><code>.popitem()</code>随机删一个并返回其键值对。</p>
<p><code>.clear()</code>清空。</p>
<p><code>del d[key1]</code> 删除一组键值对。</p>
<p><code>.get(key, None)</code>查找 不存在则返回第二个参数 默认为None。</p>
<p><code>.items()</code>返回键值对组成的列表。功能与<code>dict()</code>相反。</p>
<p><code>.keys()</code>返回键组成的列表。</p>
<p><code>.values()</code>返回值组成的列表。</p>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><blockquote>
<h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><p>可迭代类型 可变类型 无序类型 , 元素不重复</p>
<p>生成方式:</p>
<ol>
<li><code>{1,2,3,4,5}</code></li>
<li><code>set(可迭代对象)</code></li>
</ol>
</blockquote>
<p>规范的初始化</p>
<p>创建一个空字典或空集合的时候使用<code>dict()</code>和<code>set()</code><br>而不是使用<code>{}</code></p>
<h4 id="增删方法"><a href="#增删方法" class="headerlink" title="增删方法"></a>增删方法</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">s1.add(p_obj)</span><br><span class="line">s1.update(s2) </span><br><span class="line">s.claer()<span class="comment">#清空</span></span><br><span class="line">s.pop()<span class="comment">#随机删除一个并返回其值</span></span><br><span class="line">s.remove(value) <span class="comment">#删除 没有=&gt;报错</span></span><br><span class="line">s.discard(value)<span class="comment">#删除 没有不报错</span></span><br></pre></td></tr></table></figure></div>

<h4 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">s.copy()          <span class="comment">#如果是list直接使用切片就可以浅拷贝arr2=arr[:]</span></span><br></pre></td></tr></table></figure></div>

<h4 id="集合之间运算"><a href="#集合之间运算" class="headerlink" title="集合之间运算"></a>集合之间运算</h4><table>
<thead>
<tr>
<th align="left">运算</th>
<th align="left">运算符表示</th>
<th align="left">对象方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left">交集</td>
<td align="left">s1&amp;s2</td>
<td align="left">s1.intersection(s2)</td>
</tr>
<tr>
<td align="left">并集</td>
<td align="left">s1|s2</td>
<td align="left">s1.union(s2)</td>
</tr>
<tr>
<td align="left">差集</td>
<td align="left">s1-s2</td>
<td align="left">s1.difference(s2)</td>
</tr>
<tr>
<td align="left">交叉补集</td>
<td align="left"></td>
<td align="left">s1.symmetric_difference(s2)</td>
</tr>
</tbody></table>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">s1.issubset(s2)   <span class="comment">#s1是否是s2子集</span></span><br><span class="line">s1.issuperset(s2)   <span class="comment">#s1是否是s2超集</span></span><br><span class="line">s1.intersection_update(s2)  </span><br><span class="line">s1.difference_update(s2)</span><br><span class="line">s1.symmetric_difference_update(s2)</span><br></pre></td></tr></table></figure></div>

<p>内置函数 <code>set()</code>和 <code>frozenset()</code>分别用来生成可变和不可变的集合</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十一)</title>
    <url>/Python/Python_id_26.html</url>
    <content><![CDATA[<h2 id="列表和元组"><a href="#列表和元组" class="headerlink" title="列表和元组"></a>列表和元组</h2><h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><blockquote>
<h4 id="list"><a href="#list" class="headerlink" title="#list"></a><a href="http://nanarino.metoyun.com/py/5-列表和元组.html#list" target="_blank" rel="noopener">#</a>list</h4><p>可迭代类型 可变类型 有序类型</p>
<p>使用方括号来创建列表</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">li = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>]</span><br></pre></td></tr></table></figure></div>
</blockquote>
<a id="more"></a>

<h4 id="索引和切片"><a href="#索引和切片" class="headerlink" title="索引和切片"></a>索引和切片</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;li[<span class="number">0</span>]</span><br><span class="line"><span class="string">'a'</span></span><br><span class="line">&gt;&gt;&gt;li[<span class="number">1</span>:<span class="number">2</span>]</span><br><span class="line">[<span class="string">'b'</span>]</span><br></pre></td></tr></table></figure></div>

<p>与字符串切片功能不同之处：</p>
<ul>
<li>进行获取、切片、赋值给其他变量等 （getitem）得到的是其浅拷贝</li>
<li>进行直接赋值（setitem）则会改变原列表</li>
</ul>
<h4 id="getitem操作"><a href="#getitem操作" class="headerlink" title="getitem操作"></a>getitem操作</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">a[:<span class="number">1</span>][<span class="number">0</span>] = <span class="number">5</span></span><br><span class="line">print(a)</span><br><span class="line"><span class="comment">#打印结果[1,2]</span></span><br></pre></td></tr></table></figure></div>

<h4 id="setitem操作"><a href="#setitem操作" class="headerlink" title="setitem操作"></a>setitem操作</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">a[:<span class="number">1</span>] = [<span class="number">5</span>]</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment">#打印结果[5,2]</span></span><br></pre></td></tr></table></figure></div>

<p>关于切片</p>
<p>可以在学习面向对象的魔术方法后再深入研究</p>
<h4 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">[]+[]  <span class="comment">#拼合</span></span><br><span class="line">[]*int  <span class="comment">#重复</span></span><br><span class="line">item <span class="keyword">in</span> [] <span class="comment">#判断成员是否存在 返回布尔值</span></span><br></pre></td></tr></table></figure></div>

<h4 id="常用内置函数"><a href="#常用内置函数" class="headerlink" title="常用内置函数"></a>常用内置函数</h4><ul>
<li><code>len(list)</code> 获取长度</li>
<li><code>list()</code> 转化为列表类型</li>
<li><code>max()</code>/<code>min()</code>求最值，可选参数key进行操作</li>
<li><code>reversed(list)</code>临时翻转，不限于列表</li>
<li><code>sorted(iterable)</code>临时排序，不限于列表 ，可选key和倒序。</li>
<li><code>sum</code>所有成员是数字的时候可用，求和，不限于列表</li>
</ul>
<h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><ul>
<li><code>&#39;&#39;.join(list)</code> 将列表转为字符串</li>
<li><code>.count(value)</code>计次</li>
<li><code>.copy()</code>浅拷贝，和切片<code>[:]</code>等效</li>
</ul>
<h5 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h5><ul>
<li><code>.append(p)</code> 追加</li>
<li><code>.extend(iterable)</code>迭代追加</li>
<li><code>.insert(index,obj)</code>插入</li>
<li><code>.pop(index=-1)</code> 删除默认最后一个 并返回它的值</li>
<li><code>.remove(value)</code> 删除</li>
<li><code>del</code> 删除 索引/切片</li>
<li><code>.clear()</code> 清空</li>
<li><code>.index(value)</code>查询是否存在,不存在会报错</li>
</ul>
<h5 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h5><p><code>.sort()</code>永久排序<br><code>.reverse()</code>倒序，相当于<code>li[:] = li[::-1]</code>的效果</p>
<p>.sort()即list.sort(self)方法，和全局函数sorted(iterable)</p>
<p>它们本质是<strong>快排算法</strong>两两比较大小<br>它们的参数完全一致（sorted不限于列表）。不同的是：<br>列表的sort方法无返回值，直接修改self<br>内置函数sorted，返回临时排序后的列表</p>
<h3 id="成员赋值"><a href="#成员赋值" class="headerlink" title="成员赋值"></a>成员赋值</h3><h4 id="逐个赋值"><a href="#逐个赋值" class="headerlink" title="逐个赋值"></a>逐个赋值</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, c = arr</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></div>

<h4 id="获取剩余"><a href="#获取剩余" class="headerlink" title="获取剩余"></a>获取剩余</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c, *d, e = arr1</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e</span><br><span class="line"><span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></div>

<p>此方法不限于列表</p>
<h3 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h3><blockquote>
<h4 id="tuple"><a href="#tuple" class="headerlink" title="#tuple"></a><a href="http://nanarino.metoyun.com/py/5-列表和元组.html#tuple" target="_blank" rel="noopener">#</a>tuple</h4><p>可迭代类型 不可变类型 有序类型</p>
<p>元组中只包含一个元素时，必须在末尾元素后面添加逗号 （推荐所有情况都加逗号）<br>创建元组使用小括号</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">tup = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>,)</span><br></pre></td></tr></table></figure></div>
</blockquote>
<h4 id="索引和切片-1"><a href="#索引和切片-1" class="headerlink" title="索引和切片"></a>索引和切片</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;tup[<span class="number">1</span>]</span><br><span class="line"><span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;tup[:<span class="number">1</span>]</span><br><span class="line">(<span class="number">1</span>,)</span><br></pre></td></tr></table></figure></div>

<p>和字符串的索引和切片操作几乎一样。<br>元组的切片和索引<strong>只读</strong>（只有getitem操作）。</p>
<p>内置函数<code>tuple()</code>可以将对象转化为元组</p>
<h4 id="常用方法-1"><a href="#常用方法-1" class="headerlink" title="常用方法"></a>常用方法</h4><ul>
<li><code>.count()</code></li>
<li><code>.index()</code></li>
</ul>
<p>对象方法是返回新的对象还是修改对象本身</p>
<p>一般来说，对于可变类型 对象方法如<code>list.sort()</code>会影响到self本身<br>而对于不可变类型，对象方法如<code>str.replace()</code>会返回一个预期的新对象</p>
<h3 id="内置函数enumerate"><a href="#内置函数enumerate" class="headerlink" title="内置函数enumerate()"></a>内置函数enumerate()</h3><p><code>for i in 列表</code> 只能遍历出列表成员，如果需要同时遍历出索引可以使用：<br><code>enumerate(sequence, [start=0])</code> 意为枚举，将一个可迭代的对象，同时列出数据和数据下标<br>可以用list()函数把enumerate()返回的枚举对象转为一个列表</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;li = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>]</span><br><span class="line">&gt;&gt;&gt;list(enumerate(li))</span><br><span class="line">[(<span class="number">0</span>, <span class="string">'a'</span>), (<span class="number">1</span>, <span class="string">'b'</span>), (<span class="number">2</span>, <span class="string">'c'</span>)]</span><br></pre></td></tr></table></figure></div>

<p>一般直接在for循环中使用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">namelist = [<span class="string">'夏色祭'</span>,<span class="string">'赤井心'</span>,<span class="string">'湊阿夸'</span>]</span><br><span class="line"><span class="keyword">for</span> i, name <span class="keyword">in</span> enumerate(namelist):</span><br><span class="line">	print(i,name)</span><br><span class="line"></span><br><span class="line"><span class="string">'''打印内容</span></span><br><span class="line"><span class="string">0 夏色祭</span></span><br><span class="line"><span class="string">1 赤井心</span></span><br><span class="line"><span class="string">2 湊阿夸</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></div>

<h3 id="内置函数slice"><a href="#内置函数slice" class="headerlink" title="内置函数slice()"></a>内置函数slice()</h3><p>意为切片<br><code>slice(stop)</code><br><code>slice(start, stop[, step])</code></p>
<p>实例化一个切片对象，用来代替切片中的中括号内的内容</p>
<ul>
<li>start – 起始位置</li>
<li>stop – 结束位置</li>
<li>step – 间距</li>
</ul>
<p>切片对象用索引的写法<code>[slice(1,2)]</code>可以达到切片的效果<code>[1:2]</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = slice(<span class="number">10</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(a)</span><br><span class="line">slice(<span class="literal">None</span>, <span class="number">10</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = slice(<span class="number">1</span>,<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(a)</span><br><span class="line">slice(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(a.start)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(a.stop)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(a.step)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[slice(<span class="number">2</span>,<span class="number">6</span>)]</span><br><span class="line">[<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure></div>

<h3 id="内置函数range"><a href="#内置函数range" class="headerlink" title="内置函数range()"></a>内置函数range()</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="code"><pre><span class="line">range(<span class="keyword">stop</span>)<span class="string">`</span></span><br><span class="line"><span class="string">`</span><span class="keyword">range</span>(<span class="keyword">start</span>, <span class="keyword">stop</span>[, step])</span><br></pre></td></tr></table></figure></div>

<p>参数类似切片，可创建一个整数列表，可以很方便的用在for循环中，<br>一般用来固定循环for次数，与其他语言中的`for(i=0; i效果相似</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Python3.x 中 range() 函数返回的结果是一个整数序列的可迭代对象,而不是列表</span></span><br><span class="line"><span class="string">可以用list()函数把range()返回的可迭代对象转为一个列表 </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(range(<span class="number">5</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure></div>

<p>打印一个九九乘法表，来试试吧，例如：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">a=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,i+<span class="number">1</span>):</span><br><span class="line">        a+=(str(j)+<span class="string">"×"</span>+str(i)+<span class="string">"="</span>+str(j*i)+<span class="string">" "</span>)</span><br><span class="line">    a+=<span class="string">"\n"</span>   </span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(十)</title>
    <url>/Python/Python_id_25.html</url>
    <content><![CDATA[<h2 id="数字和字符串"><a href="#数字和字符串" class="headerlink" title="数字和字符串"></a>数字和字符串</h2><h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><blockquote>
<p>属于不可变类型</p>
<p>使用字面量直接创建 包括：<br>十进制整型<code>int</code> 浮点型<code>float</code> 复数<code>complex</code> 布尔型<code>bool</code></p>
</blockquote>
<a id="more"></a>

<h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><p>和其他语言一样使用算术运算符<code>+</code>, <code>-</code>, <code>*</code> 和 <code>/</code> 取模<code>%</code><br>在整数除法中，除法 <code>/</code> 总是返回一个浮点数，<br>如果只想得到整数的结果，丢弃可能的分数部分，可以使用运算符 <code>//</code><br>使用 <code>**</code> 操作来进行幂运算<br>位运算符和其他语言一样 左移右移异或等</p>
<blockquote>
<p>利用位运算将变量a和b的值交换</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">a = a ^ b</span><br><span class="line">b = a ^ b</span><br><span class="line">a = a ^ b</span><br></pre></td></tr></table></figure></div>
</blockquote>
<h4 id="常见属性"><a href="#常见属性" class="headerlink" title="常见属性"></a>常见属性</h4><p><code>.real</code> 实部<br><code>.imag</code> 虚部（字面量的虚数单位为<code>j</code>）。<br>整型：<code>.numerator</code> 分子 是它本身。<br>整型：<code>.denominator</code> 分母 恒为1。</p>
<h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><p><code>.bit_length()</code> 得到指定数值的二进制的长度数</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">i = <span class="number">100</span></span><br><span class="line">print(i.bit_length())</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">                  bit_length</span></span><br><span class="line"><span class="string">1     0000 0001       1</span></span><br><span class="line"><span class="string">2     0000 0010       2</span></span><br><span class="line"><span class="string">3     0000 0011       2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure></div>

<h4 id="常用内置函数"><a href="#常用内置函数" class="headerlink" title="常用内置函数"></a>常用内置函数</h4><ul>
<li><code>abs()</code>求绝对值 复数求模</li>
<li><code>max()</code>/<code>min()</code>求最值</li>
<li><code>int(x)</code> 将x转换为一个整数</li>
<li><code>float(x)</code> 将x转换到一个浮点数</li>
<li><code>pow(a,b)</code> 相当于<code>a**b</code></li>
<li><code>pow(a,b,c)</code> 相当于<code>a**b%c</code></li>
<li><code>round(num)</code> 四舍五入（实际是不是真正的四舍五入，是以5.0为界）</li>
<li><code>divmod(被除数,除数)</code> 返回元组:<code>(商,余数)</code></li>
<li><code>complex(x, y)</code> 以x为实部，y为虚部，实例化一个复数</li>
</ul>
<h4 id="有关进制"><a href="#有关进制" class="headerlink" title="有关进制"></a>有关进制</h4><p>其他进制的<strong>字面量</strong>可以直接转换为<code>int</code>类型，也可以相互运算</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x29a</span></span><br><span class="line"><span class="number">666</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x29a</span> - <span class="number">666</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<p>其他进制的<strong>字符串字面量</strong>，无法直接由<code>str()</code>函数获得</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="number">0x29a</span>) == <span class="string">'0x29a'</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="number">0x29a</span>) == <span class="string">'666'</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></div>

<p>进制转换</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>bin(<span class="number">255</span>)</span><br><span class="line"><span class="string">'0b11111111'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>oct(<span class="number">255</span>)</span><br><span class="line"><span class="string">'0o377'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hex(<span class="number">255</span>)</span><br><span class="line"><span class="string">'0xff'</span></span><br></pre></td></tr></table></figure></div>

<p>若内置函数 <code>int()</code> 传入了两个参数，<br><code>int(x, base)</code> 则第一个参数必需是字符串类型，其第二个参数是原进制。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>int(<span class="string">'0xff'</span>, <span class="number">16</span>)</span><br><span class="line"><span class="number">255</span></span><br></pre></td></tr></table></figure></div>

<table>
<thead>
<tr>
<th>转换为↓</th>
<th>2进制</th>
<th>8进制</th>
<th>10进制</th>
<th>16进制</th>
</tr>
</thead>
<tbody><tr>
<td>2进制</td>
<td><code>x</code></td>
<td><code>bin(int(x, 8))</code></td>
<td><code>bin(int(x, 10))</code></td>
<td><code>bin(int(x, 16))</code></td>
</tr>
<tr>
<td>8进制</td>
<td><code>oct(int(x, 2))</code></td>
<td><code>x</code></td>
<td><code>oct(int(x, 10))</code></td>
<td><code>oct(int(x, 16))</code></td>
</tr>
<tr>
<td>10进制</td>
<td><code>int(x, 2)</code></td>
<td><code>int(x, 8)</code></td>
<td><code>x</code></td>
<td><code>int(x, 16)</code></td>
</tr>
<tr>
<td>16进制</td>
<td><code>hex(int(x, 2))</code></td>
<td><code>hex(int(x, 8))</code></td>
<td><code>hex(int(x, 10))</code></td>
<td><code>x</code></td>
</tr>
</tbody></table>
<h4 id="有关模块"><a href="#有关模块" class="headerlink" title="有关模块"></a>有关模块</h4><p><code>decimal</code>模块提供了 <code>Decimal</code> 数据类型用于浮点数计算，拥有更高的精度用来解决如下情况：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0.1</span> + <span class="number">0.2</span></span><br><span class="line"><span class="number">0.30000000000000004</span></span><br></pre></td></tr></table></figure></div>

<p>但是在精度要求不高的时候可以使用字符串格式化来解决。</p>
<ul>
<li><code>math</code>模块：提供基本的三角函数指数对数等方法,数域只到实数(负数不能用它开平方)</li>
<li><code>cmath</code>模块：同<code>math</code>模块, 数域扩充到复数 ,还提供了转换极坐标系的方法</li>
<li><code>numpy</code>模块：用于复杂的数学问题:排列组合 矩阵等 这里不过多讨论</li>
</ul>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><blockquote>
<h4 id="str"><a href="#str" class="headerlink" title="str"></a>str</h4><p>可迭代类型 不可变类型 有序类型.</p>
<p>使用字面量引号(<code>&#39;</code>或<code>&quot;</code>)来创建字符串<br>在python3中，字符串都是Unicode字符，相当于python2中字面量前面加<code>u</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">var1 = <span class="string">'我想起高兴的事情!'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#python2中的中文字符最好在前面加u </span></span><br><span class="line"><span class="comment">#var1 = u'我想起高兴的事情!'</span></span><br></pre></td></tr></table></figure></div>
</blockquote>
<h4 id="索引和切片"><a href="#索引和切片" class="headerlink" title="索引和切片"></a>索引和切片</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">var1[<span class="number">0</span>]</span><br><span class="line">var1[<span class="number">1</span>:<span class="number">5</span>]</span><br></pre></td></tr></table></figure></div>

<p>对于切片：</p>
<ul>
<li>切片遵循左闭右开原则。</li>
<li>切片的冒号左边不写默认是0，右边不写默认是长度-1。</li>
<li>切片还可以使用第二个冒号<code>[::step]</code>，代表间距，为-1时可以倒序。</li>
</ul>
<p>切片和索引<strong>只读</strong>（只有getitem操作）</p>
<h4 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h4><p><code>\n</code>换行、 <code>\t</code>制表符键盘的tab、 <code>\\</code>反斜线\ 、 <code>\/</code>斜线/</p>
<p><code>\&#39;</code> <code>\&quot;</code>引号前面的\有时候必须有，有时候不能有，有时候是可有可无的。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#第二个单引号前不能有\</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'\\\\\'</span></span><br><span class="line"><span class="string">SyntaxError: EOL while scanning string literal</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#第二个单引号前必须有\</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; eval("'</span>\\\\\<span class="string">'")</span></span><br><span class="line"><span class="string">'</span>\\<span class="string">'</span></span><br></pre></td></tr></table></figure></div>

<p>用原始字符串就能解决这个问题。</p>
<p>关于换行</p>
<p>换行风格有多种，转义字符组合各不相同，可以参阅有关文档</p>
<h4 id="原始字符串"><a href="#原始字符串" class="headerlink" title="原始字符串"></a>原始字符串</h4><p>在字符串的前面加<code>r</code>可以显示原始字符串（Raw String）<br>原始字符串常被用来书写正则表达式</p>
<p>内置函数<code>repr()</code>可以查看原始字符串</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">r"\n"</span></span><br><span class="line"><span class="string">'\\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">r"\n"</span>)</span><br><span class="line">\n</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(<span class="string">r"\n"</span>)</span><br><span class="line"><span class="string">"'\\\\n'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(repr(<span class="string">r"\n"</span>))</span><br><span class="line"><span class="string">'\\n'</span></span><br></pre></td></tr></table></figure></div>

<h4 id="二进制字符串"><a href="#二进制字符串" class="headerlink" title="二进制字符串"></a>二进制字符串</h4><p>实际上它已经不是<code>str</code>类型。二进制字符串字面量只包含ASCII字符。<br>在字符串的前面加<code>b</code>可以当成二进制字符串识别（Bytes String）<br>等价于使用内置函数<code>bytes()</code>和<code>str.encode()</code>。</p>
<p><code>str</code>类型转化为<code>bytes</code>类型的方法如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b'eJwLKs3NTNRRKC7NzgQAF/kEBw=='</span><span class="comment">#只包含ASCII字符 可直接在字符串前面加上b</span></span><br><span class="line"><span class="string">b'eJwLKs3NTNRRKC7NzgQAF/kEBw=='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bytes(<span class="string">"eJwLKs3NTNRRKC7NzgQAF/kEBw=="</span>,<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">b'eJwLKs3NTNRRKC7NzgQAF/kEBw=='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'eJwLKs3NTNRRKC7NzgQAF/kEBw=='</span>.encode() <span class="comment">#默认utf-8</span></span><br><span class="line"><span class="string">b'eJwLKs3NTNRRKC7NzgQAF/kEBw=='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str.encode(<span class="string">'eJwLKs3NTNRRKC7NzgQAF/kEBw=='</span>) <span class="comment">#同上，静态方法的形式调用</span></span><br><span class="line"><span class="string">b'eJwLKs3NTNRRKC7NzgQAF/kEBw=='</span></span><br></pre></td></tr></table></figure></div>

<p><code>bytes</code>类型转化为<code>str</code>类型的方法如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="string">b'\xe4\xbd\xa0\xe5\xa5\xbd'</span>,<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">'你好'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b'\xe4\xbd\xa0\xe5\xa5\xbd'</span>.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">'你好'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bytes.decode(<span class="string">b'\xe4\xbd\xa0\xe5\xa5\xbd'</span>,<span class="string">'utf-8'</span>)<span class="comment">#同上，静态方法的形式调用</span></span><br><span class="line"><span class="string">'你好'</span></span><br></pre></td></tr></table></figure></div>

<p>静态方法的方式来调用</p>
<p>类上定义的对象方法以静态方法的形式调用，只需要第一个参数是实例对象（<code>self</code>）即可。<br>这将在会在之后面向对象章节中介绍。</p>
<h4 id="运算符操作"><a href="#运算符操作" class="headerlink" title="运算符操作"></a>运算符操作</h4><ul>
<li><code>str+str</code> 拼接</li>
<li><code>str*int</code> 重复拼接</li>
<li><code>in</code> <code>not in</code>是否包含给定的字符</li>
<li><code>%</code> 格式化 后面专门讲</li>
</ul>
<h4 id="常用方法-1"><a href="#常用方法-1" class="headerlink" title="常用方法"></a>常用方法</h4><ul>
<li><code>.encode()</code>编码，默认编码为utf-8，最终返回值是bytes类型</li>
<li><code>.decode()</code>解码，<strong>已废弃</strong>，但python2中依然可用来转换中文等的编码</li>
</ul>
<h5 id="替换分割"><a href="#替换分割" class="headerlink" title="替换分割"></a>替换分割</h5><p>不会修改原字符串，只会返回预期的字符串。</p>
<ul>
<li><code>.split(str)</code>以str分割为list，不能传空字符串。</li>
<li><code>.join(list)</code>(将可迭代对象)以字符串拼接</li>
<li><code>.replace()</code> 替换</li>
<li><code>.strip()</code> <code>.lstrip()</code> <code>.rstrip()</code>去掉两端空格/指定字符</li>
<li><code>.partition(str)</code>分割返回元组</li>
<li><code>.translate</code>(翻译表)过滤</li>
</ul>
<h5 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h5><ul>
<li><code>.find(str)</code>找不到返回<code>-1</code></li>
<li><code>.index(str)</code>找不到报错</li>
<li><code>.count(str)</code>返回出现次数</li>
</ul>
<h5 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h5><ul>
<li><code>.format()</code>格式化字符串 后面专门讲</li>
<li><code>.expandtabs(int)</code>用制表符占位分组</li>
<li><code>.zfill(2)</code> 不足两位开头补0，功能与<code>&#39;%02d&#39;%num</code>一样</li>
<li><code>.center()</code> <code>.ljust()</code> <code>.rjust()</code> 几种填充方法</li>
</ul>
<h5 id="大小转换"><a href="#大小转换" class="headerlink" title="大小转换"></a>大小转换</h5><ul>
<li><code>.swapcase()</code>大小写翻转</li>
<li><code>.title()</code>首字母大写</li>
<li><code>.capitalize()</code>首字母大写</li>
<li><code>.upper()</code>全部罗马字大写</li>
<li><code>.lower()</code>全部罗马字小写</li>
<li><code>.casefold()</code>全部字符小写</li>
</ul>
<p>更多方法可以使用内置函数<code>dir()</code>来查看</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir(str)</span><br><span class="line">[<span class="string">'__add__'</span>, <span class="string">'__class__'</span>, <span class="string">'__contains__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>,</span><br><span class="line"> <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__getitem__'</span>, <span class="string">'__getnewargs__'</span>, <span class="string">'__gt__'</span>,</span><br><span class="line"> <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__le__'</span>, <span class="string">'__len__'</span>, <span class="string">'__lt__'</span>,</span><br><span class="line"> <span class="string">'__mod__'</span>, <span class="string">'__mul__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>,</span><br><span class="line"> <span class="string">'__rmod__'</span>, <span class="string">'__rmul__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>,</span><br><span class="line"> <span class="string">'capitalize'</span>, <span class="string">'casefold'</span>, <span class="string">'center'</span>, <span class="string">'count'</span>, <span class="string">'encode'</span>, <span class="string">'endswith'</span>, <span class="string">'expandtabs'</span>, <span class="string">'find'</span>,</span><br><span class="line"> <span class="string">'format'</span>, <span class="string">'format_map'</span>, <span class="string">'index'</span>, <span class="string">'isalnum'</span>, <span class="string">'isalpha'</span>, <span class="string">'isascii'</span>, <span class="string">'isdecimal'</span>,</span><br><span class="line"> <span class="string">'isdigit'</span>, <span class="string">'isidentifier'</span>, <span class="string">'islower'</span>, <span class="string">'isnumeric'</span>, <span class="string">'isprintable'</span>, <span class="string">'isspace'</span>, <span class="string">'istitle'</span>,</span><br><span class="line"> <span class="string">'isupper'</span>, <span class="string">'join'</span>, <span class="string">'ljust'</span>, <span class="string">'lower'</span>, <span class="string">'lstrip'</span>, <span class="string">'maketrans'</span>, <span class="string">'partition'</span>, <span class="string">'replace'</span>,</span><br><span class="line"> <span class="string">'rfind'</span>, <span class="string">'rindex'</span>, <span class="string">'rjust'</span>, <span class="string">'rpartition'</span>, <span class="string">'rsplit'</span>, <span class="string">'rstrip'</span>, <span class="string">'split'</span>, <span class="string">'splitlines'</span>,</span><br><span class="line"> <span class="string">'startswith'</span>, <span class="string">'strip'</span>, <span class="string">'swapcase'</span>, <span class="string">'title'</span>, <span class="string">'translate'</span>, <span class="string">'upper'</span>, <span class="string">'zfill'</span>]</span><br></pre></td></tr></table></figure></div>

<p><code>isdigit()</code> 是否纯数字 <code>isascii()</code> 是否纯ascii字符 等。。。</p>
<h4 id="相关的内置函数"><a href="#相关的内置函数" class="headerlink" title="相关的内置函数"></a>相关的内置函数</h4><ul>
<li><code>repr()</code>转化为原始字符串类型（调用魔术方法<code>__repr__</code>）</li>
<li><code>str()</code>转化为字符串类型（调用魔术方法<code>__str__</code>，不存在则调用<code>__repr__</code>）<br>将二进制字符串转为字符串类型：<code>str(msg,&#39;utf-8&#39;)</code></li>
<li><code>len(var1)</code>返回字符串长度</li>
<li><code>bytes(str, encoding=&#39;utf-8&#39;)</code>编码</li>
<li><code>print()</code>在控制台中调用<code>__str__</code>并显示</li>
</ul>
<h4 id="for-in-中使用字符串"><a href="#for-in-中使用字符串" class="headerlink" title="for in 中使用字符串"></a>for in 中使用字符串</h4><p>循环字符串，将会逐个字符的打印：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">'你想吃桃子'</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> a:</span><br><span class="line">	print(char)</span><br></pre></td></tr></table></figure></div>

<p>当然，你也可以：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'\n'</span>.join(<span class="string">'你想吃桃子'</span>))</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(九)</title>
    <url>/Python/Python_id_24.html</url>
    <content><![CDATA[<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id="异常类"><a href="#异常类" class="headerlink" title="异常类"></a>异常类</h3><p>Python2在exceptions模块内建了很多的异常类型，通过使用dir函数来查看exceptions中的异常类型，如下：</p>
<a id="more"></a>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python27</span></span><br><span class="line"><span class="keyword">import</span> exceptions</span><br><span class="line"><span class="keyword">print</span> dir(exceptions)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">===</span></span><br><span class="line"><span class="string">['ArithmeticError', 'AssertionError', 'AttributeError',</span></span><br><span class="line"><span class="string">'BaseException', 'BufferError', 'BytesWarning',</span></span><br><span class="line"><span class="string">'DeprecationWarning', 'EOFError', 'EnvironmentError',</span></span><br><span class="line"><span class="string">'Exception', 'FloatingPointError', 'FutureWarning',</span></span><br><span class="line"><span class="string">'GeneratorExit', 'IOError', 'ImportError', 'ImportWarning',</span></span><br><span class="line"><span class="string">'IndentationError', 'IndexError', 'KeyError',</span></span><br><span class="line"><span class="string">'KeyboardInterrupt', 'LookupError', 'MemoryError',</span></span><br><span class="line"><span class="string">'NameError', 'NotImplementedError', 'OSError',</span></span><br><span class="line"><span class="string">'OverflowError', 'PendingDeprecationWarning',</span></span><br><span class="line"><span class="string">'ReferenceError', 'RuntimeError', 'RuntimeWarning',</span></span><br><span class="line"><span class="string">'StandardError', 'StopIteration', 'SyntaxError',</span></span><br><span class="line"><span class="string">'SyntaxWarning', 'SystemError', 'SystemExit',</span></span><br><span class="line"><span class="string">'TabError', 'TypeError', 'UnboundLocalError',</span></span><br><span class="line"><span class="string">'UnicodeDecodeError', 'UnicodeEncodeError',</span></span><br><span class="line"><span class="string">'UnicodeError', 'UnicodeTranslateError', 'UnicodeWarning',</span></span><br><span class="line"><span class="string">'UserWarning', 'ValueError', 'Warning',</span></span><br><span class="line"><span class="string">'ZeroDivisionError', '__doc__', '__name__', '__package__']</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></div>

<p>在python3中它们是全局的。</p>
<h4 id="捕获异常和获取异常信息"><a href="#捕获异常和获取异常信息" class="headerlink" title="捕获异常和获取异常信息"></a>捕获异常和获取异常信息</h4><p>和C#中的try/catch类似，Python中使用try/except关键字来捕捉异常，如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    print(<span class="number">2</span>/<span class="number">0</span>)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    print(<span class="string">'除数不能为0'</span>)</span><br></pre></td></tr></table></figure></div>

<p>在一个except语句只捕捉其后声明的异常类型，如果可能会抛出的是其他类型的异常就需要再增加一个except语句了，或者也可以指定一个更通用的异常类型比如：Exception，(也可以不接任何异常和参数直接捕获,但是pycharm会给出一个警告的) 如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    print(<span class="number">2</span>/<span class="string">'0'</span>)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    print(<span class="string">'除数不能为0'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    print(<span class="string">'其他类型异常'</span>)</span><br></pre></td></tr></table></figure></div>

<p>每个异常都会有一些异常信息，一般情况下我们应该把这些异常信息记录下来：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    print(<span class="number">2</span>/<span class="string">'0'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:    <span class="comment"># Exception位置也可以放一个错误类元组</span></span><br><span class="line">    <span class="comment"># unsupported operand type(s) for /: 'int' and 'str'</span></span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure></div>

<p>finally子句和try子句联合使用但是和except语句不同，finally不管try子句内部是否有异常发生，都会执行finally子句内的代码。所有一般情况下，finally自己常常用于关闭文件或者在socket中。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    print(<span class="number">2</span>/<span class="string">'0'</span>)</span><br><span class="line"><span class="keyword">except</span> (ZeroDivisionError,Exception):</span><br><span class="line">    print(<span class="string">'发生了一个异常'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'正常得出了计算结果'</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    print(<span class="string">'不管是否发生异常都执行'</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="抛出异常和自定义异常"><a href="#抛出异常和自定义异常" class="headerlink" title="抛出异常和自定义异常"></a>抛出异常和自定义异常</h4><p>Python中的raise关键字用于引发一个异常，基本上和C#和Java中的throw关键字相同，如下所示：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ThorwErr</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">"抛出一个异常"</span>) </span><br><span class="line"><span class="comment"># Exception: 抛出一个异常 </span></span><br><span class="line">ThorwErr()</span><br></pre></td></tr></table></figure></div>

<p>raise关键字后面是抛出是一个通用的异常类型(Exception)，一般来说抛出的异常越详细越好。<br>捕捉到了异常，但是又想重新引发它(传递异常)，可以使用不带参数的raise语句即可：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MuffledCalculator</span>:</span></span><br><span class="line">    muffled = <span class="literal">False</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calc</span><span class="params">(self,expr)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> eval(expr)</span><br><span class="line">        <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">            <span class="keyword">if</span> self.muffled:</span><br><span class="line">                print(<span class="string">'Division by zero is illegal'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span></span><br></pre></td></tr></table></figure></div>

<p>Python中也可以自定义自己的特殊类型的异常，只需要要从Exception类继承(直接或间接)即可</p>
<h3 id="警告类"><a href="#警告类" class="headerlink" title="警告类"></a>警告类</h3><p>和异常类的exceptions模块一样，警告类型在warnings模块中，<br>但是事实上Warning基类是Exception基类的子类。</p>
<h4 id="发出警告"><a href="#发出警告" class="headerlink" title="发出警告"></a>发出警告</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line">warnings.warn(<span class="string">'使用了已弃用功能'</span>, DeprecationWarning)</span><br></pre></td></tr></table></figure></div>

<h4 id="忽略警告"><a href="#忽略警告" class="headerlink" title="忽略警告"></a>忽略警告</h4><p>调用 <code>filterwarnings()</code> 将规则添加到警告过滤器，<code>simplefilter()</code>是其简易版。<br>调用 <code>resetwarnings()</code> 将警告过滤器重置为默认状态。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.simplefilter(<span class="string">"ignore"</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="警告上升为异常"><a href="#警告上升为异常" class="headerlink" title="警告上升为异常"></a>警告上升为异常</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.simplefilter(<span class="string">"error"</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="上下文管理"><a href="#上下文管理" class="headerlink" title="上下文管理"></a>上下文管理</h3><p>以下内容可能超出理解，以后请回看。</p>
<h4 id="with-as-语句"><a href="#with-as-语句" class="headerlink" title="with as 语句"></a>with as 语句</h4><p>在使用内置函数<code>open()</code>读写文件的时候需要繁琐的方法来捕获异常：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = open(<span class="string">'1.txt'</span>)</span><br><span class="line">    f.read()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure></div>

<p>大可不必如此，<code>open()</code>返回的文件句柄对象实现了上下文管理，只需要：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'1.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.read()</span><br></pre></td></tr></table></figure></div>

<h4 id="实现上下文协议"><a href="#实现上下文协议" class="headerlink" title="实现上下文协议"></a>实现上下文协议</h4><p>对任意对象实现上下文管理，可以通过实现魔术方法<code>__enter__</code>和<code>__exit__</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_value, traceback)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> exc_type:</span><br><span class="line">            print(traceback)</span><br></pre></td></tr></table></figure></div>

<p><code>__enter__</code>和<code>__exit__</code>也可以借由内置模块<code>contextlib</code>的装饰来实现</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open_a</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> A(name)</span><br></pre></td></tr></table></figure></div>

<h4 id="closing"><a href="#closing" class="headerlink" title="@closing"></a>@closing</h4><p>如果一个对象没有实现上下文，我们就不能把它用于<code>with</code>语句。这个时候，可以用<code>closing()</code>来把该对象变为上下文对象</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> closing</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> closing(urlopen(<span class="string">'https://www.python.org'</span>)) <span class="keyword">as</span> page:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> page:</span><br><span class="line">        print(line)</span><br></pre></td></tr></table></figure></div>

<h3 id="熔断器模式"><a href="#熔断器模式" class="headerlink" title="熔断器模式"></a>熔断器模式</h3><p>熔断器模式Circuit Breaker</p>
<blockquote>
<p>熔断器模式可以防止应用程序不断地尝试执行可能会失败的操作，使得应用程序继续执行而不用等待修正错误，或者浪费CPU时间去等到长时间的超时产生。熔断器模式也可以使应用程序能够诊断错误是否已经修正，如果已经修正，应用程序会再次尝试调用操作。</p>
<p>熔断器模式就像是那些容易导致错误的操作的一种代理。这种代理能够记录最近调用发生错误的次数，然后决定使用允许操作继续，或者立即返回错误。</p>
</blockquote>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(八)</title>
    <url>/Python/Python_id_23.html</url>
    <content><![CDATA[<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><ul>
<li><p>成员运算符：<code>in</code>后面讲列表了会讲</p>
</li>
<li><p>比较运算符：<code>==</code> <code>&gt;</code> <code>&gt;=</code> <code>&lt;</code> <code>&lt;=</code> <code>&lt;&gt;</code> <code>!=</code><br>对于<code>None</code>的判断除了比较运算符，更推荐用<code>is None</code> 和 <code>is not None</code><br>在python3中，是否不等于<code>&lt;&gt;</code>被取消了，想要使用需要先引入模块</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> barry_as_FLUFL</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<a id="more"></a>

<ul>
<li>逻辑运算符：<code>and</code> <code>or</code> <code>not</code></li>
<li>位运算符：<code>|</code> <code>&amp;</code> <code>~</code> <code>^</code> <code>&gt;&gt;</code> <code>&lt;&lt;</code></li>
</ul>
<p>内置模块<a href="https://docs.python.org/zh-cn/3/library/operator.html" target="_blank" rel="noopener"><code>operator</code></a>里的函数与运算符映射。</p>
<h3 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h3><p>赋值运算符 <code>=</code> 用于给变量赋值。<br>在python中，声明和赋值都是等号 <code>=</code> ，赋值语句本身不会返回任何结果<br>在python3.8中新增的海象运算符（the walrus operator）<code>:=</code>，其表达式会赋值同时返回左值的引用。</p>
<h4 id="连用"><a href="#连用" class="headerlink" title="连用"></a>连用</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">c = <span class="number">1</span></span><br><span class="line">a = b = c = <span class="number">1</span></span><br><span class="line">print(a,b,c)</span><br></pre></td></tr></table></figure></div>

<p>赋予相当于起别名，多个变量表示的会是同一个内存地址</p>
<h4 id="内置函数id"><a href="#内置函数id" class="headerlink" title="内置函数id()"></a>内置函数<code>id()</code></h4><p>使用内置函数<code>id()</code>可以查看内存地址的表示；<br>布尔表达式中也可以连用比较<code>==</code>，多个值全等的时候将返回<code>Ture</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">print(id(a) == id(b) == id(c))</span><br></pre></td></tr></table></figure></div>

<p>当变量被修改的时候，内置函数<code>id()</code>也会重新指向。<br>对于可变的容器类型，其成员被修改，容器的<code>id()</code>将不会发生变化。</p>
<h4 id="布尔表达式"><a href="#布尔表达式" class="headerlink" title="布尔表达式"></a>布尔表达式</h4><p>布尔表达式是逻辑运算的计算式。<br>逻辑运算符优先级为：<code>()</code>&gt; <code>not</code>&gt; <code>and</code> &gt; <code>or</code> 。同优先级进行从左往右先后计算。<br>二元逻辑运算符会先后将其两边的表达式结果，<strong>隐式地</strong>转化为<code>bool</code>类型后再参与逻辑运算</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">and</span> <span class="literal">True</span>    <span class="comment">#相当于 bool(1) and True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></div>

<p>内置函数<code>bool()</code>会<strong>显式地</strong>把其他类型转换为<code>bool</code>类型<br><code>bool</code>类型只有两个值：<code>True</code>和<code>False</code></p>
<ul>
<li>非零非空转换成布尔类型是 <code>True</code></li>
<li>0 ，None等值转换成布尔类型是 <code>False</code></li>
</ul>
<p>值得注意的是：</p>
<p>与JavaScript不同，python中如<code>bool([])</code>等空对象都是False。<br>而JavaScript中只要是对象都是true。<br>事实上，这是对象的魔术方法<code>__bool__</code>所定义的。</p>
<h4 id="连用-1"><a href="#连用-1" class="headerlink" title="连用"></a>连用</h4><p>比较运算符可以连续使用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="number">2015</span> &gt; y &gt; <span class="number">2018</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div>

<h3 id="短路法"><a href="#短路法" class="headerlink" title="短路法"></a>短路法</h3><p>在计算布尔表达式结果时往往只判断左边就既定了结果：<br><code>x or y</code> 如果<code>x==True</code>，则返回x<br><code>x and y</code> 如果<code>x==True</code>，则返回y<br>短路之后，逻辑运算符右侧的<strong>隐式</strong>进行类型转换将不会进行，直接返回：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">or</span> [] <span class="keyword">or</span> <span class="number">1</span> <span class="keyword">or</span> <span class="number">3</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">or</span> [] <span class="keyword">or</span> <span class="number">3</span> <span class="keyword">or</span> <span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">and</span> <span class="literal">True</span> <span class="keyword">and</span> [] <span class="keyword">and</span> <span class="number">0</span></span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">and</span> <span class="literal">True</span> <span class="keyword">and</span> <span class="number">0</span> <span class="keyword">and</span> []</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<p><strong>思考题</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;issubclass(bool, int) <span class="keyword">or</span> bool([]) <span class="keyword">and</span> <span class="number">2</span>&gt;&gt;<span class="number">3</span> <span class="keyword">or</span> (<span class="number">0.1</span>+<span class="number">0.2</span>==<span class="number">0.3</span>)</span><br><span class="line"><span class="comment">#??? 可以在后续的学习中思考</span></span><br></pre></td></tr></table></figure></div>

<h3 id="流程控制-1"><a href="#流程控制-1" class="headerlink" title="流程控制"></a>流程控制</h3><p><strong>python中 流程控制相关代码块都不具备独立的命名空间</strong><br>流程控制中的条件是布尔表达式，<code>if</code> <code>while</code>也能<strong>隐式</strong>地将结果转换为布尔值：</p>
<h4 id="if"><a href="#if" class="headerlink" title="if"></a>if</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件:</span><br><span class="line">    条件满足就...</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    否则就...</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>if</code>…<code>elif</code>…<code>else</code>语句 可以并列多个条件</li>
<li><code>pass</code> 表示空语句,一般起到占位作用</li>
</ul>
<h4 id="while"><a href="#while" class="headerlink" title="while"></a>while</h4><p>终止循环的方式：</p>
<ul>
<li>改变条件，使其不成立。</li>
<li><code>break</code></li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> 条件:</span><br><span class="line">    循环体</span><br></pre></td></tr></table></figure></div>

<p><code>continue</code>可以跳过本轮循环</p>
<h4 id="while也有else"><a href="#while也有else" class="headerlink" title="while也有else"></a>while也有else</h4><p>循环正常执行完（不<code>break</code>），或第一次就不满足时进入else分支。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt;= <span class="number">5</span>:</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"循环正常执行完"</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="语句和表达式"><a href="#语句和表达式" class="headerlink" title="语句和表达式"></a>语句和表达式</h3><p>在python中，<code>a + b</code>是表达式，<code>a = b</code>是语句</p>
<h4 id="内置函数eval-和exec"><a href="#内置函数eval-和exec" class="headerlink" title="内置函数eval()和exec()"></a>内置函数<code>eval()</code>和<code>exec()</code></h4><p><code>exec</code>可以将字符串或字节代码对象当作<strong>语句</strong>执行。<br><code>eval</code>可以将字符串或字节代码对象当作<strong>表达式</strong>执行得到返回值。<br>如果使用<code>eval</code>执行的原代码块是语句而不是表达式将会抛出<code>SyntaxError</code>异常。<br>异常处理将在下一章讲到。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#模拟python shell交互式</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    ex = input(<span class="string">'&gt;&gt;&gt; '</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            print(eval(ex))</span><br><span class="line">        <span class="keyword">except</span> SyntaxError <span class="keyword">as</span> e:</span><br><span class="line">            exec(ex)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"Traceback (most recent call last):"</span>)</span><br><span class="line">        print(e)</span><br></pre></td></tr></table></figure></div>

<h4 id="内置函数compile"><a href="#内置函数compile" class="headerlink" title="内置函数compile()"></a>内置函数<code>compile()</code></h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="VIM"><figure class="iseeu highlight /vim"><table><tr><td class="code"><pre><span class="line">compile()` 函数将一个字符串编译为字节代码对象。</span><br><span class="line"><span class="keyword">mode</span>参数指定编译代码的种类。可以指定为 `<span class="string">'exec'</span>`, `<span class="string">'eval'</span>`, `<span class="string">'single'</span></span><br><span class="line">#模拟<span class="keyword">python</span> <span class="keyword">shell</span>交互式</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">ex</span> = <span class="built_in">input</span>(<span class="string">'&gt;&gt;&gt; '</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        exec(compile(<span class="keyword">ex</span>,<span class="string">''</span>,<span class="string">'single'</span>))</span><br><span class="line">    except Exception <span class="keyword">as</span> <span class="keyword">e</span>:</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">"Traceback (most recent call last):"</span>)</span><br><span class="line">        <span class="keyword">print</span>(<span class="keyword">e</span>)</span><br></pre></td></tr></table></figure></div>

<p>两种模拟交互的方式略有区别，前者可以返回<code>None</code>值，但这往往不符合预期。</p>
<h3 id="for-in"><a href="#for-in" class="headerlink" title="for in"></a>for in</h3><p>可以循环一个可迭代对象</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> 成员变量 <span class="keyword">in</span> 容器:</span><br><span class="line">	循环体</span><br></pre></td></tr></table></figure></div>

<p>例如，打印名单，这里以列表为例：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">namelist = [<span class="string">'夏色祭'</span>,<span class="string">'赤井心'</span>,<span class="string">'湊阿夸'</span>]</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> namelist:</span><br><span class="line">	print(name)</span><br></pre></td></tr></table></figure></div>

<h4 id="for也有else"><a href="#for也有else" class="headerlink" title="for也有else"></a>for也有else</h4><p>循环正常执行完（不<code>break</code>），或<code>for in 空容器</code>时进入else分支。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(七)</title>
    <url>/Python/Python_id_22.html</url>
    <content><![CDATA[<h2 id="python种类"><a href="#python种类" class="headerlink" title="python种类"></a>python种类</h2><h3 id="从实现"><a href="#从实现" class="headerlink" title="从实现:"></a>从实现:</h3><p>我们用的都是<code>CPython</code>就是用C语言实现的Python及其解释器（JIT编译器）<br>速度最快的是<code>pypy</code>是python自己实现的自己<br>其他版本:C++(<code>Pyston</code>) \ Java(<code>Jython</code>) \ C#(<code>IronPython</code>)</p>
<a id="more"></a>

<p>从版本:</p>
<ul>
<li>python2</li>
<li>python3</li>
</ul>
<p>区别：python2默认编码方式是ascii码，python3是Unicode<br>解决编码问题：在文件的首行：<code>#-*- encoding:utf-8 -*-</code></p>
<p>SyntaxError: Non-UTF-8 code starting with …</p>
<p>在python3中的中文也有小概率遇到这种情况<br>也是通过 <code>#-*- encoding:utf-8 -*-</code> 来解决</p>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量：就是将一些运算的中间结果暂存到内存中，以便后续代码调用。</p>
<ul>
<li><p>必须由数字，字母，下划线任意组合，且不能数字开头。</p>
</li>
<li><p>不能是python中的关键字 以下:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">[<span class="string">'and'</span>, <span class="string">'as'</span>, <span class="string">'assert'</span>, <span class="string">'break'</span>, <span class="string">'class'</span>, <span class="string">'continue'</span>,</span><br><span class="line">	<span class="string">'def'</span>, <span class="string">'del'</span>, <span class="string">'elif'</span>, <span class="string">'else'</span>, <span class="string">'except'</span>, <span class="string">'exec'</span>,</span><br><span class="line">	<span class="string">'finally'</span>, <span class="string">'for'</span>, <span class="string">'from'</span>, <span class="string">'global'</span>, <span class="string">'if'</span>, <span class="string">'import'</span>, </span><br><span class="line">	<span class="string">'in'</span>, <span class="string">'is'</span>, <span class="string">'lambda'</span>, <span class="string">'not'</span>, <span class="string">'or'</span>, <span class="string">'pass'</span>, <span class="string">'print'</span>, </span><br><span class="line">	<span class="string">'raise'</span>, <span class="string">'return'</span>, <span class="string">'try'</span>, <span class="string">'while'</span>, <span class="string">'with'</span>, <span class="string">'yield'</span>]</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>变量具有可描述性。</p>
</li>
<li><p>不能是汉字等字符。</p>
</li>
</ul>
<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p>客观不变的量 或者程序员不希望它被修改的量。如:</p>
<ul>
<li>圆周率<code>π=3.14</code></li>
<li>自然对数底数<code>e=2.71</code></li>
<li><code>BIR_OF_CHINA = 1949</code></li>
</ul>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>方便自己方便他人理解代码。</p>
<ul>
<li><p>单行注释：<code>#</code></p>
</li>
<li><p>多行注释：<code>&#39;&#39;&#39;</code>被注释内容<code>&#39;&#39;&#39;</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">被注释内容:代码千万行,注释第一行,注释不规范,亲人两行泪</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<p>它不仅是注释，也是带换行的字符串块</p>
<h3 id="用户交互input"><a href="#用户交互input" class="headerlink" title="用户交互input"></a>用户交互<code>input</code></h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">a = input(<span class="string">"请输入"</span>)</span><br></pre></td></tr></table></figure></div>

<p>1，等待输入。 2，将输入的内容赋值给了前面变量。 3，<code>input</code>接受的数据类型全部是<code>str</code>类型（字符串类型）</p>
<h3 id="基础数据类型初始"><a href="#基础数据类型初始" class="headerlink" title="基础数据类型初始"></a>基础数据类型初始</h3><p>基础数据类型有：数字，字符串，列表，元组，字典<br>内置函数<code>type()</code>返回变量的类型</p>
<ul>
<li>整型：<code>int</code>，十进制的整数类型<br>数字类型还有浮点型和复数类型，可以相互转换。<br>数字类型可以参与一些算数运算符：加减乘除<br>字符串转化成数字：<code>int(str)</code> 条件：str必须是数字组成的。<br>数字转化成字符串：<code>str(int)</code></li>
<li>布尔值：<code>bool</code><br>True False 表示真假 是逻辑运算表达式的结果<br>布尔类型并不是基础数据类型 是<strong>继承</strong>的整型的<code>1</code>和<code>0</code></li>
<li>字符串：<code>str</code><br>python当中凡是用引号引起来的都是字符串。<br>可相加：str + str 拼接<br>可相乘：str * int 复读</li>
<li>列表：<code>list</code><br>一个具有顺序的容器，可以在里面放置其他类型<br>用花括号包裹，各个成员之间用逗号隔开：<br><code>[ 2019, &quot;春节&quot;]</code></li>
<li>…</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 8安装nodejs</title>
    <url>/CentOS/CentOS_id_07.html</url>
    <content><![CDATA[<p>curl -sL <a href="https://rpm.nodesource.com/setup_10.x" target="_blank" rel="noopener">https://rpm.nodesource.com/setup_10.x</a> | bash -</p>
<p>yum install -y nodejs</p>
<p>[root@localhost /]# node -v<br>v10.9.0<br>[root@localhost /]# npm -v<br>6.2.0</p>
]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(六)</title>
    <url>/Python/Python_id_21.html</url>
    <content><![CDATA[<h2 id="Python-获取-100-以内的质数"><a href="#Python-获取-100-以内的质数" class="headerlink" title="Python - 获取 100 以内的质数"></a>Python - 获取 100 以内的质数</h2><p>题目： 获取 100 以内的质数。</p>
<a id="more"></a>

<p><strong>程序分析：</strong>质数（prime number）又称素数，有无限个。质数定义为在大于1的自然数中，除了1和它本身以外不再有其他因数的数称为质数，如：2、3、5、7、11、13、17、19。</p>
<h3 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h3><p>#!/usr/bin/python # -<em>- coding: UTF-8 -</em>-  num=[]; i=2 for i in range(2,100):   j=2   for j in range(2,i):      if(i%j==0):         break   else:      num.append(i) print(num)</p>
<h3 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h3><p>import math def func_get_prime(n):  return filter(lambda x: not [x%i for i in range(2, int(math.sqrt(x))+1) if x%i ==0], range(2,n+1))  print func_get_prime(100)</p>
<p>输出结果为：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tr><td class="code"><pre><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">53</span>, <span class="number">59</span>, <span class="number">61</span>, <span class="number">67</span>, <span class="number">71</span>, <span class="number">73</span>, <span class="number">79</span>, <span class="number">83</span>, <span class="number">89</span>, <span class="number">97</span>]</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu配置数据库踩坑记录</title>
    <url>/Ubuntu/Ubuntu_id_01.html</url>
    <content><![CDATA[<h2 id="MySQL数据库"><a href="#MySQL数据库" class="headerlink" title="MySQL数据库"></a>MySQL数据库</h2><a id="more"></a>
<p>ubuntu环境下安装MySQL数据库:</p>
<ul>
<li>sudo apt-get install mysql-server</li>
<li>sudo apt install  mysql-client</li>
<li>sudo apt install libmysqlclient-dev</li>
</ul>
<p>检查是否安装成功:</p>
<ul>
<li>sudo netstat -tap | grep mysql</li>
</ul>
<p>配置远程数据库访问权限:</p>
<ul>
<li>sudo vi /etc/mysql/mysql.conf.d/mysqld.cnf</li>
<li>修改该文件配置项</li>
<li>bind-address = 127.0.0.1</li>
<li>将此行数值修改为0.0.0.0</li>
</ul>
<p>进入mysql数据库:</p>
<ul>
<li>grant all on <em>.</em> to root@’%’ identified by ‘你的密码’ with grant option;</li>
<li>flush privileges;</li>
</ul>
<p>重启数据库:</p>
<ul>
<li>sudo service mysql restart</li>
</ul>
<p>完全删除数据库:</p>
<ul>
<li><pre><code>sudo apt-get remove mysql-*
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
dpkg -l |grep ^rc|awk &apos;{print $2}&apos; |sudo xargs dpkg -P</code></pre></li>
</ul>
<p>user = debian-sys-maint</p>
<p>password = NIbvCi0MJMQKWqmI</p>
<p>查看默认账户名和密码:</p>
<ul>
<li>sudo vi /etc/mysql/debian.cnf</li>
</ul>
<p>将密码修改:</p>
<ul>
<li>update user set authentication_string=password(‘000000’) where user=’root’ and host=’localhost’;</li>
<li>update mysql.user set plugin=’mysql_native_password’;</li>
<li>flush privileges</li>
</ul>
<hr>
<p>PS: </p>
<p>​        以上数据库修改之后,在进行远程仓库访问的时候,如果输入的命令为:</p>
<p>mysql -h ip地址 -p 3306 -u root -p</p>
<p>enter password:</p>
<p>​        当出现以上情况时,将会出现错误:</p>
<p>mysql: [Warning] Using a password on the command line interface can be insecure.<br>ERROR 1049 (42000): Unknown database ‘3306’</p>
<p>​        这个原因是因为密码password的缩写和端口port的缩写发生冲突,导致系统无法识别对应的密码</p>
<p>​        将命令改为:  mysql -h ip地址 -u root -p</p>
<p>enter password:</p>
<p>​        省略port 端口,</p>
<p>​        即可完成访问</p>
]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(五)</title>
    <url>/Python/Python_id_20.html</url>
    <content><![CDATA[<h3 id="Python-JSON"><a href="#Python-JSON" class="headerlink" title="Python JSON"></a>Python JSON</h3><p>本章节我们将为大家介绍如何使用 Python 语言来编码和解码 JSON 对象。</p>
<p>JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式，易于人阅读和编写。</p>
<a id="more"></a>

<hr>
<h4 id="JSON-函数"><a href="#JSON-函数" class="headerlink" title="JSON 函数"></a>JSON 函数</h4><p>使用 JSON 函数需要导入 json 库：<strong>import json</strong>。</p>
<table>
<thead>
<tr>
<th align="left">函数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">json.dumps</td>
<td align="left">将 Python 对象编码成 JSON 字符串</td>
</tr>
<tr>
<td align="left">json.loads</td>
<td align="left">将已编码的 JSON 字符串解码为 Python 对象</td>
</tr>
</tbody></table>
<hr>
<h4 id="json-dumps"><a href="#json-dumps" class="headerlink" title="json.dumps"></a>json.dumps</h4><p>json.dumps 用于将 Python 对象编码成 JSON 字符串。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line">json.dumps(obj, <span class="attribute">skipkeys</span>=<span class="literal">False</span>, <span class="attribute">ensure_ascii</span>=<span class="literal">True</span>, <span class="attribute">check_circular</span>=<span class="literal">True</span>, <span class="attribute">allow_nan</span>=<span class="literal">True</span>, <span class="attribute">cls</span>=None, <span class="attribute">indent</span>=None, <span class="attribute">separators</span>=None, <span class="attribute">encoding</span>=<span class="string">"utf-8"</span>, <span class="attribute">default</span>=None, <span class="attribute">sort_keys</span>=<span class="literal">False</span>, **kw)</span><br></pre></td></tr></table></figure></div>

<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>以下实例将数组编码为 JSON 格式数据：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="D"><figure class="iseeu highlight /d"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = [ &#123; <span class="string">'a'</span> : <span class="number">1</span>, <span class="string">'b'</span> : <span class="number">2</span>, <span class="string">'c'</span> : <span class="number">3</span>, <span class="string">'d'</span> : <span class="number">4</span>, <span class="string">'e'</span> : <span class="number">5</span> &#125; ]</span><br><span class="line"></span><br><span class="line">json = json.dumps(data)</span><br><span class="line">print json</span><br></pre></td></tr></table></figure></div>

<p>以上代码执行结果为：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tr><td class="code"><pre><span class="line">[&#123;<span class="attr">"a"</span>: <span class="number">1</span>, <span class="attr">"c"</span>: <span class="number">3</span>, <span class="attr">"b"</span>: <span class="number">2</span>, <span class="attr">"e"</span>: <span class="number">5</span>, <span class="attr">"d"</span>: <span class="number">4</span>&#125;]</span><br></pre></td></tr></table></figure></div>

<p>使用参数让 JSON 数据格式化输出：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import json</span><br><span class="line">&gt;&gt;&gt; <span class="builtin-name">print</span> json.dumps(&#123;<span class="string">'a'</span>: <span class="string">'Runoob'</span>, <span class="string">'b'</span>: 7&#125;, <span class="attribute">sort_keys</span>=<span class="literal">True</span>, <span class="attribute">indent</span>=4, separators=(<span class="string">','</span>, <span class="string">': '</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"a"</span>: <span class="string">"Runoob"</span>,</span><br><span class="line">    <span class="string">"b"</span>: 7</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>python 原始类型向 json 类型的转化对照表：</p>
<table>
<thead>
<tr>
<th align="left">Python</th>
<th align="left">JSON</th>
</tr>
</thead>
<tbody><tr>
<td align="left">dict</td>
<td align="left">object</td>
</tr>
<tr>
<td align="left">list, tuple</td>
<td align="left">array</td>
</tr>
<tr>
<td align="left">str, unicode</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">int, long, float</td>
<td align="left">number</td>
</tr>
<tr>
<td align="left">True</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">False</td>
<td align="left">false</td>
</tr>
<tr>
<td align="left">None</td>
<td align="left">null</td>
</tr>
</tbody></table>
<hr>
<h4 id="json-loads"><a href="#json-loads" class="headerlink" title="json.loads"></a>json.loads</h4><p>json.loads 用于解码 JSON 数据。该函数返回 Python 字段的数据类型。</p>
<h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><figure class="highlight inform7"><table><tr><td class="code"><pre><span class="line">json.loads(s<span class="comment">[, encoding<span class="comment">[, cls<span class="comment">[, object_hook<span class="comment">[, parse_float<span class="comment">[, parse_int<span class="comment">[, parse_constant<span class="comment">[, object_pairs_hook<span class="comment">[, **kw]</span>]</span>]</span>]</span>]</span>]</span>]</span>]</span>)</span><br></pre></td></tr></table></figure>

<h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><p>以下实例展示了Python 如何解码 JSON 对象：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="NIX"><figure class="iseeu highlight /nix"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="built_in">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="attr">jsonData</span> = '&#123;<span class="string">"a"</span>:<span class="number">1</span>,<span class="string">"b"</span>:<span class="number">2</span>,<span class="string">"c"</span>:<span class="number">3</span>,<span class="string">"d"</span>:<span class="number">4</span>,<span class="string">"e"</span>:<span class="number">5</span>&#125;';</span><br><span class="line"></span><br><span class="line"><span class="attr">text</span> = json.loads(jsonData)</span><br><span class="line">print text</span><br></pre></td></tr></table></figure></div>

<p>以上代码执行结果为：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AWK"><figure class="iseeu highlight /awk"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">u'a'</span>: <span class="number">1</span>, <span class="string">u'c'</span>: <span class="number">3</span>, <span class="string">u'b'</span>: <span class="number">2</span>, <span class="string">u'e'</span>: <span class="number">5</span>, <span class="string">u'd'</span>: <span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure></div>

<p>json 类型转换到 python 的类型对照表：</p>
<table>
<thead>
<tr>
<th align="left">JSON</th>
<th align="left">Python</th>
</tr>
</thead>
<tbody><tr>
<td align="left">object</td>
<td align="left">dict</td>
</tr>
<tr>
<td align="left">array</td>
<td align="left">list</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">unicode</td>
</tr>
<tr>
<td align="left">number (int)</td>
<td align="left">int, long</td>
</tr>
<tr>
<td align="left">number (real)</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">true</td>
<td align="left">True</td>
</tr>
<tr>
<td align="left">false</td>
<td align="left">False</td>
</tr>
<tr>
<td align="left">null</td>
<td align="left">None</td>
</tr>
</tbody></table>
<p>更多内容参考：<a href="https://docs.python.org/2/library/json.html。" target="_blank" rel="noopener">https://docs.python.org/2/library/json.html。</a></p>
<hr>
<h3 id="使用第三方库：Demjson"><a href="#使用第三方库：Demjson" class="headerlink" title="使用第三方库：Demjson"></a>使用第三方库：Demjson</h3><p>Demjson 是 python 的第三方模块库，可用于编码和解码 JSON 数据，包含了 JSONLint 的格式化及校验功能。</p>
<p>Github 地址：<a href="https://github.com/dmeranda/demjson" target="_blank" rel="noopener">https://github.com/dmeranda/demjson</a></p>
<p>官方地址：<a href="http://deron.meranda.us/python/demjson/" target="_blank" rel="noopener">http://deron.meranda.us/python/demjson/</a></p>
<h4 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h4><p>在使用 Demjson 编码或解码 JSON 数据前，我们需要先安装 Demjson 模块。本教程我们会下载 <a href="http://deron.meranda.us/python/demjson/download" target="_blank" rel="noopener">Demjson</a> 并安装：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">$ tar -xvzf demjson<span class="number">-2.2</span><span class="number">.3</span>.tar.gz</span><br><span class="line">$ cd demjson<span class="number">-2.2</span><span class="number">.3</span></span><br><span class="line">$ python setup.py install</span><br></pre></td></tr></table></figure></div>

<p>更多安装介绍查看：<a href="http://deron.meranda.us/python/demjson/install" target="_blank" rel="noopener">http://deron.meranda.us/python/demjson/install</a></p>
<h3 id="JSON-函数-1"><a href="#JSON-函数-1" class="headerlink" title="JSON 函数"></a>JSON 函数</h3><table>
<thead>
<tr>
<th align="left">函数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">encode</td>
<td align="left">将 Python 对象编码成 JSON 字符串</td>
</tr>
<tr>
<td align="left">decode</td>
<td align="left">将已编码的 JSON 字符串解码为 Python 对象</td>
</tr>
</tbody></table>
<hr>
<h3 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h3><p>Python encode() 函数用于将 Python 对象编码成 JSON 字符串。</p>
<h4 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line">demjson.encode(self, obj, <span class="attribute">nest_level</span>=0)</span><br></pre></td></tr></table></figure></div>

<h4 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h4><p>以下实例将数组编码为 JSON 格式数据：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="D"><figure class="iseeu highlight /d"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> demjson</span><br><span class="line"></span><br><span class="line">data = [ &#123; <span class="string">'a'</span> : <span class="number">1</span>, <span class="string">'b'</span> : <span class="number">2</span>, <span class="string">'c'</span> : <span class="number">3</span>, <span class="string">'d'</span> : <span class="number">4</span>, <span class="string">'e'</span> : <span class="number">5</span> &#125; ]</span><br><span class="line"></span><br><span class="line">json = demjson.encode(data)</span><br><span class="line">print json</span><br></pre></td></tr></table></figure></div>

<p>以上代码执行结果为：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tr><td class="code"><pre><span class="line">[&#123;<span class="attr">"a"</span>:<span class="number">1</span>,<span class="attr">"b"</span>:<span class="number">2</span>,<span class="attr">"c"</span>:<span class="number">3</span>,<span class="attr">"d"</span>:<span class="number">4</span>,<span class="attr">"e"</span>:<span class="number">5</span>&#125;]</span><br></pre></td></tr></table></figure></div>

<hr>
<h3 id="decode"><a href="#decode" class="headerlink" title="decode"></a>decode</h3><p>Python 可以使用 demjson.decode() 函数解码 JSON 数据。该函数返回 Python 字段的数据类型。</p>
<h4 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ARMASM"><figure class="iseeu highlight /armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">demjson.decode</span>(<span class="keyword">self, </span>txt)</span><br></pre></td></tr></table></figure></div>

<h4 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h4><p>以下实例展示了Python 如何解码 JSON 对象：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="NIX"><figure class="iseeu highlight /nix"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="built_in">import</span> demjson</span><br><span class="line"></span><br><span class="line"><span class="attr">json</span> = '&#123;<span class="string">"a"</span>:<span class="number">1</span>,<span class="string">"b"</span>:<span class="number">2</span>,<span class="string">"c"</span>:<span class="number">3</span>,<span class="string">"d"</span>:<span class="number">4</span>,<span class="string">"e"</span>:<span class="number">5</span>&#125;';</span><br><span class="line"></span><br><span class="line"><span class="attr">text</span> = demjson.decode(json)</span><br><span class="line">print  text</span><br></pre></td></tr></table></figure></div>

<p>以上代码执行结果为：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AWK"><figure class="iseeu highlight /awk"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">u'a'</span>: <span class="number">1</span>, <span class="string">u'c'</span>: <span class="number">3</span>, <span class="string">u'b'</span>: <span class="number">2</span>, <span class="string">u'e'</span>: <span class="number">5</span>, <span class="string">u'd'</span>: <span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(四)</title>
    <url>/Python/Python_id_19.html</url>
    <content><![CDATA[<h3 id="Python2-x与3-x版本区别"><a href="#Python2-x与3-x版本区别" class="headerlink" title="Python2.x与3.x版本区别"></a>Python2.x与3.x版本区别</h3><p>Python的3.0版本，常被称为Python 3000，或简称Py3k。相对于Python的早期版本，这是一个较大的升级。</p>
<p>为了不带入过多的累赘，Python 3.0在设计的时候没有考虑向下相容。</p>
<a id="more"></a>

<p>许多针对早期Python版本设计的程式都无法在Python 3.0上正常执行。</p>
<p>为了照顾现有程式，Python 2.6作为一个过渡版本，基本使用了Python 2.x的语法和库，同时考虑了向Python 3.0的迁移，允许使用部分Python 3.0的语法与函数。</p>
<p>新的Python程式建议使用Python 3.0版本的语法。</p>
<p>除非执行环境无法安装Python 3.0或者程式本身使用了不支援Python 3.0的第三方库。目前不支援Python 3.0的第三方库有Twisted, py2exe, PIL等。</p>
<p>大多数第三方库都正在努力地相容Python 3.0版本。即使无法立即使用Python 3.0，也建议编写相容Python 3.0版本的程式，然后使用Python 2.6, Python 2.7来执行。</p>
<p>Python 3.0的变化主要在以下几个方面:</p>
<hr>
<h4 id="print-函数"><a href="#print-函数" class="headerlink" title="print 函数"></a>print 函数</h4><p>print语句没有了，取而代之的是print()函数。 Python 2.6与Python 2.7部分地支持这种形式的print语法。在Python 2.6与Python 2.7里面，以下三种形式是等价的：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">print</span> <span class="string">"fish"</span></span><br><span class="line"><span class="builtin-name">print</span> (<span class="string">"fish"</span>) #注意print后面有个空格</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">"fish"</span>) #<span class="builtin-name">print</span>()不能带有任何其它参数</span><br></pre></td></tr></table></figure></div>

<p>然而，Python 2.6实际已经支持新的print()语法：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ import print_function</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">"fish"</span>, <span class="string">"panda"</span>, <span class="attribute">sep</span>=<span class="string">', '</span>)</span><br></pre></td></tr></table></figure></div>

<hr>
<h4 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h4><p>Python 2 有 ASCII str() 类型，unicode() 是单独的，不是 byte 类型。</p>
<p>现在， 在 Python 3，我们最终有了 Unicode (utf-8) 字符串，以及一个字节类：byte 和 bytearrays。</p>
<p>由于 Python3.X 源码文件默认使用utf-8编码，这就使得以下代码是合法的：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="RUBY"><figure class="iseeu highlight /ruby"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; 中国 = <span class="string">'china'</span> </span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt;print(中国) </span><br><span class="line">china</span><br></pre></td></tr></table></figure></div>

<p>Python 2.x</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TAGGERSCRIPT"><figure class="iseeu highlight /taggerscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; str = "我爱北京天安门"</span><br><span class="line">&gt;&gt;&gt; str</span><br><span class="line">'<span class="symbol">\x</span>e6<span class="symbol">\x</span>88<span class="symbol">\x</span>91<span class="symbol">\x</span>e7<span class="symbol">\x</span>88<span class="symbol">\x</span>b1<span class="symbol">\x</span>e5<span class="symbol">\x</span>8c<span class="symbol">\x</span>97<span class="symbol">\x</span>e4<span class="symbol">\x</span>ba<span class="symbol">\x</span>ac<span class="symbol">\x</span>e5<span class="symbol">\x</span>a4<span class="symbol">\x</span>a9<span class="symbol">\x</span>e5<span class="symbol">\x</span>ae<span class="symbol">\x</span>89<span class="symbol">\x</span>e9<span class="symbol">\x</span>97<span class="symbol">\x</span>a8'</span><br><span class="line">&gt;&gt;&gt; str = u"我爱北京天安门"</span><br><span class="line">&gt;&gt;&gt; str</span><br><span class="line">u'<span class="symbol">\u</span>6211<span class="symbol">\u</span>7231<span class="symbol">\u</span>5317<span class="symbol">\u</span>4eac<span class="symbol">\u</span>5929<span class="symbol">\u</span>5b89<span class="symbol">\u</span>95e8'</span><br></pre></td></tr></table></figure></div>

<p>Python 3.x</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="RUBY"><figure class="iseeu highlight /ruby"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; str = <span class="string">"我爱北京天安门"</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; str</span><br><span class="line"><span class="string">'我爱北京天安门'</span></span><br></pre></td></tr></table></figure></div>

<hr>
<h4 id="除法运算"><a href="#除法运算" class="headerlink" title="除法运算"></a>除法运算</h4><p>Python中的除法较其它语言显得非常高端，有套很复杂的规则。Python中的除法有两个运算符，/和//</p>
<p>首先来说/除法:</p>
<p>在python 2.x中/除法就跟我们熟悉的大多数语言，比如Java啊C啊差不多，整数相除的结果是一个整数，把小数部分完全忽略掉，浮点数除法会保留小数点的部分得到一个浮点数的结果。</p>
<p>在python 3.x中/除法不再这么做了，对于整数之间的相除，结果也会是浮点数。</p>
<p>Python 2.x:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="number">1</span> / <span class="number">2</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">&gt;&gt;&gt; <span class="number">1.0</span> / <span class="number">2.0</span></span><br><span class="line"><span class="number">0.5</span></span><br></pre></td></tr></table></figure></div>

<p>Python 3.x:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="number">1</span>/<span class="number">2</span></span><br><span class="line"><span class="number">0.5</span></span><br></pre></td></tr></table></figure></div>

<p>而对于//除法，这种除法叫做floor除法，会对除法的结果自动进行一个floor操作，在python 2.x和python 3.x中是一致的。</p>
<p>python 2.x:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="number">-1</span> <span class="comment">// 2</span></span><br><span class="line"><span class="number">-1</span></span><br></pre></td></tr></table></figure></div>

<p>python 3.x:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="number">-1</span> <span class="comment">// 2</span></span><br><span class="line"><span class="number">-1</span></span><br></pre></td></tr></table></figure></div>

<p>注意的是并不是舍弃小数部分，而是执行 floor 操作，如果要截取整数部分，那么需要使用 math 模块的 trunc 函数</p>
<p>python 3.x:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">import</span> math</span><br><span class="line">&gt;&gt;&gt; math.trunc(<span class="number">1</span> / <span class="number">2</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line">&gt;&gt;&gt; math.trunc(<span class="number">-1</span> / <span class="number">2</span>)</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<h4 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h4><p>在 Python 3 中处理异常也轻微的改变了，在 Python 3 中我们现在使用 as 作为关键词。</p>
<p>捕获异常的语法由 <strong>except exc, var</strong> 改为 <strong>except exc as var</strong>。</p>
<p>使用语法except (exc1, exc2) as var可以同时捕获多种类别的异常。 Python 2.6已经支持这两种语法。</p>
<ul>
<li>\1. 在2.x时代，所有类型的对象都是可以被直接抛出的，在3.x时代，只有继承自BaseException的对象才可以被抛出。</li>
<li>\2. 2.x raise语句使用逗号将抛出对象类型和参数分开，3.x取消了这种奇葩的写法，直接调用构造函数抛出对象即可。</li>
</ul>
<p>在2.x时代，异常在代码中除了表示程序错误，还经常做一些普通控制结构应该做的事情，在3.x中可以看出，设计者让异常变的更加专一，只有在错误发生的情况才能去用异常捕获语句来处理。</p>
<hr>
<h4 id="xrange"><a href="#xrange" class="headerlink" title="xrange"></a>xrange</h4><p>在 Python 2 中 xrange() 创建迭代对象的用法是非常流行的。比如： for 循环或者是列表/集合/字典推导式。</p>
<p>这个表现十分像生成器（比如。”惰性求值”）。但是这个 xrange-iterable 是无穷的，意味着你可以无限遍历。</p>
<p>由于它的惰性求值，如果你不得仅仅不遍历它一次，xrange() 函数 比 range() 更快（比如 for 循环）。尽管如此，对比迭代一次，不建议你重复迭代多次，因为生成器每次都从头开始。</p>
<p>在 Python 3 中，range() 是像 xrange() 那样实现以至于一个专门的 xrange() 函数都不再存在（在 Python 3 中 xrange() 会抛出命名异常）。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line">n = <span class="number">10000</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_range</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_xrange</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(n):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div>

<p>Python 2</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SAS"><figure class="iseeu highlight /sas"><table><tr><td class="code"><pre><span class="line">print <span class="string">'Python'</span>, python_versi<span class="meta">on(</span>)</span><br><span class="line"></span><br><span class="line">print <span class="string">'\ntiming range()'</span> </span><br><span class="line"><span class="name">%timeit</span> test<span class="meta">_range(</span>n)</span><br><span class="line"></span><br><span class="line">print <span class="string">'\n\ntiming xrange()'</span> </span><br><span class="line"><span class="name">%timeit</span> test_<span class="meta">xrange(</span>n)</span><br><span class="line"></span><br><span class="line">Python 2.7.6</span><br><span class="line"></span><br><span class="line">timing<span class="meta"> range(</span>)</span><br><span class="line">1000 loops, best of 3: 433 µs per loop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">timing <span class="meta">xrange(</span>)</span><br><span class="line">1000 loops, best of 3: 350 µs per loop</span><br></pre></td></tr></table></figure></div>

<p>Python 3</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SAS"><figure class="iseeu highlight /sas"><table><tr><td class="code"><pre><span class="line">p<span class="meta">rint(</span><span class="string">'Python'</span>, python_versi<span class="meta">on(</span>))</span><br><span class="line"></span><br><span class="line">p<span class="meta">rint(</span><span class="string">'\ntiming range()'</span>)</span><br><span class="line"><span class="name">%timeit</span> test<span class="meta">_range(</span>n)</span><br><span class="line"></span><br><span class="line">Python 3.4.1</span><br><span class="line"></span><br><span class="line">timing<span class="meta"> range(</span>)</span><br><span class="line">1000 loops, best of 3: 520 µs per loop</span><br><span class="line">p<span class="meta">rint(</span><span class="meta">xrange(</span>10))</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">NameError                                 Traceback (most recent <span class="meta">call</span> last)</span><br><span class="line">&lt;ipython-<span class="meta">input</span>-5-5d8f9b79ea70&gt; <span class="meta">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 p<span class="meta">rint(</span><span class="meta">xrange(</span>10))</span><br><span class="line"></span><br><span class="line">NameError: name <span class="string">'xrange'</span> is <span class="meta">not</span> defined</span><br></pre></td></tr></table></figure></div>

<h4 id="八进制字面量表示"><a href="#八进制字面量表示" class="headerlink" title="八进制字面量表示"></a>八进制字面量表示</h4><p>八进制数必须写成0o777，原来的形式0777不能用了；二进制必须写成0b111。</p>
<p>新增了一个bin()函数用于将一个整数转换成二进制字串。 Python 2.6已经支持这两种语法。</p>
<p>在Python 3.x中，表示八进制字面量的方式只有一种，就是0o1000。</p>
<p>python 2.x</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="number">0</span>o1000</span><br><span class="line"><span class="number">512</span></span><br><span class="line">&gt;&gt;&gt; <span class="number">01000</span></span><br><span class="line"><span class="number">512</span></span><br></pre></td></tr></table></figure></div>

<p>python 3.x</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="number">01000</span></span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">    <span class="number">01000</span></span><br><span class="line">        ^</span><br><span class="line">SyntaxError: invalid token</span><br><span class="line">&gt;&gt;&gt; <span class="number">0</span>o1000</span><br><span class="line"><span class="number">512</span></span><br></pre></td></tr></table></figure></div>

<hr>
<h4 id="不等运算符"><a href="#不等运算符" class="headerlink" title="不等运算符"></a>不等运算符</h4><p>Python 2.x中不等于有两种写法 != 和 &lt;&gt;</p>
<p>Python 3.x中去掉了&lt;&gt;, 只有!=一种写法，还好，我从来没有使用&lt;&gt;的习惯</p>
<hr>
<h4 id="去掉了repr表达式"><a href="#去掉了repr表达式" class="headerlink" title="去掉了repr表达式``"></a>去掉了repr表达式``</h4><p>Python 2.x 中反引号``相当于repr函数的作用</p>
<p>Python 3.x 中去掉了``这种写法，只允许使用repr函数，这样做的目的是为了使代码看上去更清晰么？不过我感觉用repr的机会很少，一般只在debug的时候才用，多数时候还是用str函数来用字符串描述对象。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="REASONML"><figure class="iseeu highlight /reasonml"><table><tr><td class="code"><pre><span class="line">def send<span class="constructor">Mail(<span class="params">from_</span>: <span class="params">str</span>, <span class="params">to</span>: <span class="params">str</span>, <span class="params">title</span>: <span class="params">str</span>, <span class="params">body</span>: <span class="params">str</span>)</span> -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure></div>

<hr>
<h4 id="多个模块被改名（根据PEP8）"><a href="#多个模块被改名（根据PEP8）" class="headerlink" title="多个模块被改名（根据PEP8）"></a>多个模块被改名（根据PEP8）</h4><table>
<thead>
<tr>
<th align="left">旧的名字</th>
<th align="left">新的名字</th>
</tr>
</thead>
<tbody><tr>
<td align="left">_winreg</td>
<td align="left">winreg</td>
</tr>
<tr>
<td align="left">ConfigParser</td>
<td align="left">configparser</td>
</tr>
<tr>
<td align="left">copy_reg</td>
<td align="left">copyreg</td>
</tr>
<tr>
<td align="left">Queue</td>
<td align="left">queue</td>
</tr>
<tr>
<td align="left">SocketServer</td>
<td align="left">socketserver</td>
</tr>
<tr>
<td align="left">repr</td>
<td align="left">reprlib</td>
</tr>
</tbody></table>
<p>StringIO模块现在被合并到新的io模组内。 new, md5, gopherlib等模块被删除。 Python 2.6已经支援新的io模组。</p>
<p>httplib, BaseHTTPServer, CGIHTTPServer, SimpleHTTPServer, Cookie, cookielib被合并到http包内。</p>
<p>取消了exec语句，只剩下exec()函数。 Python 2.6已经支援exec()函数。</p>
<h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><p>1）Py3.X去除了long类型，现在只有一种整型——int，但它的行为就像2.X版本的long</p>
<p>2）新增了bytes类型，对应于2.X版本的八位串，定义一个bytes字面量的方法如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="RUBY"><figure class="iseeu highlight /ruby"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; b = b<span class="string">'china'</span> </span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; type(b) </span><br><span class="line">&lt;type <span class="string">'bytes'</span>&gt;</span><br></pre></td></tr></table></figure></div>

<p>str 对象和 bytes 对象可以使用 .encode() (<strong>str -&gt; bytes</strong>) 或 .decode() (<strong>bytes -&gt; str</strong>)方法相互转化。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="RUBY"><figure class="iseeu highlight /ruby"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; s = b.decode() </span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; s </span><br><span class="line"><span class="string">'china'</span> </span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; b1 = s.encode() </span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; b1 </span><br><span class="line">b<span class="string">'china'</span></span><br></pre></td></tr></table></figure></div>

<p>3）dict的.keys()、.items 和.values()方法返回迭代器，而之前的iterkeys()等函数都被废弃。同时去掉的还有 dict.has_key()，用 in替代它吧 。</p>
<h4 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h4><p>原：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GAMS"><figure class="iseeu highlight /gams"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">file</span>(<span class="params"> ..... </span>)</span></span><br><span class="line">或 </span><br><span class="line"><span class="function"><span class="title">open</span>(<span class="params">.....</span>)</span></span><br></pre></td></tr></table></figure></div>

<p>改为只能用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GAMS"><figure class="iseeu highlight /gams"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">open</span>(<span class="params">.....</span>)</span></span><br></pre></td></tr></table></figure></div>

<p>从键盘录入一个字符串</p>
<p>原:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STYLUS"><figure class="iseeu highlight /stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">raw_input</span><span class="params">( <span class="string">"提示信息"</span> )</span></span></span><br></pre></td></tr></table></figure></div>

<p>改为:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STYLUS"><figure class="iseeu highlight /stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">input</span><span class="params">( <span class="string">"提示信息"</span> )</span></span></span><br></pre></td></tr></table></figure></div>

<p>在python2.x中raw_input()和input( )，两个函数都存在，其中区别为：</p>
<ul>
<li>raw_input()—将所有输入作为字符串看待，返回字符串类型</li>
<li>input()—–只能接收”数字”的输入，在对待纯数字输入时具有自己的特性，它返回所输入的数字的类型（int, float ）</li>
</ul>
<p>在python3.x中raw_input()和input( )进行了整合，去除了raw_input()，仅保留了input()函数，其接收任意任性输入，将所有输入默认为字符串处理，并返回字符串类型。</p>
<h4 id="map、filter-和-reduce"><a href="#map、filter-和-reduce" class="headerlink" title="map、filter 和 reduce"></a>map、filter 和 reduce</h4><p>这三个函数号称是函数式编程的代表。在 Python3.x 和 Python2.x 中也有了很大的差异。</p>
<p>首先我们先简单的在 Python2.x 的交互下输入 map 和 filter,看到它们两者的类型是 built-in function(内置函数):</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; map</span><br><span class="line">&lt;built-in function map&gt;</span><br><span class="line">&gt;&gt;&gt; filter</span><br><span class="line">&lt;built-in function filter&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></div>

<p>它们输出的结果类型都是列表:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; map(lambda x:x *<span class="number">2</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line">&gt;&gt;&gt; filter(lambda x:x %<span class="number">2</span> ==<span class="number">0</span>,range(<span class="number">10</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></div>

<p>但是在Python 3.x中它们却不是这个样子了：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; map</span><br><span class="line">&lt;<span class="keyword">class</span> '<span class="symbol">map</span>'&gt;</span><br><span class="line">&gt;&gt;&gt; <span class="symbol">map</span>(<span class="symbol">print,</span>[<span class="symbol">1,<span class="symbol">2</span>,<span class="symbol">3</span></span>])</span><br><span class="line">&lt;<span class="symbol">map</span> <span class="symbol">object</span> <span class="symbol">at</span> <span class="symbol">0x10d8bd400</span>&gt;</span><br><span class="line">&gt;&gt;&gt; <span class="symbol">filter</span></span><br><span class="line">&lt;<span class="symbol">class</span> '<span class="symbol">filter</span>'&gt;</span><br><span class="line">&gt;&gt;&gt; <span class="symbol">filter</span>(<span class="symbol">lambda</span> <span class="symbol">x:<span class="symbol">x</span></span> % <span class="symbol">2</span> == <span class="symbol">0, <span class="symbol">range</span></span>(<span class="symbol">10</span>))</span><br><span class="line">&lt;<span class="symbol">filter</span> <span class="symbol">object</span> <span class="symbol">at</span> <span class="symbol">0x10d8bd3c8</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></div>

<p>首先它们从函数变成了类，其次，它们的返回结果也从当初的列表成了一个可迭代的对象, 我们尝试用 next 函数来进行手工迭代:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="RUBY"><figure class="iseeu highlight /ruby"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; f =filter(lambda <span class="symbol">x:</span>x %<span class="number">2</span> ==<span class="number">0</span>, range(<span class="number">10</span>))</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; next(f)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; next(f)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; next(f)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; next(f)</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt;</span><br></pre></td></tr></table></figure></div>

<p>对于比较高端的 reduce 函数，它在 Python 3.x 中已经不属于 built-in 了，被挪到 functools 模块当中。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>进程线程协程</title>
    <url>/Spider/Spider_id_14.html</url>
    <content><![CDATA[<h2 id="异步多进程爬虫实现"><a href="#异步多进程爬虫实现" class="headerlink" title="异步多进程爬虫实现:"></a>异步多进程爬虫实现:</h2><a id="more"></a>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 创建线程池</span></span><br><span class="line">pool = Pool(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 准备网址列表</span></span><br><span class="line">url_list = [<span class="string">'www.baidu.com'</span>,<span class="string">'www.baidu.com'</span>,<span class="string">'www.baidu.com'</span>]</span><br><span class="line"><span class="comment"># 创建操作函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_requests</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="comment"># 函数返回获取到的网页源码的数据</span></span><br><span class="line">    <span class="keyword">return</span> requests.get(url).text</span><br><span class="line"><span class="comment"># 将返回的页面源码数据接收</span></span><br><span class="line">request_text_list = pool.map(get_requests,url_list)</span><br></pre></td></tr></table></figure></div>





<h2 id="单线程多任务异步协程"><a href="#单线程多任务异步协程" class="headerlink" title="单线程多任务异步协程:"></a>单线程多任务异步协程:</h2><h3 id="正常协程实现"><a href="#正常协程实现" class="headerlink" title="正常协程实现:"></a>正常协程实现:</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 单协程写法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> func(url):</span><br><span class="line">    print(<span class="string">'start'</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">'stop'</span>)</span><br><span class="line">    </span><br><span class="line">f = func(url)</span><br><span class="line">task = asynic.ensure_future(f)</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until+complete(task)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多重协程写法</span></span><br><span class="line"><span class="comment"># 多线程时,需要设置线程挂起,参考下列代码</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> func(url):</span><br><span class="line">    print(<span class="string">'start'</span>)</span><br><span class="line">    <span class="comment"># 在需要进行挂起的位置进行线程等待声明,即await</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">'stop'</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">urls = [</span><br><span class="line">	<span class="string">'www.baidu.com'</span>,  </span><br><span class="line">	<span class="string">'www.baidu.com'</span>, </span><br><span class="line">	<span class="string">'www.baidu.com'</span>, </span><br><span class="line">	<span class="string">'www.baidu.com'</span>, </span><br><span class="line">	<span class="string">'www.baidu.com'</span>      </span><br><span class="line">]</span><br><span class="line">tasks = []</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    f = func(url)</span><br><span class="line">    task = asynic.ensure_future(f)</span><br><span class="line">    <span class="comment"># 在创建好新的写成之后,将其添加到协程列表中</span></span><br><span class="line">    tasks.append(task)</span><br><span class="line"><span class="comment"># 创建事件循环</span></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="comment"># 将协程列表注册到事件循环中去</span></span><br><span class="line"><span class="comment"># 在注册列表类型时，需要甚至线程挂起，所以需要使用asyncio。wait进行特殊声明</span></span><br><span class="line">loop.run_until+complete(asyncio.wait(tasks))</span><br></pre></td></tr></table></figure></div>



<h3 id="在使用协程进行网页爬取的时候，是无法使用await挂起的，也就是说，requests并不支持挂起："><a href="#在使用协程进行网页爬取的时候，是无法使用await挂起的，也就是说，requests并不支持挂起：" class="headerlink" title="在使用协程进行网页爬取的时候，是无法使用await挂起的，也就是说，requests并不支持挂起："></a>在使用协程进行网页爬取的时候，是无法使用await挂起的，也就是说，requests并不支持挂起：</h3><h3 id="在这个时候，需要使用支持await的请求模块。"><a href="#在这个时候，需要使用支持await的请求模块。" class="headerlink" title="在这个时候，需要使用支持await的请求模块。"></a>在这个时候，需要使用支持await的请求模块。</h3><h3 id="也就是aiohttp。"><a href="#也就是aiohttp。" class="headerlink" title="也就是aiohttp。"></a>也就是aiohttp。</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="comment"># 构建aiohttp请求</span></span><br><span class="line">    <span class="comment"># 每一次请求都需要对</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> a:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> <span class="keyword">await</span> a.get(url=url) <span class="keyword">as</span> response:</span><br><span class="line">            result = <span class="keyword">await</span> response.text()</span><br><span class="line">            print(result)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">'https://www.baidu.com'</span>,</span><br><span class="line">    <span class="string">'https://www.baidu.com'</span>,</span><br><span class="line">    <span class="string">'https://www.baidu.com'</span></span><br><span class="line">]</span><br><span class="line">tasks = []</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    f = func(url)</span><br><span class="line">    task = asyncio.ensure_future(f)</span><br><span class="line">    tasks.append(task)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br></pre></td></tr></table></figure></div>

<p>在aiohttp中，和requests一样有get和post请求</p>
<p>这些请求的参数基本相同，</p>
<p>唯一不同的地方在于代理IP</p>
<p>在requests中，代理IP的类型是一个字典类型的数据，</p>
<p>但是在这里，代理IP的类型是一个字符串</p>
<p>同时参数名为proxy</p>
<h2 id="在通常情况下-不要使用asyncio"><a href="#在通常情况下-不要使用asyncio" class="headerlink" title="在通常情况下,不要使用asyncio!!!"></a>在通常情况下,不要使用asyncio!!!</h2><h2 id="在通常情况下-不要使用asyncio-1"><a href="#在通常情况下-不要使用asyncio-1" class="headerlink" title="在通常情况下,不要使用asyncio!!!"></a>在通常情况下,不要使用asyncio!!!</h2><h2 id="在通常情况下-不要使用asyncio-2"><a href="#在通常情况下-不要使用asyncio-2" class="headerlink" title="在通常情况下,不要使用asyncio!!!"></a>在通常情况下,不要使用asyncio!!!</h2><h3 id="在没有足够充足的代理与完善的伪装的时候-一定不要使用asyncio"><a href="#在没有足够充足的代理与完善的伪装的时候-一定不要使用asyncio" class="headerlink" title="在没有足够充足的代理与完善的伪装的时候,一定不要使用asyncio!"></a>在没有足够充足的代理与完善的伪装的时候,一定不要使用asyncio!</h3><h3 id="协程的恐怖性能足以让任何网站的程序发现-即使没有发现-过于高频的访问也足以击溃网站了"><a href="#协程的恐怖性能足以让任何网站的程序发现-即使没有发现-过于高频的访问也足以击溃网站了" class="headerlink" title="协程的恐怖性能足以让任何网站的程序发现,即使没有发现,过于高频的访问也足以击溃网站了!"></a>协程的恐怖性能足以让任何网站的程序发现,即使没有发现,过于高频的访问也足以击溃网站了!</h3>]]></content>
      <categories>
        <category>Scrapy</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(三)</title>
    <url>/Python/Python_id_18.html</url>
    <content><![CDATA[<h3 id="Python-基础语法"><a href="#Python-基础语法" class="headerlink" title="Python 基础语法"></a>Python 基础语法</h3><p>Python 语言与 Perl，C 和 Java 等语言有许多相似之处。但是，也存在一些差异。</p>
<p>在本章中我们将来学习 Python 的基础语法，让你快速学会 Python 编程。</p>
<a id="more"></a>

<hr>
<h3 id="第一个-Python-程序"><a href="#第一个-Python-程序" class="headerlink" title="第一个 Python 程序"></a>第一个 Python 程序</h3><h4 id="交互式编程"><a href="#交互式编程" class="headerlink" title="交互式编程"></a>交互式编程</h4><p>交互式编程不需要创建脚本文件，是通过 Python 解释器的交互模式进来编写代码。</p>
<p>linux上你只需要在命令行中输入 Python 命令即可启动交互式编程,提示窗口如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line">$ python</span><br><span class="line">Python 2.7.6 (default, Sep  9 2014, 15:04:36)</span><br><span class="line">[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.39)] on darwin</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> **<span class="keyword">or</span>** <span class="string">"license"</span> *<span class="number">*f</span><span class="keyword">or</span>** more information.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(二)</title>
    <url>/Python/Python_id_17.html</url>
    <content><![CDATA[<h3 id="python环境搭建"><a href="#python环境搭建" class="headerlink" title="python环境搭建"></a>python环境搭建</h3><p>Python可应用于多平台包括 Linux 和 Mac OS X。</p>
<p>你可以通过终端窗口输入 “python” 命令来查看本地是否已经安装Python以及Python的安装版本。</p>
<a id="more"></a>

<ul>
<li>Unix (Solaris, Linux, FreeBSD, AIX, HP/UX, SunOS, IRIX, 等等。)</li>
<li>Win 9x/NT/2000</li>
<li>Macintosh (Intel, PPC, 68K)</li>
<li>OS/2</li>
<li>DOS (多个DOS版本)</li>
<li>PalmOS</li>
<li>Nokia 移动手机</li>
<li>Windows CE</li>
<li>Acorn/RISC OS</li>
<li>BeOS</li>
<li>Amiga</li>
<li>VMS/OpenVMS</li>
<li>QNX</li>
<li>VxWorks</li>
<li>Psion</li>
<li>Python 同样可以移植到 Java 和 .NET 虚拟机上。</li>
</ul>
<hr>
<h3 id="Python下载"><a href="#Python下载" class="headerlink" title="Python下载"></a>Python下载</h3><p>Python最新源码，二进制文档，新闻资讯等可以在Python的官网查看到：</p>
<p><a href="https://www.python.org/" target="_blank" rel="noopener">Python官网</a></p>
<p>你可以在以下链接中下载 Python 的文档，你可以下载 HTML、PDF 和 PostScript 等格式的文档。</p>
<p><a href="https://www.python.org/doc/" target="_blank" rel="noopener">Python文档下载地址</a></p>
<hr>
<h3 id="Python安装"><a href="#Python安装" class="headerlink" title="Python安装"></a>Python安装</h3><p>Python已经被移植在许多平台上（经过改动使它能够工作在不同平台上）。</p>
<p>您需要下载适用于您使用平台的二进制代码，然后安装Python。</p>
<p>如果您平台的二进制代码是不可用的，你需要使用C编译器手动编译源代码。</p>
<p>编译的源代码，功能上有更多的选择性， 为python安装提供了更多的灵活性。</p>
<p>以下是各个平台安装包的下载地址：</p>
<p><img src="fcg22450.github.io/img/python_img/%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80.jpg" alt="各个平台安装包的下载地址"></p>
<p>以下为不同平台上安装 Python 的方法：</p>
<h4 id="Unix-amp-Linux-平台安装-Python"><a href="#Unix-amp-Linux-平台安装-Python" class="headerlink" title="Unix &amp; Linux 平台安装 Python:"></a>Unix &amp; Linux 平台安装 Python:</h4><p>以下为在 Unix &amp; Linux 平台上安装 Python 的简单步骤：</p>
<ul>
<li>打开 WEB 浏览器访问<a href="https://www.python.org/downloads/source/" target="_blank" rel="noopener">https://www.python.org/downloads/source/</a></li>
<li>选择适用 于Unix/Linux 的源码压缩包。</li>
<li>下载及解压压缩包。</li>
<li>如果你需要自定义一些选项修改<em>Modules/Setup</em></li>
<li><strong>执行</strong> ./configure 脚本</li>
<li>make</li>
<li>make install</li>
</ul>
<p>执行以上操作后，Python 会安装在 /usr/local/bin 目录中，Python 库安装在 /usr/local/lib/pythonXX，XX 为你使用的 Python 的版本号。</p>
<h4 id="Window-平台安装-Python"><a href="#Window-平台安装-Python" class="headerlink" title="Window 平台安装 Python:"></a>Window 平台安装 Python:</h4><p>以下为在 Window 平台上安装 Python 的简单步骤：</p>
<ul>
<li>打开 WEB 浏览器访问<a href="https://www.python.org/downloads/windows/" target="_blank" rel="noopener">https://www.python.org/downloads/windows/</a> <img src="fcg22450.github.io/img/python_img/window%E5%AE%89%E8%A3%85python.png" alt=""></li>
<li>在下载列表中选择Window平台安装包，包格式为：<em>python-XYZ.msi</em> 文件 ， XYZ 为你要安装的版本号。</li>
<li>要使用安装程序 <em>python-XYZ.msi</em>, Windows 系统必须支持 Microsoft Installer 2.0 搭配使用。只要保存安装文件到本地计算机，然后运行它，看看你的机器支持 MSI。Windows XP 和更高版本已经有 MSI，很多老机器也可以安装 MSI。<img src="fcg22450.github.io/img/python_img/%E6%96%87%E4%BB%B6%E9%80%89%E6%8B%A9.png" alt=""></li>
<li>下载后，双击下载包，进入 Python 安装向导，安装非常简单，你只需要使用默认的设置一直点击”下一步”直到安装完成即可。</li>
</ul>
<h4 id="MAC-平台安装-Python"><a href="#MAC-平台安装-Python" class="headerlink" title="MAC 平台安装 Python:"></a>MAC 平台安装 Python:</h4><p>MAC 系统一般都自带有 Python2.x版本 的环境，你也可以在链接 <a href="https://www.python.org/downloads/mac-osx/" target="_blank" rel="noopener">https://www.python.org/downloads/mac-osx/</a> 上下载最新版安装。</p>
<hr>
<h3 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h3><p>程序和可执行文件可以在许多目录，而这些路径很可能不在操作系统提供可执行文件的搜索路径中。</p>
<p>path(路径)存储在环境变量中，这是由操作系统维护的一个命名的字符串。这些变量包含可用的命令行解释器和其他程序的信息。</p>
<p>Unix或Windows中路径变量为PATH（UNIX区分大小写，Windows不区分大小写）。</p>
<p>在Mac OS中，安装程序过程中改变了python的安装路径。如果你需要在其他目录引用Python，你必须在path中添加Python目录。</p>
<h4 id="在-Unix-Linux-设置环境变量"><a href="#在-Unix-Linux-设置环境变量" class="headerlink" title="在 Unix/Linux 设置环境变量"></a>在 Unix/Linux 设置环境变量</h4><ul>
<li><p>在 csh shell:</p>
<p>输入</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="NGINX"><figure class="iseeu highlight /nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">setenv</span> PATH <span class="string">"<span class="variable">$PATH</span>:/usr/local/bin/python"</span></span><br></pre></td></tr></table></figure></div>

<p>, 按下”Enter”。</p>
</li>
<li><p>在 bash shell (Linux):</p>
<p>输入</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="string">"<span class="variable">$PATH</span>:/usr/local/bin/python"</span></span><br></pre></td></tr></table></figure></div>

<p>，按下”Enter”。</p>
</li>
<li><p>在 sh 或者 ksh shell:</p>
<p>输入</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="INI"><figure class="iseeu highlight /ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">PATH</span>=<span class="string">"$PATH:/usr/local/bin/python"</span></span><br></pre></td></tr></table></figure></div>

<p>, 按下”Enter”。</p>
</li>
</ul>
<h4 id="在-Windows-设置环境变量"><a href="#在-Windows-设置环境变量" class="headerlink" title="在 Windows 设置环境变量"></a>在 Windows 设置环境变量</h4><p>在环境变量中添加Python目录：</p>
<p><strong>在命令提示框中(cmd) :</strong> 输入</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="INI"><figure class="iseeu highlight /ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">path</span>=%path%<span class="comment">;C:\Python</span></span><br></pre></td></tr></table></figure></div>

<p>按下”Enter”。</p>
<p><strong>注意:</strong> C:\Python 是Python的安装目录。</p>
<p>也可以通过以下方式设置：</p>
<ul>
<li>右键点击”计算机”，然后点击”属性”</li>
<li>然后点击”高级系统设置”</li>
<li>选择”系统变量”窗口下面的”Path”,双击即可！</li>
<li></li>
<li>然后在”Path”行，添加python安装路径即可(我的D:\Python32)，所以在后面，添加该路径即可。 <strong>ps：记住，路径直接用分号”；”隔开！</strong></li>
<li>最后设置成功以后，在cmd命令行，输入命令”python”，就可以有相关显示。</li>
</ul>
<hr>
<h3 id="Python-环境变量"><a href="#Python-环境变量" class="headerlink" title="Python 环境变量"></a>Python 环境变量</h3><p>下面几个重要的环境变量，它应用于Python：</p>
<table>
<thead>
<tr>
<th align="left">变量名</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">PYTHONPATH</td>
<td align="left">PYTHONPATH是Python搜索路径，默认我们import的模块都会从PYTHONPATH里面寻找。</td>
</tr>
<tr>
<td align="left">PYTHONSTARTUP</td>
<td align="left">Python启动后，先寻找PYTHONSTARTUP环境变量，然后执行此变量指定的文件中的代码。</td>
</tr>
<tr>
<td align="left">PYTHONCASEOK</td>
<td align="left">加入PYTHONCASEOK的环境变量, 就会使python导入模块的时候不区分大小写.</td>
</tr>
<tr>
<td align="left">PYTHONHOME</td>
<td align="left">另一种模块搜索路径。它通常内嵌于的PYTHONSTARTUP或PYTHONPATH目录中，使得两个模块库更容易切换。</td>
</tr>
</tbody></table>
<hr>
<h3 id="运行Python"><a href="#运行Python" class="headerlink" title="运行Python"></a>运行Python</h3><p>有三种方式可以运行Python：</p>
<h3 id="1、交互式解释器："><a href="#1、交互式解释器：" class="headerlink" title="1、交互式解释器："></a>1、交互式解释器：</h3><p>你可以通过命令行窗口进入 Python，并在交互式解释器中开始编写 Python 代码。</p>
<p>你可以在 Unix、DOS 或任何其他提供了命令行或者 shell 的系统进行 Python 编码工作。</p>
<p>$ python # Unix/Linux</p>
<p>或者</p>
<p>C:&gt;python # Windows/DOS</p>
<p>以下为Python命令行参数：</p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-d</td>
<td align="left">在解析时显示调试信息</td>
</tr>
<tr>
<td align="left">-O</td>
<td align="left">生成优化代码 ( .pyo 文件 )</td>
</tr>
<tr>
<td align="left">-S</td>
<td align="left">启动时不引入查找Python路径的位置</td>
</tr>
<tr>
<td align="left">-V</td>
<td align="left">输出Python版本号</td>
</tr>
<tr>
<td align="left">-X</td>
<td align="left">从 1.6版本之后基于内建的异常（仅仅用于字符串）已过时。</td>
</tr>
<tr>
<td align="left">-c cmd</td>
<td align="left">执行 Python 脚本，并将运行结果作为 cmd 字符串。</td>
</tr>
<tr>
<td align="left">file</td>
<td align="left">在给定的python文件执行python脚本。</td>
</tr>
</tbody></table>
<h3 id="2、命令行脚本"><a href="#2、命令行脚本" class="headerlink" title="2、命令行脚本"></a>2、命令行脚本</h3><p>在你的应用程序中通过引入解释器可以在命令行中执行Python脚本，如下所示：</p>
<p>$ python script.py # Unix/Linux</p>
<p>或者</p>
<p>C:&gt;python script.py # Windows/DOS</p>
<p><strong>注意：</strong>在执行脚本时，请检查脚本是否有可执行权限。</p>
<h3 id="3、集成开发环境（IDE：Integrated-Development-Environment）-PyCharm"><a href="#3、集成开发环境（IDE：Integrated-Development-Environment）-PyCharm" class="headerlink" title="3、集成开发环境（IDE：Integrated Development Environment）: PyCharm"></a>3、集成开发环境（IDE：Integrated Development Environment）: PyCharm</h3><p>PyCharm 是由 JetBrains 打造的一款 Python IDE，支持 macOS、 Windows、 Linux 系统。</p>
<p>PyCharm 功能 : 调试、语法高亮、Project管理、代码跳转、智能提示、自动完成、单元测试、版本控制……</p>
<p>PyCharm 下载地址 : <a href="https://www.jetbrains.com/pycharm/download/" target="_blank" rel="noopener">https://www.jetbrains.com/pycharm/download/</a></p>
<p>PyCharm 安装地址：<a href="https://www.runoob.com/w3cnote/pycharm-windows-install.html" target="_blank" rel="noopener">http://www.runoob.com/w3cnote/pycharm-windows-install.html</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>分布式爬虫实现原理与运行机制</title>
    <url>/Spider/Spider_id_13.html</url>
    <content><![CDATA[<h2 id="分布式爬虫"><a href="#分布式爬虫" class="headerlink" title="分布式爬虫"></a>分布式爬虫</h2><a id="more"></a>
<h2 id="什么是分布式爬虫"><a href="#什么是分布式爬虫" class="headerlink" title="什么是分布式爬虫:"></a>什么是分布式爬虫:</h2><ul>
<li><h5 id="基于多台电脑组建一个分布式机群-然后让集群中的每一台电脑执行同一组程序-然后让他们对同一个网站的数据进行分布爬取"><a href="#基于多台电脑组建一个分布式机群-然后让集群中的每一台电脑执行同一组程序-然后让他们对同一个网站的数据进行分布爬取" class="headerlink" title="基于多台电脑组建一个分布式机群,然后让集群中的每一台电脑执行同一组程序,然后让他们对同一个网站的数据进行分布爬取"></a>基于多台电脑组建一个分布式机群,然后让集群中的每一台电脑执行同一组程序,然后让他们对同一个网站的数据进行分布爬取</h5></li>
</ul>
<h2 id="使用分布式爬虫的目的"><a href="#使用分布式爬虫的目的" class="headerlink" title="使用分布式爬虫的目的:"></a>使用分布式爬虫的目的:</h2><ul>
<li><h5 id="提升数据爬取效率"><a href="#提升数据爬取效率" class="headerlink" title="提升数据爬取效率"></a>提升数据爬取效率</h5></li>
</ul>
<h2 id="如何实现分布式爬取"><a href="#如何实现分布式爬取" class="headerlink" title="如何实现分布式爬取:"></a>如何实现分布式爬取:</h2><ul>
<li><h5 id="基于-scrapy-redis-的形式实现分布式爬虫"><a href="#基于-scrapy-redis-的形式实现分布式爬虫" class="headerlink" title="基于 scrapy + redis  的形式实现分布式爬虫"></a>基于 scrapy + redis  的形式实现分布式爬虫</h5><ul>
<li><h5 id="scrapy结合scrapy-radis组件实现分布式"><a href="#scrapy结合scrapy-radis组件实现分布式" class="headerlink" title="scrapy结合scrapy-radis组件实现分布式"></a>scrapy结合scrapy-radis组件实现分布式</h5></li>
</ul>
</li>
</ul>
<h2 id="原生的scrapy是无法实现分布式爬虫的"><a href="#原生的scrapy是无法实现分布式爬虫的" class="headerlink" title="原生的scrapy是无法实现分布式爬虫的"></a>原生的scrapy是无法实现分布式爬虫的</h2><ul>
<li><h5 id="调度器无法实现共享-从而导致出现重复请求"><a href="#调度器无法实现共享-从而导致出现重复请求" class="headerlink" title="调度器无法实现共享,从而导致出现重复请求"></a>调度器无法实现共享,从而导致出现重复请求</h5></li>
<li><h5 id="管道无法实现共享-不利于数据汇总"><a href="#管道无法实现共享-不利于数据汇总" class="headerlink" title="管道无法实现共享,不利于数据汇总"></a>管道无法实现共享,不利于数据汇总</h5></li>
</ul>
<h2 id="scrapy-redis组件的作用"><a href="#scrapy-redis组件的作用" class="headerlink" title="scrapy-redis组件的作用:"></a>scrapy-redis组件的作用:</h2><ul>
<li><h5 id="提供可以被共享的调度器和管道"><a href="#提供可以被共享的调度器和管道" class="headerlink" title="提供可以被共享的调度器和管道"></a>提供可以被共享的调度器和管道</h5></li>
</ul>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置:"></a>环境配置:</h2><ul>
<li><h5 id="安装redis数据库"><a href="#安装redis数据库" class="headerlink" title="安装redis数据库"></a>安装redis数据库</h5></li>
<li><h5 id="pip-install-scrapy-redis"><a href="#pip-install-scrapy-redis" class="headerlink" title="pip install scrapy_redis"></a>pip install scrapy_redis</h5></li>
</ul>
<h2 id="编码流程"><a href="#编码流程" class="headerlink" title="编码流程:"></a>编码流程:</h2><ul>
<li><h5 id="创建一个工程"><a href="#创建一个工程" class="headerlink" title="创建一个工程"></a>创建一个工程</h5></li>
<li><h5 id="创建一个爬虫文件"><a href="#创建一个爬虫文件" class="headerlink" title="创建一个爬虫文件"></a>创建一个爬虫文件</h5><ul>
<li><h6 id="spider-和-CrawlSpider-都可以使用"><a href="#spider-和-CrawlSpider-都可以使用" class="headerlink" title="spider 和 CrawlSpider 都可以使用"></a>spider 和 CrawlSpider 都可以使用</h6></li>
<li><h6 id="修改爬虫文件"><a href="#修改爬虫文件" class="headerlink" title="修改爬虫文件"></a>修改爬虫文件</h6><ul>
<li><p>导入组件</p>
<ul>
<li><pre><code class="python"><span class="keyword">from</span> scrapy_redis.spider <span class="keyword">import</span> RedisSpider,RedisCrawlSpider
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CLEAN"><figure class="iseeu highlight /clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  - 将创建好的爬虫文件类的父类修改为新导入的scrapy_redis的子类</span><br><span class="line"></span><br><span class="line">  - 将start_url替换掉,换成redis_key</span><br><span class="line"></span><br><span class="line">- ###### 修改settings</span><br><span class="line"></span><br><span class="line">  - 指定管道</span><br><span class="line"></span><br><span class="line">    - ```python</span><br><span class="line">      # 开启可被共享的管道</span><br><span class="line">      ITEM_PIPELINES = &#123;</span><br><span class="line">          <span class="string">'scrapy_redis.pipelines.RedisPipeline'</span>: <span class="number">300</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
<li><p>指定调度器</p>
<ul>
<li><pre><code class="python"><span class="comment"># 指定使用可被共享的调度器</span>
<span class="comment"># 增加了一个去重容器类的配置,作用使用 Redis的set集合来存储请求的指纹数据,从而实现请求去重的持久化</span>
<span class="comment"># 对重复的请求对象去重</span>
DUPEFILTER_CLASS = <span class="string">'scrapy_redis.dupefilter.RFPDupeFilter'</span>
<span class="comment"># 使用scrapy_redis组件自己的调度器</span>
SCHEDULER = <span class="string">'scrapy_redis.scheduler.Scheduler'</span>
<span class="comment"># 配置调度器是否持久化,也就是说在爬虫运行结束之后要不要清除Redis中请求队列和去重指纹的set</span>
<span class="comment"># 这样实际上已经实现了增量式,也就是说,再次运行的时候,将不会将已经获取过的数据重复的获取,</span>
<span class="comment"># 增量式的概念就是:</span>
    <span class="comment"># 在创建爬虫之后,每次运行都会进行对比,紧紧对网站的更新内容进行爬取,而不会进行重复数据的重复获取,减少内存占用,同时也更加合理</span>
SCHEDULER_PERSIST = <span class="literal">True</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="LSL"><figure class="iseeu highlight /lsl"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 置定redis服务</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    # REDIS_HOST = 'redis 服务器地址'</span><br><span class="line">    REDIS_HOST = '<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>'</span><br><span class="line">    REDIS_PORT = <span class="number">6379</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>redis配置文件redis.windows.conf</p>
<ul>
<li>bind 127.0.0.1<ul>
<li>将这行代码注释掉</li>
<li>接触127.0.0.1绑定,使其他电脑可以访问本机redis</li>
</ul>
</li>
<li>protected-mode yes<ul>
<li>将yes改为no,关闭redis数据保护,关闭后允许其他电脑修改本机redis 数据库</li>
</ul>
</li>
</ul>
</li>
<li><p>携带配置文件启动redis服务</p>
<ul>
<li>redis-server ./redis.windows.conf</li>
</ul>
</li>
<li><p>启动redis客户端</p>
</li>
<li><p>运行爬虫文件</p>
<ul>
<li>cd ./spiders</li>
<li>scrapy runspider spiderName.py</li>
</ul>
</li>
<li><p>向调度器放入起始的     <strong>url</strong>     </p>
<ul>
<li>队列的位置<ul>
<li>队列存储在队列中</li>
<li>lpush key value</li>
<li>按照爬虫中设定好的目标redis队列名称放入起始url</li>
<li>当你把起始url放入之后,将会自动开始爬取</li>
</ul>
</li>
</ul>
</li>
<li><p>爬虫文件运行之后将会把获取到的数据自动存储到redis中</p>
</li>
<li><p>数据存储到 spiderName:items, response存储到 spiderName:response</p>
</li>
<li><p>注意,在进行分布式的时候,redis 的ip地址必须保持精确,也就是说,想要做分布式最好使用一个内网连接机群</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Scrapy</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>百度AI项目解析与使用</title>
    <url>/Spider/Spider_id_08.html</url>
    <content><![CDATA[<h2 id="百度AI"><a href="#百度AI" class="headerlink" title="百度AI"></a>百度AI</h2><a id="more"></a>
<p>百度ai是开放性的库,在其中实现了包括文本识别,语言识别,声音识别,指纹识别,虹膜识别等各式各样基于人工智能AI的识别方法:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> aip <span class="keyword">import</span> AipNlp</span><br><span class="line"></span><br><span class="line"><span class="string">""" 你的 APPID AK SK """</span></span><br><span class="line">APP_ID = <span class="string">'18141048'</span></span><br><span class="line">API_KEY = <span class="string">'CPKSpk7Up1aATfxAaP9xln1O'</span></span><br><span class="line">SECRET_KEY = <span class="string">'miR2GGKYfx214xEGUO0i83cgFmD3T1Z3'</span></span><br><span class="line"></span><br><span class="line">client = AipNlp(APP_ID, API_KEY, SECRET_KEY)</span><br></pre></td></tr></table></figure></div>

<p>它的库是开放的,使用方法同样是开放的,所以我们在进行时使用的时候,可以直接调用对应的aip库中的识别方法,就可以将我们的数据分门别类地识别出来,</p>
<h2 id="提取关键字分类"><a href="#提取关键字分类" class="headerlink" title="提取关键字分类"></a>提取关键字分类</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">client.topic(title, content);</span><br><span class="line"><span class="comment"># 文章分类,从标题与内容中提取关键字进行分类</span></span><br><span class="line"><span class="comment"># title,content都是必填</span></span><br><span class="line"><span class="comment"># 项判断词义相似度</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">client.wordSimEmbedding(word1, word2);</span><br><span class="line"><span class="comment"># 判断两个对象的相似度</span></span><br><span class="line"><span class="comment"># 这个结果判断的其实是两个对象的词义的相似度</span></span><br><span class="line"><span class="comment"># 返回结果为:</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    "score": 0.456862,</span></span><br><span class="line"><span class="string">    # score 为该对象的相似度,</span></span><br><span class="line"><span class="string">    "words": &#123;</span></span><br><span class="line"><span class="string">      "word_1": "北京",</span></span><br><span class="line"><span class="string">      "word_2": "上海"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;'''</span></span><br></pre></td></tr></table></figure></div>

<h2 id="判断文本相似度"><a href="#判断文本相似度" class="headerlink" title="判断文本相似度"></a>判断文本相似度</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">text1 = <span class="string">"浙富股份"</span></span><br><span class="line"></span><br><span class="line">text2 = <span class="string">"万事通自考网"</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" 调用短文本相似度 """</span></span><br><span class="line">client.simnet(text1, text2);</span><br><span class="line"></span><br><span class="line"><span class="string">""" 如果有可选参数 """</span></span><br><span class="line">options = &#123;&#125;</span><br><span class="line">options[<span class="string">"model"</span>] = <span class="string">"CNN"</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" 带参数调用短文本相似度 """</span></span><br><span class="line">client.simnet(text1, text2, options)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"># 这个结果匹配的是文本的相似度,也就是说,并不在乎其中的意义,比较的是其中的内容</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    "log_id": 12345,</span></span><br><span class="line"><span class="string">    "texts":&#123;</span></span><br><span class="line"><span class="string">        "text_1":"浙富股份",</span></span><br><span class="line"><span class="string">        "text_2":"万事通自考网"</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "score":0.3300237655639648 //相似度结果</span></span><br><span class="line"><span class="string">&#125;,</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></div>

<h3 id="抽取关键字"><a href="#抽取关键字" class="headerlink" title="抽取关键字"></a>抽取关键字</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">title = <span class="string">"iphone手机出现“白苹果”原因及解决办法，用苹果手机的可以看下"</span></span><br><span class="line"></span><br><span class="line">content = <span class="string">"如果下面的方法还是没有解决你的问题建议来我们门店看下成都市锦江区红星路三段99号银石广场24层01室。"</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" 调用文章标签 """</span></span><br><span class="line">client.keyword(title, content);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取标题与文章中的关键字信息,也就说文字节点,这一点能够方便我们更快的定位想要的信息,以及进行更加精确的信息分类</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    "log_id": 4457308639853058292,</span></span><br><span class="line"><span class="string">    "items": [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            "score": 0.997762,</span></span><br><span class="line"><span class="string">            "tag": "iphone"</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            "score": 0.861775,</span></span><br><span class="line"><span class="string">            "tag": "手机"</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            "score": 0.845657,</span></span><br><span class="line"><span class="string">            "tag": "苹果"</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            "score": 0.83649,</span></span><br><span class="line"><span class="string">            "tag": "苹果公司"</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            "score": 0.797243,</span></span><br><span class="line"><span class="string">            "tag": "数码"</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></div>

<h3 id="错别字纠正"><a href="#错别字纠正" class="headerlink" title="错别字纠正"></a>错别字纠正</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">text = <span class="string">"百度是一家人工只能公司"</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" 调用文本纠错 """</span></span><br><span class="line">client.ecnet(text);</span><br><span class="line"><span class="comment"># 返回结果将会把错误信息与正确的信息封装到item中,并返回,根据这些信息可以将原来的数据进行修正,减少错别字</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    "log_id": 6770395607901559829,</span></span><br><span class="line"><span class="string">    "item": &#123;</span></span><br><span class="line"><span class="string">        "vec_fragment": [</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                "ori_frag": "只能",</span></span><br><span class="line"><span class="string">                "begin_pos": 21,</span></span><br><span class="line"><span class="string">                "correct_frag": "智能",</span></span><br><span class="line"><span class="string">                "end_pos": 27</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        "score": 0.875169,</span></span><br><span class="line"><span class="string">        "correct_query": "百度是一家人工智能公司"</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "text": "百度是一家人工只能公司"</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></div>

<h3 id="文字情绪识别"><a href="#文字情绪识别" class="headerlink" title="文字情绪识别"></a>文字情绪识别</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">text = <span class="string">"本来今天高高兴兴"</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" 调用对话情绪识别接口 """</span></span><br><span class="line">client.emotion(text);</span><br><span class="line"></span><br><span class="line"><span class="string">""" 如果有可选参数 """</span></span><br><span class="line">options = &#123;&#125;</span><br><span class="line">options[<span class="string">"scene"</span>] = <span class="string">"talk"</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" 带参数调用对话情绪识别接口 """</span></span><br><span class="line">client.emotion(text, options)</span><br><span class="line"></span><br><span class="line"><span class="comment"># neutral      非强烈负面情绪</span></span><br><span class="line"><span class="comment"># pessimistic  强烈负面情绪</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    "log_id": 4258005459150262970,</span></span><br><span class="line"><span class="string">    "text": "本来今天高高兴兴",</span></span><br><span class="line"><span class="string">    "items": [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            "prob": 0.998619,</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            "label": "neutral"</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            "prob": 0.00138141,</span></span><br><span class="line"><span class="string">            "label": "pessimistic"</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></div>



]]></content>
      <categories>
        <category>Scrapy</category>
      </categories>
      <tags>
        <tag>百度AI</tag>
      </tags>
  </entry>
  <entry>
    <title>python基础知识(一)</title>
    <url>/Python/Python_id_16.html</url>
    <content><![CDATA[<h2 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h2><p>这是我所学的第一门编程语言,我的计算机知识从这里起步.</p>
<hr>
<h3 id="Python-简介"><a href="#Python-简介" class="headerlink" title="Python 简介"></a>Python 简介</h3><a id="more"></a>

<p>Python 是一个高层次的结合了解释性、编译性、互动性和面向对象的脚本语言。</p>
<p>Python 的设计具有很强的可读性，相比其他语言经常使用英文关键字，其他语言的一些标点符号，它具有比其他语言更有特色语法结构。</p>
<ul>
<li><strong>Python 是一种解释型语言：</strong> 这意味着开发过程中没有了编译这个环节。类似于PHP和Perl语言。</li>
<li><strong>Python 是交互式语言：</strong> 这意味着，您可以在一个 Python 提示符 <strong>&gt;&gt;&gt;</strong> 后直接执行代码。</li>
<li><strong>Python 是面向对象语言:</strong> 这意味着Python支持面向对象的风格或代码封装在对象的编程技术。</li>
<li><strong>Python 是初学者的语言：</strong>Python 对初级程序员而言，是一种伟大的语言，它支持广泛的应用程序开发，从简单的文字处理到 WWW 浏览器再到游戏。</li>
</ul>
<hr>
<h3 id="Python-发展历史"><a href="#Python-发展历史" class="headerlink" title="Python 发展历史"></a>Python 发展历史</h3><p>Python 是由 Guido van Rossum 在八十年代末和九十年代初，在荷兰国家数学和计算机科学研究所设计出来的。</p>
<p>Python 本身也是由诸多其他语言发展而来的,这包括 ABC、Modula-3、C、C++、Algol-68、SmallTalk、Unix shell 和其他的脚本语言等等。</p>
<p>像 Perl 语言一样，Python 源代码同样遵循 GPL(GNU General Public License)协议。</p>
<p>现在 Python 是由一个核心开发团队在维护，Guido van Rossum 仍然占据着至关重要的作用，指导其进展。</p>
<p>Python 2.7 被确定为最后一个 Python 2.x 版本，它除了支持 Python 2.x 语法外，还支持部分 Python 3.1 语法。</p>
<hr>
<h3 id="Python-特点"><a href="#Python-特点" class="headerlink" title="Python 特点"></a>Python 特点</h3><p><strong>1.易于学习：</strong>Python有相对较少的关键字，结构简单，和一个明确定义的语法，学习起来更加简单。</p>
<p><strong>2.易于阅读：</strong>Python代码定义的更清晰。</p>
<p><strong>3.易于维护：</strong>Python的成功在于它的源代码是相当容易维护的。</p>
<p><strong>4.一个广泛的标准库：</strong>Python的最大的优势之一是丰富的库，跨平台的，在UNIX，Windows和Macintosh兼容很好。</p>
<p><strong>5.互动模式：</strong>互动模式的支持，您可以从终端输入执行代码并获得结果的语言，互动的测试和调试代码片断。</p>
<p><strong>6.可移植：</strong>基于其开放源代码的特性，Python已经被移植（也就是使其工作）到许多平台。</p>
<p><strong>7.可扩展：</strong>如果你需要一段运行很快的关键代码，或者是想要编写一些不愿开放的算法，你可以使用C或C++完成那部分程序，然后从你的Python程序中调用。</p>
<p><strong>8.数据库：</strong>Python提供所有主要的商业数据库的接口。</p>
<p><strong>9.GUI编程：</strong>Python支持GUI可以创建和移植到许多系统调用。</p>
<p><strong>10.可嵌入:</strong> 你可以将Python嵌入到C/C++程序，让你的程序的用户获得”脚本化”的能力。 </p>
<hr>
<p><strong>优点</strong></p>
<ul>
<li>简单 – Python 是一种代表简单主义思想的语言。阅读一个良好的 Python 程序就感觉像是在读英语一样，尽管这个英语的要求非常严格！Python 的这种伪代码本质是它最大的优点之一。它使你能够专注于解决问题而不是去搞明白语言本身。</li>
<li>易学 – 就如同你即将看到的一样，Python 极其容易上手。前面已经提到了，Python 有极其简单的语法。</li>
<li>免费、开源 – Python 是 FLOSS（自由/开放源码软件）之一。简单地说，你可以自由地发布这个软件的拷贝、阅读它的源代码、对它做改动、把它的一部分用于新的自由软件中。FLOSS 是基于一个团体分享知识的概念。这是为什么 Python 如此优秀的原因之一——它是由一群希望看到一个更加优秀的 Python 的人创造并经常改进着的。</li>
<li>高层语言 – 当你用 Python 语言编写程序的时候，你无需考虑诸如如何管理你的程序使用的内存一类的底层细节。</li>
<li>可移植性 – 由于它的开源本质，Python 已经被移植在许多平台上（经过改动使它能够工作在不同平台上）。如果你小心地避免使用依赖于系统的特性，那么你的所有 Python 程序无需修改就可以在下述任何平台上面运行。这些平台包括 Linux、Windows、FreeBSD、Macintosh、Solaris、OS/2、Amiga、AROS、AS/400、BeOS、OS/390、z/OS、Palm OS、QNX、VMS、Psion、Acom RISC OS、VxWorks、PlayStation、Sharp Zaurus、Windows CE 甚至还有 PocketPC、Symbian 以及 Google 基于 Linux 开发的 Android 平台！</li>
<li>解释性 – 这一点需要一些解释。一个用编译性语言比如 C 或 C++ 写的程序可以从源文件（即 C 或 C++ 语言）转换到一个你的计算机使用的语言（二进制代码，即0和1）。这个过程通过编译器和不同的标记、选项完成。当你运行你的程序的时候，连接/转载器软件把你的程序从硬盘复制到内存中并且运行。而 Python 语言写的程序不需要编译成二进制代码。你可以直接从源代码运行程序。在计算机内部，Python 解释器把源代码转换成称为字节码的中间形式，然后再把它翻译成计算机使用的机器语言并运行。事实上，由于你不再需要担心如何编译程序，如何确保连接转载正确的库等等，所有这一切使得使用 Python 更加简单。由于你只需要把你的 Python 程序拷贝到另外一台计算机上，它就可以工作了，这也使得你的 Python 程序更加易于移植。</li>
<li>面向对象 – Python 既支持面向过程的编程也支持面向对象的编程。在“面向过程”的语言中，程序是由过程或仅仅是可重用代码的函数构建起来的。在“面向对象”的语言中，程序是由数据和功能组合而成的对象构建起来的。与其他主要的语言如 C++ 和 Java 相比，Python 以一种非常强大又简单的方式实现面向对象编程。</li>
<li>可扩展性 – 如果你需要你的一段关键代码运行得更快或者希望某些算法不公开，你可以把你的部分程序用 C 或 C++ 编写，然后在你的 Python 程序中使用它们。</li>
<li>丰富的库 – Python 标准库确实很庞大。它可以帮助你处理各种工作，包括正则表达式、文档生成、单元测试、线程、数据库、网页浏览器、CGI、FTP、电子邮件、XML、XML-RPC、HTML、WAV 文件、密码系统、GUI（图形用户界面）、Tk 和其他与系统有关的操作。记住，只要安装了 Python，所有这些功能都是可用的。这被称作 Python 的“功能齐全”理念。除了标准库以外，还有许多其他高质量的库，如 wxPython、Twisted 和 Python 图像库等等。</li>
<li>规范的代码 – Python 采用强制缩进的方式使得代码具有极佳的可读性。</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>运行速度，有速度要求的话，用 C++ 改写关键部分吧。</li>
<li>国内市场较小（国内以 Python 来做主要开发的，目前只有一些 web2.0 公司）。但时间推移，目前很多国内软件公司，尤其是游戏公司，也开始规模使用他。</li>
<li>中文资料匮乏（好的 Python 中文资料屈指可数，现在应该变多了）。托社区的福，有几本优秀的教材已经被翻译了，但入门级教材多，高级内容还是只能看英语版。</li>
<li>构架选择太多（没有像 C# 这样的官方 .net 构架，也没有像 ruby 由于历史较短，构架开发的相对集中。Ruby on Rails 构架开发中小型web程序天下无敌）。不过这也从另一个侧面说明，python比较优秀，吸引的人才多，项目也多。</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>redis概览</title>
    <url>/Redis/Redis_id_02.html</url>
    <content><![CDATA[<h2 id="redis数据库安装与使用"><a href="#redis数据库安装与使用" class="headerlink" title="redis数据库安装与使用:"></a>redis数据库安装与使用:</h2><a id="more"></a>
<ul>
<li>前往github下载要使用的版本的压缩包</li>
<li>解压缩文件</li>
<li>cd到安装目录</li>
<li>运行redis-server</li>
<li>将安装目录添加到系统环境变量中</li>
<li>运行redis-server</li>
<li>再次打开一个cmd窗口,输入redis-cli即可进入redis环境</li>
<li>keys *   查看当前所有数据</li>
<li>端口: 127.0.0.1:6379</li>
</ul>
<h2 id="redis数据类型"><a href="#redis数据类型" class="headerlink" title="redis数据类型:"></a>redis数据类型:</h2><ul>
<li>list<ul>
<li>llen<ul>
<li>获取列表长度</li>
</ul>
</li>
<li>lpush<ul>
<li>在表头添加数据</li>
</ul>
</li>
<li>rpush<ul>
<li>在表尾添加数据</li>
</ul>
</li>
<li>lpop <ul>
<li>从表头弹出数据</li>
</ul>
</li>
<li>rpop<ul>
<li>从表尾弹出数据</li>
</ul>
</li>
<li>rpoplpush<ul>
<li>从表尾弹出数据并添加到表头</li>
</ul>
</li>
<li>lrange listName num num  <ul>
<li>从xx到xx的所有数据,支持负数</li>
</ul>
</li>
<li>lindex listName num<ul>
<li>指定下标获取对应的值</li>
</ul>
</li>
<li>linsert key    (before) value newvalue<ul>
<li>在某个值之前添加另一个新的数值</li>
</ul>
</li>
<li>linsert key    (after) value newvalue<ul>
<li>在某个值之后添加另一个新的值</li>
</ul>
</li>
<li>lrem key  n  value <ul>
<li>删除某个值,n为次数</li>
<li>当n &gt; 0,则删除n个对应的值,且删除顺序从左往右</li>
<li>当n &lt; 0,删除n个对应的值,且删除顺序从右往左</li>
<li>当n = 0,则删除所有符合条件的数据</li>
</ul>
</li>
</ul>
</li>
<li>string<ul>
<li>二进制安全的键值对,以key:value的形式存在,也就是说,可以存储二进制文件</li>
<li>string单个大小最大为512M</li>
</ul>
</li>
<li>set<ul>
<li>set设定键值对</li>
<li>get根据键获取对应的值</li>
<li>append 在键对应的值后面追加新的数据,同时具备set的概念,如果追加的目标是一个不存在的键,将会自动创建出来</li>
<li>strlen 获取键对应的字符串的长度</li>
<li>setnx 对一个键进行赋值,如果该键存在,则不会有任何效果,如果该键并不存在,则进行创建并赋值</li>
<li>incr 对键对应的值进行+1操作,前提是这个值是纯粹的数字</li>
<li>decr 对键对应的值进行-1操作,前提是这个值不是纯数字</li>
<li>incrby keysName num 对键所对应的值进行加法操作,</li>
<li>decrby  keysName num 对键所对应的值进行减法操作</li>
</ul>
</li>
<li>hash</li>
<li>zset</li>
</ul>
<h2 id="redis基础操作"><a href="#redis基础操作" class="headerlink" title="redis基础操作:"></a>redis基础操作:</h2><ul>
<li>keys * <ul>
<li>查看所有的数据</li>
</ul>
</li>
<li>exists name<ul>
<li>查看符合该名称的数据总量</li>
</ul>
</li>
<li>del name<ul>
<li>删除目标数据</li>
</ul>
</li>
<li>expire name succes<ul>
<li>为一个数据设置过期时间,时间单位默认为秒,需输入数字</li>
</ul>
</li>
<li>ttl name<ul>
<li>查看该对象还有多久过期</li>
</ul>
</li>
<li>dbsize<ul>
<li>查看当前正在使用的库中的数据的数量</li>
</ul>
</li>
<li>Flushdb<ul>
<li>清空当前的库</li>
</ul>
</li>
<li>Flushall<ul>
<li>清空所有的库</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>基于crawlSpider进行的全栈数据爬取</title>
    <url>/Spider/Spider_id_03.html</url>
    <content><![CDATA[<h2 id="基于crawlSpider进行的全栈数据爬取"><a href="#基于crawlSpider进行的全栈数据爬取" class="headerlink" title="基于crawlSpider进行的全栈数据爬取"></a>基于crawlSpider进行的全栈数据爬取</h2><a id="more"></a>
<h2 id="crawlspider是爬虫类中spider的一个子类"><a href="#crawlspider是爬虫类中spider的一个子类" class="headerlink" title="crawlspider是爬虫类中spider的一个子类"></a>crawlspider是爬虫类中spider的一个子类</h2><h2 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h2><p>创建一个基于crawlspider的爬虫文件</p>
<ul>
<li>​    scrapy genspider -t crawl spiderName <a href="http://www.xxx.com" target="_blank" rel="noopener">www.xxx.com</a><ul>
<li>使用指令创建一个基于crawlSpider的爬虫文件</li>
</ul>
</li>
<li>构造链接提取器和构造解析器<ul>
<li>链接提取器<ul>
<li>可以根据制定的规则进行指定链接的提取</li>
</ul>
</li>
<li>构造解析器</li>
</ul>
</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy.linkextractors <span class="keyword">import</span> LinkExtractor</span><br><span class="line"><span class="keyword">from</span> scrapy.spiders <span class="keyword">import</span> CrawlSpider, Rule</span><br><span class="line"><span class="keyword">from</span> ..items <span class="keyword">import</span> Homework1Item, Homework1ContentItem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SunSpider</span><span class="params">(CrawlSpider)</span>:</span></span><br><span class="line">    name = <span class="string">'sun'</span></span><br><span class="line">    <span class="comment"># allowed_domains = ['www.xxx.com']</span></span><br><span class="line">    start_urls = [</span><br><span class="line">        <span class="string">'http://wz.sun0769.com/index.php/question/questionType?type=4'</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    rules = (</span><br><span class="line">        <span class="comment"># 进行链接提取,follow开启深度提取 ,</span></span><br><span class="line">        Rule(LinkExtractor(allow=<span class="string">r'type=4&amp;page=\d+'</span>),</span><br><span class="line">             callback=<span class="string">'parse_item'</span>,</span><br><span class="line">             follow=<span class="literal">True</span>),</span><br><span class="line">        <span class="comment"># 进行详情页链接提取,但是关闭深度提取</span></span><br><span class="line">        Rule(LinkExtractor(allow=<span class="string">r'question/\d+/\d+\.shtml'</span>),</span><br><span class="line">             callback=<span class="string">'parse_detail'</span>,</span><br><span class="line">             follow=<span class="literal">False</span>),</span><br><span class="line">    )</span><br><span class="line">	<span class="comment"># 在进行上述的网页处理的时候,这两个将会同步进行,也就是说,在第一个深度提取运行一次的时候,另一个也会一起运行一次</span></span><br><span class="line">    <span class="comment"># 这种情况下,每次我们获取一个新的页面,第二个提取器将会对这个新的页面进行处理,然后再处理下一个页面</span></span><br><span class="line">    <span class="comment"># 正常的spider和这个crawlspider是通用的,也就是说,在使用这个crawlspdier进行深度爬取的时候,其他的spider操作也是没问题的</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_item</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        tr_list = response.xpath(</span><br><span class="line">            <span class="string">'//*[@id="morelist"]/div/table[2]//tr/td/table//tr'</span>)</span><br><span class="line">        <span class="keyword">for</span> tr <span class="keyword">in</span> tr_list:</span><br><span class="line">            title = tr.xpath(<span class="string">'./td[2]/a[2]/@title'</span>).extract_first()</span><br><span class="line">            detail = tr.xpath(<span class="string">'./td[3]/span/text()'</span>).extract_first()</span><br><span class="line">            <span class="comment"># print(title,detail)</span></span><br><span class="line">            item = Homework1ContentItem()</span><br><span class="line">            item[<span class="string">'title'</span>] = title</span><br><span class="line">            item[<span class="string">'detail'</span>] = detail</span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_detail</span><span class="params">(self, response)</span>:</span></span><br><span class="line"></span><br><span class="line">        content = response.xpath(</span><br><span class="line">            <span class="string">'/html/body/div[9]/table[2]//tr[1]//text()'</span>).extract()</span><br><span class="line">        content = <span class="string">''</span>.join(content)</span><br><span class="line">        item = Homework1Item()</span><br><span class="line">        item[<span class="string">'content'</span>] = content</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Scrapy</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>增量式爬虫使用</title>
    <url>/Spider/Spider_id_19.html</url>
    <content><![CDATA[<h2 id="1—增量式爬虫简介"><a href="#1—增量式爬虫简介" class="headerlink" title="1—增量式爬虫简介"></a>1—增量式爬虫简介</h2><a id="more"></a>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念:"></a>概念:</h3><p>​    检测网站数据更新情况</p>
<h3 id="核心"><a href="#核心" class="headerlink" title="核心:"></a>核心:</h3><p>​    去重</p>
<h3 id="要点"><a href="#要点" class="headerlink" title="要点::"></a>要点::</h3><p>​    深度爬取类型的网站中需要对详情页的url进行记录和检测</p>
<h4 id="记录"><a href="#记录" class="headerlink" title="记录:"></a>记录:</h4><p>​        将爬取过的详情页的url进行记录保存</p>
<p>​        将url存储到redis中去</p>
<h4 id="检测"><a href="#检测" class="headerlink" title="检测:"></a>检测:</h4><p>​        在对某一个详情页的url发请求之前先要到记录表中进行查看,该url是否存在,如果存在的话,意味着这个url已经被爬取过了</p>
<h2 id="2—使用流程及案例"><a href="#2—使用流程及案例" class="headerlink" title="2—使用流程及案例"></a>2—使用流程及案例</h2><h3 id="深度爬取类型的网站使用增量式爬虫爬取数据"><a href="#深度爬取类型的网站使用增量式爬虫爬取数据" class="headerlink" title="深度爬取类型的网站使用增量式爬虫爬取数据:"></a>深度爬取类型的网站使用增量式爬虫爬取数据:</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy.linkextractors <span class="keyword">import</span> LinkExtractor</span><br><span class="line"><span class="keyword">from</span> scrapy.spiders <span class="keyword">import</span> CrawlSpider, Rule</span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> Redis</span><br><span class="line"><span class="keyword">from</span> ..items <span class="keyword">import</span> ZlsMovieproItem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZlsSpider</span><span class="params">(CrawlSpider)</span>:</span></span><br><span class="line">    name = <span class="string">'zls'</span></span><br><span class="line">    conn = Redis()</span><br><span class="line">    <span class="comment"># 设置初试url</span></span><br><span class="line">    start_urls = [<span class="string">'https://www.4567tv.tv/index.php/vod/show/id/8.html'</span>]</span><br><span class="line">    rules = (</span><br><span class="line">        Rule(LinkExtractor(allow=<span class="string">r'id/8/page/\d+\.html'</span>),</span><br><span class="line">             callback=<span class="string">'parse_item'</span>,</span><br><span class="line">             follow=<span class="literal">True</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_item</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="comment"># 进行数据解析,准备就进行深度爬取,</span></span><br><span class="line">        <span class="comment"># 因为这里的深度解析涉及两层页面,所以需要进行手动发送请求来确保更加精确</span></span><br><span class="line">        li_list = response.xpath(<span class="string">'//div[1]/div/div/div/div[2]/ul/li'</span>)</span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">            movie_name = li.xpath(<span class="string">'./div/div/h4/a/text()'</span>).extract_first()</span><br><span class="line">            detail_url = <span class="string">'https://www.4567tv.tv'</span> + li.xpath(</span><br><span class="line">                <span class="string">'./div/div/h4/a/@href'</span>).extract_first()</span><br><span class="line">            <span class="comment"># 进行数据插入,通过sadd的返回值来辨别数据是否重复</span></span><br><span class="line">            <span class="comment"># 将获取到的详情页的url存储到redis中</span></span><br><span class="line">            <span class="comment"># 在执行sadd操作的时候,如果要插入的数据已经存在,将会返回0,并且插入失败,如果不存在,返回1,插入成功</span></span><br><span class="line">            ex = self.conn.sadd(<span class="string">'movie_url_data'</span>, detail_url)</span><br><span class="line">            <span class="keyword">if</span> ex == <span class="number">1</span>:</span><br><span class="line">                print(<span class="string">'哦~一块新鲜的奶酪!'</span>)</span><br><span class="line">                item = ZlsMovieproItem()</span><br><span class="line">                item[<span class="string">'movie_name'</span>] = movie_name</span><br><span class="line">                将获取到的电影名称存储到item并进行传递</span><br><span class="line">                <span class="keyword">yield</span> scrapy.Request(url=detail_url,</span><br><span class="line">                                     callback=self.detail_parse,</span><br><span class="line">                                     meta=&#123;<span class="string">'item'</span>: item&#125;)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'腐朽的味道!!!'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">detail_parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        item = response.meta[<span class="string">'item'</span>]</span><br><span class="line">        detail_text = response.xpath(</span><br><span class="line">            <span class="string">'//div[1]/div/div/div/div[2]/p[5]/span[3]/text()'</span>).extract_first()</span><br><span class="line">        item[<span class="string">'detail_text'</span>] = detail_text</span><br><span class="line">        print(item)</span><br><span class="line">        <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure></div>

<h3 id="不需要深度爬取的网站的注意点"><a href="#不需要深度爬取的网站的注意点" class="headerlink" title="不需要深度爬取的网站的注意点:"></a>不需要深度爬取的网站的注意点:</h3><p>数据指纹:</p>
<p>​    一组数据的唯一标识</p>
<p>​    在数据库中构建指纹集合,换句话说,就是创建一个绝对不会重复的id,来确保数据爬取的时候不会重复获取已有的数据</p>
<h2 id="3—核心要点"><a href="#3—核心要点" class="headerlink" title="3—核心要点"></a>3—核心要点</h2>]]></content>
      <categories>
        <category>Scrapy</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>代理ip</title>
    <url>/Spider/Spider_id_10.html</url>
    <content><![CDATA[<p>[TOC]</p>
<h2 id="代理IP"><a href="#代理IP" class="headerlink" title="代理IP"></a>代理IP</h2><a id="more"></a>
<h2 id="代理IP与代理服务器"><a href="#代理IP与代理服务器" class="headerlink" title="代理IP与代理服务器:"></a>代理IP与代理服务器:</h2><ol>
<li><p>代理IP分类</p>
<ul>
<li>透明代理IP<ul>
<li>服务器知道你在使用代理IP,并且知道你的真实IP</li>
</ul>
</li>
<li>匿名IP<ul>
<li>服务器知道你在使用代理IP,但不知道你的真正IP</li>
</ul>
</li>
<li>高匿名IP<ul>
<li>服务器不知道你在使用代理IP,并且不知道你的真正IP</li>
</ul>
</li>
</ul>
</li>
<li><p>代理IP分为两种:</p>
<ul>
<li>基于接口<ul>
<li>获取固定数量的代理IP</li>
<li>这些IP地址时固定的,固定数量,如果你的请求数量过多的话,同样又被发现的风险</li>
</ul>
</li>
<li>基于隧道<ul>
<li>这种代理IP基于云端服务器存在,拥有一个云端的IP池</li>
<li>每次使用时,都会从庞大的IP池中随即调用代理IP</li>
<li>因此,基于隧道的代理IP在使用时几乎不会出现重复使用的IP</li>
<li>相比较固定数量的基于接口IP,更加的安全</li>
</ul>
</li>
<li>相比较起来,使用基于隧道的代理IP更加好用,但是相对的是,基于隧道的代理IP价格更加昂贵</li>
</ul>
</li>
<li><pre><code class="python"><span class="keyword">import</span> requests

url = <span class="string">'http://httpbin.org/get'</span>

proxies = {
    <span class="string">"http"</span>: <span class="string">"http://60.167.103.60:9999"</span>,
    <span class="string">"https"</span>: <span class="string">"https://183.166.138.137:9999"</span>
}
res = requests.get(url=url,proxies=proxies)
print(res.text)
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AUTOHOTKEY"><figure class="iseeu highlight /autohotkey"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">4</span>. 在进行高频请求的时候,如果你的爬虫被检测了出来,将会被返回一个特殊的错误:ConectionPool</span><br><span class="line"></span><br><span class="line"><span class="title">   1. 这个错误的意思就是说:</span> 你已经被发现了,并且你用来进行请求的IP已经被禁掉了</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>. ```python</span><br><span class="line">   proxies = [</span><br><span class="line">       &#123;<span class="string">"http"</span>: <span class="string">"http://60.167.103.60:9999"</span>&#125;,</span><br><span class="line">       &#123;<span class="string">"http"</span>: <span class="string">"http://60.167.103.60:9999"</span>&#125;,</span><br><span class="line">       &#123;<span class="string">"http"</span>: <span class="string">"http://60.167.103.60:9999"</span>&#125;,</span><br><span class="line">       &#123;<span class="string">"http"</span>: <span class="string">"http://60.167.103.60:9999"</span>&#125;</span><br><span class="line">   ]</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>代理ip池写法,创建一个列表,存储准备好的IP,然后使用随机模块进行随即调用,这样可以确保每次都会随机抽取一个代理ip来发送请求</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Scrapy</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>动态获取数据</title>
    <url>/Spider/Spider_id_11.html</url>
    <content><![CDATA[<h2 id="动态获取数据"><a href="#动态获取数据" class="headerlink" title="动态获取数据"></a>动态获取数据</h2><a id="more"></a>
<ol>
<li>在一些网页中,进行ajax请求的时候需要传递参数,有些参数是特殊的动态参数,这些参数通常隐藏在页面中,只需要进行对应的匹配就能够进行获取</li>
<li>在一些网页中,cookie的获取可能是在执行ajax请求进行动态加载的时候才传递过来的,因此,想要获取对应的cookie,就需要是用Session模块在进行ajax请求的时候进行获取,才能拿到需要使用的cookie</li>
</ol>
]]></content>
      <categories>
        <category>Scrapy</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask文件上传</title>
    <url>/Flask/Flask_id_11.html</url>
    <content><![CDATA[<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传:"></a>文件上传:</h2><a id="more"></a>
<ul>
<li><pre><code class="python"><span class="comment">#导入必须的模块包</span>
<span class="keyword">from</span> wtform <span class="keyword">import</span> Form,StringField,PasswordField,SubmitField,BooleanField,FileField,SelectField
<span class="comment">#导入验证器包</span>
<span class="keyword">from</span> wtform.validators <span class="keyword">import</span> EqualTo,Length,UUID,URL,ValidatorsError,InputRequired,Email
<span class="comment">#从flask_wtf中导入file.FileRequired(是否为空验证)和file.FileAllowed(验证是否符合要求的格式,格式要求的范围作为参数进行传递,切记传入的参数必须为一个列表)</span>
<span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template,send_from_directory
<span class="keyword">from</span> werkzeug.datastructures <span class="keyword">import</span> CombinedMultiDict

<span class="keyword">from</span> flask_wtf.file <span class="keyword">import</span> FileRequired,FileAllowed
<span class="comment">#导入文件名过滤包</span>
<span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename
<span class="keyword">import</span> os

</code></pre>
</li>
</ul>
<p>  app = Flask(<strong>name</strong>)</p>
<p>  upload_url = os.path.join(os.path.dirname(<strong>file</strong>),’image’)</p>
<p>  class userForm(Form):<br>      #创建文件上传约束<br>      avater = FileField(validators=[FileRequired(),FileAllowed([‘jpg’,’png’,’gif’])])</p>
<p>  @app.route(‘/‘,methods=[‘GET’,’POST’])<br>  dedf func():<br>      if request.method == ‘GET’:<br>          return render_template(‘add.html’)<br>      else:<br>          #使用ConbinedMultiDict模块对传输的两个不同的值进行合并,一起传入wtf文件传输判定中进行验证<br>          userform = userForm(CombinedMultiDict([request.form,request.files]))<br>          if userform.validate():<br>              avater = userform.avater.data<br>              filename = secure_filename(avater.filename)<br>              avater.save(os.path.join(upload_url,filename))<br>              return ‘上传成功’</p>
<pre><code></code></pre>]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask常用钩子函数</title>
    <url>/Flask/Flask_id_09.html</url>
    <content><![CDATA[<h2 id="常用钩子函数"><a href="#常用钩子函数" class="headerlink" title="常用钩子函数"></a>常用钩子函数</h2><a id="more"></a>
<ol>
<li><h3 id="errorhandler"><a href="#errorhandler" class="headerlink" title="errorhandler"></a>errorhandler</h3><ol>
<li><p>错误报告专用</p>
</li>
<li><p>在装饰器中传入参数进行对应错误代码进行捕获</p>
</li>
<li><p>定义错误捕获函数进行捕获,此函数中定义参数为error</p>
</li>
<li><p>此错误报告可以返回 ‘html’ 页面,并使用js对其进行修饰</p>
<ol>
<li><p>使用abort模块进行错误跳转,即,当访问的界面不符合条件时,直接返回对应的错误,</p>
<ol>
<li><pre><code class="python"><span class="keyword">from</span> flask <span class="keyword">import</span> abort

.....
<span class="meta">@app.route('/)</span>
<span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span>
    <span class="keyword">if</span>....:
       <span class="keyword">return</span> render_template(<span class="string">'...html'</span>)
    <span class="keyword">else</span>:
       <span class="comment">#不满足条件直接返回404错误</span>
       abort(<span class="number">404</span>)
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">         </span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  @app.errorhandler(404)</span><br><span class="line">  def func1(error):</span><br><span class="line">      return '404'</span><br><span class="line">  @app.errorhandler(500)</span><br><span class="line">  def func2(error):</span><br><span class="line">      return '500'</span><br></pre></td></tr></table></figure></code></pre>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><h3 id="context-processor"><a href="#context-processor" class="headerlink" title="context_processor"></a>context_processor</h3><ol>
<li>上下文声明专用</li>
<li>在声明的函数中直接返回要定义的上下文内容</li>
</ol>
<ul>
<li><pre><code class="python"><span class="meta">@app.context_processor</span>
<span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">()</span>:</span>
    <span class="keyword">return</span> {<span class="string">"current"</span>:<span class="string">""</span>}</code></pre>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask文件下载</title>
    <url>/Flask/Flask_id_12.html</url>
    <content><![CDATA[<h2 id="文件下载模块"><a href="#文件下载模块" class="headerlink" title="文件下载模块"></a>文件下载模块</h2><a id="more"></a>
<h2 id="send-file"><a href="#send-file" class="headerlink" title="send_file"></a>send_file</h2><h4 id="return-send-file-文件路径-as-attachment-True-cache-timeout-1"><a href="#return-send-file-文件路径-as-attachment-True-cache-timeout-1" class="headerlink" title="return send_file(文件路径,,==as_attachment=True==,==cache_timeout=1==)"></a>return send_file(文件路径,,==as_attachment=True==,==cache_timeout=1==)</h4>]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask中g定向</title>
    <url>/Flask/Flask_id_13.html</url>
    <content><![CDATA[<h2 id="g定向"><a href="#g定向" class="headerlink" title="g定向"></a>g定向</h2><a id="more"></a>
<ul>
<li><p>g定向使用</p>
<ul>
<li><pre><code class="python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,g

</code></pre>
</li>
</ul>
</li>
</ul>
<pre><code>app = Flask(__name__)

@app.route(&apos;/&apos;)
def func():
    g.username = &apos;root&apos;
    return &apos;hello world&apos;
```</code></pre><ul>
<li><p>g的声明方法和local相同</p>
</li>
<li><p>使用g定向声明过的变量在整个flask文件中通用,及如果你在app中调用了另一个外部文件的函数,在这个函数中你是可以直接传入g来使用你在app中声明的变量的</p>
</li>
<li><p>这样可以不传入参数</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask_wtf</title>
    <url>/Flask/Flask_id_08.html</url>
    <content><![CDATA[<h2 id="flask-wtf简介"><a href="#flask-wtf简介" class="headerlink" title="flask_wtf简介:"></a><em>flask_wtf简介:</em></h2><a id="more"></a>
<ul>
<li>​    flask_wtf模块下载安装<ul>
<li>pip install flask-wtf</li>
<li>使用命令行形式安装flask_wtf模块</li>
</ul>
</li>
</ul>
<hr>
<h2 id="flask-wtf实际使用"><a href="#flask-wtf实际使用" class="headerlink" title="flask_wtf实际使用:"></a>flask_wtf实际使用:</h2><ul>
<li><pre><code class="python"><span class="keyword">from</span> wtforms <span class="keyword">import</span> Form,StringField,PasswordField,SubmitField
<span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> EqualTo,Length
<span class="comment">#创建一个全新的form表单类,该类继承自Form</span>
<span class="class"><span class="keyword">class</span> <span class="title">RegistForm</span><span class="params">(Form)</span>:</span>
    <span class="comment">#username属性设定</span>
    username = StringField(validators=[Length(min=<span class="number">3</span>,max=<span class="number">8</span>)])
    <span class="comment">#password属性设定</span>
    password= PasswordField(validators=[Length(min=<span class="number">6</span>,max=<span class="number">10</span>)])
    <span class="comment">#EqalTo作用,添加EqualTo的字段必须与其参数的值相同,相当于绑定</span>
    password_1 = PasswordField(validators=[Length(min=<span class="number">6</span>,max=<span class="number">10</span>),EqualTo(<span class="string">'password'</span>)])
    sub = SubmitField()

app = Flask(__name__)

</code></pre>
</li>
</ul>
<p>  @app.route(‘/‘)<br>  def hello_world():<br>      return ‘Hello World!’<br>  #创建form表单提交页面<br>  @app.route(‘/regist’,methods=[‘GET’,’POST’])<br>  def regist():<br>      #判断请求方式并给出相应回复<br>      if request.method == ‘GET’:<br>          return render_template(‘regist.html’)<br>      else:<br>          #实例化表单类<br>          regist_form = RegistForm(request.form)<br>          #判断类中的validate是否正常,即验证是否通过<br>          #根据判定结果进行不同的返回情况<br>          if regist_form.validate():<br>              return ‘True’<br>          else:<br>              print(regist_form.errors())<br>              return “false”</p>
  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="REASONML"><figure class="iseeu highlight /reasonml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 在length函数中,可以添加一个新的参数,message,用来设定报错之后的</span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  username = <span class="constructor">StringField(<span class="params">validators</span>=[Length(<span class="params">min</span>=3,<span class="params">max</span>=8,<span class="params">message</span>='您所输入的账户名称不符合要求.请重新输入')</span>])</span><br></pre></td></tr></table></figure></div>

<ul>
<li>这个message所储存的参数将会体现在类的errors方法里面,可以通过直接输出来查看</li>
</ul>
<hr>
<h2 id="flask-wtf常用验证器"><a href="#flask-wtf常用验证器" class="headerlink" title="flask_wtf常用验证器:"></a>flask_wtf常用验证器:</h2><p>验证器导入方法:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> EqualTo</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> Length</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> NumberRange</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> Email</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> InputRequired</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> Regexp</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> URL</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> UUID</span><br></pre></td></tr></table></figure></div>



<ul>
<li><p>EqualTo           </p>
<ul>
<li>绑定另一个字段,使两个字段保持一致</li>
</ul>
</li>
<li><p>Length             </p>
<ul>
<li>限定内容长度,以及自定义报错提醒</li>
</ul>
</li>
<li><p>NumberRange   </p>
<ul>
<li>限定数字的大小所在区间,和length一样有max和min两个值限制,只有在这两个值之剑才满足</li>
</ul>
</li>
<li><p>Email               </p>
<ul>
<li>邮箱验证器,用于验证邮箱,不需要参数,内置了邮箱格式验证</li>
</ul>
</li>
<li><p>InputRequired  </p>
<ul>
<li>对输入的信息进行验证,有值即为True,没有则为false</li>
</ul>
</li>
<li><p>Regexp</p>
<ul>
<li>正则表达式,自动将输入的内容于Regexp的内容匹配对照</li>
</ul>
</li>
<li><p>URL</p>
<ul>
<li>验证输入的是否为正确的url地址</li>
</ul>
</li>
<li><p>UUID</p>
<ul>
<li><p>验证是否为UUID</p>
</li>
<li><p>UUID导入方法</p>
<ul>
<li><pre><code class="python">form uuid <span class="keyword">import</span> uuid4
print(uuid4())
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ELIXIR"><figure class="iseeu highlight /elixir"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"><span class="comment">## 自定义验证器:</span></span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">validate_</span></span>字段名 (<span class="keyword">self</span>,filed)<span class="symbol">:</span></span><br><span class="line">      <span class="comment">#通过这个方法定义的验证器,将会自行调用进行判断,</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>自定义验证器的名字为validate_加上要绑定的字段名</p>
</li>
<li><p>validate_字段名</p>
</li>
<li><p>需要设定一个形参,不限制</p>
</li>
</ul>
<hr>
<h2 id="flask-wtf常用字段"><a href="#flask-wtf常用字段" class="headerlink" title="flask_wtf常用字段:"></a>flask_wtf常用字段:</h2><ul>
<li><p>IntegerField</p>
<ul>
<li>整形字段,该输入框只支持输入数字类型</li>
<li>最终拿到的值也是整形,即int</li>
<li>同一属性的还有FloatField</li>
</ul>
</li>
<li><p>StringField</p>
<ul>
<li>字符串形式,该输入框支持输入字符串类型</li>
</ul>
</li>
<li><p>PasswordField</p>
<ul>
<li>密码字段,如果使用该字段创建表单,其生成的将会是密码输入框</li>
</ul>
</li>
<li><p>SubmitField</p>
<ul>
<li>此字段对应的是submit提交按钮</li>
</ul>
</li>
<li><p>BooleanField</p>
<ul>
<li>单选框模板</li>
</ul>
</li>
</ul>
<ul>
<li><p>FileField</p>
<ul>
<li>文件框</li>
</ul>
</li>
<li><p>SelectField</p>
<ul>
<li><p>下拉框</p>
</li>
<li><pre><code class="python">tags = SelecrField(<span class="string">'标签名'</span>,choices=[(<span class="string">'1'</span>,<span class="string">'python'</span>),(<span class="string">'2'</span>,<span class="string">'ios'</span>)])</code></pre>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask_sqlalchemy</title>
    <url>/Flask/Flask_id_07.html</url>
    <content><![CDATA[<h2 id="flask-sqlalchemy"><a href="#flask-sqlalchemy" class="headerlink" title="flask_sqlalchemy"></a>flask_sqlalchemy</h2><a id="more"></a>


<h2 id="创建flask数据库链接"><a href="#创建flask数据库链接" class="headerlink" title="创建flask数据库链接"></a>创建flask数据库链接</h2><hr>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLALchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.comfig[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">'mysql+mysqlconnector://root:password@localhost:port/database'</span></span><br><span class="line">db = SQLALchemy(app)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'person'</span></span><br><span class="line">    id = db.COlumn(db.Integer,primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">100</span>))</span><br><span class="line">db.drop_all()</span><br><span class="line">db.create_all()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello world!'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ = <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></div>



<hr>
<h2 id="关于导包"><a href="#关于导包" class="headerlink" title="关于导包:"></a>关于导包:</h2><ul>
<li>flask_sqlalchemy中把sqlalchemy的所有模块整合到了一起,所以不需要像原生sqlalchemy一样导入一大堆模块,在这一方面做的比原生SQL alchemy好得多</li>
</ul>
<hr>
<h2 id="关于分页查询"><a href="#关于分页查询" class="headerlink" title="关于分页查询:"></a>关于分页查询:</h2><h2 id="paginate"><a href="#paginate" class="headerlink" title="paginate"></a><u>paginate</u></h2><p>per_page:设定每页展示的数据</p>
<p>page:当前的页数</p>
<p>has_prve:判断是否具有上一页</p>
<p>has_next:判断是否具有下一页</p>
<p>prve_num:上一页的页码</p>
<p>next_num:下一页的页码</p>
<p>iter_pages: 所有页码,可遍历</p>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask_session</title>
    <url>/Flask/Flask_id_06.html</url>
    <content><![CDATA[<h2 id="cookie创建"><a href="#cookie创建" class="headerlink" title="cookie创建:"></a>cookie创建:</h2><a id="more"></a>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line">res = Response(<span class="string">'示例'</span>)</span><br><span class="line"></span><br><span class="line">res.set_cookie(<span class="string">'username'</span>,<span class="string">'root'</span>,</span><br><span class="line">               max_age=<span class="number">60</span>,</span><br><span class="line">               expires=datetime(year,month,day,hour,minute,second),</span><br><span class="line">              domain=<span class="string">'.fcg.com'</span>)</span><br><span class="line"><span class="comment">#创建cookie时需要导入以下几项,</span></span><br><span class="line"><span class="comment">#	1.cookies名字 + cookies值 (必传)</span></span><br><span class="line"><span class="comment">#	2.max_age从当前开始计算的过期时间,单位为秒,不添加的时候默认过期时间为关闭浏览器过期</span></span><br><span class="line"><span class="comment">#	3.expires设定过期时间,以格林尼治标准时间计算,换算到北京时间需要减八,这个参数如果设置的话,需要传入六个参数分别是--(year,month,day,hour,minute,second)</span></span><br><span class="line"><span class="comment">#	4.domain设定cookie作用范围,在主域名前面加上.即为将此cookie应用于所有子域名</span></span><br><span class="line"><span class="comment">#	5.设定作用范围,需要先绑定好主域名和子域名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#cookie删除</span></span><br><span class="line">res = Response(<span class="string">'删除'</span>)</span><br><span class="line">res.delete_cookie(<span class="string">'username'</span>)</span><br></pre></td></tr></table></figure></div>

<hr>
<h2 id="session创建"><a href="#session创建" class="headerlink" title="session创建:"></a>session创建:</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#创建并设置session.cookie</span></span><br><span class="line">    session[<span class="string">'username'</span>] = <span class="string">'123'</span></span><br><span class="line">    <span class="comment">#设定session过期时间</span></span><br><span class="line">    session.permanent=<span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello world'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#session.permanent默认为一个月</span></span><br><span class="line"><span class="comment">#可以通过设定修改,</span></span><br><span class="line"><span class="comment">#app.config['PERMANENT_SESSION_LIFETIME'] = timedelta(剩余过期的时间)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#session删除</span></span><br><span class="line">session.pop(<span class="string">'username'</span>)</span><br><span class="line"><span class="comment">#相当于字典删除</span></span><br><span class="line">session.clear()</span><br><span class="line"><span class="comment">#将session中储存的数据全部清空</span></span><br><span class="line"><span class="keyword">del</span> session[key]</span><br></pre></td></tr></table></figure></div>

<hr>
<h2 id="请求函数的装饰器使用方法"><a href="#请求函数的装饰器使用方法" class="headerlink" title="*请求函数的装饰器使用方法*:"></a><strong>*<u>请求函数的装饰器使用方法</u>*:</strong></h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">decorators</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>设置请求函数过滤用装饰器</p>
</li>
<li><pre><code class="python"><span class="comment">#从functools 中导入模块wraps</span>
<span class="keyword">from</span> functools <span class="keyword">import</span> wraps

<span class="keyword">from</span> flask <span class="keyword">import</span> session,redirect,url_for
<span class="function"><span class="keyword">def</span> <span class="title">login_required</span><span class="params">(func)</span>:</span>
    <span class="comment">#设定从functools里面导入的装饰器,此装饰器的参数为外部函数传入的值</span>
<span class="meta">    @wraps(func)</span>
    <span class="comment">#定义内层函数,该内从函数中执行运算与判定</span>
    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span>
        <span class="comment">#获取session</span>
        username = session.get(<span class="string">'username'</span>)
        <span class="comment">#判断是否存在session</span>
        <span class="keyword">if</span> username:
            <span class="comment">#存在session时,正常调用外层函数传入的func参数</span>
            <span class="keyword">return</span> func(*args,**kwargs)
        <span class="keyword">else</span>:
            <span class="comment">#当session中不存在对应的cookie时,重定向当前网址到登陆界面</span>
            <span class="keyword">return</span> redirect(url_for(<span class="string">'login'</span>))

    <span class="comment">#正常的闭包函数用法,返回内层函数的引用</span>
    <span class="keyword">return</span> wrapper</code></pre>
</li>
</ul>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask中app上下文机制</title>
    <url>/Flask/Flask_id_01.html</url>
    <content><![CDATA[<h2 id="app上下文"><a href="#app上下文" class="headerlink" title="app上下文"></a>app上下文</h2><a id="more"></a>
<p>应用上下文和请求上下文都是存放到一个’LocalStack’的栈中</p>
<p>和应用app相关的操作就必须用到应用上下文,比如通过current_app获取当前这个app</p>
<p>和请求相关的操作就必须用到请求上下文,比如url_for反转视图函数</p>
<p>视图函数中不需要考虑上下文的问题</p>
<hr>
<h3 id="应用上下文"><a href="#应用上下文" class="headerlink" title="应用上下文:"></a>应用上下文:</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> current_app</span><br><span class="line"><span class="comment">#current_app模块的作用是获取当前文件的栈</span></span><br><span class="line"><span class="comment">#使用的方法</span></span><br><span class="line"></span><br><span class="line">current_app.name</span><br><span class="line"><span class="comment">#获取当前文件的名字</span></span><br><span class="line"><span class="comment">#此选项需要在路由函数中才能使用</span></span><br><span class="line"><span class="comment">#在路由函数外直接使用将会报错</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><h5 id="手动推入应用上下文"><a href="#手动推入应用上下文" class="headerlink" title="手动推入应用上下文:"></a>手动推入应用上下文:</h5><ul>
<li><p>第一种方法:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在路由函数外调用current_app模块</span></span><br><span class="line"><span class="comment">#需要先设定好应用上下文</span></span><br><span class="line">app.context = app.app_context()</span><br><span class="line">app.context.push()</span><br><span class="line">print(current_app.name)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>第二种方法:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> app.app_context():</span><br><span class="line">	print(corrent_app.name)</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
</li>
</ul>
<hr>
<h3 id="请求上下文"><a href="#请求上下文" class="headerlink" title="请求上下文:"></a>请求上下文:</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#请求上下文最常见的一个是url_for</span></span><br><span class="line"><span class="comment">#在视图函数中</span></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#查看url_for打印出来的路由地址</span></span><br><span class="line">    print(url_for(<span class="string">'func1'</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello world'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/test/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello user'</span></span><br><span class="line"></span><br><span class="line">print(url_for(<span class="string">'func1'</span>))</span><br><span class="line"><span class="comment">#在路由函数外直接调用url_for 查看路由地址将会报错,原因是请求上下文问题</span></span><br><span class="line"><span class="comment">#此问题无法使用应用上下文的方法解决</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><h5 id="手动推入请求上下文"><a href="#手动推入请求上下文" class="headerlink" title="手动推入请求上下文:"></a>手动推入请求上下文:</h5><ul>
<li><p>​    </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在路由函数之外调用</span></span><br><span class="line"><span class="keyword">with</span> app.test_requert_context():</span><br><span class="line">    print(url_for(<span class="string">'func1'</span>))</span><br><span class="line"><span class="comment">#注意,test_request_context这个函数会在推送请求上下文之前先检查有没有应用上下文,如果没有,将会先推送一个应用上下文过来,在推送一个请求上下文,也就是说,在一定程度上等同于app_context的加强版</span></span><br></pre></td></tr></table></figure></div>

</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask信号机制</title>
    <url>/Flask/Flask_id_16.html</url>
    <content><![CDATA[<h2 id="flask信号"><a href="#flask信号" class="headerlink" title="flask信号"></a>flask信号</h2><a id="more"></a>
<h3 id="信号使用详解"><a href="#信号使用详解" class="headerlink" title="信号使用详解:"></a>信号使用详解:</h3><ul>
<li><p>信号使用分为三步</p>
</li>
<li><p>定义信号</p>
<ul>
<li><pre><code class="python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask
<span class="keyword">from</span> signal <span class="keyword">import</span> visit_signal

app = Flask(__name__)

<span class="meta">@app.route('/')</span>
<span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span>
    username = request.args.get(<span class="string">'username'</span>)
    <span class="keyword">if</span> username:
        g.user = username
        visit_signal.send()
    <span class="keyword">else</span>:
        <span class="keyword">return</span> <span class="string">'hello world'</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  <span class="keyword">from</span> blinker <span class="keyword">import</span> Namespace</span><br><span class="line">  my_pace = Namepace()</span><br><span class="line">  visit_signal = my_pace.signal(<span class="string">'visit-signal'</span>)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(sender)</span>:</span></span><br><span class="line">      <span class="keyword">from</span> flask <span class="keyword">import</span> g</span><br><span class="line">      print(g.user)</span><br><span class="line">  visit_signal.connect(func)</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
<li><p>监听信号</p>
<ul>
<li><pre><code class="python">visit_signal.send()
<span class="comment">#设置监听</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"><span class="section">### flask自带的信号机制:</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### 		模板渲染时传出的信号:</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span><span class="code">```</span>python</span><br><span class="line">  #正常信号监听</span><br><span class="line">  from flask import Flask,render<span class="emphasis">_template,template_</span>rendered</span><br><span class="line">  app = Flask(<span class="strong">__name__</span>)</span><br><span class="line">  <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line">  #其一</span><br><span class="line">  def template<span class="emphasis">_rendered_</span>func(sender,template,context):</span><br><span class="line"><span class="code">      print('sender:',sender)</span></span><br><span class="line"><span class="code">      print('template:',template)</span></span><br><span class="line"><span class="code">      print('context',context)</span></span><br><span class="line">  template<span class="emphasis">_randered.context(template_</span>rendered_func)</span><br><span class="line">  <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line">  @app.route('/')</span><br><span class="line">  def func1():</span><br><span class="line"><span class="code">      return render_template('index.html')</span></span><br></pre></td></tr></table></figure></div>


</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><pre><code class="python"><span class="comment">#异常信号监听</span>
<span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template,template_rendered,got_request_exception
app = Flask(__name__)
***********************************************************
<span class="comment">#其二  </span>
<span class="function"><span class="keyword">def</span> <span class="title">request_exception_log</span><span class="params">(sender,*args,**kwargs)</span>:</span>
    print(sender)
    print(args)
    print(kwargs)
got_request_exception.connect(request_exception_log)
***********************************************************
<span class="meta">@app.route('/')</span>
<span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span>
    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</code></pre>
</li>
</ul>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask分页</title>
    <url>/Flask/Flask_id_15.html</url>
    <content><![CDATA[<h2 id="flask-分页"><a href="#flask-分页" class="headerlink" title="flask 分页"></a>flask 分页</h2><a id="more"></a>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> goods.has_prev %&#125;</span><br><span class="line">    &lt;a href="/show?page=&#123;&#123; goods.prev_num &#125;&#125;"&gt;上一页&lt;/a&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% <span class="keyword">for</span> foo <span class="keyword">in</span> goods.iter_pages() %&#125;</span><br><span class="line">    &lt;a href="/show?page=&#123;&#123; foo &#125;&#125;"&gt;&#123;&#123; foo &#125;&#125;&lt;/a&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> goods.has_next %&#125;</span><br><span class="line">    &lt;a href="/show?page=&#123;&#123; goods.next_num &#125;&#125;"&gt;下一页&lt;/a&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route('/show/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    page = int(request.args.get(<span class="string">'page'</span>,<span class="number">1</span>))</span><br><span class="line">    goods = GOOds.query.paginate(page,per_page=<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># app_list = app_sql.session.query(app_sql.Subordinate_forces).offset(num * 10).limit(10).all()</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'show.html'</span>,goods=goods)</span><br></pre></td></tr></table></figure></div>





<p>下载判断</p>
<p>@page.route(“/goodsdown”)<br>def download():<br>    goodslist = Goods.query.all()<br>    data = []<br>    for goods in goodslist:<br>        temp = {}<br>        temp[“id”] = goods.id<br>        temp[“name”] = goods.name<br>        temp[“price”] = goods.price<br>        temp[“img”] = goods.img</p>
<pre><code>    data.append(temp)


# 每次下载 向数据库中写入count
count = Count.query.first()


print(&quot;count&quot;, count)
if not count:
    count = Count(count=1)
    db.session.add(count)
    db.session.commit()
else:
    count.count += 1
    db.session.commit()


with open(&quot;static/data.json&quot;, &quot;w&quot;) as f:
    jstr = json.dumps(data, ensure_ascii=False)
    f.write(jstr)


return send_file(&quot;static/data.json&quot;, as_attachment=True, cache_timeout=1)</code></pre>]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask数据库迁移</title>
    <url>/Flask/Flask_id_10.html</url>
    <content><![CDATA[<h2 id="flask数据库迁移"><a href="#flask数据库迁移" class="headerlink" title="flask数据库迁移"></a><code>flask</code>数据库迁移</h2><a id="more"></a>
<hr>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm.orm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.dialects.mysql <span class="keyword">import</span> LONGTEXT,DECIMAL,DATETIME</span><br><span class="line"></span><br><span class="line">Host = <span class="string">'127.0.0.1'</span></span><br><span class="line">Port = <span class="string">'3306'</span></span><br><span class="line">User = <span class="string">'root'</span></span><br><span class="line">Password = <span class="string">'000000'</span></span><br><span class="line">Database = 要使用的数据库名称</span><br><span class="line">DB_URI = <span class="string">'mysql+mysqlconnector://&#123;user&#125;:&#123;password&#125;@&#123;host&#125;:&#123;port&#125;/&#123;database&#125;'</span>.format(user=User,password=Password,host=Host,port=Port,database=Database)</span><br><span class="line">engine = create_engine(DB_URI)</span><br><span class="line">Base = declarative_base(engine)</span><br><span class="line">session = sessionmaker(engine)()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'person'</span></span><br><span class="line">    id = Column(Integer,primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">100</span>))</span><br><span class="line">Base.metadata.drop_all()</span><br><span class="line">Base.metadata.create_all()</span><br></pre></td></tr></table></figure></div>

<p>创建一个模型</p>
<hr>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="EBNF"><figure class="iseeu highlight /ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">alembic init alembic</span></span><br></pre></td></tr></table></figure></div>

<p>创建新的alembic文件(此操作在命令提示符中完成)</p>
<hr>
<p>修改alembic文件内容</p>
<ul>
<li>打开alembic.ini文件<ul>
<li>修改<strong>*<u>sqlalchemy.url</strong></u>*为:</li>
</ul>
</li>
</ul>
<p>​        </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="INI"><figure class="iseeu highlight /ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">sqlalchemy.url</span> = <span class="string">'mysql+mysqlconnector://root:password@localhost:port/database'</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>打开alembic文件夹</li>
</ul>
<ul>
<li><p>打开env.py文件</p>
<ul>
<li><p>在其中添加以下代码</p>
</li>
<li><pre><code class="python"><span class="keyword">import</span> sys,os
<span class="keyword">import</span> app
sys.path.append(os.path.dirname(os.path.dirname(__file__)))
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 修改文件代码</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    #修改前</span><br><span class="line">    target_metadata = None</span><br><span class="line">    #修改后</span><br><span class="line">    target_metadata = app.Base.metadata</span><br></pre></td></tr></table></figure>

------
</code></pre>
</li>
</ul>
</li>
</ul>
<hr>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">*alembic revision --autogenerate -m 'first commit'</span><br><span class="line">创建新的迁移脚本(此操作在命令提示符中完成)</span><br><span class="line">alembic revision --autogenerate -m 'add age column'</span><br><span class="line">更新迁移脚本(此操作在命令提示符中完成)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="alembic-upgrade-head"><a href="#alembic-upgrade-head" class="headerlink" title="alembic upgrade head"></a><u><strong><em>alembic upgrade head</em></strong></u></h4><p>数据库迁移开启(此操作在命令提示符中完成)</p>
<hr>
<h3 id="alembic常用字段"><a href="#alembic常用字段" class="headerlink" title="alembic常用字段"></a><strong><u>alembic常用字段</u></strong></h3><ul>
<li>​    init<ul>
<li>新建一个仓库</li>
</ul>
</li>
<li>revision<ul>
<li>创建一个新的版本文件</li>
</ul>
</li>
<li>–autogenerate<ul>
<li>自动将当前模型的修改,生成迁移文件</li>
</ul>
</li>
<li>–m<ul>
<li>本次迁移做了哪些修改,可以通过指定这个参数,进行回顾</li>
</ul>
</li>
<li>upgeade<ul>
<li>将置定版本的迁移文件映射到数据库之中,如果有多个迁移文件没有映射,那么会执行多个迁移脚本</li>
</ul>
</li>
<li>[head]<ul>
<li>代表最新的迁移脚本的版本号</li>
<li>一般指向最新版</li>
</ul>
</li>
<li>‘first commit’ <ul>
<li>生成第一个迁移脚本时的映射参数</li>
</ul>
</li>
<li>add age column<ul>
<li>修改数据库时使用的映射参数</li>
</ul>
</li>
<li>history<ul>
<li>列出所有的迁移版本及其信息</li>
<li>alembic history  (展示所有的版本更新的版本号)</li>
</ul>
</li>
<li>heads<ul>
<li>展示head指向的脚本文件的版本号</li>
<li>这个版本号通常为正在使用的版本号</li>
</ul>
</li>
<li>downgrade<ul>
<li>执行指定版本迁移文件中的downgrade函数</li>
<li>与upgrade对应,使用方法为<ul>
<li>alembic downgrade 版本号</li>
<li>版本号可以在文件中查看,即为对应迁移文件中的revision的值</li>
</ul>
</li>
</ul>
</li>
<li>current<ul>
<li>展示当前数据库中的版本号</li>
<li>使用方法<ul>
<li>在数据库中会生成一个额外的表,alem_version ,这个表中存储着当前的版本号</li>
<li>在命令提示符中输入<ul>
<li>alembic current 会得到当前正在使用的版本号</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="alembic在flask中的使用"><a href="#alembic在flask中的使用" class="headerlink" title="*alembic在flask中的使用*"></a><strong>*<u>alembic在flask中的使用*</u></strong></h2><ul>
<li><p>前期操作方法相同</p>
</li>
<li><p>在创建好仓库时,按照以下步骤设定</p>
<ul>
<li><p>找到alembic.ini文件</p>
</li>
<li><p><img src="C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572849457816.png" alt="1572849457816"></p>
</li>
<li><p>修改其中的sqlalchemy_uri的值为要使用的数据库链接</p>
</li>
<li><p>找到alembic文件夹下的env.py</p>
</li>
<li><p>在其中进行如下操作</p>
</li>
<li><pre><code class="python"><span class="keyword">import</span> sys,os
sys.path.append(os.path.dirname(os.path.dirname(__file__)))
<span class="keyword">import</span> app
*
target_metadata = app.db.Model.metadata</code></pre>
</li>
</ul>
</li>
<li><p>之后的操作和之前并无差别</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask文件上传</title>
    <url>/Flask/Flask_id_14.html</url>
    <content><![CDATA[<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传:"></a>文件上传:</h2><a id="more"></a>
<ul>
<li><pre><code class="python"><span class="comment">#导入必须的模块包</span>
<span class="keyword">from</span> wtform <span class="keyword">import</span> Form,StringField,PasswordField,SubmitField,BooleanField,FileField,SelectField
<span class="comment">#导入验证器包</span>
<span class="keyword">from</span> wtform.validators <span class="keyword">import</span> EqualTo,Length,UUID,URL,ValidatorsError,InputRequired,Email
<span class="comment">#从flask_wtf中导入file.FileRequired(是否为空验证)和file.FileAllowed(验证是否符合要求的格式,格式要求的范围作为参数进行传递,切记传入的参数必须为一个列表)</span>
<span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template,send_from_directory
<span class="keyword">from</span> werkzeug.datastructures <span class="keyword">import</span> CombinedMultiDict

<span class="keyword">from</span> flask_wtf.file <span class="keyword">import</span> FileRequired,FileAllowed
<span class="comment">#导入文件名过滤包</span>
<span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename
<span class="keyword">import</span> os

</code></pre>
</li>
</ul>
<p>  app = Flask(<strong>name</strong>)</p>
<p>  upload_url = os.path.join(os.path.dirname(<strong>file</strong>),’image’)</p>
<p>  class userForm(Form):<br>      #创建文件上传约束<br>      avater = FileField(validators=[FileRequired(),FileAllowed([‘jpg’,’png’,’gif’])])</p>
<p>  @app.route(‘/‘,methods=[‘GET’,’POST’])<br>  dedf func():<br>      if request.method == ‘GET’:<br>          return render_template(‘add.html’)<br>      else:<br>          #使用ConbinedMultiDict模块对传输的两个不同的值进行合并,一起传入wtf文件传输判定中进行验证<br>          userform = userForm(CombinedMultiDict([request.form,request.files]))<br>          if userform.validate():<br>              avater = userform.avater.data<br>              filename = secure_filename(avater.filename)<br>              avater.save(os.path.join(upload_url,filename))<br>              return ‘上传成功’</p>
<pre><code></code></pre>]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask_script</title>
    <url>/Flask/Flask_id_05.html</url>
    <content><![CDATA[<h2 id="flask-script"><a href="#flask-script" class="headerlink" title="*flask_script*"></a><strong>*<u>flask_script*</u></strong></h2><h2 id="flask-script安装"><a href="#flask-script安装" class="headerlink" title="flask_script安装:"></a>flask_script安装:</h2><a id="more"></a>

<ol>
<li><p>​    安装方法</p>
<ol>
<li><pre><code>pip install flask-script
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"><span class="comment">## flask_script初次使用:</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> ```python</span><br><span class="line">   <span class="keyword">from</span> flask_script <span class="keyword">import</span> Manage</span><br><span class="line">   <span class="keyword">from</span> app <span class="keyword">import</span> app</span><br><span class="line">   manage = Manage(app)</span><br><span class="line"><span class="meta">   @manage.command</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">       print(<span class="string">'hello world'</span>)</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">   <span class="comment">#最简单的flask_script创建</span></span><br><span class="line">   <span class="comment">#无参数</span></span><br></pre></td></tr></table></figure></div></code></pre></li>
</ol>
</li>
<li><pre><code class="python"><span class="meta">@manage.option('-u','--username',dest='')</span>
<span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(username)</span>:</span>
    print(<span class="string">"你输入的账号为%s"</span>%username)

<span class="comment">#有参数</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AUTOIT"><figure class="iseeu highlight /autoit"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">3.</span> 进入命令提示符,进入代码所在的文件夹</span><br><span class="line"></span><br><span class="line">   <span class="number">1.</span> ```python</span><br><span class="line">      python (文件名称) <span class="function"><span class="keyword">func</span></span></span><br><span class="line">      </span><br><span class="line">      <span class="meta">#无参数</span></span><br></pre></td></tr></table></figure></div>

<span class="number">2.</span> ```python
   python (文件名称) func -u <span class="string">"root"</span>

   <span class="comment">#有参数</span>
   <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"><span class="comment">## flask_script进阶操作:</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 额外创建一个script文件</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 在文件中引入要集成的文件</span><br><span class="line"></span><br><span class="line">   <span class="number">1.</span> ```python</span><br><span class="line">      <span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager</span><br><span class="line">      <span class="keyword">from</span> app <span class="keyword">import</span> app,db,Person</span><br><span class="line">      </span><br><span class="line">      db_script = Manager()</span><br><span class="line"><span class="meta">      @db_script.command</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">          print(<span class="string">'仓库创建成功'</span>)</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line"><span class="meta">      @db_script.command</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">          print(<span class="string">'数据迁移成功'</span>)</span><br><span class="line">      </span><br><span class="line"><span class="meta">      @db_script.command</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">func3</span><span class="params">()</span>:</span></span><br><span class="line">          print(<span class="string">'数据映射成功'</span>)</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>在主文件中注册附属的script文件</p>
<ol>
<li><pre><code class="python"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager
<span class="keyword">from</span> app <span class="keyword">import</span> app,db,Person
<span class="keyword">from</span> db_script <span class="keyword">import</span> db_script
manager = Manager(app)
manager.add_command(<span class="string">'db'</span>,db_script)
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="VIM"><figure class="iseeu highlight /vim"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">4</span>. 在命令提示符中使用</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>. ```<span class="keyword">python</span></span><br><span class="line">      <span class="keyword">python</span> 文件名 db func1</span><br><span class="line">      <span class="keyword">python</span> 文件名 db func2</span><br><span class="line">      <span class="keyword">python</span> 文件名 db func3</span><br></pre></td></tr></table></figure></div>


</code></pre>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask_migrate</title>
    <url>/Flask/Flask_id_03.html</url>
    <content><![CDATA[<h2 id="flask-migrate"><a href="#flask-migrate" class="headerlink" title="*flask_migrate*"></a><strong>*<u>flask_migrate*</u></strong></h2><hr>
<h2 id="flask-migrate初试"><a href="#flask-migrate初试" class="headerlink" title="flask_migrate初试:"></a>flask_migrate初试:</h2><a id="more"></a>
<ul>
<li><p>模块导入</p>
<ul>
<li><pre><code class="python"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span>  Migrate,MigrateCommand
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CLEAN"><figure class="iseeu highlight /clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  - Migrate用于migrate对象实例化通过app以及db来构筑完整的migrate</span><br><span class="line"></span><br><span class="line">  - MigrateCommand是一个对象,其中封存着要使用的command对象(此对象使用方法等同于flask_script的构筑方法)</span><br><span class="line"></span><br><span class="line">  - 此处还可以导入flask_script模块</span><br><span class="line"></span><br><span class="line">- 具体实现步骤</span><br><span class="line"></span><br><span class="line">  - migrate文件内的构造</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    #导入flask_script模块</span><br><span class="line">    <span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager</span><br><span class="line">    #导入flask_migrate模块</span><br><span class="line">    <span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate,MigrateCommand</span><br><span class="line">    #导入app</span><br><span class="line">    <span class="keyword">from</span> app <span class="keyword">import</span> app</span><br><span class="line">    #导入数据库链接实例db</span><br><span class="line">    <span class="keyword">from</span> exts <span class="keyword">import</span> db</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    #实例化manager对象</span><br><span class="line">    manager = Manager(app)</span><br><span class="line">    #开始创建app与数据库连接</span><br><span class="line">    Migrate(app,db)</span><br><span class="line">    #在创建好的对象中添加script子命令</span><br><span class="line">    manager.add_command(<span class="string">'db'</span>,MigrateCommand)</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>exts文件中的构造</p>
</li>
<li><pre><code class="python"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLALchemy

db.SQLALchemy()
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- app文件中的构造</span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  <span class="keyword">from</span> flask import Flask</span><br><span class="line">  <span class="keyword">from</span> exts import db</span><br><span class="line">  import config</span><br><span class="line">  app = Flask(__name__)</span><br><span class="line">  app.config.from_object(config)</span><br><span class="line">  db.init_app(app)</span><br><span class="line">  @app.route(<span class="string">'/'</span>)</span><br><span class="line">  def hello_world():</span><br><span class="line">      return <span class="string">'Hello World!'</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">      app.<span class="builtin-name">run</span>()</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>models文件中的构造</p>
</li>
<li><pre><code class="python"><span class="keyword">from</span> exts <span class="keyword">import</span> db
<span class="class"><span class="keyword">class</span> <span class="title">person</span><span class="params">(db.Model)</span>:</span>
    __tablename__ = <span class="string">'person'</span>
    id = db.column(db.Integer,primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>)
    name = db.Column(db.String(<span class="number">100</span>))
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"><span class="section">## flask_migrate在命令行中的使用:</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>进入文件夹,打开命令窗口</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span><span class="code">```</span>python</span><br><span class="line">  python 文件名 db(子命令名称) init</span><br><span class="line">  #创建一个migrations文件夹</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
<li><p>创建一个迁移文件</p>
</li>
<li><pre><code class="python">python 文件名 db(子命令名称) migrate
<span class="comment">########################################</span>
<span class="comment">#注意,这里有一个坑,如果在创建migrate文件的时候,没有传入你的models文件中的表(类)</span>
<span class="comment">#那么将会出现无法找到表的情况</span>
<span class="comment">#具体表现形式为</span>
<span class="string">"""</span>
<span class="string">INFO  [alembic.runtime.migration] Context impl MySQLImpl.</span>
<span class="string">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</span>
<span class="string">INFO  [alembic.env] No changes in schema detected.</span>
<span class="string">"""</span>
<span class="comment">#在这种情况下,需要在migrate中导入表</span>
form models <span class="keyword">import</span> Person
<span class="comment">########################################</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 将创建好的迁移文件映射到数据库中</span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  python 文件名 db(子命令名) upgrade</span><br><span class="line">  #完成数据库映射</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>python 文件名 db(子命令名) downgrade</p>
</li>
<li><p>python 文件名 db(子命令名) head</p>
</li>
<li><p>python 文件名 db(子命令名) history</p>
</li>
</ul>
<p>基本上所有的方法对应着flask_alembic中的方法</p>
<p>可以使用 –help方法查看可以使用的全部方法</p>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask开端</title>
    <url>/Flask/Flask_id_02.html</url>
    <content><![CDATA[<h2 id="—————————–flask开端——————————–"><a href="#—————————–flask开端——————————–" class="headerlink" title="—————————–flask开端——————————–"></a>—————————–flask开端——————————–</h2><hr>
<h2 id="flask安装"><a href="#flask安装" class="headerlink" title="flask安装:"></a>flask安装:</h2><a id="more"></a>
<ul>
<li>​    pip install flask     在命令提示符中输入pip指令进行安装</li>
<li>​        使用pycharm安装flask</li>
</ul>
<hr>
<h2 id="flask使用"><a href="#flask使用" class="headerlink" title="flask使用:"></a>flask使用:</h2><ul>
<li><p>​    初次创建flask工程</p>
<ul>
<li><pre><code class="python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask

app = Flask(__name__)

</code></pre>
</li>
</ul>
</li>
</ul>
<pre><code>@app.route(&apos;/&apos;)
def hello_world():
    return &apos;hello world!&apos;

if __name__ = &apos;__main__&apos;:
    app.run(debug=True)
```</code></pre><ul>
<li>注意,在2018之后版本的pycharm中,设定debug=true并不能开启debug模式,想要开启debug模式需要在pycharm中进行设定</li>
</ul>
<ul>
<li>点击运行按钮左边的选项,在台出的页面中选择edit configurations</li>
<li>进入后勾选FLASK_DEBUG</li>
</ul>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>flask_route</title>
    <url>/Flask/Flask_id_04.html</url>
    <content><![CDATA[<h2 id="flask-route"><a href="#flask-route" class="headerlink" title="*flask_route*"></a><strong>*<u>flask_route*</u></strong></h2><a id="more"></a>
<ul>
<li><p>创建app主体</p>
<ul>
<li><pre><code class="python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask
app = Flask(__name__)
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">- </span>绑定路由</span><br><span class="line"></span><br><span class="line"><span class="bullet">  - </span><span class="code">```</span>python</span><br><span class="line"><span class="code">    @app.route('/')</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><pre><code class="python"><span class="meta">@app.route('/',methods=['GET','PORT'])</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  - 绑定路由时,如果不设定methods方法,将会默认为get方法,这种情况下,其他方法无法访问</span><br><span class="line"></span><br><span class="line">- 设定路由的执行函数</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'hello world!'</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>路由的执行函数通过return来实现,在不返回HTML页面的情况下,可以将要返回的数值直接返回,但是只能返回字符串类型</p>
</li>
</ul>
</li>
<li><p>在设定玩路由之后,只需要开辟一个程序入口进行运行,就构成了一个完整的flask</p>
<ul>
<li><pre><code class="python"><span class="keyword">if</span> __name__ = <span class="string">'__main'</span>:
    app.run(debug=<span class="literal">True</span>)</code></pre>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>DRF自定义错误捕获</title>
    <url>/Django/Django_id_10.html</url>
    <content><![CDATA[<h2 id="自定义错误捕获"><a href="#自定义错误捕获" class="headerlink" title="自定义错误捕获:"></a>自定义错误捕获:</h2><a id="more"></a>
<p>在drf和django框架中,仅仅内置了一些常见的错误捕获,如:</p>
<ul>
<li><p>​    </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">HTTP_100_CONTINUE = <span class="number">100</span></span><br><span class="line">HTTP_101_SWITCHING_PROTOCOLS = <span class="number">101</span></span><br><span class="line">HTTP_200_OK = <span class="number">200</span></span><br><span class="line">HTTP_201_CREATED = <span class="number">201</span></span><br><span class="line">HTTP_202_ACCEPTED = <span class="number">202</span></span><br><span class="line">HTTP_203_NON_AUTHORITATIVE_INFORMATION = <span class="number">203</span></span><br><span class="line">HTTP_204_NO_CONTENT = <span class="number">204</span></span><br><span class="line">HTTP_205_RESET_CONTENT = <span class="number">205</span></span><br><span class="line">HTTP_206_PARTIAL_CONTENT = <span class="number">206</span></span><br><span class="line">HTTP_207_MULTI_STATUS = <span class="number">207</span></span><br><span class="line">HTTP_208_ALREADY_REPORTED = <span class="number">208</span></span><br><span class="line">HTTP_226_IM_USED = <span class="number">226</span></span><br><span class="line">HTTP_300_MULTIPLE_CHOICES = <span class="number">300</span></span><br><span class="line">HTTP_301_MOVED_PERMANENTLY = <span class="number">301</span></span><br><span class="line">HTTP_302_FOUND = <span class="number">302</span></span><br><span class="line">HTTP_303_SEE_OTHER = <span class="number">303</span></span><br><span class="line">HTTP_304_NOT_MODIFIED = <span class="number">304</span></span><br><span class="line">HTTP_305_USE_PROXY = <span class="number">305</span></span><br><span class="line">HTTP_306_RESERVED = <span class="number">306</span></span><br><span class="line">HTTP_307_TEMPORARY_REDIRECT = <span class="number">307</span></span><br><span class="line">HTTP_308_PERMANENT_REDIRECT = <span class="number">308</span></span><br><span class="line">HTTP_400_BAD_REQUEST = <span class="number">400</span></span><br><span class="line">HTTP_401_UNAUTHORIZED = <span class="number">401</span></span><br><span class="line">HTTP_402_PAYMENT_REQUIRED = <span class="number">402</span></span><br><span class="line">HTTP_403_FORBIDDEN = <span class="number">403</span></span><br><span class="line">HTTP_404_NOT_FOUND = <span class="number">404</span></span><br><span class="line">HTTP_405_METHOD_NOT_ALLOWED = <span class="number">405</span></span><br><span class="line">HTTP_406_NOT_ACCEPTABLE = <span class="number">406</span></span><br><span class="line">HTTP_407_PROXY_AUTHENTICATION_REQUIRED = <span class="number">407</span></span><br><span class="line">HTTP_408_REQUEST_TIMEOUT = <span class="number">408</span></span><br><span class="line">HTTP_409_CONFLICT = <span class="number">409</span></span><br><span class="line">HTTP_410_GONE = <span class="number">410</span></span><br><span class="line">HTTP_411_LENGTH_REQUIRED = <span class="number">411</span></span><br><span class="line">HTTP_412_PRECONDITION_FAILED = <span class="number">412</span></span><br><span class="line">HTTP_413_REQUEST_ENTITY_TOO_LARGE = <span class="number">413</span></span><br><span class="line">HTTP_414_REQUEST_URI_TOO_LONG = <span class="number">414</span></span><br><span class="line">HTTP_415_UNSUPPORTED_MEDIA_TYPE = <span class="number">415</span></span><br><span class="line">HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE = <span class="number">416</span></span><br><span class="line">HTTP_417_EXPECTATION_FAILED = <span class="number">417</span></span><br><span class="line">HTTP_422_UNPROCESSABLE_ENTITY = <span class="number">422</span></span><br><span class="line">HTTP_423_LOCKED = <span class="number">423</span></span><br><span class="line">HTTP_424_FAILED_DEPENDENCY = <span class="number">424</span></span><br><span class="line">HTTP_426_UPGRADE_REQUIRED = <span class="number">426</span></span><br><span class="line">HTTP_428_PRECONDITION_REQUIRED = <span class="number">428</span></span><br><span class="line">HTTP_429_TOO_MANY_REQUESTS = <span class="number">429</span></span><br><span class="line">HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE = <span class="number">431</span></span><br><span class="line">HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS = <span class="number">451</span></span><br><span class="line">HTTP_500_INTERNAL_SERVER_ERROR = <span class="number">500</span></span><br><span class="line">HTTP_501_NOT_IMPLEMENTED = <span class="number">501</span></span><br><span class="line">HTTP_502_BAD_GATEWAY = <span class="number">502</span></span><br><span class="line">HTTP_503_SERVICE_UNAVAILABLE = <span class="number">503</span></span><br><span class="line">HTTP_504_GATEWAY_TIMEOUT = <span class="number">504</span></span><br><span class="line">HTTP_505_HTTP_VERSION_NOT_SUPPORTED = <span class="number">505</span></span><br><span class="line">HTTP_506_VARIANT_ALSO_NEGOTIATES = <span class="number">506</span></span><br><span class="line">HTTP_507_INSUFFICIENT_STORAGE = <span class="number">507</span></span><br><span class="line">HTTP_508_LOOP_DETECTED = <span class="number">508</span></span><br><span class="line">HTTP_509_BANDWIDTH_LIMIT_EXCEEDED = <span class="number">509</span></span><br><span class="line">HTTP_510_NOT_EXTENDED = <span class="number">510</span></span><br><span class="line">HTTP_511_NETWORK_AUTHENTICATION_REQUIRED = <span class="number">511</span></span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<p>但是一些偏门的,或者说,更加细微之处的错误,就需要我们自定义一些错误捕获函数来进行捕获</p>
<p>那么,废话不多说,上代码</p>
<ol>
<li><p>第一步,创建一个错误捕获函数的文件</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> exception_handler</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(exc,context)</span>:</span></span><br><span class="line">    <span class="comment">#实例化框架自带的错误捕获,先进行筛选</span></span><br><span class="line">    response = exception_handler(exc,context)</span><br><span class="line">	<span class="comment">#当没有捕获到错误之后,执行我们自定义的错误验证机制</span></span><br><span class="line">    <span class="keyword">if</span> response == <span class="literal">None</span>:</span><br><span class="line">        <span class="string">'''开始进行判断'''</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(exc,ZeroDivisionError):</span><br><span class="line">            print(<span class="string">'服务器错误'</span>)</span><br><span class="line">            response = Response(<span class="string">'服务器错误'</span>,status=status.HTTP_500_INTERNAL_SERVER_ERROR)</span><br><span class="line">    <span class="comment">#上面的验证返回的结果存储到response,这是一个已经完成序列化的数据,可以直接返回</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在配置文件setting中进行配置(通常情况下,我们创建一个新的文件夹来存放这个文件,然后再setting中以app的形式注册这个文件夹)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">'EXCEPTION_HANDLER'</span>:<span class="string">'utiles.excaptions.func'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
<p>完成了上述的工作之后,当我们的码出现错误之后,将会自动进行错误捕获</p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>DRF中generics</title>
    <url>/Django/Django_id_08.html</url>
    <content><![CDATA[<h2 id="generics"><a href="#generics" class="headerlink" title="generics"></a>generics</h2><a id="more"></a>
<ol>
<li><p>这模块中封装着GenericsAPIViews类,对APIViews进行了进一步的封装,比起APIViews,它的功能进一步扩展</p>
</li>
<li><pre><code>from rest_framework.generics import GenericsAPIViews
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">3.</span> </span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> .serializer <span class="keyword">import</span> StudentsSerializer,Students_Serializer</span><br><span class="line"><span class="keyword">from</span> . models <span class="keyword">import</span> CuressInfo,Students</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentsAPIViews</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="comment"># queryset = Students.objects.all()</span></span><br><span class="line">    <span class="comment"># serializer_class = StudentsSerializer</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        students = Students.objects.all()</span><br><span class="line">        serializer = StudentsSerializer(instance=students,many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="keyword">import</span> json</span><br><span class="line">        data_string = request.body.decode()</span><br><span class="line">        data_dict = json.loads(data_string)</span><br><span class="line">        serializer = Students_Serializer(data=data_dict)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        serializer.save()</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">stdSl</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request,id)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> .serializer <span class="keyword">import</span> SerializerModel</span><br><span class="line">        serializer = SerializerModel(data=Students.objects.all(),many=<span class="literal">True</span>)</span><br><span class="line">        serializer.is_valid()</span><br><span class="line">        print(serializer.data)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(serializer.data)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request,id)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> .serializer <span class="keyword">import</span> SerializerModel</span><br><span class="line">        <span class="keyword">import</span> json</span><br><span class="line">        data_string = request.body.decode()</span><br><span class="line">        data_dict = json.loads(data_string)</span><br><span class="line">        serializer = SerializerModel(data=data_dict)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        serializer.save()</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self,request,id)</span>:</span></span><br><span class="line">        instance = Students.objects.get(id=id)</span><br><span class="line">        <span class="keyword">import</span> json</span><br><span class="line">        data_dict = json.loads(request.body.decode())</span><br><span class="line">        serializer = Students_Serializer(instance=instance,data=data_dict)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        serializer.save()</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> .serializer <span class="keyword">import</span> ModelSerializerAPIViews</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentsModelAPIViews</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        instance = Students.objects.all()</span><br><span class="line">        serializer = ModelSerializerAPIViews(instance=instance,many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="comment"># instance = Students.objects.get(id=id)</span></span><br><span class="line">        data_dict = request.data</span><br><span class="line">        serializer = ModelSerializerAPIViews(data=data_dict)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        serializer.save()</span><br><span class="line">        print(serializer.error_messages)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentsGenericAPIViews</span><span class="params">(GenericAPIView)</span>:</span></span><br><span class="line">    queryset = Students.objects.all()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        all_dict = self.get_queryset()</span><br><span class="line">        serializer = ModelSerializerAPIViews(instance=all_dict,many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        serializer = ModelSerializerAPIViews(data=request.data)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        serializer.save()</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentsGenericAPIViews</span><span class="params">(GenericAPIView)</span>:</span></span><br><span class="line">    queryset = Students.objects.all()</span><br><span class="line">    serializer_class = ModelSerializerAPIViews</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        all_dict = self.get_queryset()</span><br><span class="line">        serializer = self.get_serializer(instance=all_dict,many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        serializer = self.get_serializer(data=request.data)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        serializer.save()</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ListModelMixin                  展示全部数据,里面封装的是全部数据的获取,方法名为list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CreateModelMixin	   添加新的数据,这里面封存的方法名为create</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DestroyAPIView	  删除对应的数据,对应的方法为destroy</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># UpdateAPIView		修改对应的数据,对应的方法名为update</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RetrieveAPIView	  获取单条数据,需要有对应的pk数值传入,方法名为retrieve</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># RetrieveUpdateDestroyAPIView	这个里面封装了多个视图分支类,包括DestroyAPIView-------UpdateAPIView------RetrieveAPIView------GenericsAPIView四个,所以它里面包含了对应的方法</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin,CreateModelMixin</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentsListModelMixin</span><span class="params">(GenericAPIView,ListModelMixin,CreateModelMixin)</span>:</span></span><br><span class="line">    queryset = Students.objects.all()</span><br><span class="line">    serializer_class = ModelSerializerAPIViews</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.list(request)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.create(request)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># from rest_framework.generics import ListAPIView,CreateAPIView,DestroyAPIView,UpdateAPIView,RetrieveAPIView</span></span><br><span class="line"><span class="comment"># from rest_framework.generics import RetrieveUpdateDestroyAPIView</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 终极形态</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># ModelAPIViewSet里面,相当于继承了以上的多种方法</span></span><br><span class="line"><span class="comment"># 同时,在使用ModelAPIViewSet创建的类视图进行注册时,需要在as_view中传入参数具体操作方法请往下看==============&gt;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Students_ListModelMixin</span><span class="params">(ModelViewSet)</span>:</span></span><br><span class="line">    queryset = Students.objects.all()</span><br><span class="line">    serializer_class = ModelSerializerAPIViews</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ReadOnlyModelViewSet</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Students_ListModelMixin</span><span class="params">(ReadOnlyModelViewSet)</span>:</span></span><br><span class="line">    <span class="comment"># 当使用ReadOnlyModelViewSet时,所获得的方法是只读的,也即是说,里面并没有封装修改数据的方法</span></span><br><span class="line">    queryset = Students.objects.all()</span><br><span class="line">    serializer_class = ModelSerializerAPIViews</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================&gt;</span></span><br><span class="line">	<span class="comment"># 路由属性为显示全部数据时的注册方式</span></span><br><span class="line">	path(<span class="string">'students5/'</span>,Students_ListModelMixin.as_view(&#123;</span><br><span class="line">        <span class="string">'get'</span>:<span class="string">'list'</span>,</span><br><span class="line">        <span class="string">'post'</span>:<span class="string">'create'</span></span><br><span class="line">    &#125;)),</span><br><span class="line">    <span class="comment">#当需要使用路由获取参数时的方式</span></span><br><span class="line">    re_path(<span class="string">r'students5/(?P&lt;pk&gt;\d+)/'</span>,Students_ListModelMixin.as_view(&#123;</span><br><span class="line">        <span class="string">'get'</span>:<span class="string">'retrieve'</span>,</span><br><span class="line">        <span class="string">'put'</span>:<span class="string">'update'</span>,</span><br><span class="line">        <span class="string">'delete'</span>:<span class="string">'destroy'</span></span><br><span class="line">    &#125;)),</span><br><span class="line">	<span class="comment"># 确切的书,在as_view中,你需要将访问方式同函数绑定起来,确保你在访问时将会执行对应的方法</span></span><br><span class="line">    <span class="comment"># 访问方式与方法的绑定一般整合为一个字典形式传入视图类</span></span><br></pre></td></tr></table></figure></div>


</code></pre></li>
</ol>
<hr>
<h3 id="在视图函数函数类中调用多个序列化器"><a href="#在视图函数函数类中调用多个序列化器" class="headerlink" title="在视图函数函数类中调用多个序列化器"></a>在视图函数函数类中调用多个序列化器</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> .serializer <span class="keyword">import</span> CuressInfo,ModelSerializerAPIViews</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentsModelViewSet</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    queryset = Students.objects.all()</span><br><span class="line">    serializer_class = ModelSerializerAPIViews</span><br><span class="line">    <span class="comment"># 重写get_serializer_class方法,在其中添加判断,如果对应的访问方式,就返回需要用到的序列化器</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.request.method == <span class="string">'GET'</span>:</span><br><span class="line">            <span class="keyword">return</span> ModelSerializerAPIViews</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> CuressInfo</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        instance = self.get_queryset()</span><br><span class="line">        serializer = self.get_serializer(instance=instance,many=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        data = request.data</span><br><span class="line">        serializer = self.get_serializer(data=data)</span><br><span class="line">        serializer.is_valid(raise_excaption=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentsModelViewSet</span><span class="params">(ModelViewSet)</span>:</span></span><br><span class="line">    queryset = Students.objects.all()</span><br><span class="line">    serializer_class = ModelSerializerAPIViews</span><br><span class="line">    <span class="comment"># 重写get_serializer_class方法,在其中添加判断,如果对应的访问方式,就返回需要用到的序列化器</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#在视图集函数中,使用的并不是self.request.method进行判断,而是self.action</span></span><br><span class="line">        <span class="keyword">if</span> self.action == <span class="string">'list'</span>:</span><br><span class="line">            <span class="keyword">return</span> ModelSerializerAPIViews</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> CuressInfo</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        instance = self.get_queryset()</span><br><span class="line">        serializer = self.get_serializer(instance=instance,many=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        data = request.data</span><br><span class="line">        serializer = self.get_serializer(data=data)</span><br><span class="line">        serializer.is_valid(raise_excaption=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>DRF中的APIViews视图类</title>
    <url>/Django/Django_id_09.html</url>
    <content><![CDATA[<h2 id="from-rest-framework-views-import-APIViews"><a href="#from-rest-framework-views-import-APIViews" class="headerlink" title="from rest_framework.views import APIViews"></a>from rest_framework.views import APIViews</h2><a id="more"></a>
<ol>
<li><p>封装在DRF中的视图模块,相比直接使用django中的views模块,这个模块的使用更加的严谨,功能更多,更好用</p>
<ol>
<li>从页面中使用request获取到的json数据将会自动转换成字典类型的数据,方便使用,不需要额外导入一次json模块</li>
<li>其他方面的使用views使用方式相同</li>
<li>从根本上来看,APIViews继承自Views</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>DRF验证器机制使用</title>
    <url>/Django/Django_id_07.html</url>
    <content><![CDATA[<h2 id="DRF验证器机制"><a href="#DRF验证器机制" class="headerlink" title="DRF验证器机制"></a>DRF验证器机制</h2><a id="more"></a>
<ol>
<li><p>创建基于drf框架的验证器</p>
<ol>
<li><pre><code class="python"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializer
<span class="class"><span class="keyword">class</span> <span class="title">SerializerStudents</span><span class="params">(serializer.Serializer)</span>:</span>
    name = serializer.CharField(max_length=<span class="number">10</span>,min_length=<span class="number">2</span>)
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2.</span> 在创建好的视图类中使用这个验证器类</span><br><span class="line"></span><br><span class="line">   ```python</span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">Students</span><span class="params">(View)</span>:</span></span><br><span class="line">       <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">           <span class="comment">#获取客户端传输过来的json数据并进行解码操作</span></span><br><span class="line">           data_string = request.body.decode()</span><br><span class="line">           <span class="comment">#导入json模块</span></span><br><span class="line">           <span class="keyword">import</span> json</span><br><span class="line">           <span class="comment">#使用json模块的方法对获取到的字符串进行转换,变成一个字典</span></span><br><span class="line">           data_dict = json.loads(data_string)</span><br><span class="line">           <span class="comment">#使用创建好的验证器类</span></span><br><span class="line">           <span class="keyword">from</span> .serializer <span class="keyword">import</span> SerializerStudents</span><br><span class="line">           serializer = SerializerStudents(data=data_dict)</span><br><span class="line">           <span class="comment">#验证器类的is_valid方法返回的数据为bool数据,当通过验证时,返回结果为true,否则返回false</span></span><br><span class="line">           print(serializer.is_valid())</span><br><span class="line">           <span class="comment">#is_valid方法的属性为raise_excaption</span></span><br><span class="line">           <span class="comment">#这个属性默认时关闭的,当他开启时,意味着当验证出错时,将会直接报错,并直接停止代码的继续运行,</span></span><br><span class="line">           print(serializer.is_valid(raise_exception=<span class="literal">True</span>))</span><br><span class="line">           <span class="comment">#返回报错信息,这个并不会阻止程序的继续运行</span></span><br><span class="line">           print(serializer.erreo_messages)</span><br><span class="line">           <span class="comment">#</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ol>
</li>
<li><p>创建一个验证器方法进行验证</p>
<ol>
<li><p>单字段验证</p>
<ul>
<li><pre><code class="python"><span class="function"><span class="keyword">def</span> <span class="title">validate_name</span><span class="params">(self,data)</span>:</span>
    <span class="comment">#传入的参数可以直接设定为data</span>
    <span class="keyword">if</span> data == <span class="string">'root'</span>:
        <span class="keyword">raise</span> serializer.ValidationError(message=<span class="string">'用户名不能为root'</span>)
        <span class="comment">#当满足条件时,返回错误原因和信息</span>
    <span class="keyword">return</span> data
    <span class="comment">#当通过验证时,返回原数据data</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PGSQL"><figure class="iseeu highlight /pgsql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2.</span> 全局字段验证</span><br><span class="line"></span><br><span class="line">   - ```python</span><br><span class="line">     def <span class="keyword">validate</span>(self,data_dict):</span><br><span class="line">         #验证方法和单字段验证基本相同,区别是传入的数据类型是字典,进行判断是只需要从字典中取出对应的值即可进行判断,要注意的是,最终依然要将这个数据返回回去</span><br><span class="line">         <span class="type">name</span> = data_dict.<span class="keyword">get</span>(<span class="string">'name'</span>)</span><br><span class="line">         <span class="keyword">password</span> = data_dict.<span class="keyword">get</span>(<span class="string">'password'</span>)</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> data_dict</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
</ol>
</li>
<li><p>创建一个验证器类外部的方法进行使用</p>
<ol>
<li><p>在验证器类外部进行函数定义</p>
<ul>
<li><pre><code class="python"><span class="function"><span class="keyword">def</span> <span class="title">check_validate</span><span class="params">(data)</span>:</span>
    <span class="keyword">if</span> data==<span class="string">'user'</span>:
        <span class="keyword">raise</span> serializer.ValidationError(message=<span class="string">'不能使用user作为用户名'</span>)
    <span class="keyword">return</span> data
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="REASONML"><figure class="iseeu highlight /reasonml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2.</span> 在验证器类中定义字段属性时使用</span><br><span class="line"></span><br><span class="line">   - ```python</span><br><span class="line">     name = serializer.<span class="constructor">CharFIeld(<span class="params">max_length</span>=20,<span class="params">min_length</span>=2,<span class="params">validates</span>=[<span class="params">check_validate</span>])</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
</ol>
</li>
<li><p>在验证器类中重写create(添加一条数据)方法和update(修改一条数据)方法</p>
<ol>
<li><p>重写create方法</p>
<ul>
<li><pre><code class="python"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self,validate_data)</span>:</span>
    name = validate_data.get(<span class="string">'name'</span>)
    instance = Students.objects.create(
        name=name
    )
    <span class="keyword">return</span> instance
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XQUERY"><figure class="iseeu highlight /xquery"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2</span>. 重写<span class="keyword">update</span>方法</span><br><span class="line"></span><br><span class="line">   - ```python</span><br><span class="line">     def <span class="keyword">update</span>(self,<span class="keyword">instance</span>,validate_data):</span><br><span class="line">        <span class="built_in"> name</span> = validate_date,get(<span class="string">'name'</span>)</span><br><span class="line">         <span class="keyword">instance</span><span class="built_in">.name</span> =<span class="built_in"> name</span></span><br><span class="line">         <span class="keyword">instance</span>.save()</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">instance</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
<li><p>使用这两种方法</p>
<ol>
<li><p>通用的激活方法</p>
<ul>
<li><pre><code class="python">serializer.save()
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XQUERY"><figure class="iseeu highlight /xquery"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   - 通过验证之后的数据,可以使用方法save()</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. create可以直接使用,当验证时传入的参数仅有一个data时,将会调用create方法,而不会激活<span class="keyword">update</span>方法</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 使用<span class="keyword">update</span>方法</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>. ```python</span><br><span class="line">          def <span class="keyword">update</span>(self, <span class="keyword">instance</span>, validated_data):</span><br><span class="line">             <span class="built_in"> name</span> = validated_data.get(<span class="string">'name'</span>)</span><br><span class="line">              curess = <span class="number">1</span></span><br><span class="line">              <span class="keyword">instance</span><span class="built_in">.name</span> =<span class="built_in"> name</span></span><br><span class="line">              <span class="keyword">instance</span>.curess_id = curess</span><br><span class="line">              <span class="keyword">instance</span>.save()</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">instance</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
<ol start="2">
<li><pre><code class="python"><span class="class"><span class="keyword">class</span> <span class="title">stdSl</span><span class="params">(View)</span>:</span>
    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self,request,id)</span>:</span>
        instance = Students.objects.get(id=id)
        <span class="keyword">import</span> json
        data_dict = json.loads(request.body.decode())
        serializer = Students_Serializer(instance=instance,data=data_dict)
        serializer.is_valid(raise_exception=<span class="literal">True</span>)
        serializer.save()
        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</code></pre>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="以上内容为serializer-Serializer组件的使用-相比较起来-drf框架中其实已经封装好了专用的模型类序列化器"><a href="#以上内容为serializer-Serializer组件的使用-相比较起来-drf框架中其实已经封装好了专用的模型类序列化器" class="headerlink" title="以上内容为serializer.Serializer组件的使用,相比较起来,drf框架中其实已经封装好了专用的模型类序列化器"></a>以上内容为serializer.Serializer组件的使用,相比较起来,drf框架中其实已经封装好了专用的模型类序列化器</h2><hr>
<h3 id="serializer-ModelSerializer"><a href="#serializer-ModelSerializer" class="headerlink" title="serializer.ModelSerializer:"></a>serializer.ModelSerializer:</h3><ul>
<li></li>
</ul>
<hr>
<h2 id="验证器使用时的属性和字段"><a href="#验证器使用时的属性和字段" class="headerlink" title="验证器使用时的属性和字段:"></a>验证器使用时的属性和字段:</h2><ul>
<li></li>
<li></li>
</ul>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Git操作</title>
    <url>/Git/Git_id_03.html</url>
    <content><![CDATA[<h2 id="git-bash操作实例"><a href="#git-bash操作实例" class="headerlink" title="git bash操作实例:"></a>git bash操作实例:</h2><a id="more"></a>
<ul>
<li><p>​    在文件夹中打开git(在文件页面上方的路径里面输入git bash即可快速打开git编辑界面)</p>
</li>
<li><pre><code>git init //初始化git文件包
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
git add 文件名     //创建镜像文件
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
git commit  //提交
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
git commit -m &apos;描述信息&apos; //提交,但不会打开编辑窗口
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
git clone https://github.com/fcg22450/my_flask.git

#https://github.com/fcg22450/my_flask.git这里的内容从github页面获取
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
git add .
#将当前文件夹中的所有文件打包成迁移文件
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
git push -u origin master
#将生成的迁移文件上传到github仓库中
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
cd test 
#进入对应文件夹
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
git status
#查看当前准备好的迁移文件
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
git config --system --unset credential.helper
# 清空密码
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
git config --global credential.helper store
# 保存密码</code></pre></li>
</ul>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>DRF文件上传与静态文件访问</title>
    <url>/Django/Django_id_06.html</url>
    <content><![CDATA[<h2 id="DRF文件上传及访问"><a href="#DRF文件上传及访问" class="headerlink" title="DRF文件上传及访问"></a>DRF文件上传及访问</h2><a id="more"></a>
<h2 id="关于DRF文件上传"><a href="#关于DRF文件上传" class="headerlink" title="关于DRF文件上传:"></a>关于DRF文件上传:</h2><p>​    其实我的掌握并不强,目前也只能完成非前后端分离的状态提交的数据,在前后端分离的状态,我提交的数据不知道为什么始终无法传上来,查验代码之后提示是我的上传数据格式不一致,但是查了好久都没找到具体的解决办法</p>
<p>​    那么,先演示一下使用drf进行的django工程内部的提交:</p>
<p>​        </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">imgCal</span><span class="params">(ModelViewSet)</span>:</span></span><br><span class="line">    queryset = imageInfo.objects.all()</span><br><span class="line">    serializer_class = StudentsSerializer</span><br><span class="line">    <span class="comment">#重写get方法,确保在进行get访问时获取进行文件上传的模板</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'./imgfrom.html'</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">#在这里,我选择了重写ModelViewSet中自带的create方法,并将其更名为post</span></span><br><span class="line">    <span class="comment">#模板自带的create方法所获得的request.data并不是表单直接提交的数据,因为个人原因(其实就是懒)我将request.data方法改掉,改为使用表单的方式获取数据,然后存储到一个字典之中,</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># 创建一个新的字典</span></span><br><span class="line">        a_dict = &#123;&#125;</span><br><span class="line">        <span class="comment"># 获取上传的文件,并存储到创建的字典中去</span></span><br><span class="line">        a_dict[<span class="string">'name'</span>] = request.POST.get(<span class="string">'name'</span>)</span><br><span class="line">        a_dict[<span class="string">'img'</span>] = request.FILES.get(<span class="string">'img'</span>)</span><br><span class="line">        <span class="comment"># 最后得到的,是这样一个集合</span></span><br><span class="line">        <span class="comment"># &lt; QueryDict: &#123;'name': ['小小'], 'img': ['C:\\fakepath\\003.png']&#125; &gt;</span></span><br><span class="line">        print(request.GET)</span><br><span class="line">        <span class="comment"># 创建序列化器对象,将床架你的字典作为data放入序列化器</span></span><br><span class="line">        serializer = self.get_serializer(data=a_dict)</span><br><span class="line">        print(serializer.is_valid())</span><br><span class="line">        <span class="comment"># create方法原生的使用方法,转到下一个类方法中</span></span><br><span class="line">        self.perform_create(serializer)</span><br><span class="line">        headers = self.get_success_headers(serializer.data)</span><br><span class="line">        <span class="comment"># 将最终结果返回回去,不需要修改</span></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED, headers=headers)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_create</span><span class="params">(self, serializer)</span>:</span></span><br><span class="line">        <span class="comment"># 对序列化器结果进行判断,这里加不加都可以,之所以加上这层判断,只是我在书写过程中,为了确保结构完整,并且能够在每一个位置进行判断,确定bug位置而书写的</span></span><br><span class="line">        <span class="comment">#当序列化通过时,执行save</span></span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid(raise_exception=<span class="literal">True</span>):</span><br><span class="line">            serializer.save()</span><br><span class="line">        <span class="comment"># 当序列化未通过时,将会执行以下数据</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'数据无效'</span>,serializer.data)</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_success_headers</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">'Location'</span>: str(data[api_settings.URL_FIELD_NAME])&#125;</span><br><span class="line">        <span class="keyword">except</span> (TypeError, KeyError):</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;</span><br></pre></td></tr></table></figure></div>

<p>以下是序列化器部分:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentsSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = imageInfo</span><br><span class="line">        fields = <span class="string">'__all__'</span></span><br></pre></td></tr></table></figure></div>

<p>平平无奇的序列化器,没有添加什么额外的配置要求</p>
<p>值得一提的是,在数据库中我并不是使用的imageFields,而是使用了兼容性感觉更高的filefield</p>
<p>下面是数据库配置:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_to</span><span class="params">(instance, fielname)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/'</span>.join([settings.MEDIA_ROOT, instance.user_name, fielname])</span><br><span class="line"><span class="comment">#以上代码是自己重写的文件下载模块,已弃之不用</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">imageInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    img = models.FileField(upload_to=<span class="string">''</span>)</span><br><span class="line">    <span class="comment"># 必备参数,upload</span></span><br><span class="line">    <span class="comment"># 如果你不需要再设定好的下载路径中再次准备一个文件夹进行文件存储,可以直接为空,即: upload=''</span></span><br><span class="line">    <span class="comment"># 当然,在使用之前,需要准备好MEDIA_URL以及MEDIA_ROOT,如果想要在网页中能直接通过网址进行蹄片查看,需要配置好meida路由</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'imageinfo'</span></span><br></pre></td></tr></table></figure></div>

<p>以下是路由配置:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">re_path(<span class="string">'media/(?P&lt;path&gt;.*)'</span>,serve,&#123;<span class="string">'document_root'</span>:settings.MEDIA_ROOT&#125;),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#setting文件配置</span></span><br><span class="line"></span><br><span class="line">MEDIA_URL = <span class="string">'static/media/'</span></span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, <span class="string">'static\media'</span>)</span><br></pre></td></tr></table></figure></div>

<p>在完成上述的代码之后,只需要配置好模板文件即可,正常的form表单的提交方法,后台的代码将会自行对获得的数据进行解析存储</p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>DRF数据分页器</title>
    <url>/Django/Django_id_05.html</url>
    <content><![CDATA[<h2 id="分页器类书写"><a href="#分页器类书写" class="headerlink" title="分页器类书写"></a>分页器类书写</h2><a id="more"></a>
<ol>
<li><pre><code class="python"><span class="comment"># 废话不多说,直接上代码</span>
<span class="keyword">from</span> rest_framework <span class="keyword">import</span> pagination

<span class="class"><span class="keyword">class</span> <span class="title">PaginationStudents</span><span class="params">(pagination.PageNumberPagination)</span>:</span>
    page_size = <span class="number">5</span>    
    <span class="comment"># 在不传入page_size参数时的默认长度</span>
    page_size_query_param = <span class="string">'size'</span>
    <span class="comment"># 设定在使用url传递参数时每页展示数量的参数名</span>
    page_query_param = <span class="string">'page'</span>
    <span class="comment"># 设定在使用url传递参数时展示的页数的参数名</span>
    max_page_size = <span class="number">5</span>
    <span class="comment"># 设定每页的最大展示数量</span>

</code></pre>
</li>
</ol>
<p>   #注意,在使用分页的时候,可以不传入每页展示数量,默认将会使用设定好的page_size<br>   <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HASKELL"><figure class="iseeu highlight /haskell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2.</span> 创建好分页器类之后,进行使用</span><br><span class="line"></span><br><span class="line">   ```python</span><br><span class="line">   from rest_framework.views <span class="keyword">import</span> ModelAPIView</span><br><span class="line"><span class="class">   <span class="keyword">class</span> <span class="type">MyPaginations</span>(<span class="type">ModelAPIView</span>):</span></span><br><span class="line"><span class="class">       queryset = <span class="type">Students</span>.objects.all()</span></span><br><span class="line"><span class="class">   	serializer_class = <span class="type">MySerializers</span></span></span><br><span class="line"><span class="class">       pagination_class = <span class="type">PaginationStudents</span></span></span><br></pre></td></tr></table></figure></div></p>
<ol start="3">
<li><p>使用时的传参方式</p>
<ul>
<li><pre><code>127.0.0.1/api/students5/?page=1&amp;size=5

page为页码
size为单页显示的最大数量
</code></pre></li>
</ul>
</li>
</ol>
<p>​    </p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>vue路由配置</title>
    <url>/Vue/Vue_id_04.html</url>
    <content><![CDATA[<h2 id="配置vue路由"><a href="#配置vue路由" class="headerlink" title="配置vue路由"></a>配置vue路由</h2><a id="more"></a>
<ol>
<li><h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><ul>
<li><p>cd ./vueproject/src/router</p>
</li>
<li><p>进入到路由文件夹中,打开index.js文件</p>
</li>
<li><p>在文件中导入设定好的Vue路由文件</p>
<ul>
<li>import User from ‘../components/User’</li>
<li>这里可以通过输入vue文件名的方式进行快捷编写</li>
</ul>
</li>
<li><p>在路由数组中注册路由</p>
<ul>
<li><pre><code class="javascript">routes: [
    {
        path:<span class="string">'/user'</span>,
        name: <span class="string">'User'</span>,
        component:User
    }
]
&lt;!--￼<span class="number">0</span>--&gt;
&lt;router-link to=<span class="string">'/user'</span>&gt;user&lt;router-link&gt;
&lt;!--￼<span class="number">1</span>--&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>渲染:</p>
<p>使用模板语法,对传递过来的参数进行提取</p>


]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>关于vue的配置</title>
    <url>/Vue/Vue_id_09.html</url>
    <content><![CDATA[<h2 id="Vue配置"><a href="#Vue配置" class="headerlink" title="Vue配置"></a>Vue配置</h2><a id="more"></a>


<ol>
<li><h3 id="在电脑中安装node-js"><a href="#在电脑中安装node-js" class="headerlink" title="在电脑中安装node.js"></a>在电脑中安装node.js</h3><ul>
<li>………..省略</li>
</ul>
</li>
<li><h3 id="使用node-js安装脚手架"><a href="#使用node-js安装脚手架" class="headerlink" title="使用node.js安装脚手架"></a>使用node.js安装脚手架</h3><ul>
<li><pre><code>npm install -g vue-cli
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CLEAN"><figure class="iseeu highlight /clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">3.</span> ### 查看vue版本</span><br><span class="line"></span><br><span class="line">   -</span><br></pre></td></tr></table></figure></div>
vue -V
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CLEAN"><figure class="iseeu highlight /clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">4.</span> ### vue下载换源</span><br><span class="line"></span><br><span class="line">   - ```python</span><br><span class="line">     npm --registry https:<span class="comment">//registry.npm.taobao.org</span></span><br><span class="line">     #临时使用</span><br></pre></td></tr></table></figure></div></code></pre></li>
<li><pre><code class="python">npm config set registry https://registry.npm.taobao.org
<span class="comment">#持久使用</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CLEAN"><figure class="iseeu highlight /clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">5.</span> ### 创建一个新的vue工程</span><br><span class="line"></span><br><span class="line">   - ```cmd</span><br><span class="line">     vue init webpack 文件名</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
<li><h3 id="运行vue工程"><a href="#运行vue工程" class="headerlink" title="运行vue工程"></a>运行vue工程</h3><ul>
<li><pre><code>vue run dev
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CLEAN"><figure class="iseeu highlight /clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">7.</span> ### 删除node_modules</span><br><span class="line"></span><br><span class="line">   -</span><br></pre></td></tr></table></figure></div>
npm install rimraf -g
rimraf node_modules</code></pre></li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>关于哈希加密算法</title>
    <url>/Python/Python_id_02.html</url>
    <content><![CDATA[<h2 id="哈希加密"><a href="#哈希加密" class="headerlink" title="哈希加密"></a>哈希加密</h2><a id="more"></a>
<ul>
<li><p>该加密算法对于相同的字符串将会是一致的,同时,这种加密是单向的,无法反向编译出来,也就是说,想要对 加密后的数据进行比较,你需要将要比较的数据先进行加密,然后才能进行比较,当两者内容一致时,才会通过验证</p>
</li>
<li><p>当使用在登陆页面时,其流程时这样的:输入密码===&gt;进行加密===&gt;调用数据库===&gt;进行比较===&gt;验证通过===&gt;返回session信息,进入登陆状态</p>
</li>
<li><pre><code class="python"><span class="comment">#导入哈希加密包</span>
<span class="comment">#在py3之后,md5包被移除,其功能被整合到hashlib包中</span>
<span class="keyword">import</span> hashlib
<span class="comment">#创建一个新的哈希加密对象</span>
h1 = hashlib.md5()
<span class="comment">#在对象中添加要加密的字符串,该字符串需要先转化成二进制格式,即utf8</span>
h1.update(str.encode(encoding=<span class="string">'utf8'</span>))
<span class="comment">#查看转码后的数据,hexdigest为十六进制模式</span>
print(h1.hexdigest())
<span class="comment">#查看转码后的数据,digest为二进制模式</span>
print(h1.digest())</code></pre>
</li>
<li><p>这里要注意的是,每次进行加密,都要重新创建一个哈希对象,也即是重新书写一遍==&gt;h1 = hashlib.md5()</p>
</li>
<li><p>如果不进行重新定义的话,当加密时遇到相同的字符串,如”hello world”这样的字符串,将会出现”hello worldhello world”这样的叠加形式,所以需要重新定义</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django数据库关系属性</title>
    <url>/Django/Django_id_19.html</url>
    <content><![CDATA[<h2 id="数据库关系属性"><a href="#数据库关系属性" class="headerlink" title="数据库关系属性"></a>数据库关系属性</h2><a id="more"></a>
<ul>
<li><h2 id="一对多关系"><a href="#一对多关系" class="headerlink" title="一对多关系"></a>一对多关系</h2><ul>
<li><p>ForeignKey</p>
</li>
<li><p>外键专属,一对多关系设定,通常情况下,这个属性设置在多类属性中,关联一类属性</p>
</li>
<li><pre><code class="python">news_type = models.ForeignKey(<span class="string">'NewsTypeInfo'</span>,on_delete=models.CASCADE)
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">- ## 多对多关系</span><br><span class="line"></span><br><span class="line">  - ManyToManyField</span><br><span class="line"></span><br><span class="line">  - 多对多关系建立字段,这个字段可以写在任意一个里面,并不影响使用</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    news_type = models.ManyToManyField('NewsInfo')</span><br></pre></td></tr></table></figure>


</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><h2 id="一对一关系"><a href="#一对一关系" class="headerlink" title="一对一关系"></a>一对一关系</h2><ul>
<li>OneToOneField</li>
</ul>
</li>
</ul>
<h2 id="通过模型类实现关联查询语句"><a href="#通过模型类实现关联查询语句" class="headerlink" title="通过模型类实现关联查询语句:"></a>通过模型类实现关联查询语句:</h2><p>​    </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Two.models <span class="keyword">import</span> *</span><br><span class="line">b = HeroInfo.objects.filter(hbook__id=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#通过一对多关系获取对象的方法</span></span><br><span class="line"><span class="comment">#关系字段加上双下划线加上对应表中的字段即可进行查询,但需要注意</span></span><br><span class="line">b = HeroInfo.object.get(id=<span class="number">1</span>)</span><br><span class="line">b.hbook</span><br><span class="line"><span class="comment">#以上两种方法都能进行查询,但是第一种方法查询出来的结果是一个查询集,第二种拿到的是一个对象</span></span><br></pre></td></tr></table></figure></div>

<p>在没有关系的情况下查询的话,就不能使用关系属性字段进行查询,这个这时候,就需要用模型类的名字进行查询,用模型类的名字代替关系属性字段的名字</p>
<h2 id="自关联属性字段查询"><a href="#自关联属性字段查询" class="headerlink" title="自关联属性字段查询:"></a>自关联属性字段查询:</h2><h3 id="设定自关联属性字段"><a href="#设定自关联属性字段" class="headerlink" title="设定自关联属性字段:"></a>设定自关联属性字段:</h3><p>​            </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AreaInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	a_title = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    <span class="comment">#设置关联属性字段,关联自身,即self</span></span><br><span class="line">    <span class="comment">#这个字段即意味着与自身关联</span></span><br><span class="line">    a_parent = models.ForeignKey(<span class="string">'self'</span>,on_delete=models.CASCADE,null=<span class="literal">True</span>,blank=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="自关联属于特殊的一对多"><a href="#自关联属于特殊的一对多" class="headerlink" title="自关联属于特殊的一对多"></a>自关联属于特殊的一对多</h4><h4 id="在查询时遵循一对多的查询方式"><a href="#在查询时遵循一对多的查询方式" class="headerlink" title="在查询时遵循一对多的查询方式"></a>在查询时遵循一对多的查询方式</h4><p>由一查多时使用字段名__set.all()进行查询</p>
<p>由多查一时使用字段名查询</p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django中cookie和session</title>
    <url>/Django/Django_id_22.html</url>
    <content><![CDATA[<h2 id="COOKIES"><a href="#COOKIES" class="headerlink" title="COOKIES"></a>COOKIES</h2><a id="more"></a>
<ol>
<li><p>设置cookie</p>
<ol>
<li><p>创建一个全新的HttpResponse对象</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">response = HttpResponse(<span class="string">'设置cookie'</span>)</span><br><span class="line">response.set_cookie(<span class="string">'num'</span>,<span class="number">1</span>,max_age=<span class="number">10</span>*<span class="number">24</span>*<span class="number">3600</span>)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>获取cookie</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">num = request.COOKIES[<span class="string">'num'</span>]</span><br><span class="line"><span class="keyword">return</span> HttpResponse(num)</span><br></pre></td></tr></table></figure></div>
</li>
</ol>
</li>
<li><p>设置过期时间</p>
<ol>
<li><p>max_age,设置单位为秒</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">response.set_cookie(<span class="string">'num'</span>,<span class="number">1</span>,max_age=<span class="number">10</span>*<span class="number">24</span>*<span class="number">3600</span>)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>exprice,设置较为复杂,但是适合长期设置</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse,HttpResponse</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime,timedelta</span><br><span class="line">response.set_cookie(<span class="string">'num'</span>,<span class="number">1</span>,expires=datetime.now() + timedelta(days=<span class="number">10</span>))</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
</li>
</ol>
<hr>
<h2 id="相较于cookie-session安全性较高-在保存一些重要数据时-更适合使用session来进行保存-如用户的帐号-密码-私人信息等"><a href="#相较于cookie-session安全性较高-在保存一些重要数据时-更适合使用session来进行保存-如用户的帐号-密码-私人信息等" class="headerlink" title="相较于cookie,session安全性较高,在保存一些重要数据时,更适合使用session来进行保存,如用户的帐号,密码,私人信息等"></a>相较于cookie,session安全性较高,在保存一些重要数据时,更适合使用session来进行保存,如用户的帐号,密码,私人信息等</h2><h2 id="sessions"><a href="#sessions" class="headerlink" title="sessions"></a>sessions</h2><ol>
<li><p>设置session</p>
<ol>
<li><pre><code class="python"><span class="comment">#设置session</span>
<span class="function"><span class="keyword">def</span> <span class="title">set_session</span><span class="params">(request)</span>:</span>
    request.session[<span class="string">'username'</span>] = <span class="string">'root'</span>
    request.session[<span class="string">'age'</span>] = <span class="string">'000000'</span>
    <span class="keyword">return</span> HttpResponse(<span class="string">'设置成功'</span>)
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PGSQL"><figure class="iseeu highlight /pgsql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2.</span> 获取<span class="keyword">session</span></span><br><span class="line"></span><br><span class="line">   <span class="number">1.</span> ```python</span><br><span class="line">      #获取<span class="keyword">session</span></span><br><span class="line">      def get_session(request):</span><br><span class="line">          username = request.<span class="keyword">session</span>[<span class="string">'username'</span>]</span><br><span class="line">          age = request.<span class="keyword">session</span>[<span class="string">'age'</span>]</span><br><span class="line">          <span class="keyword">return</span> HttpResponse(username + <span class="string">':'</span> + str(age))</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ol>
</li>
<li><p>session使用方法</p>
<ol>
<li><p>直接使用字典的键值对获取方法</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session[<span class="string">'cookie名'</span>]</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>使用get方法获取,可以设置默认值</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.get(<span class="string">'cookie名,default="默认值")</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>clear,删除session中保存的数据,但是删除掉的只是值</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.clear()</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>flash,删除整条数据,完全删除所有数据,数据表完全清除</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.flash()</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>del    删除目标数据的所有内容</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">del</span> request.session[<span class="string">'cookie'</span>]</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>设置session过期时间</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.set_expiry(value)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>当没有设置过期时间的时候,默认将会在两周之后过期</li>
<li>当value值为0的时候,将会在关闭浏览器的时候过期</li>
<li>当value大于0的时候,将会在value秒之后过期</li>
</ul>
</li>
<li><p>has_key   判断session中有没有对应的cookie</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.has_key(<span class="string">'username'</span>)</span><br></pre></td></tr></table></figure></div>



</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django视图管理</title>
    <url>/Django/Django_id_27.html</url>
    <content><![CDATA[<h2 id="Django视图管理"><a href="#Django视图管理" class="headerlink" title="Django视图管理"></a>Django视图管理</h2><h2 id="视图函数在views-py文件中进行定义"><a href="#视图函数在views-py文件中进行定义" class="headerlink" title="#视图函数在views.py文件中进行定义"></a>#视图函数在views.py文件中进行定义</h2><h2 id="1-定义视图函数"><a href="#1-定义视图函数" class="headerlink" title="1).定义视图函数"></a>1).定义视图函数</h2><p>​    <a id="more"></a></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'视图函数成功'</span>)</span><br></pre></td></tr></table></figure></div>

<hr>
<h2 id="2-配置路由"><a href="#2-配置路由" class="headerlink" title="2).配置路由"></a>2).配置路由</h2><ul>
<li><p>导入路由模块</p>
<ul>
<li><pre><code class="python"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path
<span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> include
urlatterns = [
    path(<span class="string">''</span>,include(<span class="string">'路径'</span>))
]
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CLEAN"><figure class="iseeu highlight /clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 设定好总的路由之后开始设定从属的路由</span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  <span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">from</span> First <span class="keyword">import</span> views</span><br><span class="line">  #导入views视图函数文件</span><br><span class="line">  urlpatterns = [</span><br><span class="line">      #给视图函数绑定url,</span><br><span class="line">      re_path(r<span class="string">'index/'</span>,views.index)</span><br><span class="line">      ###################################</span><br><span class="line">      #两种方法都可以使用</span><br><span class="line">      path(<span class="string">'index/'</span>,views.index)</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>path配置方法不需要考虑路由名字匹配的问题</p>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-构建模板文件"><a href="#3-构建模板文件" class="headerlink" title="3).构建模板文件"></a>3).构建模板文件</h2><hr>
<ul>
<li><p>构造模板</p>
<ul>
<li><p>在django2.2.7中,创建新的项目时会自动配置好tempalte文件,只需要在里面创建应用文件的模板文件夹即可,</p>
</li>
<li><p>旧版本中并不主动生成template文件夹,所以需要自己创建并进行配置</p>
</li>
<li><p>```<br>‘DIRS’: [os.path.join(BASE_DIR, ‘templates’)],</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AWK"><figure class="iseeu highlight /awk"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 模板构造与导入</span><br><span class="line"></span><br><span class="line">  - 加载模板文件</span><br><span class="line"></span><br><span class="line">    - 从模板文件目录获取html文件的内容,得到一个模板对象</span><br><span class="line">  - 定义模板上下文</span><br><span class="line"></span><br><span class="line">    - 向模板文件传递数据</span><br><span class="line">  - 模板渲染</span><br><span class="line"></span><br><span class="line">    - 得到一个标准的html页面</span><br><span class="line"></span><br><span class="line">      - ```python</span><br><span class="line">        re_path(<span class="string">r'lists/(\d+)'</span>,views.lists)</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>重定向,路由传参方法,使用正则匹配路由</p>
</li>
<li><pre><code class="python"><span class="function"><span class="keyword">def</span> <span class="title">lists</span><span class="params">(request,bid)</span>:</span>
    books = BookInfo.objects.get(id=bid)
    heros = books.heroinfo_set.all()
    <span class="keyword">return</span> render(request,<span class="string">'FirstTemplates/lists.html'</span>,{
        <span class="string">'books'</span> : books,
        <span class="string">'heros'</span> : heros
    })</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>DRF初试</title>
    <url>/Django/Django_id_02.html</url>
    <content><![CDATA[<h2 id="DRF初试"><a href="#DRF初试" class="headerlink" title="DRF初试"></a>DRF初试</h2><a id="more"></a>
<ol>
<li><p>创建一个新的序列化器</p>
<ol>
<li><p>Serializer序列化器创建,通常这个序列化器我们使用一个新的文件承载</p>
<ul>
<li><pre><code class="python"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializer
<span class="keyword">from</span> .models <span class="keyword">import</span> *
<span class="class"><span class="keyword">class</span> <span class="title">StudentsSerializer</span><span class="params">(serializer.ModelSerializer)</span>:</span>
    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span>
        model = Students
        fields = <span class="string">'__all__'</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HASKELL"><figure class="iseeu highlight /haskell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   - 在创建序列化器的时候,需要直接或者间接的继承serializer.<span class="type">Serializer</span>这个类</span><br><span class="line"></span><br><span class="line">   - 当序列化器继承自serializer.<span class="type">ModelSerializer</span>的时候,需要在序列化器的模型类中声明要使用的模型类model,以及要使用的字段fields</span><br><span class="line"></span><br><span class="line">   - 当fields的值为'__all__'的时候,就相当于对应着这个模型类中的全部字段</span><br><span class="line"></span><br><span class="line">   - 字段声明</span><br><span class="line"></span><br><span class="line">     - </span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 在view中使用这个序列化器</span><br><span class="line"></span><br><span class="line">   - ```python</span><br><span class="line">     from rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line">     from .serializer <span class="keyword">import</span> StudentsSerializer</span><br><span class="line">     from .models <span class="keyword">import</span> *</span><br><span class="line"><span class="class">     <span class="keyword">class</span> <span class="type">StudentsAPIViews</span>(<span class="type">ModelViewSet</span>):</span></span><br><span class="line"><span class="class">         queryset = <span class="type">Students</span>.objects.all()</span></span><br><span class="line"><span class="class">         serializer = <span class="type">StudentsSerializer</span></span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
<li><p>在settings文件中注册test_framework应用</p>
<ul>
<li><pre><code class="python">INSTALLED_APPS = [
    <span class="string">'test_framework'</span>
]
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CLEAN"><figure class="iseeu highlight /clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">4.</span> 设置test_framework模块路由</span><br><span class="line"></span><br><span class="line">   - ```python</span><br><span class="line">     <span class="keyword">from</span> test_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line">     <span class="keyword">from</span> .views <span class="keyword">import</span> StudentsAPIViews</span><br><span class="line">     urlpatterns = []</span><br><span class="line">     router = DefaultRouter()</span><br><span class="line">     router.register(<span class="string">'student'</span>,StudentsAPIViews,basename=<span class="string">'StudentsAPIViews'</span>)</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     urlpatterns += router.urls</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
<li><p>在主路由中配置好应用的路由</p>
<ul>
<li><pre><code class="python"><span class="keyword">from</span> fjango.contrib <span class="keyword">import</span> admin
<span class="keyword">from</span> django.urls <span class="keyword">import</span> path,include
urlpatterns = [
    path(<span class="string">'admin/'</span>,admin.site.urls),
    path(<span class="string">'api/'</span>,include(<span class="string">'drf_app.urls'</span>)),
]</code></pre>
</li>
</ul>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django中间件</title>
    <url>/Django/Django_id_23.html</url>
    <content><![CDATA[<h2 id="django中间件"><a href="#django中间件" class="headerlink" title="django中间件"></a>django中间件</h2><a id="more"></a>
<p>中间件需要使用request参数的META属性</p>
<ul>
<li><p>获取用户ip地址</p>
<ul>
<li>​        如下所示</li>
<li></li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CSS"><figure class="iseeu highlight /css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">request</span><span class="selector-class">.META</span><span class="selector-attr">[<span class="string">'REMOTE_ADDR'</span>]</span></span><br></pre></td></tr></table></figure></div>



</li>
</ul>
<h2 id="自定义中间件类对访问的ip进行限制-从而对特定ip进行封号处理"><a href="#自定义中间件类对访问的ip进行限制-从而对特定ip进行封号处理" class="headerlink" title="自定义中间件类对访问的ip进行限制,从而对特定ip进行封号处理"></a>自定义中间件类对访问的ip进行限制,从而对特定ip进行封号处理</h2><ol>
<li><p>创建一个全新的中间件文件</p>
<ol>
<li><p>创建一个新的中间件问价</p>
<ul>
<li><p>middleware.py</p>
</li>
<li><pre><code class="python"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse

<span class="class"><span class="keyword">class</span> <span class="title">BlockedIPSMiddleware</span><span class="params">(object)</span>:</span>
    EXCLUDE = [<span class="string">'192.168.1.238'</span>,<span class="string">'127.0.0.1'</span>]
    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self,request,view_func,*view_args,**view_keargs)</span>:</span>
        user_ip = request.META[<span class="string">'REMOTE_ADDR'</span>]
        <span class="keyword">if</span> user_ip <span class="keyword">in</span> BlockedIPSMiddleware.EXCLUDE:
            <span class="keyword">return</span> HttpResponse(<span class="string">"拒绝访问"</span>)
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 注意,<span class="number">2.0</span>以后无法使用以上的方法进行中间价创建</span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  <span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line">  </span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">BlockedIPSMiddleware</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">      EXCLUDE = [<span class="string">'192.168.1.238'</span>,<span class="string">'127.0.0.1'</span>]</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self,request,view_func,*view_args,**view_keargs)</span>:</span></span><br><span class="line">          user_ip = request.META[<span class="string">'REMOTE_ADDR'</span>]</span><br><span class="line">          <span class="keyword">if</span> user_ip <span class="keyword">in</span> BlockedIPSMiddleware.EXCLUDE:</span><br><span class="line">              <span class="keyword">return</span> HttpResponse(<span class="string">"拒绝访问"</span>)</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
</ul>
</li>
<li><p>创建好之后,再setting文件中进行中间件注册</p>
<ul>
<li>setting.py文件中</li>
<li>MIDDLEWARE = [要注册的中间件函数路径]</li>
<li>该路径需要精确到中间件函数类</li>
</ul>
</li>
<li><p>运行django项目,可以看到,被记录的函数已经无法正常访问这个项目了</p>
</li>
<li><p>中间件覆盖了项目所属所有的页面</p>
</li>
</ol>
</li>
<li><p>process_exception</p>
<ol>
<li><p>这个中间件函数将会在视图函数出错的时候进行调用</p>
</li>
<li><h5 id="注意-这个函数在进行调用的时候-如果多个中间件类都定义了这个函数并且都进行了注册-将会以从下往上的顺序进行调用"><a href="#注意-这个函数在进行调用的时候-如果多个中间件类都定义了这个函数并且都进行了注册-将会以从下往上的顺序进行调用" class="headerlink" title="注意,这个函数在进行调用的时候,如果多个中间件类都定义了这个函数并且都进行了注册,将会以从下往上的顺序进行调用"></a>注意,这个函数在进行调用的时候,如果多个中间件类都定义了这个函数并且都进行了注册,将会以从下往上的顺序进行调用</h5></li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>DRF框架的权限验证器与限流</title>
    <url>/Django/Django_id_03.html</url>
    <content><![CDATA[<h2 id="DRF框架权限验证器"><a href="#DRF框架权限验证器" class="headerlink" title="DRF框架权限验证器:"></a>DRF框架权限验证器:</h2><a id="more"></a>
<p>基础验证器</p>
<ol>
<li><p>drf中集成了关于权限验证的一些基本模块,具体可以分为:</p>
<p>​            所有用户均可访问———AllowAny</p>
<p>​            登录用户可访问–-——IsAuthenticated</p>
<p>​            仅限管理员权限可以访问——–IsAdminUser</p>
</li>
<li><p>关于基本权限验证模块的使用方法</p>
<ul>
<li><p>话不多说,上代码</p>
</li>
<li><pre><code class="python"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> AllowAny
<span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView
<span class="class"><span class="keyword">class</span> <span class="title">MyPermissions</span><span class="params">(APIView)</span>:</span>

    permission_classes = [AllowAny]
    <span class="comment">#当视图函数中设定permission_classes的值为AllowAny时,这个页面允许任何人访问,也就是说,相当于允许游客进行访问</span>
    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(selfg,request)</span>:</span>
        <span class="keyword">return</span> HttpResponse(<span class="string">'权限验证通过,欢迎'</span>)


</code></pre>
</li>
</ul>
</li>
</ol>
<pre><code>from rest_framework.permissions import IsAuthenticated,IsAdminUser
from rest_framework.views import APIView
class MyPermissions(APIView):

    permission_classes = [IsAuthenticated]
    #当视图函数中设定permission_classes的值为IsAuthenticated时,这个页面允许任何用户访问,也就是说,只要你进行登录,就可以进行访问
    def get(selfg,request):
        return HttpResponse(&apos;权限验证通过,欢迎&apos;)


from rest_framework.permissions import IsAdminUser
from rest_framework.views import APIView
class MyPermissions(APIView):

    permission_classes = [IsAdminUser]
    #当视图函数中设定permission_classes的值为IsAdminUser时,这个页面只允许拥有管理员权限的用户进行访问
    def get(selfg,request):
        return HttpResponse(&apos;权限验证通过,欢迎&apos;)
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">     </span><br><span class="line"></span><br><span class="line"># 自定义权限验证器:</span><br><span class="line"></span><br><span class="line">1. 在drf中,允许我们自定义一些权限验证器,来实现我们想要的一些功能,比如说.…...留后门、留后门,还有...留后门之类的操作,当然,如果是大公司,同时自己又没有高级权限的话,不建议留后门,毕竟如果留后门被发现了的话不太好,哈哈哈哈</span><br><span class="line"></span><br><span class="line">2. 上代码</span><br><span class="line"></span><br><span class="line">   - 首先创建一个自定义的权限验证,这个验证就不需要使用自带的模块了,直接自定义</span><br><span class="line"></span><br><span class="line">   - ```python</span><br><span class="line">     from rest_framework.permissions import BasePermission</span><br><span class="line">     class My_permissions(BasePermission):</span><br><span class="line">         def has_permission(self,request,view):</span><br><span class="line">             if request.query_paramy.get('user') == 'root':</span><br><span class="line">                 return True</span><br></pre></td></tr></table></figure></code></pre><ul>
<li><p>在调用权限验证的时候选择使用自定义的权限验证器</p>
</li>
<li><pre><code class="python"><span class="class"><span class="keyword">class</span> <span class="title">MyPermissions</span><span class="params">(APIView)</span>:</span>
    permission_classes = [My_permissions]
    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span>
        <span class="keyword">return</span> HttpResponse(<span class="string">'权限验证通过,欢迎'</span>)
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 限流</span><br><span class="line"></span><br><span class="line">### 全局限流设置:</span><br><span class="line"></span><br><span class="line">- 在setting文件中设定限流要求</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    </span><br><span class="line">    REST_FRAMEWORK = &#123;</span><br><span class="line">        'DEFAULT_THROTTLE_CLASSES':(</span><br><span class="line">            'rest_framework.throttling.AnonRateThrottle',</span><br><span class="line">            'rest_framework.throttling.UserRateThrottle'</span><br><span class="line">        ),</span><br><span class="line">        'DEFAULT_THROTTLE_RATES':&#123;</span><br><span class="line">            #单位时间内访问次数限制</span><br><span class="line">            #anon匿名用户限流</span><br><span class="line">            'anon':'1/second',</span><br><span class="line">            #user注册用户限流</span><br><span class="line">            'user':'1/second'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

- 注册限流信息时,所需要使用的rest_framework模块需要现在INSTALLED_APPS中进行配置才能进行使用,同时,这里使用的时候需要与注册的app名相同


</code></pre>
</li>
</ul>
<h3 id="局部限流设置"><a href="#局部限流设置" class="headerlink" title="局部限流设置:"></a>局部限流设置:</h3><ul>
<li><p>无论是局部限流还是全局限流,都需要现在setting文件中进行配置,但是这个配置并不相同</p>
<ul>
<li><pre><code class="python">REST_FRAMEWORK = {
    <span class="string">'DEFAULT_THROTTLE_RATES'</span>:{
        <span class="string">'anon'</span>:<span class="string">'1/second'</span>,
        <span class="string">'user'</span>:<span class="string">'1/second'</span>
    }
}
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 在进行局部限流时,不需要导入自带的限流模块</span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  <span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line">  <span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> UserRateThrottle</span><br><span class="line">  <span class="keyword">class</span> <span class="symbol">Mythrottling</span>(<span class="symbol">APIView</span>):</span><br><span class="line">      <span class="symbol">throttling_class</span> = [<span class="symbol">UserRateThrottle</span>]</span><br><span class="line">      <span class="symbol">def</span> <span class="symbol">get</span>(<span class="symbol">self,<span class="symbol">request</span></span>):</span><br><span class="line">          <span class="symbol">return</span> <span class="symbol">Response</span>('这是投票页面')</span><br></pre></td></tr></table></figure></div>


</code></pre>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django数据库操作</title>
    <url>/Django/Django_id_30.html</url>
    <content><![CDATA[<h2 id="Django数据库操作"><a href="#Django数据库操作" class="headerlink" title="Django数据库操作"></a>Django数据库操作</h2><h2 id="Django中不需要定义id字段"><a href="#Django中不需要定义id字段" class="headerlink" title="#Django中不需要定义id字段"></a>#Django中不需要定义id字段</h2><a id="more"></a>

<h3 id="数据库创建–基础字段"><a href="#数据库创建–基础字段" class="headerlink" title="数据库创建–基础字段:"></a>数据库创建–基础字段:</h3><ul>
<li><p>CharField(定义一个字符串类型的字段)</p>
<ul>
<li>max_length=xx,  定义字符串最大长度</li>
</ul>
</li>
<li><p>DateField(定义一个时间类型的字段)</p>
<ul>
<li>时间类型字段一共有三个,TimeField</li>
</ul>
</li>
<li><p>BooleanField</p>
</li>
<li><p>FileField</p>
<ul>
<li>文件字段</li>
</ul>
</li>
<li><p>TextField</p>
<ul>
<li>大文本字段,超过4000字符的文本使用这个字段</li>
</ul>
</li>
<li><p>ImageField</p>
<ul>
<li>上传图片</li>
</ul>
</li>
<li><p>ForeignKey  外键</p>
<ul>
<li><p>第一个参数为要关联的模型类</p>
</li>
<li><h3 id="第二个参数必须加上下面这个参数-才能保证正确"><a href="#第二个参数必须加上下面这个参数-才能保证正确" class="headerlink" title="第二个参数必须加上下面这个参数,才能保证正确"></a>第二个参数必须加上下面这个参数,才能保证正确</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="INI"><figure class="iseeu highlight /ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">on_delete</span>=models.CASCADE</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在django2.0之后的版本中不在有默认的on_delete,所以这里需要手动传入这个参数</p>
<ul>
<li><pre><code>on_delete=None,               # 删除关联表中的数据时,当前表与其关联的field的行为
    on_delete=models.CASCADE,     # 删除关联数据,与之关联也删除
    on_delete=models.DO_NOTHING,  # 删除关联数据,什么也不做
    on_delete=models.PROTECT,     # 删除关联数据,引发错误ProtectedError
    # models.ForeignKey(&apos;关联表&apos;, on_delete=models.SET_NULL, blank=True, null=True)
    on_delete=models.SET_NULL,    # 删除关联数据,与之关联的值设置为null（前提FK字段需要设置为可空,一对一同理）
    # models.ForeignKey(&apos;关联表&apos;, on_delete=models.SET_DEFAULT, default=&apos;默认值&apos;)
    on_delete=models.SET_DEFAULT, # 删除关联数据,与之关联的值设置为默认值（前提FK字段需要设置默认值,一对一同理）
    on_delete=models.SET,         # 删除关联数据,
     a. 与之关联的值设置为指定值,设置：models.SET(值)
     b. 与之关联的值设置为可执行对象的返回值,设置：models.SET(可执行对象)
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">## 字段属性</span><br><span class="line"></span><br><span class="line">- default</span><br><span class="line">- null</span><br><span class="line">  - 判断字段能不能为空</span><br><span class="line">  - 默认为false</span><br><span class="line">- primary_key</span><br><span class="line">  - 主键约束</span><br><span class="line">- Foregin_key</span><br><span class="line">  - 外键约束\</span><br><span class="line">- autoincerment</span><br><span class="line">  - 自增长</span><br><span class="line">- blank</span><br><span class="line">  - 后台出入数据时是否允许为空</span><br><span class="line">- verbose_name</span><br><span class="line">  - 设定字段在管理页面显示的名称</span><br><span class="line"></span><br><span class="line">## 插入、更新和删除</span><br><span class="line"></span><br><span class="line">#### 插入、更新</span><br><span class="line"></span><br><span class="line">​	save()</span><br><span class="line"></span><br><span class="line">#### 删除</span><br><span class="line"></span><br><span class="line">​	delete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">## 生成迁移文件</span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  python manage.py makemigrations</span><br><span class="line">  #生成迁移脚本</span><br></pre></td></tr></table></figure></code></pre></li>
</ul>
</li>
</ul>
</li>
<li><pre><code class="python">python manage.py migrate
<span class="comment">#将迁移脚本映射到数据库之中</span>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">## 修改Django数据库默认配置:</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">#修改setting文件中的database中的参数</span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    'default': &#123;</span><br><span class="line">        'ENGINE': 'django.db.backends.mysql',</span><br><span class="line">        # 'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),</span><br><span class="line">        'NAME': 'django_demo',#数据库名称,需要手动创建好数据库</span><br><span class="line">        'USER': "root",	#用户名,默认为root</span><br><span class="line">        'PASSWORD': '000000',#mysql密码</span><br><span class="line">        'HOST': 'localhost',#数据库地址,一般为本机127.0.0.1,通localhost</span><br><span class="line">        'PORT': '3306'#MySQL数据库端口号.默认3306</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<hr>
<h2 id="运行整个项目"><a href="#运行整个项目" class="headerlink" title="运行整个项目:"></a>运行整个项目:</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure></div>

<hr>
<h2 id="通过models文件在数据库中添加数据"><a href="#通过models文件在数据库中添加数据" class="headerlink" title="通过models文件在数据库中添加数据"></a>通过models文件在数据库中添加数据</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">python manage.py shell</span><br><span class="line"><span class="comment">#进入交互模式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> 模块名.models <span class="keyword">import</span> 模型类名</span><br><span class="line"><span class="keyword">from</span> first.models <span class="keyword">import</span> BookInfo</span><br><span class="line">b = BookInfo()</span><br><span class="line">b.btitle = <span class="string">'天龙八部'</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line">b.bpub_data = date(<span class="number">1998</span>,<span class="number">3</span>,<span class="number">22</span>)</span><br><span class="line">b.save()</span><br></pre></td></tr></table></figure></div>

<h2 id="通过模型类从数据库中获取对应的数据"><a href="#通过模型类从数据库中获取对应的数据" class="headerlink" title="通过模型类从数据库中获取对应的数据"></a>通过模型类从数据库中获取对应的数据</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">b1 = BookInfo.objects.get(id=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div>

<p>#通过模型对象BookInfo的objects方法的get方法获取满足对应条件的字段 </p>
<p>type(b1)</p>
<p>#返回对象是First.models.BookInfo</p>
<h3 id="修改表中数据"><a href="#修改表中数据" class="headerlink" title="修改表中数据:"></a>修改表中数据:</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GCODE"><figure class="iseeu highlight /gcode"><table><tr><td class="code"><pre><span class="line">b<span class="number">1.</span>btitle = <span class="string">'新的数据'</span></span><br><span class="line">b<span class="number">1.</span>save<span class="comment">()</span></span><br></pre></td></tr></table></figure></div>

<p>从根本上来说,修改数据仅仅只是拿到数据之后重新赋值,然后进行提交而已</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CPP"><figure class="iseeu highlight /cpp"><table><tr><td class="code"><pre><span class="line">b1.<span class="keyword">delete</span>()</span><br></pre></td></tr></table></figure></div>

<p>从数据库中删除这条数据</p>
<hr>
<h2 id="外键查询"><a href="#外键查询" class="headerlink" title="外键查询:"></a>外键查询:</h2><ul>
<li><p>ForeignKey设置外键</p>
</li>
<li><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment">#书名</span></span><br><span class="line">    btitle = models.CharField(max_length=<span class="number">10</span>)</span><br><span class="line">    <span class="comment">#上架时间</span></span><br><span class="line">    bpub_data = models.DateField()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeroInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment">#人物名</span></span><br><span class="line">    hname = models.CharField(max_length=<span class="number">10</span>)</span><br><span class="line">    <span class="comment">#人物性别,true为男,false为女</span></span><br><span class="line">    hgender = models.BooleanField(default=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment">#简介</span></span><br><span class="line">    hcomment = models.CharField(max_length=<span class="number">300</span>)</span><br><span class="line">    <span class="comment">#人物所属书籍,一对多关系</span></span><br><span class="line">    <span class="comment">#设置外键</span></span><br><span class="line">    hbook = models.ForeignKey(<span class="string">'BookInfo'</span>,on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>外键创建好之后的字段名为设定好的models模型里面的外键字段加上_id,这个id和另一个表的id对照</p>
</li>
<li><pre><code class="python">b = BookInfo()
b.btitle = <span class="string">'天龙八部'</span>
<span class="keyword">from</span> datetime <span class="keyword">import</span> date
b.bpub_data = date(<span class="number">1998</span>,<span class="number">2</span>,<span class="number">33</span>)
b.save()
<span class="comment">#之后添加HeroInfo表的数据</span>
h = HeroInfo()
h.hname = <span class="string">'段誉'</span>
h.hgender = <span class="literal">True</span>
<span class="comment">#外键字段赋值为已经创建好的与这条数据关联的bookinfo表对象</span>
<span class="comment">#通过这个字段可以查询到对应表的信息</span>
h.hbook = b

<span class="comment">###################################################################</span>
<span class="comment">#一对多的情况下查询一的信息</span>
&gt;&gt;&gt;h.hbook.btitle
&gt;&gt;&gt;<span class="string">'天龙八部'</span>
&gt;&gt;&gt;h.hbook.bpub_data
&gt;&gt;&gt;datetime.date(<span class="number">1998</span>,<span class="number">2</span>,<span class="number">33</span>)
<span class="comment">#一对多查询所属信息</span>
&gt;&gt;&gt;b.heroinfo_set.all()
<span class="comment">#返回的结果是一个集合,里面以列表形式放置了所有对应的数据</span>
<span class="meta">&gt;&gt;&gt; </span>&lt;QuerySet [&lt;HeroInfo: HeroInfo object (<span class="number">1</span>)&gt;]&gt;
&gt;&gt;&gt;b.heroinfo_set.first()
<span class="comment">#返回的结果是对应数据的第一条</span>
<span class="meta">&gt;&gt;&gt; </span>&lt;HeroInfo: HeroInfo object (<span class="number">1</span>)&gt;
<span class="comment">#通过将这一条数据赋值之后可以继续进行一些查询</span>
&gt;&gt;&gt;b1 = b.heroinfo_set.first()
&gt;&gt;&gt;b1.hname
&gt;&gt;&gt;<span class="string">"段誉"</span>
<span class="comment">######################################################</span>
<span class="comment">#查询全部数据</span>
<span class="meta">&gt;&gt;&gt; </span>BookInfo.objects.all()
<span class="meta">&gt;&gt;&gt; </span>HeroInfo.objects.all()
<span class="comment">#模型类名.objects.all()</span></code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="数据库查询语句"><a href="#数据库查询语句" class="headerlink" title="数据库查询语句"></a>数据库查询语句</h2><h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><ul>
<li><p>all</p>
<ul>
<li>all返回的是一个数据集合</li>
<li>此返回数据可以进行遍历</li>
</ul>
</li>
<li><p>filter</p>
<ul>
<li>返回的结果也是一个集合,可以遍历</li>
<li>属性名__exact = 1<ul>
<li>判断是否相等</li>
<li>此项属性等同于id = 1</li>
</ul>
</li>
<li>属性名__contains<ul>
<li>查询包含某个字符的数据</li>
</ul>
</li>
<li>属性名__endswith<ul>
<li>查询以某字符结尾的数据</li>
<li>以某字符串结尾</li>
</ul>
</li>
<li>属性名__startswith<ul>
<li>以某字符串开头</li>
</ul>
</li>
<li>属性名__range<ul>
<li>在一个范围之内(前面为小值，后面为大值)</li>
</ul>
</li>
<li>属性名__isnull<ul>
<li>查询某字段为空或者不为空的数据</li>
<li>属性名_isnull=false    不为空</li>
<li>属性名__isnull=true   为空</li>
</ul>
</li>
<li>属性名__in = [1,2,3]<ul>
<li>查询目标字段再此列表元素的范围内的数据</li>
</ul>
</li>
<li>属性名__gt = 3(gt为大于)<ul>
<li>等同于                属性名 &gt; 3</li>
</ul>
</li>
<li>属性名__lt = 3(lt为小于)<ul>
<li>等同于                属性名 &lt; 3</li>
</ul>
</li>
<li>属性名__gte = 3(gte为大于等于)<ul>
<li>等同于                属性名 &gt;= 3</li>
</ul>
</li>
<li>属性名__lte = 3(lte为小于等于)<ul>
<li>等同于                属性名 &lt;= 3</li>
</ul>
</li>
<li>属性名__year<ul>
<li>bpub_date__year = 1980</li>
<li>查询1980年之后的数据</li>
<li>查询时间信息还可以使用上面的大于等于的方法<ul>
<li>bpub_date_gt = date(1998,1,1)</li>
<li>查询在1998年1月1日之后的数据</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>exclude</p>
<ul>
<li><p>返回的结果也是一个集合,可以遍历</p>
</li>
<li><p>查询不满足某个条件的数据</p>
</li>
</ul>
</li>
<li><p>order_by排序</p>
<ul>
<li><p>返回的结果也是一个集合,可以遍历</p>
</li>
<li><p>排序字段一般是放在条件查询之后进行的</p>
</li>
<li><p>BackInfo.objects.all().order_by(‘id’)</p>
<ul>
<li>默认排序方式为升序排列</li>
</ul>
</li>
<li><p>BackInfo.objects.all().order_by(‘-id’)</p>
<ul>
<li>在前面加个-将会进行降序排列</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h3><ul>
<li>两个条件并存</li>
<li>与&amp;<ul>
<li>filter(id_gt=1,age_gt=10)<ul>
<li>id大于1并且age大于10</li>
</ul>
</li>
</ul>
</li>
<li>或  |<ul>
<li>这个条件查询需要导入一个新的模块</li>
<li>from django.db.models import Q</li>
<li>filter(Q(id=1) | Q(age=15))</li>
<li>创建新的Q对象,作为或条件的单位,</li>
</ul>
</li>
<li>查询条件为一个字段的数值大于另一个字段的数据<ul>
<li>如,查询一本书的阅读量大于评论量的的数据</li>
<li>这个时候需要导入一个新的模块F<ul>
<li>from django.db.models import F</li>
<li>使用f模块构造对应字段的对象,并将这个对象作为条件进行查询</li>
<li>BookInfo.objects.filter(bread_gt=F(bcomment))</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数."></a>聚合函数.</h3><h5 id="—-—-聚合操作的关键字"><a href="#—-—-聚合操作的关键字" class="headerlink" title="—-—-聚合操作的关键字:"></a>—-—-聚合操作的关键字:</h5><p>​    <strong>aggregate</strong></p>
<p>​    查询时所使用的模块都在django.db.models这个包里面</p>
<h4 id="聚合函数总览"><a href="#聚合函数总览" class="headerlink" title="聚合函数总览"></a>聚合函数总览</h4><ul>
<li>count该字段的总个数</li>
<li>max最大数值</li>
<li>min最小数值</li>
<li>sum该字段数值的和</li>
<li>avg平均数值</li>
</ul>
<h4 id="聚合函数使用时需要导入模块"><a href="#聚合函数使用时需要导入模块" class="headerlink" title="聚合函数使用时需要导入模块"></a>聚合函数使用时需要导入模块</h4><ol>
<li>​    <u>f<strong>rom django.db.models import Count,Max,Min,Avg,Sum</strong></u></li>
<li>​    <u><strong>这五个聚合函数需要从django.db.models里面引入进来</strong></u></li>
<li>​    <u><strong>BookInfo.objects.aggregate(Sum(‘bread’))</strong></u></li>
<li>​    <u><strong>模型类名.bojects.aggregate(聚合函数(字段名))</strong></u></li>
<li>​    <u><strong>当不加查询条件时默认为all,也就是说,all时可以省略的</u></strong></li>
</ol>
<h5 id="当进行聚合之后-返回的值是一个字典-书写形式为-key-聚合的属性名-聚合方式-value-聚合的结果"><a href="#当进行聚合之后-返回的值是一个字典-书写形式为-key-聚合的属性名-聚合方式-value-聚合的结果" class="headerlink" title="当进行聚合之后,返回的值是一个字典,书写形式为,key = 聚合的属性名__聚合方式      ,value = 聚合的结果"></a>当进行聚合之后,返回的值是一个字典,书写形式为,key = 聚合的属性名__聚合方式      ,value = 聚合的结果</h5><h4 id="聚合函数另一种用法"><a href="#聚合函数另一种用法" class="headerlink" title="聚合函数另一种用法:"></a>聚合函数另一种用法:</h4><p>在已经进行过条件查询的情况下,直接使用小写的.count()得到的结果时一个数值,这个数值是已经查询到的数据的总数</p>
<p>但是因为条件查询完毕之后获取的是数据集合,所以这个数据集合是没有其他的属性的,他唯一适用的聚合函数只有一个,那就是计算总数的<strong><u><code>count</code></u></strong></p>
<p>注意,在所有返回的为数据集合的查询语句后面,以上的所有函数都是可以用的,你可以继续在后面使用分类,</p>
<p>所有结果为查询集的结果都是可以进行切片的,[:]</p>
<p>注意,这个切片使用的下标是不允许使用负数的</p>
<p>切片之后的结果依然是一个查询集,可以使用get()方法进行查询</p>
<p>exists()   判断这个查询集中是否有数据,有返回True,没有返回False</p>
<p>existe     相当于查看这个判断并展示这个查询及的全部数据</p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django-filter过滤器的使用</title>
    <url>/Django/Django_id_04.html</url>
    <content><![CDATA[<h2 id="Django-filter模块使用"><a href="#Django-filter模块使用" class="headerlink" title="Django-filter模块使用:"></a>Django-filter模块使用:</h2><a id="more"></a>
<h2 id="目前-过滤器django-filter只能在ListAPIView的子类中使用"><a href="#目前-过滤器django-filter只能在ListAPIView的子类中使用" class="headerlink" title="目前,过滤器django_filter只能在ListAPIView的子类中使用"></a>目前,过滤器django_filter只能在ListAPIView的子类中使用</h2><ol>
<li><h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><ul>
<li><pre><code class="python"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> ListAPIView
<span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend
<span class="class"><span class="keyword">class</span> <span class="title">MYfilter</span><span class="params">(ListAPIView)</span>:</span>
    queryset = Students.objects.all()
    serializer_class = StudentsSerializer
    filter_backends = [DjangoFilterBackend]
    filter_fields = (<span class="string">"id"</span>,)
    <span class="comment">#注意,filter_fields的值必须是一个元组!!!!</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ASCIIDOC"><figure class="iseeu highlight /asciidoc"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">- </span>使用方法</span><br></pre></td></tr></table></figure></div>
在网址url之后追加-------/?id=1
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">2. ### 排序</span><br><span class="line"></span><br><span class="line">   - ```python</span><br><span class="line">     from rest_framework.filters import OrderingFilter</span><br><span class="line">     from rest_framework.generics import ListAPIView</span><br><span class="line">     class MYfilter(ListAPIView):</span><br><span class="line">         queryset = Students.objects.all()</span><br><span class="line">         serializer_class = StudentsSerializer</span><br><span class="line">         filter_backends = [OrderingFilter]</span><br><span class="line">         ordering_fields = ['id']</span><br></pre></td></tr></table></figure></code></pre>
</li>
<li><p>使用方法</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line">在网址url之后追加------/?<span class="attribute">ordering</span>=xx</span><br><span class="line">xx为ordering_fields中准备的用来作为排序基准的字段</span><br><span class="line">倒序为在xx前加上-号</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django模型管理器</title>
    <url>/Django/Django_id_18.html</url>
    <content><![CDATA[<h2 id="模型管理器详解"><a href="#模型管理器详解" class="headerlink" title="模型管理器详解"></a>模型管理器详解</h2><a id="more"></a>
<ol>
<li><h2 id="objects模型管理器"><a href="#objects模型管理器" class="headerlink" title="objects模型管理器"></a>objects模型管理器</h2><ol>
<li><p>本质上来说,objects其实是django为我们封装的一个特殊的模型管理器类,它本质上其实是models.Manager对象</p>
</li>
<li><p>也就是说,我们可以通过重写models.Manager的方法来实现给这个管理器进行重命名</p>
</li>
<li><p>如:</p>
<ol>
<li><pre><code class="python"><span class="comment">#在模型类属性之中直接重写models.manger方法</span>
book = models.manger()
<span class="comment">#自定义一个管理器对象,这之后我们就可以不适用objects来进行查询</span>
<span class="comment">#而是使用book来进行查询</span>
BookInfo.book.all()
<span class="comment">#在进行定义之后,将无法使用原本的objects</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2.</span> <span class="comment">## 常用的重写模型管理器方法</span></span><br><span class="line"></span><br><span class="line">   <span class="number">1.</span> 创建一个模型类来进行重写</span><br><span class="line"></span><br><span class="line">      <span class="number">1.</span> ```python</span><br><span class="line">         <span class="class"><span class="keyword">class</span> <span class="title">BookInfoManger</span><span class="params">(models.Manager)</span>:</span></span><br><span class="line">             <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>这是最简单得到重写Manager的方法</p>
</li>
<li><p>通过这个类可以创建全新的Manager对象来进行查询</p>
</li>
<li><p>注意,一旦进行重写之后,django自带的objects将会无法使用,只能使用自己创建的对象进行查询</p>
</li>
</ol>
</li>
<li><p>在模型类之中进行其他的编写</p>
<ol>
<li><p>重写all方法(改变结果集)</p>
<ul>
<li><pre><code class="python"><span class="function"><span class="keyword">def</span> <span class="title">all</span><span class="params">(self)</span>:</span>
    <span class="comment">#通过super方法调用父类的all方法对模型类对象进行查询</span>
    books = super().all()
    <span class="comment">#对处理过的结果进行处理</span>
    books = books.filter(id__gt=<span class="number">1</span>)
    <span class="comment">#将结果返回</span>
    <span class="keyword">return</span> books
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="FSHARP"><figure class="iseeu highlight /fsharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 这样处理过的all方法在调用时将不会返回全部的数据,而是会根据这个重新定义的all方法对数据进行处理之后才会返回,</span><br><span class="line"></span><br><span class="line">- 最终返回结果为</span><br><span class="line"></span><br><span class="line">  ```python</span><br><span class="line">  &gt;&gt;&gt; BookInfo.a.all()</span><br><span class="line">  &gt;&gt;&gt; &lt;QuerySet <span class="meta">[&lt;BookInfo: 神墓&gt;, &lt;BookInfo: 龙蛇演义&gt;, &lt;BookInfo: 那年那兔那些事儿&gt;, &lt;BookInfo: 亮剑&gt;, &lt;BookInfo: 秒速五厘米&gt;, &lt;BookInfo: 你的名字&gt;]</span>&gt;</span><br></pre></td></tr></table></figure></div>

返回结果为一个返回集</code></pre>
</li>
</ul>
</li>
<li><p>自定义类方法(定义额外的方法)</p>
<ul>
<li><p>在这里我们可以自定义一些方法,比如自定义一些添加用的方法,也即是说,把原本复杂的添加方法封装成为类方法进行使用,这样的话,可以减少代码的数量</p>
</li>
<li><p>重写字段添加</p>
<ul>
<li><pre><code class="python"><span class="meta">@classmethod</span>
<span class="function"><span class="keyword">def</span> <span class="title">create_book</span><span class="params">(cls,btitle,bpub_date,cate_id)</span>:</span>
    obj = BookInfo()
    obj.btitle = btitle
    obj.bpub_date = bpub_date
    obj.cate_id = cate_id
    obj.save()
    <span class="keyword">return</span> obj
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ARMASM"><figure class="iseeu highlight /armasm"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 重写添加信息方法</span><br><span class="line"></span><br><span class="line">- 在模型类中的写法,此方法不适合写在模型类中,因为过多的类方法会使模型类变得臃肿,不方便使用,所以我们一般将这些方法定义在我们重写的manager模型管理器中</span><br><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  def create_book(<span class="keyword">self,btitle,bpub_date,cate_id):</span></span><br><span class="line"><span class="keyword"> </span>     obj = <span class="keyword">BookInfo()</span></span><br><span class="line"><span class="keyword"> </span>     obj.<span class="keyword">btitle </span>= <span class="keyword">btitle</span></span><br><span class="line"><span class="keyword"> </span>     obj.<span class="keyword">bpub_date </span>= <span class="keyword">bpub_date</span></span><br><span class="line"><span class="keyword"> </span>     obj.cate_id = cate_id</span><br><span class="line">      obj.save()</span><br><span class="line">      return objpython</span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>这两种方法都可以使用,</p>
</li>
<li><p>重写封装的方法适用于增删改查的所有方法</p>
</li>
<li><p>在manager函数中,封装好了一个model方法,这个方法返回的是调用这个方法的模型类</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CRYSTAL"><figure class="iseeu highlight /crystal"><table><tr><td class="code"><pre><span class="line"><span class="keyword">self</span>.model()</span><br></pre></td></tr></table></figure></div>

<p>使用这个方法之后,就不会出现换一个模型类就无法调用的情况了</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>axios请求与跨域</title>
    <url>/Vue/Vue_id_03.html</url>
    <content><![CDATA[<h2 id="axios请求与跨域"><a href="#axios请求与跨域" class="headerlink" title="axios请求与跨域."></a>axios请求与跨域.</h2><a id="more"></a>
<ol>
<li><p>创建一个django工程并运行</p>
</li>
<li><p>运行vue工程</p>
</li>
<li><p>vue配置跨域</p>
<ul>
<li><p>cd vueproject/src/main.js</p>
<ul>
<li>导入axios模块</li>
<li>import axios from ‘axios’</li>
<li>注册axios模块</li>
<li>Vue.prototype.$axios = axios</li>
</ul>
</li>
<li><p>cd vueproject/config/index.js</p>
<ul>
<li><p>配置跨域请求—-—-proxytable</p>
</li>
<li><pre><code class="javascript">proxyTable: {
    <span class="string">'/api'</span>: {
        target: <span class="string">'http://127.0.0.1:8000/api/test/'</span>,
        #要连接的接口
        changeOrigin: <span class="literal">true</span>,
        #是否跨域
        pathRewrite: {
            <span class="string">'^api/'</span>:<span class="string">''</span>
            #重写接口的域名
        }    
    }
}
&lt;!--￼<span class="number">0</span>--&gt;
<span class="keyword">export</span> <span class="keyword">default</span> {
    name:<span class="string">'User'</span>,
    data(){
        <span class="keyword">return</span> {
            page_info: <span class="string">'this is user route'</span>
        }
    },
    created(){
        <span class="keyword">this</span>.$axios.get(<span class="string">'http://127.0.0.1:8000/api/test'</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> {<span class="built_in">console</span>.log(response.data)})
    }
}
&lt;!--￼<span class="number">1</span>--&gt;</code></pre>
</li>
</ul>
</li>
<li><p>创建django跨域中间件</p>
<ul>
<li><p>在应用中创建middlewares.py文件</p>
</li>
<li><pre><code class="python"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin
<span class="class"><span class="keyword">class</span> <span class="title">MyTest</span><span class="params">(MiddlewareMixin)</span>:</span>
    <span class="function"><span class="keyword">def</span> <span class="title">precess_response</span><span class="params">(self,request,response)</span>:</span>
        response[<span class="string">'Access-Control-Allow-Origin'</span>] = [<span class="string">'*'</span>]
        <span class="keyword">return</span> response
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DIFF"><figure class="iseeu highlight /diff"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="deletion">- 注册中间件</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-</span></span><br></pre></td></tr></table></figure></div>
<span class="string">'app.middlewares.MyTest'</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">5. </span>在完成了上述步骤之后,跨域请求的基本要求就完成了</span><br><span class="line"></span><br><span class="line"><span class="bullet">6. </span>将获得数据绑定到vue模板中去</span><br><span class="line"></span><br><span class="line"><span class="bullet">   - </span>在模板版中准备一个接受用的变量</span><br><span class="line"></span><br><span class="line"><span class="code">     -</span></span><br></pre></td></tr></table></figure></div>
django_message : <span class="string">''</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HAML"><figure class="iseeu highlight /haml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">-<span class="ruby"> 在请求到数据之后将数据赋予这个变量</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">  -</span></span><br></pre></td></tr></table></figure></div>
this.django_message = response.data.message</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li></li>
</ol>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Axios</tag>
      </tags>
  </entry>
  <entry>
    <title>API接口生成</title>
    <url>/Vue/Vue_id_01.html</url>
    <content><![CDATA[<h2 id="自动创建api接口的文档"><a href="#自动创建api接口的文档" class="headerlink" title="自动创建api接口的文档"></a>自动创建api接口的文档</h2><a id="more"></a>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置:"></a>配置:</h2><h4 id="setting文件配置"><a href="#setting文件配置" class="headerlink" title="setting文件配置:"></a>setting文件配置:</h4><ol>
<li><p>下载模块</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">pip install corsapi</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>配置SCHEMA_CLASS</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">'DEFAULT_SCHEMA_CLASS'</span>: <span class="string">'rest_framework.schemas.AutoSchema'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在主路由中注册使用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.decumentation <span class="keyword">import</span> include_docs_urls</span><br><span class="line"><span class="keyword">from</span> django.url <span class="keyword">import</span> path,include</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'docs/'</span>,include_docs_urls(title=<span class="string">'API管理页面'</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

</li>
</ol>
<p>创建成功之后的画面如下图:<img src="/fcg22450.github.io/img/interactive/1575621839123.png" alt="1575621839123"></p>
<p>在这里面,还有一些别的设置,如,在模型类中设置字段的提示属性 :</p>
<ul>
<li>help_text = ‘ ’</li>
</ul>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>axios</tag>
      </tags>
  </entry>
  <entry>
    <title>Django模板使用</title>
    <url>/Django/Django_id_17.html</url>
    <content><![CDATA[<h2 id="Django模板使用"><a href="#Django模板使用" class="headerlink" title="Django模板使用"></a>Django模板使用</h2><a id="more"></a>
<ol>
<li><pre><code>for foo in msg
    forloop.counter
endfor
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   - <span class="keyword">for</span>循环中可以使用forloop.counter获取当前循环的次数</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span></span><br></pre></td></tr></table></figure></div>
if books

else

endif
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AUTOIT"><figure class="iseeu highlight /autoit"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="number">1.</span> <span class="keyword">if</span>循环,包括<span class="keyword">elseif</span>与<span class="keyword">else</span></span><br><span class="line"></span><br><span class="line"><span class="meta">## 模板注释</span></span><br><span class="line"></span><br><span class="line">单行注释:</span><br></pre></td></tr></table></figure></div>
注释的内容
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MAKEFILE"><figure class="iseeu highlight /makefile"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">多行注释:</span></span><br></pre></td></tr></table></figure></div>
comment
注释的内容
endcomment
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 过滤器:</span><br><span class="line"></span><br><span class="line">1. default</span><br><span class="line"></span><br><span class="line">   - </span><br><span class="line"></span><br><span class="line">2. length</span><br><span class="line"></span><br><span class="line">   -  </span><br><span class="line"></span><br><span class="line">3. date</span><br><span class="line"></span><br><span class="line">   - 默认时间显示格式为美式</span><br><span class="line"></span><br><span class="line">   -</span><br></pre></td></tr></table></figure>
  dete:&apos;Y年-m月-d日&apos;
  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HAML"><figure class="iseeu highlight /haml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">-<span class="ruby"> 通过过滤器可以将时间格式转化为想要的状态</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">- safe,关闭自动转义</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">- autoescape标签关闭转义</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">  -</span></span><br></pre></td></tr></table></figure></div>
    autoescape
    模板内容
    endautoescape
    <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   - 模板硬编码不会进行转义</span><br><span class="line"></span><br><span class="line"><span class="comment">### 自定义过滤器:</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> ​	在应用下新建templatetags文件夹,此文件夹名为固定名称,不可自定义</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> ​        在文件夹中创建一个py文件用来存放自定义过滤器</span><br><span class="line"></span><br><span class="line">   - ```python</span><br><span class="line">     <span class="keyword">from</span> django.tempalte <span class="keyword">import</span> Library</span><br><span class="line">     <span class="comment">#创建一个实例化Library对象</span></span><br><span class="line">     register = Library()</span><br><span class="line">     </span><br><span class="line">     <span class="comment">#创建一个过滤器函数</span></span><br><span class="line"><span class="meta">     @register.filter</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">mod</span><span class="params">(num)</span>:</span></span><br><span class="line">         <span class="keyword">return</span> num %<span class="number">2</span> == <span class="number">0</span></span><br></pre></td></tr></table></figure></div></code></pre></li>
<li><p>在模板中导入这个过滤器文件</p>
<ul>
<li><pre><code>load filters
#在这里进行的模块导入只需要将过滤器文件的名字导入进去就可以直接进行使用了</code></pre></li>
</ul>
</li>
</ol>
<h3 id="一个坑"><a href="#一个坑" class="headerlink" title="一个坑:"></a>一个坑:</h3><p>​    自定义过滤器时,创建出来的library对象的名字必须是register</p>
<p>​    目前还不明白原因,但是使用了library之后会出现无法查询到filters模板的问题,</p>
<h4 id="自定义过滤器时最少需要有一个参数传入-最多两个"><a href="#自定义过滤器时最少需要有一个参数传入-最多两个" class="headerlink" title="自定义过滤器时最少需要有一个参数传入,最多两个"></a>自定义过滤器时最少需要有一个参数传入,最多两个</h4>]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>关于vue的一些问题</title>
    <url>/Vue/Vue_id_10.html</url>
    <content><![CDATA[<h2 id="踩坑记录"><a href="#踩坑记录" class="headerlink" title="踩坑记录"></a>踩坑记录</h2><a id="more"></a>
<h2 id="第一点"><a href="#第一点" class="headerlink" title="第一点"></a>第一点</h2><p>​    最初老师教的其实是2.0版本,相比起来,更加高端的vue/cli3的代码更加简洁高效,我也不知道为啥学校不叫最新的,反正当初这个坑是被我踩到了</p>
<p>​    这其中有着很多的问题,如缺少依赖包,缺少必备的代码库,林林总总的红色报错在当时直接把我惊呆了</p>
<p>​    因为在出问题之前,我一直是在使用webstorm进行代码的编写,webstorm是个很好的软件,基本上,只要你装好了环境,他就能帮你进行一系列的操作,但也正是这些,导致我压根没发现这些潜在的问题</p>
<p>​    事情的起因,是因为我的webstorm到期了……<img src="/fcg22450.github.io/img/interactive/1576150667489.png" alt="1576150667489"></p>
<p>​    这是一个悲伤的故事,我的电脑中安装了很多编辑器</p>
<p>​    包括webstorm,pycharm,codeblock,vscode,golang等等,也正是因为到期了,我便决定收拾一下vscode,将vue问价你放到vscode中去写</p>
<p>​    然后问题就出现了.</p>
<p>先是新建的vue文件无法显示,然后就是疯狂报错,到最后,我三个dos窗口全是红色,惨不忍睹</p>
<p>于是忍痛删掉了电脑中的vue插件,然后开始重新安装</p>
<p>以下是这两天安装的全部插件,不排除被我忘记的可能</p>
<ul>
<li><p>npm install @vue/cli -g –save</p>
</li>
<li><p>npm install axios</p>
</li>
<li><p>npm install stylus</p>
</li>
<li><p>npm install stylus-loader</p>
</li>
<li><p>npm install style-loader</p>
</li>
<li><p>npm install css-loader</p>
</li>
<li><p>npm install pug</p>
</li>
<li><p>npm install webpack</p>
</li>
<li><p>npm install cors-js</p>
</li>
<li><p>ps:更多的插件一时想不起来了.反正,凡是报错了的插件,我几乎全都下载了一遍</p>
</li>
<li><p>到现在,之前所有的错误提示全部消失,不仅如此,我发现最新版本的vue居然是4.0+???</p>
</li>
<li><p>WTF?</p>
</li>
<li><p>我之前用的可是2.6啊混蛋</p>
</li>
<li><p>难怪nanarino给我的项目那么简单,感情人家的已经是领先好几代了</p>
<p>临近考试了,本来以为这次考试稳了,现在看来,要是不赶紧摸清楚新版本的变化,恐怕这次要跪啊!</p>
<p>.</p>
</li>
</ul>
<hr>
<p>使用vue cli 4 的注意事项</p>
<ul>
<li>创建语句      vue create projects_name</li>
<li>下载模块      npm install models_name   -g –save</li>
<li>构建vue工程之后第一点就是重新下载axios与pug相关依赖,具体可以根据报错提示进行操作</li>
</ul>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django路由参数捕获</title>
    <url>/Django/Django_id_16.html</url>
    <content><![CDATA[<h2 id="URL参数捕获"><a href="#URL参数捕获" class="headerlink" title="URL参数捕获"></a>URL参数捕获</h2><ol>
<li><p>参数捕获的方法有两种</p>
<a id="more"></a>
<ul>
<li><p>位置参数传参</p>
<ul>
<li><p>使用一个正则表达式获取参数并传入视图函数中</p>
</li>
<li><pre><code class="python"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path,path

urlpatterns = [
    re_path(r’index/(\d+)‘,veiws.index),
]
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">- 关键字参数传参</span><br><span class="line"></span><br><span class="line">  - 使用关键字参数传参和位置参数是一样的,区别就是再正则表达式中给这个字段起一个别名</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    from django.urls import re_path,path</span><br><span class="line">    </span><br><span class="line">    urlpatterns = [</span><br><span class="line">    	re_path(r’index/(?P&lt;num&gt;\d+)‘,veiws.index),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>


</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django后台管理操作</title>
    <url>/Django/Django_id_15.html</url>
    <content><![CDATA[<h2 id="Django后台管理操作"><a href="#Django后台管理操作" class="headerlink" title="Django后台管理操作"></a>Django后台管理操作</h2><a id="more"></a>
<p>#后台管理系统为admin.py文件</p>
<h2 id="1-本地化"><a href="#1-本地化" class="headerlink" title="1).本地化"></a>1).本地化</h2><ul>
<li><p>​    修改语言格式</p>
<ul>
<li><p>修改为中文:zh-hans</p>
</li>
<li><pre><code class="python">LANGUAGE_CODE = <span class="string">'zh-hans'</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">- </span>​	修改时区</span><br><span class="line"></span><br><span class="line"><span class="bullet">  - </span>修改为中国时区</span><br><span class="line"></span><br><span class="line"><span class="bullet">  - </span>没有北京的时间,所以我们选择上海</span><br><span class="line"></span><br><span class="line"><span class="bullet">  - </span>Asia/shanghai</span><br><span class="line"></span><br><span class="line"><span class="bullet">  - </span><span class="code">```</span>python</span><br><span class="line"><span class="code">    TIME_ZONE = 'Asia/shanghai'</span></span><br></pre></td></tr></table></figure></div>
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="2-创建管理员"><a href="#2-创建管理员" class="headerlink" title="2).创建管理员"></a>2).创建管理员</h2><ul>
<li><p>创建超级管理员</p>
</li>
<li><pre><code>python manage.py createsuperuser
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 使用管理员帐号可以登入后台管理界面进行操作</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3).注册设定好的模型类</span></span><br><span class="line"></span><br><span class="line">- 在对应文件的amdin文件中注册模型类</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">HeroInfoAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">        list_display = [<span class="string">'hname'</span>, <span class="string">'hcomment'</span>, <span class="string">'hbook_id'</span>, <span class="string">'hbook_id'</span>]</span><br><span class="line">    <span class="comment">#在这里可以设定展示出来的字段总览</span></span><br><span class="line">    <span class="comment">#使用admin模块中的site.register进行注册</span></span><br><span class="line">    </span><br><span class="line">    admin.site.register(BookCateInfo,BookCateInfoAdmin)</span><br></pre></td></tr></table></figure></div></code></pre></li>
<li><p>在后台管理界面中想要将每一项数据库中的数据渲染出来需要在模型类中重写<strong>str</strong>方法</p>
<ul>
<li><pre><code class="python"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>
    <span class="keyword">return</span> self.btitle
<span class="comment">#重写str方法,会使这个表渲染在管理界面时的样式改变</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ELIXIR"><figure class="iseeu highlight /elixir"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 在数据库模型中设定方法</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">user</span></span>(<span class="keyword">self</span>)<span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> self.username</span><br><span class="line">    user.admin_order_field = <span class="string">'username'</span></span><br><span class="line">    <span class="comment">#为创建的方法字段添加排序属性</span></span><br><span class="line">    </span><br><span class="line">    user.short_description = <span class="string">'用户名'</span></span><br><span class="line">    <span class="comment">#为创建的方法附加一个别名用于展示</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>这个方法适用于自定义模型类的方法时使用</p>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="在注册模型类时可以添加的属性"><a href="#在注册模型类时可以添加的属性" class="headerlink" title="在注册模型类时可以添加的属性:"></a>在注册模型类时可以添加的属性:</h3><ul>
<li><p>list_display</p>
<ul>
<li>设定管理页面中娴熟的模型类字段</li>
<li>这个字段可以可以使用模型类中自定义好的方法</li>
</ul>
</li>
<li><p>list_per_page</p>
<ul>
<li>设定管理页面中每页显示的数据量</li>
<li>list_per_page = 10(每页展示十条数据)</li>
</ul>
</li>
<li><p>action_on_bottom</p>
<ul>
<li>设定下方的操作框</li>
<li><img src="/fcg22450.github.io/img/django/1574901352508.png" alt="1574901352508"></li>
<li>在action_on_bottom = True时,将会在展示页的下方再次增加一个操作框</li>
<li>底部操作框在不设定的时候默认为False</li>
</ul>
</li>
<li><p>action_on_top</p>
<ul>
<li>设定上方的操作框</li>
<li><img src="/fcg22450.github.io/img/django/1574901605253.png" alt="1574901605253"></li>
<li>在action_on_top = False时,将会取消展示页上方的操作框,</li>
<li>顶部操作框默认为True</li>
</ul>
</li>
<li><p>list_filter</p>
<ul>
<li><p>在页面右侧添加快速过滤选项,该选项遵循注册模型类时的约束进行</p>
</li>
<li><pre><code class="python">list_filter = [<span class="string">'username'</span>]
<span class="comment">#这个属性的参数是一个列表,可以在其中添加要过滤的字段名</span>
<span class="comment">#过滤器将会列出所有的字段名方便选择</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">- </span>search_fields</span><br><span class="line"></span><br><span class="line"><span class="bullet">  - </span>在页面顶部添加搜索框</span><br><span class="line"></span><br><span class="line"><span class="bullet">  - </span><span class="code">```</span>python</span><br><span class="line"><span class="code">    search_fields = ['username']</span></span><br><span class="line"><span class="code">    #这个属性的参数是一个列表,可以在其中添加字段</span></span><br><span class="line"><span class="code">    #在执行搜索时,将会在指定字段的数据中进行匹配</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li></li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django关闭debug模式之后的静态文件访问</title>
    <url>/Django/Django_id_14.html</url>
    <content><![CDATA[<h2 id="Django关闭debug模式之后的静态文件访问"><a href="#Django关闭debug模式之后的静态文件访问" class="headerlink" title="Django关闭debug模式之后的静态文件访问"></a>Django关闭debug模式之后的静态文件访问</h2><a id="more"></a>
<ol>
<li><pre><code>STATIC_URL = &apos;/static/&apos;
#配置默认的static静态文件夹位置
STATIC_ROOT = &apos;static&apos;
STATICFILES_DIRS = [
    os.path.join(BASE_DIR,&apos;/static/&apos;)
]
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   - ### 设置setting</span><br><span class="line"></span><br><span class="line">2. 设置url</span><br><span class="line"></span><br><span class="line">   1. ```.</span><br><span class="line">      <span class="keyword">from</span> django.views import static ##新增</span><br><span class="line">      <span class="keyword">from</span> django.conf import<span class="built_in"> settings </span>##新增</span><br><span class="line">      <span class="keyword">from</span> django.conf.urls import url ##新增</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      <span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">          url(r<span class="string">'^static/(?P&lt;path&gt;.*)$'</span>, static.serve,</span><br><span class="line">            &#123;<span class="string">'document_root'</span>: settings.STATIC_ROOT&#125;, <span class="attribute">name</span>=<span class="string">'static'</span>),</span><br></pre></td></tr></table></figure></div>

2. 固定公式可以直接使用</code></pre></li>
<li><p>模板中渲染</p>
<ol>
<li><pre><code>&lt;div id=&quot;box1&quot;&gt;&lt;img src=&quot;{% url 'static' path='logo/logo0.png' %}&quot; alt=&quot;&quot;&gt;&lt;/div&gt;</code></pre></li>
<li><p>使用url反转路由</p>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django反转url</title>
    <url>/Django/Django_id_13.html</url>
    <content><![CDATA[<h2 id="Django反转url"><a href="#Django反转url" class="headerlink" title="Django反转url"></a>Django反转url</h2><a id="more"></a>
<ol>
<li><h3 id="反转url"><a href="#反转url" class="headerlink" title="反转url:"></a>反转url:</h3><ol>
<li>使用模板语言url</li>
</ol>
</li>
</ol>
<ol start="2">
<li><p>在url定义中设定路由函数名</p>
<ul>
<li>path(‘index’,views.index,name=‘index’)</li>
</ul>
</li>
<li><p>关于应用注册的路由的反转使用</p>
<ol>
<li>注册应用路由时添加namespace<ul>
<li>path(‘’,include(‘besate’,namespace=‘basete’))</li>
</ul>
</li>
<li>在应用的urls文件中添加<ul>
<li>app_name = ‘besate’</li>
</ul>
</li>
<li>使用反转<ul>
<li>url ‘besate:index’</li>
</ul>
</li>
</ol>
</li>
<li><p>关于带参数的路由的反转编译</p>
<ol>
<li><pre><code>url ‘index’ 参数数值
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   位置参数</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span></span><br></pre></td></tr></table></figure></div>
url ‘index’ 参数名=参数数值
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="code">      命名参数</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">2. </span>在视图中进行反转url操作</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1. </span>导入模块</span><br><span class="line"></span><br><span class="line"><span class="bullet">      - </span>原始的方法是从另一个模块中导入,但是3.0中包含了这个模块</span><br><span class="line"></span><br><span class="line"><span class="bullet">      - </span>所以这个模块现在集成到了django.shortcuts中,只需要再导入render的时候顺便就可以一并导入进去了</span><br><span class="line"></span><br><span class="line"><span class="bullet">      - </span><span class="code">```</span>python</span><br><span class="line"><span class="code">        from django.shortcuts import render,reverse,redirect</span></span><br></pre></td></tr></table></figure></div></code></pre></li>
</ol>
</li>
<li><p>传入参数</p>
<ul>
<li>传入位置参数时<ul>
<li>reverse(‘three:index’,args=(1,2,3))</li>
</ul>
</li>
<li>传入命名参数时<ul>
<li>reverse(‘three:index’,kwargs={‘a’:1,‘b’:2})</li>
</ul>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django表单提交</title>
    <url>/Django/Django_id_12.html</url>
    <content><![CDATA[<h2 id="Django表单提交"><a href="#Django表单提交" class="headerlink" title="Django表单提交"></a>Django表单提交</h2><a id="more"></a>
<ul>
<li>Django表单数据提交涉及到视图函数中的request参数<ul>
<li>在django中, request对象封装了表单提交的数据</li>
<li><strong><u><em>request.GET</u></em></strong>中存储的是get方法提交的数据</li>
<li><strong><u><em>request.POST</u></em></strong>中存储的是post方法提交的数据</li>
</ul>
</li>
<li>这些方法使用get方法可以获取到对应的值,获取的名称为表单中提交的数据的名字</li>
<li>这些数据将会在提交之后自动储存到request中去</li>
</ul>
<h2 id="request其他方法"><a href="#request其他方法" class="headerlink" title="request其他方法:"></a>request其他方法:</h2><ul>
<li><p>get()</p>
<ul>
<li>获取request对象中储存的数据</li>
</ul>
</li>
<li><p>path</p>
<ul>
<li>获取当前访问的url地址</li>
</ul>
</li>
<li><p>method</p>
<ul>
<li>获取当前的访问方法</li>
</ul>
</li>
<li><p>POST</p>
<ul>
<li>存储所有使用post方法提交过来的数据</li>
</ul>
</li>
<li><p>GET</p>
<ul>
<li>存储所有使用get方法提交过来的数据</li>
</ul>
</li>
<li><p>FILES</p>
<ul>
<li>存储提交过来的文件对象</li>
</ul>
</li>
<li><p>COOKIES</p>
<ul>
<li>存储cookie信息</li>
</ul>
</li>
<li><p>session</p>
<ul>
<li><p>存储session信息</p>
</li>
<li><p>session使用方法</p>
<ol>
<li><p>直接使用字典的键值对获取方法</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session[<span class="string">'cookie名'</span>]</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>使用get方法获取,可以设置默认值</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.get(<span class="string">'cookie名,default="默认值")</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>clear,删除session中保存的数据,但是删除掉的只是值</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.clear()</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>flash,删除整条数据,完全删除所有数据,数据表完全清除</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.flash()</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>del    删除目标数据的所有内容</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">del</span> request.session[<span class="string">'cookie'</span>]</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>设置session过期时间</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.set_expiry(value)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>当没有设置过期时间的时候,默认将会在两周之后过期</li>
<li>当value值为0的时候,将会在关闭浏览器的时候过期</li>
<li>当value大于0的时候,将会在value秒之后过期</li>
</ul>
</li>
<li><p>has_key   判断session中有没有对应的cookie</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">request.session.has_key(<span class="string">'username'</span>)</span><br></pre></td></tr></table></figure></div>







</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="ajax方法提交数据"><a href="#ajax方法提交数据" class="headerlink" title="ajax方法提交数据"></a>ajax方法提交数据</h2><h3 id="ajax请求为异步请求"><a href="#ajax请求为异步请求" class="headerlink" title="ajax请求为异步请求"></a>ajax请求为异步请求</h3><p>async : true  </p>
<p>该选项默认为true,即异步请求</p>
<p>​    异步请求时优先执行其他的javascript代码,然后才会执行ajax请求的代码</p>
<p>设定为false即为同步请求</p>
<hr>
<p>使用ajax可以实现局部刷新</p>
<hr>
<ol>
<li><p>使用ajax方法提交数据</p>
<ul>
<li><pre><code class="javascript">$.ajax({
    <span class="string">'url'</span>:<span class="string">'/ajax_handle'</span>,
    <span class="string">'dataType'</span>:<span class="string">'json'</span>,
}).success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>{
    alert(data.res)
})
&lt;!--￼<span class="number">7</span>--&gt;</code></pre>
</li>
<li><p>上述为ajax信息处理函数</p>
</li>
<li><pre><code class="python">urlpatterns = [
    <span class="comment">#构建用于处理请求的网页url</span>
    path(<span class="string">'ajax_handle/'</span>,views.ajax_handle),
]
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">   - </span>以上就是基础的ajax请求构建</span><br><span class="line"></span><br><span class="line"><span class="bullet">   - </span>ajax请求禁止返回一个页面,返回的页面将会无法正常显示</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="bullet">1. </span>## 踩坑详情</span><br><span class="line"></span><br><span class="line">   -</span><br></pre></td></tr></table></figure></div>
APPEND_SLASH=<span class="literal">False</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HAML"><figure class="iseeu highlight /haml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  -<span class="ruby"> 踩坑第一条</span></span><br><span class="line"><span class="ruby">    - 使用ajax进行请求时无法绕过的一个坎,必须在settings配置文件之中配置这条数据才能继续进行下去,让人惊讶的是,教学视频之中居然没有提到这个问题,暂定为django版本过高导致的配置文件差异,从而出现的问题</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">-</span></span><br></pre></td></tr></table></figure></div>
$.ajax({
    <span class="string">'url'</span>:<span class="string">'/ajax_handle/'</span>,
    <span class="string">'type'</span>:<span class="string">'POST'</span>,
    <span class="string">'dataType'</span>:<span class="string">'json'</span>,
    <span class="string">'data'</span>:{
        username:username,
        password:password
    }
}).success(function (data) {
    <span class="keyword">if</span> (data.res == <span class="number">1</span>){
        location.href = <span class="string">'/admin/'</span>
    }<span class="keyword">else</span>{
        $(<span class="string">"#err"</span>).show().html(<span class="string">'账号名或密码错误'</span>)
    }
})</code></pre>
<ul>
<li><p>踩坑第二条</p>
<ul>
<li>在路由函数方面,django的路由设定比起flask更加严谨<ul>
<li>书写路由重定向时,如果你写的路由为”admin/“这样的格式<ul>
<li>​            那么最终请求的网址实际上为;</li>
<li>​            当前网页网址的路由后面加上你要跳转的路由<ul>
<li>​         即:    127.0.0.1:8000/login/admin</li>
</ul>
</li>
<li>在不添加前置/的情况下,默认为在当前网址的基础上再次进行路由访问</li>
</ul>
</li>
<li>无论是ajax里面的url请求地址,还是JavaScript基础上进行的重定向,都需要注意这一点</li>
<li>反之,如果在路由前面加上/,访问的界面实际上就是在最基础的127.0.0.1:8000/的基础上进行的路由访问</li>
</ul>
</li>
</ul>
</li>
<li><h2 id="这些坑需要谨记"><a href="#这些坑需要谨记" class="headerlink" title="这些坑需要谨记"></a>这些坑需要谨记</h2></li>
</ul>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django编辑页选项</title>
    <url>/Django/Django_id_11.html</url>
    <content><![CDATA[<h2 id="Django编辑页选项"><a href="#Django编辑页选项" class="headerlink" title="Django编辑页选项"></a>Django编辑页选项</h2><a id="more"></a>
<ol>
<li><h3 id="设定编辑页数据显示"><a href="#设定编辑页数据显示" class="headerlink" title="设定编辑页数据显示"></a>设定编辑页数据显示</h3><ul>
<li><p>设定显示顺序     fields</p>
<ul>
<li><p>这个属性的值是一个字典,字典中将编辑页面的字段按照想要的顺序排列好</p>
</li>
<li><pre><code class="python">fields = [<span class="string">'username'</span>,<span class="string">'password'</span>]
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 设定显示顺序,这个设定是分块设定,即将编辑页分为几个块       fieldsets</span><br><span class="line"></span><br><span class="line">  - 这个属性的值是一个元组,元组中包含着元组,并按照里面的元组分成块</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    fieldsets = (</span><br><span class="line">    	('名字',&#123;'fields':['username']&#125;),</span><br><span class="line">        <span class="meta">#设定块时,元组的第一个值是这个块的名称,第二个值是一个字典,键为   fields  ,值为一个列表,其中保存的是要展示在这个块中的字段</span></span><br><span class="line">        ('密码',&#123;'fields':['password']&#125;)</span><br><span class="line">        <span class="meta">#无论如何设定,遵循基本的规则,字典的键都是fields,值都是一个列表</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure></code></pre>
</li>
</ul>
</li>
<li><p>设定一类模型编辑时显示字类模型数据</p>
<ul>
<li><p>第一种:</p>
<ul>
<li><pre><code class="python"><span class="class"><span class="keyword">class</span> <span class="title">Power_list_StackedInline</span><span class="params">(admin.StackedInline)</span>:</span>
    model = Basic_information_of_characters
    <span class="comment">#model属性的值为这个表对应的多类表的对象</span>
    extra = <span class="number">3</span>
    <span class="comment">#在显示子类的时候留三个空白的字类方便添加和编辑</span>

<span class="comment">#将这个类在模型类约束中引入</span>
Inlines = [Power_list_StackedInline]
<span class="comment">#inlines属性的值是一个列表</span>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">  - </span>这个类设定的是显示结果是将对应的子类数据划分为一个个的块</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>第二种</span><br><span class="line"></span><br><span class="line"><span class="bullet">  - </span><span class="code">```</span>python</span><br><span class="line"><span class="code">    class Power_list_TabularInline(admin.TabularInline):</span></span><br><span class="line"><span class="code">    	model = Basic_information_of_characters</span></span><br><span class="line"><span class="code">    	extra = 3</span></span><br></pre></td></tr></table></figure></div></code></pre>
</li>
<li><p>从设定方法和使用方法来说,和第一种方法没什么两样,唯一的区别就是继承的对象不一样</p>
</li>
<li><p>这个方法展示出来的子类是以表格形式展示出来的</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>ORM框架</title>
    <url>/Django/Django_id_25.html</url>
    <content><![CDATA[<h2 id="ORM框架"><a href="#ORM框架" class="headerlink" title="ORM框架"></a>ORM框架</h2><h3 id="orm的全称"><a href="#orm的全称" class="headerlink" title="orm的全称:"></a>orm的全称:</h3><ul>
<li>​    O <ul>
<li>object</li>
<li>对象</li>
<li>在models.py中涉及模型类,</li>
</ul>
</li>
<li>​        R<ul>
<li>Relations</li>
<li>关系,用于关系数据库中的表</li>
</ul>
</li>
<li>​        M<ul>
<li>Mapping</li>
<li>(数据库)映射</li>
<li>将对数据库的操作映射到数据库中去</li>
</ul>
</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django元选项</title>
    <url>/Django/Django_id_21.html</url>
    <content><![CDATA[<h2 id="元类"><a href="#元类" class="headerlink" title="元类"></a>元类</h2><a id="more"></a>
<h3 id="通过在模型类中定义元类来对创建好的数据库表进行约束-以确保生成的数据表不依赖于应用文件的名字"><a href="#通过在模型类中定义元类来对创建好的数据库表进行约束-以确保生成的数据表不依赖于应用文件的名字" class="headerlink" title="通过在模型类中定义元类来对创建好的数据库表进行约束,以确保生成的数据表不依赖于应用文件的名字"></a>通过在模型类中定义元类来对创建好的数据库表进行约束,以确保生成的数据表不依赖于应用文件的名字</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfo</span><span class="params">(models.Manager)</span>:</span></span><br><span class="line">    btitle = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'bookinfo'</span></span><br></pre></td></tr></table></figure></div>

<h4 id="定义元类Meta-设定好创建的数据库的名字之后-执行数据库迁移"><a href="#定义元类Meta-设定好创建的数据库的名字之后-执行数据库迁移" class="headerlink" title="定义元类Meta,设定好创建的数据库的名字之后,执行数据库迁移"></a>定义元类Meta,设定好创建的数据库的名字之后,执行数据库迁移</h4><h4 id="产生的数据库名字将不会安装应用名-模型类名的规则进行创建"><a href="#产生的数据库名字将不会安装应用名-模型类名的规则进行创建" class="headerlink" title="产生的数据库名字将不会安装应用名_模型类名的规则进行创建"></a>产生的数据库名字将不会安装应用名_模型类名的规则进行创建</h4><h2 id="模板错误试图"><a href="#模板错误试图" class="headerlink" title="模板错误试图:"></a>模板错误试图:</h2><h3 id="调试模式"><a href="#调试模式" class="headerlink" title="调试模式:"></a>调试模式:</h3><ul>
<li><p>​    在网站上线时,应关闭DE_BUG模式,该选项在setting文件中进行配置,默认为true</p>
<p>​        默认选项</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = []</span><br></pre></td></tr></table></figure></div>

<p>​        修改选项</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'*'</span>]</span><br></pre></td></tr></table></figure></div>

</li>
</ul>
<p>​    ALLOWED_HOSTS选项设定的是允许访问的IP地址,一般默认设置为*,即允许所有</p>
<ul>
<li>​    错误访问视图<ul>
<li>当出现错误请求或者服务器异常时,我们可以对从异常操作的响应进行,如自定义错误页面</li>
<li>常见的错误有404(页面不存在)、500(服务器错误)</li>
<li>自定义错误访问视图需要在templates模板文件夹下创建错误访问模板,文件名为对应的http状态码,</li>
<li>如: 404.html</li>
<li>错误试图的定义需要关闭debug模式</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>关于mvc</title>
    <url>/Django/Django_id_24.html</url>
    <content><![CDATA[<h2 id="web设计模式"><a href="#web设计模式" class="headerlink" title="==web设计模式=="></a>==web设计模式==</h2><h2 id="—web-mvc—"><a href="#—web-mvc—" class="headerlink" title="—web mvc—"></a>—web mvc—</h2><h4 id="mvc基本概念"><a href="#mvc基本概念" class="headerlink" title="mvc基本概念:"></a>mvc基本概念:</h4><a id="more"></a>
<ol>
<li>​    mvc的产生理念是: ==分工==</li>
<li>​        mvc的核心理念是:  解耦<ol>
<li>解耦的概念并不难理解,将mvc当成一台电脑,如果你的硬盘出了问题,那么你并不需要将整台电脑换掉,只需要找到损坏的硬盘并将其替换更新即可</li>
<li>同理,在mvc类型的框架中,如果代码出现了问题,只需要修正对应部分的代码即可,并不需要将所有的代码推翻重来</li>
<li>在这种情况下,只要所属模块实现了需要的功能,整个框架就是可以运行的</li>
</ol>
</li>
<li>​        mvc的组成概念相当于正常的公司,旗下有多个下属的职能部门,</li>
<li>​        同理,mvc的概念是就是将多个模块集成起来分工合作,将输入,处理输出三个部分的功能交给不同的模块进行.</li>
<li>mvc为简称<ol>
<li>model<ol>
<li>模型,</li>
<li>用于后端与数据库进行交互</li>
</ol>
</li>
<li>view<ol>
<li>视图</li>
<li>用于前端,负责产生html页面</li>
</ol>
</li>
<li>controller<ol>
<li>控制器</li>
<li>接受请求,进行处理,负责model与view进行交互,并返回应答</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="/fcg22450.github.io/img/django/1573521257195.png" alt="1573521257195"></p>
<hr>
<h2 id="—python-MVT—"><a href="#—python-MVT—" class="headerlink" title="—python MVT—"></a>—python MVT—</h2><h4 id="MVT基本概念"><a href="#MVT基本概念" class="headerlink" title="MVT基本概念:"></a>MVT基本概念:</h4><ol>
<li>MVT其实是基于mvc的生产模式,只是在==Django==中因为模块的少许差异简写为MVT</li>
<li>MVT是简写,全程为:         model(模型) —–&gt;   view(视图)  —–&gt;   template(模板)</li>
<li><img src="/fcg22450.github.io/img/django/1573525796015.png" alt="1573525796015"></li>
<li>MVT为简称<ol>
<li>model<ol>
<li>模型,</li>
<li>用于后端与数据库进行交互</li>
</ol>
</li>
<li>views<ol>
<li>相当于mvc中的c,</li>
<li>用于m,t交互,处理信息,并返回应答</li>
<li>控制器</li>
<li>接受请求,进行处理,负责model与template进行交互,并返回应答</li>
</ol>
</li>
<li>template<ol>
<li>相当于mvc中的v,</li>
<li>接受信息,负责产生html页面</li>
</ol>
</li>
</ol>
</li>
</ol>
<hr>
<h2 id="快速开发和DRY原则"><a href="#快速开发和DRY原则" class="headerlink" title="快速开发和DRY原则"></a>快速开发和DRY原则</h2><h3 id="Do-not-repeat-yourself"><a href="#Do-not-repeat-yourself" class="headerlink" title="Do not repeat yourself"></a>Do not repeat yourself</h3><p>不要自己去重复一些工作</p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Django首次使用</title>
    <url>/Django/Django_id_20.html</url>
    <content><![CDATA[<h2 id="Django首次使用"><a href="#Django首次使用" class="headerlink" title="Django首次使用"></a>Django首次使用</h2><a id="more"></a>
<p>创建django项目:</p>
<h4 id="django-admin-startproect-项目名"><a href="#django-admin-startproect-项目名" class="headerlink" title="django-admin startproect 项目名"></a>django-admin startproect 项目名</h4><p>创建一个完整的django项目</p>
<h2 id="创建完整的django文件之后会生成一整套的文件-里面包含了django的各种配置"><a href="#创建完整的django文件之后会生成一整套的文件-里面包含了django的各种配置" class="headerlink" title="创建完整的django文件之后会生成一整套的文件,里面包含了django的各种配置:"></a>创建完整的django文件之后会生成一整套的文件,里面包含了django的各种配置:</h2><ol>
<li>‘<strong>init</strong>.py’        声明这是一个python文件</li>
<li>settings.py           整个项目的配置文件</li>
<li>urls.py                  url路由的配置</li>
<li>wsgi.py                web服务器与django交互入口</li>
<li>manage.py          项目管理文件</li>
</ol>
<hr>
<h2 id="此处错误问题"><a href="#此处错误问题" class="headerlink" title="此处错误问题:"></a>此处错误问题:</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> version &lt; (<span class="number">1</span>, <span class="number">3</span>, <span class="number">13</span>):</span><br><span class="line">    <span class="keyword">raise</span> ImproperlyConfigured(<span class="string">'mysqlclient 1.3.13 or newer is required; you have %s.'</span> % Database.__version__)</span><br></pre></td></tr></table></figure></div>



<ul>
<li><h4 id="提示版本错误-这一点需要将base-py文件中的报错代码注释掉-使其不会因为自身的mysqlclient版本过高导致报错"><a href="#提示版本错误-这一点需要将base-py文件中的报错代码注释掉-使其不会因为自身的mysqlclient版本过高导致报错" class="headerlink" title="提示版本错误,这一点需要将base.py文件中的报错代码注释掉,使其不会因为自身的mysqlclient版本过高导致报错"></a>提示版本错误,这一点需要将base.py文件中的报错代码注释掉,使其不会因为自身的mysqlclient版本过高导致报错</h4></li>
<li><p>第二处错误为MySQLdb不存在</p>
<ul>
<li><p>解决办法</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>打开项目中的init配置文件,在其中导入以上代码</p>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="django开发时每个模块都需要创建一个应用来实现"><a href="#django开发时每个模块都需要创建一个应用来实现" class="headerlink" title="django开发时每个模块都需要创建一个应用来实现:"></a>django开发时每个模块都需要创建一个应用来实现:</h2><ol>
<li><p>创建应用的方法:</p>
<ol>
<li><p>实例图片</p>
<ol>
<li><img src="/fcg22450.github.io/img/django/1573529761495.png" alt="1573529761495"></li>
<li><img src="/fcg22450.github.io/img/django/1573529772029.png" alt="1573529772029"></li>
</ol>
</li>
<li><pre><code class="python"><span class="comment">#进入项目文件</span>
<span class="comment">#打开cmd命令窗口</span>
<span class="comment">#输入指令</span>
python manage.py startapp 要创建的应用名称
<span class="comment">#创建完成之后,将会自动生成一个应用文件夹,文件夹名字为创建时输入的名字,文件夹中包含各种初始化的配置文件</span>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">2. 配置文件详解:</span><br><span class="line"></span><br><span class="line">   1. '__init__.py'		声明这是一个python文件</span><br><span class="line">   2. models.py           与数据库相关的内容</span><br><span class="line">   3. views                   接受请求,进行处理,与models/template进行交互,返回应答</span><br><span class="line">      1. 定义处理函数</span><br><span class="line">      2. 每一个请求都对应着一个处理函数</span><br><span class="line">   4. tests.py                写测试代码的文件</span><br><span class="line">   5. admin.py             网站后台管理相关文件</span><br><span class="line"></span><br><span class="line">3. 启动django服务器服务</span><br><span class="line"></span><br><span class="line">   1. 在setting.py文件中注册模块信息</span><br><span class="line"></span><br><span class="line">   2. ```python</span><br><span class="line">      INSTALLED_APPS = [</span><br><span class="line">          'django.contrib.admin',</span><br><span class="line">          'django.contrib.auth',</span><br><span class="line">          'django.contrib.contenttypes',</span><br><span class="line">          'django.contrib.sessions',</span><br><span class="line">          'django.contrib.messages',</span><br><span class="line">          'django.contrib.staticfiles',</span><br><span class="line">          'First',</span><br><span class="line">      ]</span><br></pre></td></tr></table></figure>


</code></pre>
</li>
</ol>
</li>
</ol>
<ol start="3">
<li><pre><code>python manage.py runserver</code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
</search>
